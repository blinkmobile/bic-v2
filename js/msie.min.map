{"version":3,"file":"msie.min.js","sources":["vendor/phpjs-2011-09.js","msie.js","main.js","lib/Object.create.js","vendor/jshashtable-2.1.js","../bower_components/underscore/underscore.js","../bower_components/es5-shim/es5-shim.js","../bower_components/jquery-migrate/jquery-migrate.js","lib/bmp-blobs.js","lib/Modernizr-tests.js","lib/utilities.js","lib/BlinkDispatch.js","lib/BMP.js","lib/BMP.BIC.Config.js","lib/BlinkStorage.js","../bower_components/history.js/scripts/bundled-uncompressed/html4+html5/jquery.history.js","lib/maps.js"],"names":["explode","delimiter","string","limit","emptyArray","arguments","length","splitted","toString","split","partA","splice","partB","join","push","utf8_encode","argString","start","end","utftext","stringl","n","c1","charCodeAt","enc","String","fromCharCode","slice","sha1","str","blockstart","i","j","A","B","C","D","E","temp","rotate_left","s","t4","cvt_hex","val","v","W","Array","H0","H1","H2","H3","H4","this","str_len","word_array","toLowerCase","urldecode","decodeURIComponent","replace","parse_url","component","o","strictMode","key","q","name","parser","strict","loose","m","exec","uri","protocol","host","port","user","password","path","query","anchor","retArr","scheme","pass","fragment","parse_str","array","glue1","glue2","array2","chr","tmp","value","bracket","keys","evalStr","that","fixStr","window","charAt","substr","indexOf","eval","htmlspecialchars","quote_style","charset","double_encode","optTemp","noquotes","OPTS","ENT_NOQUOTES","ENT_HTML_QUOTE_SINGLE","ENT_HTML_QUOTE_DOUBLE","ENT_COMPAT","ENT_QUOTES","ENT_IGNORE","concat","htmlspecialchars_decode","setlocale","category","locale","categ","cats","d","document","_copy","orig","RegExp","Date","newObj","_nplurals2a","_nplurals2b","php_js","phpjs","locales","en","LC_COLLATE","str1","str2","LC_CTYPE","an","al","ct","dg","gr","lw","pr","pu","sp","up","xd","CODESET","lower","upper","LC_TIME","a","b","c","p","P","r","x","X","alt_digits","ERA","ERA_YEAR","ERA_D_T_FMT","ERA_D_FMT","ERA_T_FMT","LC_MONETARY","int_curr_symbol","currency_symbol","mon_decimal_point","mon_thousands_sep","mon_grouping","positive_sign","negative_sign","int_frac_digits","frac_digits","p_cs_precedes","p_sep_by_space","n_cs_precedes","n_sep_by_space","p_sign_posn","n_sign_posn","LC_NUMERIC","decimal_point","thousands_sep","grouping","LC_MESSAGES","YESEXPR","NOEXPR","YESSTR","NOSTR","nplurals","en_US","en_GB","en_AU","fr","fr_CA","NS_XHTML","NS_XML","getElementsByTagNameNS","getAttributeNS","getElementsByTagName","lang","localeCategories","getenv","Object","prototype","call","strftime","fmt","timestamp","_xPad","pad","parseInt","lc_time","_formats","getDay","getMonth","getFullYear","e","g","G","y","V","H","I","getHours","ms","getTimezoneOffset","doy","k","l","M","parse","S","u","dow","U","rdow","woy","dow1_1","idow","w","Y","z","Math","abs","Z","%","_date","_aggregates","F","h","R","t","T","match","m0","m1","f","init_device","$activityIndicator","$","log","deviceVars","scrollProperty","scrollValue","$navBar","activityIndicatorTop","floor","height","css","addClass","isCameraPresent","test","isBlinkGapDevice","info","device","camerapresent","triggerScroll","trigger","insertHTML","element","html","type","MyAnswers","dispatch","add","off","siteVars","fixImages","on","insertText","text","setMainLabel","label","mainLabel","getElementById","deserialize","argsString","args","result","each","index","equalIndex","substring","getURLParameters","matches","href","location","parameters","regexp","answerSpace","keyword","isAJAXError","status","populateDataTags","$element","data","hasOwnProperty","attr","processBlinkAnswerMessage","message","iLength","isPersist","persistentStorage","parseJSON","mojotarget","mojoxml","store","set","mojodelete","remove","startype","starsProfile","clearstars","staroff","staron","JSON","stringify","resolveItemName","level","prefix","list","lLength","id","isNaN","config","decodeURI","map","pertinent","performXSLT","xmlString","xslString","deferred","Deferred","dfrd","xml","xsl","processor","ActiveXObject","reject","parseXML","XSLTProcessor","importStylesheet","transformToFragment","transformNode","xsltProcess","resolve","promise","isHome","siteStructure","currentView","first","generateMojoAnswer","currentConfig","placeholders","pLength","variable","condition","starType","dfrdXml","starDetailFn","detail","conditionStarFn","star","mojoType","details","setTimeout","when","getActiveFormsXML","always","formsXml","get","state","done","fail","pendingStore","pendingV1Store","then","keysV1","promises","keysFn","version","dfrdSummary","keyParts","interaction","displayName","form","uuid","record","json","metadata","fields","field","whenArray","setSubmitCachedFormButton","$button","countPendingForms","hide","count","buttonText","show","onStarClick","date","hasClass","removeClass","isEmptyObject","toUpperCase","time","getTime","onLinkClick","event","parts","attributes","isUnique","isPushState","title","url","tagHTML","trim","style","History","getState","pushState","replaceState","preventDefault","onclick","back","home","login","_submitStarsType","_submitStarsPost","param","currentMasterCategory","currentCategory","mastercategory","_timestamp","now","error","size2","size1","pushPendingForm","clearPendingForm","pushPendingFormV1","clearPendingFormV1","requestMoJO","mojo","requestData","_id","_m","_lc","isOnline","ajax","dataType","complete","jqxhr","responseText","timeout","max","downloadTimeout","computeTimeout","processMoJOs","deferredFetches","interactions","mojos","maximumAge","min","minimumAge","goBackToHome","$body","showLoginView","requestUri","$view","loginAccess","isCustomLogin","loginPromptInteraction","BMP","alert","MyAnswersDevice","prepareView","showView","updateLoginButtons","loginStatus","loginButton","logoutButton","submitLogoutFn","loginUseInteractions","confirm","cache","_a","xhr","loginAccount","isLoggedIn","reload","hasLogin","$loginStatus","username","empty","append","undefined","populateItemListing","requestLoginStatus","xhrStatus","submitLogin","find","serializeArray","textstatus","requestConfig","processConfig","updateNavigationButtons","helpContents","isHelp","isNoNavBar","dfrdForms","$navBars","$navButtons","$helpButton","$formsButton","isLogin","isNoNavButtons","isEmptySpace","isLoginOnly","currentInteraction","help","removeAttr","formsCount","prop","dfrdMoJOs","sideBar","update","initialiseAnswerFeatures","oldLoginStatus","current","prompt","loginToDefaultScreen","gotoDefaultScreen","$inputs","$form","isGoogleJSLoaded","google","maps","Map","$div","replaceWith","setupGoogleMaps","dfrdGoogleMaps","getCachedScript","_Blink","cfg","GOOGLE_API_KEY","onGoogleMapsLoad","formsDeferred","BlinkForms","initialiseForm","apply","updateCurrentConfig","object","configs","features","_","clone","isRotating","inArray","isFeatureMatch","options","oLength","isSetPresent","isOptionPresent","sets","sLength","sortOverrides","override","pushConfig","without","orientation","overrides","isSimple","isObject","sortBy","extend","logoBanner","cdnu","getURL","splashImage","icon","$banner","$image","imageSrc","$footer","footer","footerPosition","position","bottom","z-index","$style","styleSheet","interfaceStyle","backgroundStyle","inputPromptStyle","evenRowStyle","oddRowStyle","headerStyle","footerStyle","masterCategoriesStyle","categoriesStyle","interactionsStyle","cssText","last","showMasterCategoriesView","reverse","goBackToMasterCategoriesView","showCategoriesView","masterCategory","hasMasterCategories","goBackToCategoriesView","processFormsMap","$xml","objectId","eachElement","jQuery","children","processForms","BlinkDispatch","ajaxDeferred","libraryDeferred","validActions","formActionFn","$action","action","tag","storeKey","$children","cLength","stringifyDOM","warn","isDebug","formObjectFn","$formObject","forms","BlinkFormObject","BlinkFormElement","$data","masterCategories","hasCategories","categories","hasInteractions","answerSpaceOneKeyword","loginStatusInteraction","registeredOnly","items","siteStore","AnswerSpaceCDN","cdnLocation","deviceFeatures","gotoStorageView","activeFormsUseInteraction","activeFormsInteraction","storage","showPendingView","$box","$section","$sectionV1","$noMessage","$summary","$template","$entry","appendTo","createParamsAndArgs","keywordID","returnValue","encodeURIComponent","argElements","inputPrompt","checked","noop","encodeURI","showAnswerView","$answerBox","answerBox","completeFn","isLocalXSLT","disableXSLT","open","hyperlink","hyperlinkTarget","blinkFormObjectName","blinkFormAction","answerUrl","asn","iact","fallbackToStorage","postData","starsData","method","bLength","blinkAnswerMessage","getAnswer","showKeywordView","argsBox","goBackToKeywordView","gotoNextScreen","showSecondLevelAnswerView","arg0","showKeywordListView","prepareHistorySideBar","goBackToKeywordListView","showHelpView","helpBox","goBackToTopLevelAnswerView","submitFormWithRetry","arr","localKeyword","uploadTimeout","submitForm","submitAction","requestUrl","serializedProfile","$submits","sessionInput","formData","serialize","create","properties","Type","TypeError","Hashtable","hashObject","obj","hashCode","FUNCTION","ex","equals_fixedValueHasEquals","fixedValue","variableValue","equals","equals_fixedValueNoEquals","createKeyValCheck","kvStr","kv","Error","Bucket","hash","firstKey","firstValue","equalityFunction","entries","addEntry","getEqualityFunction","createBucketSearcher","mode","entry","EXISTENCE","ENTRY","ENTRY_INDEX_AND_VALUE","createBucketLister","entryProperty","aggregatedArr","startIndex","len","searchBuckets","buckets","bucket","getBucketForHash","bucketsByHash","hashingFunctionParam","equalityFunctionParam","hashingFunction","put","checkKey","checkValue","bucketEntry","oldValue","getEntryForKey","containsKey","bucketKey","containsValue","clear","isEmpty","createBucketAggregator","bucketFuncName","aggregated","values","bucketIndex","removeEntryForKey","arrayRemoveAt","size","total","callback","putAll","hashtable","conflictCallback","thisValue","hasConflictCallback","idx","itemsAfterDeleted","searchValue","getEntryAndIndexForKey","getEntries","root","previousUnderscore","breaker","ArrayProto","ObjProto","FuncProto","Function","nativeForEach","forEach","nativeMap","nativeReduce","reduce","nativeReduceRight","reduceRight","nativeFilter","filter","nativeEvery","every","nativeSome","some","nativeIndexOf","nativeLastIndexOf","lastIndexOf","nativeIsArray","isArray","nativeKeys","nativeBind","bind","_wrapped","exports","module","VERSION","iterator","context","collect","results","reduceError","foldl","inject","memo","initial","foldr","detect","any","select","all","identity","contains","include","target","invoke","isFunc","isFunction","pluck","where","attrs","findWhere","Infinity","computed","shuffle","rand","shuffled","random","sample","guard","lookupIterator","criteria","sort","left","right","group","behavior","groupBy","has","indexBy","countBy","sortedIndex","low","high","mid","toArray","head","take","rest","tail","drop","compact","flatten","input","shallow","output","isArguments","difference","uniq","unique","isSorted","seen","union","intersection","item","other","zip","from","hasIndex","range","stop","step","ceil","ctor","func","bound","self","partial","bindAll","funcs","memoize","hasher","delay","wait","defer","throttle","previous","later","leading","remaining","clearTimeout","trailing","debounce","immediate","callNow","once","ran","wrap","wrapper","compose","after","times","pairs","invert","functions","methods","names","source","pick","copy","omit","defaults","tap","interceptor","eq","aStack","bStack","className","global","multiline","ignoreCase","aCtor","constructor","bCtor","pop","isEqual","isString","isElement","nodeType","isFinite","parseFloat","isNumber","isBoolean","isNull","isUndefined","noConflict","accum","entityMap","escape","&","<",">","\"","'","unescape","entityRegexes","property","mixin","idCounter","uniqueId","templateSettings","evaluate","interpolate","noMatch","escapes","\\","\r","\n","\t"," "," ","escaper","template","settings","render","matcher","offset","chain","_chain","factory","define","amd","returnExports","Empty","toInteger","isPrimitive","toPrimitive","valueOf","toStr","prototypeOfArray","prototypeOfObject","_Array_slice_","array_splice","array_unshift","unshift","_toString","isRegex","isArgs","callee","binder","boundLength","boundArgs","defineGetter","defineSetter","lookupGetter","lookupSetter","supportsAccessors","owns","__defineGetter__","__defineSetter__","__lookupGetter__","__lookupSetter__","spliceWorksWithEmptyObject","omittingSecondSpliceArgIsNoop","spliceNoopReturnsEmptyArray","deleteCount","boxedString","splitString","properlyBoxesContext","properlyBoxesNonStrict","properlyBoxesStrict","__","fun","toObject","thisp","reduceCoercesToObject","___","reduceRightCoercesToObject","sought","keysWorksWithArguments","originalKeys","hasDontEnumBug","propertyIsEnumerable","hasProtoEnumBug","dontEnums","dontEnumsLength","isFn","theKeys","skipProto","skipConstructor","dontEnum","negativeDate","negativeYearString","toISOString","year","month","RangeError","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","getUTCMilliseconds","dateToJSONIsSupported","toJSON","NaN","toISO","tv","supportsExtendedYears","acceptsInvalidDates","doesNotParseY2KNewYear","NativeDate","dayFromMonth","months","toUTC","Number","isoDateExpression","UTC","day","hour","minute","second","millisecond","isLocalTime","Boolean","signOffset","hourOffset","minuteOffset","toFixed","multiply","base","divide","numToString","pow","acc","fractionDigits","string_split","compliantExecNpcg","separator","separator2","lastIndex","lastLength","flags","extended","sticky","lastLastIndex","ToUint32","str_replace","replaceReportsGroupsCorrectly","groups","replaceValue","hasCapturingGroups","wrappedReplaceValue","originalLastIndex","string_substr","ws","zeroWidth","trimBeginRegexp","trimEndRegexp","origParseInt","hexRegex","radix","migrateWarn","msg","console","warnedAbout","migrateWarnings","migrateMute","migrateTrace","trace","migrateWarnProp","defineProperty","configurable","enumerable","newValue","err","_definePropertyBroken","migrateReset","compatMode","attrFn","oldAttr","valueAttrGet","attrHooks","valueAttrSet","rnoType","rnoAttrNodeType","rboolean","ruseDefault","elem","lowerName","nType","fn","nodeName","parentNode","attrNode","getAttributeNode","nodeValue","propName","propFix","setAttribute","matched","browser","oldInit","init","oldParseJSON","rquickExpr","selector","rootjQuery","isPlainObject","parseHTML","uaMatch","ua","navigator","userAgent","chrome","webkit","safari","sub","jQuerySub","superclass","rootjQuerySub","ajaxSetup","converters","text json","oldFnData","ret","evt","_data","rscriptType","oldSelf","andSelf","addBack","clean","elems","scripts","ownerDocument","handleScript","jsTags","merge","buildFragment","childNodes","removeChild","appendChild","grep","eventAdd","eventRemove","eventTrigger","oldToggle","toggle","oldLive","live","oldDie","die","ajaxEvents","rajaxEvent","rhoverHack","hoverHack","events","special","hover","props","types","handler","mappedTypes","triggerHandler","fn2","guid","toggler","lastToggle","click","onlyHandlers","setup","teardown","generateUUID","URL","blobs","createObjectURL","blob","autoRevoke","revokeObjectURL","retrieveObject","revokeAllObjectURLs","MIME","TEXT_TYPES","isText","Blob","NestedBlob","convertArrayBufferToBase64","isConstructableBlob","buffer","binary","bytes","Uint8Array","byteLength","btoa","datum","base64","createNative","builder","BlobBuilder","getBlob","fromBlobURL","onSuccess","onError","nativelyFromBlobURL","fromNativeBlob","FileReader","onload","fromDataURI","onerror","readAsDataURL","dataURI","encoding","atob","makeNested","XMLHttpRequest","onreadystatechange","mime","serializer","readyState","DONE","getResponseHeader","responseType","response","XMLSerializer","serializeToString","send","isNested","undoNested","toNative","image","canvas","ctx","Modernizr","addTest","File","FileList","createElement","fake","body","documentElement","oldCssText","scrollTo","top","getBoundingClientRect","XPathResult","DOMParser","parseFromString","ignore","singleNodeValue","outerFragment","innerFragment","createDocumentFragment","inputtypes","file","dummy","isAndroid","isEclair","disabled","number","$number","checkValidity","Image","getContext","drawImage","toDataURL","src","PhoneGap","Device","messageLength","lowestTransferRateConst","$document","early","history","fns","initialise","debug","waitForBlinkGap","available","makeArray","isBlinkGap","hasEntities","repeat","occurrences","oldRound","round","decimals","order","chars","CHARS","hasProperties","_oldAttr","_show","isPromise","pipe","progress","isDeferred","notify","notifyWith","rejectWith","resolveWith","attribute","isHidden","display","tagName","$this","resolveTimeout","shift","appendWithCheck","attempts","needle","childrenAsProperties","_SERVER","PREFIX_GZ","SUFFIX_GZ","PREFIX","SUFFIX","GZ_TYPES","PlatformCDN","isAppCache","isSecure","applicationCache","CDN_PLATFORM","HTTP_ACCEPT_ENCODING","extension","cdn","basename","answerSpaceDefaults","getCDN","ROOT","CDN_USER","suffix","ln","preloadPage","iframeWindow","$iframe","checkCountdown","onReadyFn","testReadyFn","width","contentWindow","isWindow","node","xmlSerializer","hasFontFor","char","$target","$test","me","innerWidth","cdnp","interval","processQueue","isPaused","queue","poke","pause","resume","$dialog","putDialog","hasjQueryUI","hasjQueryMobile","bindQueue","$doc","nav","showDialog","jquery","jQueryUI","dialog","modal","closeOnEscape","mobile","alertNoQueue","dismissedFn","n10n","notification","ok","buttons","close","confirmNoQueue","cancel","isRejected","isResolved","promptNoQueue","next","dequeue","BIC","Config","toCameraOptions","cameraOpts","imageCaptureQuality","quality","imageCaptureScale","imageScale","cameraOptions","estimatedSizeMbs","estimatedSize","errorHandler","openSection","openWebSQL","webSqlDbs","logger","BlinkStorage","partition","section","sql","db","memory","readyDeferred","ready","localStorage","sessionStorage","getItem","setItem","removeItem","found","sqlitePlugin","arg1","arg2","sqlError","executeSql","code","transaction","tx","openDatabase","readTransaction","rows","dfrdSQL","retryFn","rowsAffected","row","isNumeric","removeKeysRegExp","kLength","removeDefers","search","quote","escapable","meta","holder","mind","gap","rep","indent","cx","\b","\f","replacer","space","reviver","walk","SyntaxError","Adapter","el","extra","extractEventData","originalEvent","onDomLoad","setInterval","initHtml4","initialized","enabled","savedHashes","isLastHash","newHash","isLast","oldHash","getHashByIndex","isHashEqual","saveHash","discardedHashes","discardedStates","discardState","discardedState","forwardState","backState","discardObject","discardedStateHash","getHashByState","discardHash","discardedHash","State","discarded","StateHash","recycleState","emulated","hashChange","hashChangeInit","checkerFunction","iframeId","iframe","lastIframeHash","checkerRunning","lastDocumentHash","startedWithHash","getHash","isInternetExplorer","documentHash","iframeHash","escapeHash","setHash","intervalList","hashChangeInterval","onHashChange","currentUrl","newURL","getLocationHref","currentHash","getHashByUrl","currentState","currentStateHash","busy","doubleCheckComplete","isTraditionalAnchor","extractState","getFullUrl","isLastSavedState","forward","pushQueue","scope","newState","createStateObject","newStateHash","oldState","oldStateHash","html4Hash","wasExpected","expectedStateId","storeState","setTitle","saveState","getShortUrl","previousState","getStateByIndex","clearInterval","encode","decode","initCore","safariPollInterval","doubleCheckInterval","disableSuid","storeInterval","busyDelay","initialTitle","html4Mode","delayInit","clearAllIntervals","il","arg","consoleExists","textarea","Exception","scrollTop","scrollHeight","clientHeight","getInternetExplorerMajorVersion","cached","div","innerHTML","bugs","vendor","safariPoll","ieDoubleCheck","hashEscape","cloneObject","getRootUrl","rootUrl","hostname","getBaseHref","baseElements","baseElement","baseHref","getBaseUrl","baseUrl","getBasePageUrl","getPageUrl","pageUrl","stateUrl","part","basePageUrl","allowBaseHref","fullUrl","firstChar","shortUrl","doc","idToState","stateToId","urlToId","storedStates","savedStates","normalizeStore","friendly","getLastSavedState","cleanUrl","getIdByState","extractId","getStateString","normalizeState","dataNotEmpty","normalized","hashedUrl","hasUrlDuplicate","getStateById","passedState","cleanedState","getStateId","url_or_hash","isTraditional","getIdByUrl","getLastStoredState","hasDuplicate","newId","oldId","getCurrentIndex","unescapeHash","normalizeHash","firstState","queues","flag","fireNext","fireQueueItem","clearQueue","stateChanged","doubleChecker","doubleCheckClear","doubleCheck","tryAgain","safariStatePoll","urlState","go","emptyFunction","onPopState","stateId","onUnload","currentStore","currentStoreString","DOMException","QUOTA_EXCEEDED_ERR","appCodeName","onDeviceReady","deviceDeferred","hideLocationBar","$oldView","not","$navBoxHeader","data-name","data-type","reverseTransition","endPosition","direction","getGoogleDirections","directionsService","DirectionsService","origin","destination","travelMode","route","DirectionsStatus","OK","NOT_FOUND","ZERO_RESULTS","MAX_WAYPOINTS_EXCEEDED","OVER_QUERY_LIMIT","REQUEST_DENIED","INVALID_REQUEST","setupGoogleMapsBasic","marker","markerInfo","LatLng","latitude","longitude","zoom","center","mapTypeId","MapTypeId","setOptions","kml","KmlLayer","preserveViewport","Marker","markerTitle","InfoWindow","addListener","setContent","getTitle","setupGoogleMapsDirections","directionsDisplay","geocoderOptions","travelmode","directionsOptions","DirectionsTravelMode","avoidHighways","avoidhighways","avoidTolls","avoidtolls","mapOptions","$status","$directions","promiseOrigin","promiseDestination","failedFn","language","region","originAddress","originLatitude","originLongitude","geolocation","getGeoLocation","coords","destinationAddress","destinationLatitude","destinationLongitude","lat","lng","DirectionsRenderer","setMap","setPanel","setDirections","defaultOptions","enableHighAccuracy","getCurrentPosition","altitude","accuracy","altitudeAccuracy","heading","speed","PERMISSION_DENIED","PERMISSION_DENIED_TIMEOUT","POSITION_UNAVAILABLE","googleMap","currentMarker","currentInfo","mapAction","setPosition","mainDeferred","browserDeferred","defaultScreen","defaultInteraction","defaultCategory","defaultMasterCategory","_now","onMasterCategoryClick","onCategoryClick","onKeywordClick","onHyperlinkClick","arrangement","$visualBox","$listBox","$item","$label","$description","columns","$images","itemConfig","hook","masterCategoriesArrangement","masterCategoriesDisplay","categoriesArrangement","categoriesDisplay","interactionsArrangement","interactionsDisplay","sidebarDisplay","class","alt","description","currentLevel","oldLevel","currentItem","oldItem","BlinkSideBar","$sideBar","$stack","dumpLocalStorage","getFn","determineBlinkStorageEngine","storeEngine","$progressDot","checkFn","fixWebSQL","increaseQuota_Success","quotaIncrease","gap_database","requestTerminate","getDBLimits_Success","storageQuota","allocatedSpace","currentQuota","increaseQuota","getLimits","updateLocalStorage","trimHistoryState","onOrientationChange","screenX","screenY","windowX","windowY","oldOrientation","screen","innerHeight","$window","onNetworkChange","onLine","onPendingClick","idParts","networkText","cancelText","submitAllText","submitFn","interactionName","submitData","swap","toggleClass","closest","pendingForm","onTaskBegun","runningTasks","activityIndicatorTimer","activityIndicator","onTaskComplete","displayAnswerSpace","startUp","$masterCategoriesView","$categoriesView","$keywordListView","queryParameters","_c","loaded","$startup","stars","init_main","dfrdFixWebSQL","domainWhitelist","loadedPromises","requestsCounter","fx","delegate","isPhantomJS","whitelistmanage","appendToWhitelist","externalHosts","cacheDfrd","onBrowserReady","_pushState","_replaceState","serverDomain","serverAppBranch","serverAppVersion","serverAppPath","serverDevicePath","uid","$html","inputs","checking","noupdate","obsolete","updateready","bootPromises","safariTest","ajaxPrefilter","original","answerSpaceId","conditions","setRequestHeader","requests","getScripts","urls","dfrdJSON","dfrdXSLT","dfrdXPath","xpath","xpathParse"],"mappings":"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","sourcesContent":["// see MIT/GPL http://phpjs.org/ for the original source of these functions\n\nfunction explode (delimiter, string, limit) {\n    // Splits a string on string separator and return array of components. If limit is positive only limit number of components is returned. If limit is negative all components except the last abs(limit) are returned.  \n    // \n    // version: 1103.1210\n    // discuss at: http://phpjs.org/functions/explode\n    // +     original by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n    // +     improved by: kenneth\n    // +     improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n    // +     improved by: d3x\n    // +     bugfixed by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n    // *     example 1: explode(' ', 'Kevin van Zonneveld');\n    // *     returns 1: {0: 'Kevin', 1: 'van', 2: 'Zonneveld'}\n    // *     example 2: explode('=', 'a=bc=d', 2);\n    // *     returns 2: ['a', 'bc=d']\n    var emptyArray = {\n        0: ''\n    };\n \n    // third argument is not required\n    if (arguments.length < 2 || typeof arguments[0] == 'undefined' || typeof arguments[1] == 'undefined') {\n        return null;\n    }\n \n    if (delimiter === '' || delimiter === false || delimiter === null) {\n        return false;\n    }\n \n    if (typeof delimiter == 'function' || typeof delimiter == 'object' || typeof string == 'function' || typeof string == 'object') {\n        return emptyArray;\n    }\n \n    if (delimiter === true) {\n        delimiter = '1';\n    }\n \n    if (!limit) {\n        return string.toString().split(delimiter.toString());\n    } else {\n        // support for limit argument\n        var splitted = string.toString().split(delimiter.toString());\n        var partA = splitted.splice(0, limit - 1);\n        var partB = splitted.join(delimiter.toString());\n        partA.push(partB);\n        return partA;\n    }\n}\n\nfunction utf8_encode (argString) {\n    // http://kevin.vanzonneveld.net\n    // +   original by: Webtoolkit.info (http://www.webtoolkit.info/)\n    // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n    // +   improved by: sowberry\n    // +    tweaked by: Jack\n    // +   bugfixed by: Onno Marsman\n    // +   improved by: Yves Sucaet\n    // +   bugfixed by: Onno Marsman\n    // +   bugfixed by: Ulrich\n    // +   bugfixed by: Rafal Kukawski\n    // *     example 1: utf8_encode('Kevin van Zonneveld');\n    // *     returns 1: 'Kevin van Zonneveld'\n\n    if (argString === null || typeof argString === \"undefined\") {\n        return \"\";\n    }\n\n    var string = (argString + ''); // .replace(/\\r\\n/g, \"\\n\").replace(/\\r/g, \"\\n\");\n    var utftext = \"\",\n        start, end, stringl = 0;\n\n    start = end = 0;\n    stringl = string.length;\n    for (var n = 0; n < stringl; n++) {\n        var c1 = string.charCodeAt(n);\n        var enc = null;\n\n        if (c1 < 128) {\n            end++;\n        } else if (c1 > 127 && c1 < 2048) {\n            enc = String.fromCharCode((c1 >> 6) | 192) + String.fromCharCode((c1 & 63) | 128);\n        } else {\n            enc = String.fromCharCode((c1 >> 12) | 224) + String.fromCharCode(((c1 >> 6) & 63) | 128) + String.fromCharCode((c1 & 63) | 128);\n        }\n        if (enc !== null) {\n            if (end > start) {\n                utftext += string.slice(start, end);\n            }\n            utftext += enc;\n            start = end = n + 1;\n        }\n    }\n\n    if (end > start) {\n        utftext += string.slice(start, stringl);\n    }\n\n    return utftext;\n}\n\nfunction sha1 (str) {\n    // http://kevin.vanzonneveld.net\n    // +   original by: Webtoolkit.info (http://www.webtoolkit.info/)\n    // + namespaced by: Michael White (http://getsprink.com)\n    // +      input by: Brett Zamir (http://brett-zamir.me)\n    // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n    // -    depends on: utf8_encode\n    // *     example 1: sha1('Kevin van Zonneveld');\n    // *     returns 1: '54916d2e62f65b3afa6e192e6a601cdbe5cb5897'\n    var rotate_left = function (n, s) {\n        var t4 = (n << s) | (n >>> (32 - s));\n        return t4;\n    };\n\n    var cvt_hex = function (val) {\n        var str = \"\";\n        var i;\n        var v;\n\n        for (i = 7; i >= 0; i--) {\n            v = (val >>> (i * 4)) & 0x0f;\n            str += v.toString(16);\n        }\n        return str;\n    };\n\n    var blockstart;\n    var i, j;\n    var W = new Array(80);\n    var H0 = 0x67452301;\n    var H1 = 0xEFCDAB89;\n    var H2 = 0x98BADCFE;\n    var H3 = 0x10325476;\n    var H4 = 0xC3D2E1F0;\n    var A, B, C, D, E;\n    var temp;\n\n    str = this.utf8_encode(str);\n    var str_len = str.length;\n\n    var word_array = [];\n    for (i = 0; i < str_len - 3; i += 4) {\n        j = str.charCodeAt(i) << 24 | str.charCodeAt(i + 1) << 16 | str.charCodeAt(i + 2) << 8 | str.charCodeAt(i + 3);\n        word_array.push(j);\n    }\n\n    switch (str_len % 4) {\n    case 0:\n        i = 0x080000000;\n        break;\n    case 1:\n        i = str.charCodeAt(str_len - 1) << 24 | 0x0800000;\n        break;\n    case 2:\n        i = str.charCodeAt(str_len - 2) << 24 | str.charCodeAt(str_len - 1) << 16 | 0x08000;\n        break;\n    case 3:\n        i = str.charCodeAt(str_len - 3) << 24 | str.charCodeAt(str_len - 2) << 16 | str.charCodeAt(str_len - 1) << 8 | 0x80;\n        break;\n    }\n\n    word_array.push(i);\n\n    while ((word_array.length % 16) != 14) {\n        word_array.push(0);\n    }\n\n    word_array.push(str_len >>> 29);\n    word_array.push((str_len << 3) & 0x0ffffffff);\n\n    for (blockstart = 0; blockstart < word_array.length; blockstart += 16) {\n        for (i = 0; i < 16; i++) {\n            W[i] = word_array[blockstart + i];\n        }\n        for (i = 16; i <= 79; i++) {\n            W[i] = rotate_left(W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16], 1);\n        }\n\n\n        A = H0;\n        B = H1;\n        C = H2;\n        D = H3;\n        E = H4;\n\n        for (i = 0; i <= 19; i++) {\n            temp = (rotate_left(A, 5) + ((B & C) | (~B & D)) + E + W[i] + 0x5A827999) & 0x0ffffffff;\n            E = D;\n            D = C;\n            C = rotate_left(B, 30);\n            B = A;\n            A = temp;\n        }\n\n        for (i = 20; i <= 39; i++) {\n            temp = (rotate_left(A, 5) + (B ^ C ^ D) + E + W[i] + 0x6ED9EBA1) & 0x0ffffffff;\n            E = D;\n            D = C;\n            C = rotate_left(B, 30);\n            B = A;\n            A = temp;\n        }\n\n        for (i = 40; i <= 59; i++) {\n            temp = (rotate_left(A, 5) + ((B & C) | (B & D) | (C & D)) + E + W[i] + 0x8F1BBCDC) & 0x0ffffffff;\n            E = D;\n            D = C;\n            C = rotate_left(B, 30);\n            B = A;\n            A = temp;\n        }\n\n        for (i = 60; i <= 79; i++) {\n            temp = (rotate_left(A, 5) + (B ^ C ^ D) + E + W[i] + 0xCA62C1D6) & 0x0ffffffff;\n            E = D;\n            D = C;\n            C = rotate_left(B, 30);\n            B = A;\n            A = temp;\n        }\n\n        H0 = (H0 + A) & 0x0ffffffff;\n        H1 = (H1 + B) & 0x0ffffffff;\n        H2 = (H2 + C) & 0x0ffffffff;\n        H3 = (H3 + D) & 0x0ffffffff;\n        H4 = (H4 + E) & 0x0ffffffff;\n    }\n\n    temp = cvt_hex(H0) + cvt_hex(H1) + cvt_hex(H2) + cvt_hex(H3) + cvt_hex(H4);\n    return temp.toLowerCase();\n}\n\n/* from http://phpjs.org/functions/urldecode:572 */\nfunction urldecode (str) {\n    // Decodes URL-encoded string  \n    // \n    // version: 1103.1210\n    // discuss at: http://phpjs.org/functions/urldecode\n    // +   original by: Philip Peterson\n    // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n    // +      input by: AJ\n    // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n    // +   improved by: Brett Zamir (http://brett-zamir.me)\n    // +      input by: travc\n    // +      input by: Brett Zamir (http://brett-zamir.me)\n    // +   bugfixed by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n    // +   improved by: Lars Fischer\n    // +      input by: Ratheous\n    // +   improved by: Orlando\n    // +      reimplemented by: Brett Zamir (http://brett-zamir.me)\n    // +      bugfixed by: Rob\n    // +      input by: e-mike\n    // +   improved by: Brett Zamir (http://brett-zamir.me)\n    // %        note 1: info on what encoding functions to use from: http://xkr.us/articles/javascript/encode-compare/\n    // %        note 2: Please be aware that this function expects to decode from UTF-8 encoded strings, as found on\n    // %        note 2: pages served as UTF-8\n    // *     example 1: urldecode('Kevin+van+Zonneveld%21');\n    // *     returns 1: 'Kevin van Zonneveld!'\n    // *     example 2: urldecode('http%3A%2F%2Fkevin.vanzonneveld.net%2F');\n    // *     returns 2: 'http://kevin.vanzonneveld.net/'\n    // *     example 3: urldecode('http%3A%2F%2Fwww.google.nl%2Fsearch%3Fq%3Dphp.js%26ie%3Dutf-8%26oe%3Dutf-8%26aq%3Dt%26rls%3Dcom.ubuntu%3Aen-US%3Aunofficial%26client%3Dfirefox-a');\n    // *     returns 3: 'http://www.google.nl/search?q=php.js&ie=utf-8&oe=utf-8&aq=t&rls=com.ubuntu:en-US:unofficial&client=firefox-a'\n    return decodeURIComponent((str + '').replace(/\\+/g, '%20'));\n}\n\n/* http://phpjs.org/functions/parse_url:485 version 1009.2513 */\n// note: Does not replace invalid characters with '_' as in PHP, nor does it return false for bad URLs\nfunction parse_url (str, component) {\n\tvar o = {\n\t\tstrictMode: false,\n\t\tkey: [\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"],\n\t\tq: {\n\t\t\tname: \"queryKey\",\n\t\t\tparser: /(?:^|&)([^&=]*)=?([^&]*)/g\n\t\t},\n\t\tparser: {\n\t\t\tstrict: /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*):?([^:@]*))?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,\n\t\t\tloose: /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/\\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/ \n\t\t\t\t// Added one optional slash to post-protocol to catch file:/// (should restrict this)\n\t\t}\n\t};\n\tvar m = o.parser[o.strictMode ? \"strict\" : \"loose\"].exec(str),\n\turi = {},\n\ti = 14;\n\twhile (i--) { uri[o.key[i]] = m[i] || \"\"; }\n\tswitch (component) {\n\t\tcase 'PHP_URL_SCHEME':\n\t\t\treturn uri.protocol;\n\t\tcase 'PHP_URL_HOST':\n\t\t\treturn uri.host;\n\t\tcase 'PHP_URL_PORT':\n\t\t\treturn uri.port;\n\t\tcase 'PHP_URL_USER':\n\t\t\treturn uri.user;\n\t\tcase 'PHP_URL_PASS':\n\t\t\treturn uri.password;\n\t\tcase 'PHP_URL_PATH':\n\t\t\treturn uri.path;\n\t\tcase 'PHP_URL_QUERY':\n\t\t\treturn uri.query;\n\t\tcase 'PHP_URL_FRAGMENT':\n\t\t\treturn uri.anchor;\n\t\tdefault:\n\t\t\tvar retArr = {};\n\t\t\tif (uri.protocol !== '') {retArr.scheme=uri.protocol;}\n\t\t\tif (uri.host !== '') {retArr.host=uri.host;}\n\t\t\tif (uri.port !== '') {retArr.port=uri.port;}\n\t\t\tif (uri.user !== '') {retArr.user=uri.user;}\n\t\t\tif (uri.password !== '') {retArr.pass=uri.password;}\n\t\t\tif (uri.path !== '') {retArr.path=uri.path;}\n\t\t\tif (uri.query !== '') {retArr.query=uri.query;}\n\t\t\tif (uri.anchor !== '') {retArr.fragment=uri.anchor;}\n\t\t\treturn retArr;\n\t}\n}\n\n/* from http://phpjs.org/functions/parse_str:484 */\nfunction parse_str (str, array) {\n    // http://kevin.vanzonneveld.net\n    // +   original by: Cagri Ekin\n    // +   improved by: Michael White (http://getsprink.com)\n    // +    tweaked by: Jack\n    // +   bugfixed by: Onno Marsman\n    // +   reimplemented by: stag019\n    // +   bugfixed by: Brett Zamir (http://brett-zamir.me)\n    // +   bugfixed by: stag019\n    // -    depends on: urldecode\n    // +   input by: Dreamer\n    // +   bugfixed by: Brett Zamir (http://brett-zamir.me)\n    // %        note 1: When no argument is specified, will put variables in global scope.\n    // *     example 1: var arr = {};\n    // *     example 1: parse_str('first=foo&second=bar', arr);\n    // *     results 1: arr == { first: 'foo', second: 'bar' }\n    // *     example 2: var arr = {};\n    // *     example 2: parse_str('str_a=Jack+and+Jill+didn%27t+see+the+well.', arr);\n    // *     results 2: arr == { str_a: \"Jack and Jill didn't see the well.\" }\n    var glue1 = '=',\n        glue2 = '&',\n        array2 = String(str).replace(/^&?([\\s\\S]*?)&?$/, '$1').split(glue2),\n        i, j, chr, tmp, key, value, bracket, keys, evalStr, that = this,\n        fixStr = function (str) {\n            return that.urldecode(str).replace(/([\\\\\"'])/g, '\\\\$1').replace(/\\n/g, '\\\\n').replace(/\\r/g, '\\\\r');\n        };\n\n    if (!array) {\n        array = this.window;\n    }\n\n    for (i = 0; i < array2.length; i++) {\n        tmp = array2[i].split(glue1);\n        if (tmp.length < 2) {\n            tmp = [tmp, ''];\n        }\n        key = fixStr(tmp[0]);\n        value = fixStr(tmp[1]);\n        while (key.charAt(0) === ' ') {\n            key = key.substr(1);\n        }\n        if (key.indexOf('\\0') !== -1) {\n            key = key.substr(0, key.indexOf('\\0'));\n        }\n        if (key && key.charAt(0) !== '[') {\n            keys = [];\n            bracket = 0;\n            for (j = 0; j < key.length; j++) {\n                if (key.charAt(j) === '[' && !bracket) {\n                    bracket = j + 1;\n                } else if (key.charAt(j) === ']') {\n                    if (bracket) {\n                        if (!keys.length) {\n                            keys.push(key.substr(0, bracket - 1));\n                        }\n                        keys.push(key.substr(bracket, j - bracket));\n                        bracket = 0;\n                        if (key.charAt(j + 1) !== '[') {\n                            break;\n                        }\n                    }\n                }\n            }\n            if (!keys.length) {\n                keys = [key];\n            }\n            for (j = 0; j < keys[0].length; j++) {\n                chr = keys[0].charAt(j);\n                if (chr === ' ' || chr === '.' || chr === '[') {\n                    keys[0] = keys[0].substr(0, j) + '_' + keys[0].substr(j + 1);\n                }\n                if (chr === '[') {\n                    break;\n                }\n            }\n            evalStr = 'array';\n            for (j = 0; j < keys.length; j++) {\n                key = keys[j];\n                if ((key !== '' && key !== ' ') || j === 0) {\n                    key = \"'\" + key + \"'\";\n                } else {\n                    key = eval(evalStr + '.push([]);') - 1;\n                }\n                evalStr += '[' + key + ']';\n                if (j !== keys.length - 1 && eval('typeof ' + evalStr) === 'undefined') {\n                    eval(evalStr + ' = [];');\n                }\n            }\n            evalStr += \" = '\" + value + \"';\\n\";\n            eval(evalStr);\n        }\n    }\n}\n\nfunction htmlspecialchars (string, quote_style, charset, double_encode) {\n    // http://kevin.vanzonneveld.net\n    // +   original by: Mirek Slugen\n    // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n    // +   bugfixed by: Nathan\n    // +   bugfixed by: Arno\n    // +    revised by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n    // +    bugfixed by: Brett Zamir (http://brett-zamir.me)\n    // +      input by: Ratheous\n    // +      input by: Mailfaker (http://www.weedem.fr/)\n    // +      reimplemented by: Brett Zamir (http://brett-zamir.me)\n    // +      input by: felix\n    // +    bugfixed by: Brett Zamir (http://brett-zamir.me)\n    // %        note 1: charset argument not supported\n    // *     example 1: htmlspecialchars(\"<a href='test'>Test</a>\", 'ENT_QUOTES');\n    // *     returns 1: '&lt;a href=&#039;test&#039;&gt;Test&lt;/a&gt;'\n    // *     example 2: htmlspecialchars(\"ab\\\"c'd\", ['ENT_NOQUOTES', 'ENT_QUOTES']);\n    // *     returns 2: 'ab\"c&#039;d'\n    // *     example 3: htmlspecialchars(\"my \"&entity;\" is still here\", null, null, false);\n    // *     returns 3: 'my &quot;&entity;&quot; is still here'\n    var optTemp = 0,\n        i = 0,\n        noquotes = false;\n    if (typeof quote_style === 'undefined' || quote_style === null) {\n        quote_style = 2;\n    }\n    string = string.toString();\n    if (double_encode !== false) { // Put this first to avoid double-encoding\n        string = string.replace(/&/g, '&amp;');\n    }\n    string = string.replace(/</g, '&lt;').replace(/>/g, '&gt;');\n\n    var OPTS = {\n        'ENT_NOQUOTES': 0,\n        'ENT_HTML_QUOTE_SINGLE': 1,\n        'ENT_HTML_QUOTE_DOUBLE': 2,\n        'ENT_COMPAT': 2,\n        'ENT_QUOTES': 3,\n        'ENT_IGNORE': 4\n    };\n    if (quote_style === 0) {\n        noquotes = true;\n    }\n    if (typeof quote_style !== 'number') { // Allow for a single string or an array of string flags\n        quote_style = [].concat(quote_style);\n        for (i = 0; i < quote_style.length; i++) {\n            // Resolve string input to bitwise e.g. 'ENT_IGNORE' becomes 4\n            if (OPTS[quote_style[i]] === 0) {\n                noquotes = true;\n            }\n            else if (OPTS[quote_style[i]]) {\n                optTemp = optTemp | OPTS[quote_style[i]];\n            }\n        }\n        quote_style = optTemp;\n    }\n    if (quote_style & OPTS.ENT_HTML_QUOTE_SINGLE) {\n        string = string.replace(/'/g, '&#039;');\n    }\n    if (!noquotes) {\n        string = string.replace(/\"/g, '&quot;');\n    }\n\n    return string;\n}\n\nfunction htmlspecialchars_decode (string, quote_style) {\n    // http://kevin.vanzonneveld.net\n    // +   original by: Mirek Slugen\n    // +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n    // +   bugfixed by: Mateusz \"loonquawl\" Zalega\n    // +      input by: ReverseSyntax\n    // +      input by: Slawomir Kaniecki\n    // +      input by: Scott Cariss\n    // +      input by: Francois\n    // +   bugfixed by: Onno Marsman\n    // +    revised by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n    // +   bugfixed by: Brett Zamir (http://brett-zamir.me)\n    // +      input by: Ratheous\n    // +      input by: Mailfaker (http://www.weedem.fr/)\n    // +      reimplemented by: Brett Zamir (http://brett-zamir.me)\n    // +    bugfixed by: Brett Zamir (http://brett-zamir.me)\n    // *     example 1: htmlspecialchars_decode(\"<p>this -&gt; &quot;</p>\", 'ENT_NOQUOTES');\n    // *     returns 1: '<p>this -> &quot;</p>'\n    // *     example 2: htmlspecialchars_decode(\"&amp;quot;\");\n    // *     returns 2: '&quot;'\n    var optTemp = 0,\n        i = 0,\n        noquotes = false;\n    if (typeof quote_style === 'undefined') {\n        quote_style = 2;\n    }\n    string = string.toString().replace(/&lt;/g, '<').replace(/&gt;/g, '>');\n    var OPTS = {\n        'ENT_NOQUOTES': 0,\n        'ENT_HTML_QUOTE_SINGLE': 1,\n        'ENT_HTML_QUOTE_DOUBLE': 2,\n        'ENT_COMPAT': 2,\n        'ENT_QUOTES': 3,\n        'ENT_IGNORE': 4\n    };\n    if (quote_style === 0) {\n        noquotes = true;\n    }\n    if (typeof quote_style !== 'number') { // Allow for a single string or an array of string flags\n        quote_style = [].concat(quote_style);\n        for (i = 0; i < quote_style.length; i++) {\n            // Resolve string input to bitwise e.g. 'PATHINFO_EXTENSION' becomes 4\n            if (OPTS[quote_style[i]] === 0) {\n                noquotes = true;\n            } else if (OPTS[quote_style[i]]) {\n                optTemp = optTemp | OPTS[quote_style[i]];\n            }\n        }\n        quote_style = optTemp;\n    }\n    if (quote_style & OPTS.ENT_HTML_QUOTE_SINGLE) {\n        string = string.replace(/&#0*39;/g, \"'\"); // PHP doesn't currently escape if more than one 0, but it should\n        // string = string.replace(/&apos;|&#x0*27;/g, \"'\"); // This would also be useful here, but not a part of PHP\n    }\n    if (!noquotes) {\n        string = string.replace(/&quot;/g, '\"');\n    }\n    // Put this in last place to avoid escape being double-decoded\n    string = string.replace(/&amp;/g, '&');\n\n    return string;\n}\n\nfunction setlocale (category, locale) {\n\t// Set locale information  \n\t// \n\t// version: 1107.2516\n\t// discuss at: http://phpjs.org/functions/setlocale\n\t// +   original by: Brett Zamir (http://brett-zamir.me)\n\t// +   derived from: Blues at http://hacks.bluesmoon.info/strftime/strftime.js\n\t// +   derived from: YUI Library: http://developer.yahoo.com/yui/docs/YAHOO.util.DateLocale.html\n\t// -    depends on: getenv\n\t// %          note 1: Is extensible, but currently only implements locales en,\n\t// %          note 1: en_US, en_GB, en_AU, fr, and fr_CA for LC_TIME only; C for LC_CTYPE;\n\t// %          note 1: C and en for LC_MONETARY/LC_NUMERIC; en for LC_COLLATE\n\t// %          note 2: Uses global: php_js to store locale info\n\t// %          note 3: Consider using http://demo.icu-project.org/icu-bin/locexp as basis for localization (as in i18n_loc_set_default())\n\t// *     example 1: setlocale('LC_ALL', 'en_US');\n\t// *     returns 1: 'en_US'\n\tvar categ = '',\n\tcats = [],\n\ti = 0,\n\td = this.window.document;\n \n\t// BEGIN STATIC\n\tvar _copy = function _copy(orig) {\n\t\tif (orig instanceof RegExp) {\n\t\t\treturn new RegExp(orig);\n\t\t} else if (orig instanceof Date) {\n\t\t\treturn new Date(orig);\n\t\t}\n\t\tvar newObj = {};\n\t\tfor (var i in orig) {\n\t\t\tif (typeof orig[i] === 'object') {\n\t\t\t\tnewObj[i] = _copy(orig[i]);\n\t\t\t} else {\n\t\t\t\tnewObj[i] = orig[i];\n\t\t\t}\n\t\t}\n\t\treturn newObj;\n\t};\n \n\t// Function usable by a ngettext implementation (apparently not an accessible part of setlocale(), but locale-specific)\n\t// See http://www.gnu.org/software/gettext/manual/gettext.html#Plural-forms though amended with others from\n\t// https://developer.mozilla.org/En/Localization_and_Plurals (new categories noted with \"MDC\" below, though\n\t// not sure of whether there is a convention for the relative order of these newer groups as far as ngettext)\n\t// The function name indicates the number of plural forms (nplural)\n\t// Need to look into http://cldr.unicode.org/ (maybe future JavaScript); Dojo has some functions (under new BSD),\n\t// including JSON conversions of LDML XML from CLDR: http://bugs.dojotoolkit.org/browser/dojo/trunk/cldr\n\t// and docs at http://api.dojotoolkit.org/jsdoc/HEAD/dojo.cldr\n\tvar _nplurals1 = function (n) { // e.g., Japanese\n\t\treturn 0;\n\t};\n\tvar _nplurals2a = function (n) { // e.g., English\n\t\treturn n !== 1 ? 1 : 0;\n\t};\n\tvar _nplurals2b = function (n) { // e.g., French\n\t\treturn n > 1 ? 1 : 0;\n\t};\n\tvar _nplurals2c = function (n) { // e.g., Icelandic (MDC)\n\t\treturn n % 10 === 1 && n % 100 !== 11 ? 0 : 1;\n\t};\n\tvar _nplurals3a = function (n) { // e.g., Latvian (MDC has a different order from gettext)\n\t\treturn n % 10 === 1 && n % 100 !== 11 ? 0 : n !== 0 ? 1 : 2;\n\t};\n\tvar _nplurals3b = function (n) { // e.g., Scottish Gaelic\n\t\treturn n === 1 ? 0 : n === 2 ? 1 : 2;\n\t};\n\tvar _nplurals3c = function (n) { // e.g., Romanian\n\t\treturn n === 1 ? 0 : (n === 0 || (n % 100 > 0 && n % 100 < 20)) ? 1 : 2;\n\t};\n\tvar _nplurals3d = function (n) { // e.g., Lithuanian (MDC has a different order from gettext)\n\t\treturn n % 10 === 1 && n % 100 !== 11 ? 0 : n % 10 >= 2 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2;\n\t};\n\tvar _nplurals3e = function (n) { // e.g., Croatian\n\t\treturn n % 10 === 1 && n % 100 !== 11 ? 0 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2;\n\t};\n\tvar _nplurals3f = function (n) { // e.g., Slovak\n\t\treturn n === 1 ? 0 : n >= 2 && n <= 4 ? 1 : 2;\n\t};\n\tvar _nplurals3g = function (n) { // e.g., Polish\n\t\treturn n === 1 ? 0 : n % 10 >= 2 && n % 10 <= 4 && (n % 100 < 10 || n % 100 >= 20) ? 1 : 2;\n\t};\n\tvar _nplurals3h = function (n) { // e.g., Macedonian (MDC)\n\t\treturn n % 10 === 1 ? 0 : n % 10 === 2 ? 1 : 2;\n\t};\n\tvar _nplurals4a = function (n) { // e.g., Slovenian\n\t\treturn n % 100 === 1 ? 0 : n % 100 === 2 ? 1 : n % 100 === 3 || n % 100 === 4 ? 2 : 3;\n\t};\n\tvar _nplurals4b = function (n) { // e.g., Maltese (MDC)\n\t\treturn n === 1 ? 0 : n === 0 || (n % 100 && n % 100 <= 10) ? 1 : n % 100 >= 11 && n % 100 <= 19 ? 2 : 3;\n\t};\n\tvar _nplurals5 = function (n) { // e.g., Irish Gaeilge (MDC)\n\t\treturn n === 1 ? 0 : n === 2 ? 1 : n >= 3 && n <= 6 ? 2 : n >= 7 && n <= 10 ? 3 : 4;\n\t};\n\tvar _nplurals6 = function (n) { // e.g., Arabic (MDC) - Per MDC puts 0 as last group\n\t\treturn n === 0 ? 5 : n === 1 ? 0 : n === 2 ? 1 : n % 100 >= 3 && n % 100 <= 10 ? 2 : n % 100 >= 11 && n % 100 <= 99 ? 3 : 4;\n\t};\n\t// END STATIC\n\t// BEGIN REDUNDANT\n\tthis.php_js = this.php_js || {};\n \n\tvar phpjs = this.php_js;\n \n\t// Reconcile Windows vs. *nix locale names?\n\t// Allow different priority orders of languages, esp. if implement gettext as in\n\t//     LANGUAGE env. var.? (e.g., show German if French is not available)\n\tif (!phpjs.locales) {\n\t\t// Can add to the locales\n\t\tphpjs.locales = {};\n \n\t\tphpjs.locales.en = {\n\t\t\t'LC_COLLATE': // For strcoll\n \n \n\t\t\tfunction (str1, str2) { // Fix: This one taken from strcmp, but need for other locales; we don't use localeCompare since its locale is not settable\n\t\t\t\treturn (str1 == str2) ? 0 : ((str1 > str2) ? 1 : -1);\n\t\t\t},\n\t\t\t'LC_CTYPE': { // Need to change any of these for English as opposed to C?\n\t\t\t\tan: /^[A-Za-z\\d]+$/g,\n\t\t\t\tal: /^[A-Za-z]+$/g,\n\t\t\t\tct: /^[\\u0000-\\u001F\\u007F]+$/g,\n\t\t\t\tdg: /^[\\d]+$/g,\n\t\t\t\tgr: /^[\\u0021-\\u007E]+$/g,\n\t\t\t\tlw: /^[a-z]+$/g,\n\t\t\t\tpr: /^[\\u0020-\\u007E]+$/g,\n\t\t\t\tpu: /^[\\u0021-\\u002F\\u003A-\\u0040\\u005B-\\u0060\\u007B-\\u007E]+$/g,\n\t\t\t\tsp: /^[\\f\\n\\r\\t\\v ]+$/g,\n\t\t\t\tup: /^[A-Z]+$/g,\n\t\t\t\txd: /^[A-Fa-f\\d]+$/g,\n\t\t\t\tCODESET: 'UTF-8',\n\t\t\t\t// Used by sql_regcase\n\t\t\t\tlower: 'abcdefghijklmnopqrstuvwxyz',\n\t\t\t\tupper: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\n\t\t\t},\n\t\t\t'LC_TIME': { // Comments include nl_langinfo() constant equivalents and any changes from Blues' implementation\n\t\t\t\ta: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],\n\t\t\t\t// ABDAY_\n\t\t\t\tA: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],\n\t\t\t\t// DAY_\n\t\t\t\tb: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],\n\t\t\t\t// ABMON_\n\t\t\t\tB: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],\n\t\t\t\t// MON_\n\t\t\t\tc: '%a %d %b %Y %r %Z',\n\t\t\t\t// D_T_FMT // changed %T to %r per results\n\t\t\t\tp: ['AM', 'PM'],\n\t\t\t\t// AM_STR/PM_STR\n\t\t\t\tP: ['am', 'pm'],\n\t\t\t\t// Not available in nl_langinfo()\n\t\t\t\tr: '%I:%M:%S %p',\n\t\t\t\t// T_FMT_AMPM (Fixed for all locales)\n\t\t\t\tx: '%m/%d/%Y',\n\t\t\t\t// D_FMT // switched order of %m and %d; changed %y to %Y (C uses %y)\n\t\t\t\tX: '%r',\n\t\t\t\t// T_FMT // changed from %T to %r  (%T is default for C, not English US)\n\t\t\t\t// Following are from nl_langinfo() or http://www.cptec.inpe.br/sx4/sx4man2/g1ab02e/strftime.4.html\n\t\t\t\talt_digits: '',\n\t\t\t\t// e.g., ordinal\n\t\t\t\tERA: '',\n\t\t\t\tERA_YEAR: '',\n\t\t\t\tERA_D_T_FMT: '',\n\t\t\t\tERA_D_FMT: '',\n\t\t\t\tERA_T_FMT: ''\n\t\t\t},\n\t\t\t// Assuming distinction between numeric and monetary is thus:\n\t\t\t// See below for C locale\n\t\t\t'LC_MONETARY': { // Based on Windows \"english\" (English_United States.1252) locale\n\t\t\t\tint_curr_symbol: 'USD',\n\t\t\t\tcurrency_symbol: '$',\n\t\t\t\tmon_decimal_point: '.',\n\t\t\t\tmon_thousands_sep: ',',\n\t\t\t\tmon_grouping: [3],\n\t\t\t\t// use mon_thousands_sep; \"\" for no grouping; additional array members indicate successive group lengths after first group (e.g., if to be 1,23,456, could be [3, 2])\n\t\t\t\tpositive_sign: '',\n\t\t\t\tnegative_sign: '-',\n\t\t\t\tint_frac_digits: 2,\n\t\t\t\t// Fractional digits only for money defaults?\n\t\t\t\tfrac_digits: 2,\n\t\t\t\tp_cs_precedes: 1,\n\t\t\t\t// positive currency symbol follows value = 0; precedes value = 1\n\t\t\t\tp_sep_by_space: 0,\n\t\t\t\t// 0: no space between curr. symbol and value; 1: space sep. them unless symb. and sign are adjacent then space sep. them from value; 2: space sep. sign and value unless symb. and sign are adjacent then space separates\n\t\t\t\tn_cs_precedes: 1,\n\t\t\t\t// see p_cs_precedes\n\t\t\t\tn_sep_by_space: 0,\n\t\t\t\t// see p_sep_by_space\n\t\t\t\tp_sign_posn: 3,\n\t\t\t\t// 0: parentheses surround quantity and curr. symbol; 1: sign precedes them; 2: sign follows them; 3: sign immed. precedes curr. symbol; 4: sign immed. succeeds curr. symbol\n\t\t\t\tn_sign_posn: 0 // see p_sign_posn\n\t\t\t},\n\t\t\t'LC_NUMERIC': { // Based on Windows \"english\" (English_United States.1252) locale\n\t\t\t\tdecimal_point: '.',\n\t\t\t\tthousands_sep: ',',\n\t\t\t\tgrouping: [3] // see mon_grouping, but for non-monetary values (use thousands_sep)\n\t\t\t},\n\t\t\t'LC_MESSAGES': {\n\t\t\t\tYESEXPR: '^[yY].*',\n\t\t\t\tNOEXPR: '^[nN].*',\n\t\t\t\tYESSTR: '',\n\t\t\t\tNOSTR: ''\n\t\t\t},\n\t\t\tnplurals: _nplurals2a\n\t\t};\n\t\tphpjs.locales.en_US = _copy(phpjs.locales.en);\n\t\tphpjs.locales.en_US.LC_TIME.c = '%a %d %b %Y %r %Z';\n\t\tphpjs.locales.en_US.LC_TIME.x = '%D';\n\t\tphpjs.locales.en_US.LC_TIME.X = '%r';\n\t\t// The following are based on *nix settings\n\t\tphpjs.locales.en_US.LC_MONETARY.int_curr_symbol = 'USD ';\n\t\tphpjs.locales.en_US.LC_MONETARY.p_sign_posn = 1;\n\t\tphpjs.locales.en_US.LC_MONETARY.n_sign_posn = 1;\n\t\tphpjs.locales.en_US.LC_MONETARY.mon_grouping = [3, 3];\n\t\tphpjs.locales.en_US.LC_NUMERIC.thousands_sep = '';\n\t\tphpjs.locales.en_US.LC_NUMERIC.grouping = [];\n \n\t\tphpjs.locales.en_GB = _copy(phpjs.locales.en);\n\t\tphpjs.locales.en_GB.LC_TIME.r = '%l:%M:%S %P %Z';\n \n\t\tphpjs.locales.en_AU = _copy(phpjs.locales.en_GB);\n\t\tphpjs.locales.C = _copy(phpjs.locales.en); // Assume C locale is like English (?) (We need C locale for LC_CTYPE)\n\t\tphpjs.locales.C.LC_CTYPE.CODESET = 'ANSI_X3.4-1968';\n\t\tphpjs.locales.C.LC_MONETARY = {\n\t\t\tint_curr_symbol: '',\n\t\t\tcurrency_symbol: '',\n\t\t\tmon_decimal_point: '',\n\t\t\tmon_thousands_sep: '',\n\t\t\tmon_grouping: [],\n\t\t\tp_cs_precedes: 127,\n\t\t\tp_sep_by_space: 127,\n\t\t\tn_cs_precedes: 127,\n\t\t\tn_sep_by_space: 127,\n\t\t\tp_sign_posn: 127,\n\t\t\tn_sign_posn: 127,\n\t\t\tpositive_sign: '',\n\t\t\tnegative_sign: '',\n\t\t\tint_frac_digits: 127,\n\t\t\tfrac_digits: 127\n\t\t};\n\t\tphpjs.locales.C.LC_NUMERIC = {\n\t\t\tdecimal_point: '.',\n\t\t\tthousands_sep: '',\n\t\t\tgrouping: []\n\t\t};\n\t\tphpjs.locales.C.LC_TIME.c = '%a %b %e %H:%M:%S %Y'; // D_T_FMT\n\t\tphpjs.locales.C.LC_TIME.x = '%m/%d/%y'; // D_FMT\n\t\tphpjs.locales.C.LC_TIME.X = '%H:%M:%S'; // T_FMT\n\t\tphpjs.locales.C.LC_MESSAGES.YESEXPR = '^[yY]';\n\t\tphpjs.locales.C.LC_MESSAGES.NOEXPR = '^[nN]';\n \n\t\tphpjs.locales.fr = _copy(phpjs.locales.en);\n\t\tphpjs.locales.fr.nplurals = _nplurals2b;\n\t\tphpjs.locales.fr.LC_TIME.a = ['dim', 'lun', 'mar', 'mer', 'jeu', 'ven', 'sam'];\n\t\tphpjs.locales.fr.LC_TIME.A = ['dimanche', 'lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi', 'samedi'];\n\t\tphpjs.locales.fr.LC_TIME.b = ['jan', 'f\\u00E9v', 'mar', 'avr', 'mai', 'jun', 'jui', 'ao\\u00FB', 'sep', 'oct', 'nov', 'd\\u00E9c'];\n\t\tphpjs.locales.fr.LC_TIME.B = ['janvier', 'f\\u00E9vrier', 'mars', 'avril', 'mai', 'juin', 'juillet', 'ao\\u00FBt', 'septembre', 'octobre', 'novembre', 'd\\u00E9cembre'];\n\t\tphpjs.locales.fr.LC_TIME.c = '%a %d %b %Y %T %Z';\n\t\tphpjs.locales.fr.LC_TIME.p = ['', ''];\n\t\tphpjs.locales.fr.LC_TIME.P = ['', ''];\n\t\tphpjs.locales.fr.LC_TIME.x = '%d.%m.%Y';\n\t\tphpjs.locales.fr.LC_TIME.X = '%T';\n \n\t\tphpjs.locales.fr_CA = _copy(phpjs.locales.fr);\n\t\tphpjs.locales.fr_CA.LC_TIME.x = '%Y-%m-%d';\n\t}\n\tif (!phpjs.locale) {\n\t\tphpjs.locale = 'en_US';\n\t\tvar NS_XHTML = 'http://www.w3.org/1999/xhtml';\n\t\tvar NS_XML = 'http://www.w3.org/XML/1998/namespace';\n\t\tif (d.getElementsByTagNameNS && d.getElementsByTagNameNS(NS_XHTML, 'html')[0]) {\n\t\t\tif (d.getElementsByTagNameNS(NS_XHTML, 'html')[0].getAttributeNS && d.getElementsByTagNameNS(NS_XHTML, 'html')[0].getAttributeNS(NS_XML, 'lang')) {\n\t\t\t\tphpjs.locale = d.getElementsByTagName(NS_XHTML, 'html')[0].getAttributeNS(NS_XML, 'lang');\n\t\t\t} else if (d.getElementsByTagNameNS(NS_XHTML, 'html')[0].lang) { // XHTML 1.0 only\n\t\t\t\tphpjs.locale = d.getElementsByTagNameNS(NS_XHTML, 'html')[0].lang;\n\t\t\t}\n\t\t} else if (d.getElementsByTagName('html')[0] && d.getElementsByTagName('html')[0].lang) {\n\t\t\tphpjs.locale = d.getElementsByTagName('html')[0].lang;\n\t\t}\n\t}\n\tphpjs.locale = phpjs.locale.replace('-', '_'); // PHP-style\n\t// Fix locale if declared locale hasn't been defined\n\tif (!(phpjs.locale in phpjs.locales)) {\n\t\tif (phpjs.locale.replace(/_[a-zA-Z]+$/, '') in phpjs.locales) {\n\t\t\tphpjs.locale = phpjs.locale.replace(/_[a-zA-Z]+$/, '');\n\t\t}\n\t}\n \n\tif (!phpjs.localeCategories) {\n\t\tphpjs.localeCategories = {\n\t\t\t'LC_COLLATE': phpjs.locale,\n\t\t\t// for string comparison, see strcoll()\n\t\t\t'LC_CTYPE': phpjs.locale,\n\t\t\t// for character classification and conversion, for example strtoupper()\n\t\t\t'LC_MONETARY': phpjs.locale,\n\t\t\t// for localeconv()\n\t\t\t'LC_NUMERIC': phpjs.locale,\n\t\t\t// for decimal separator (See also localeconv())\n\t\t\t'LC_TIME': phpjs.locale,\n\t\t\t// for date and time formatting with strftime()\n\t\t\t'LC_MESSAGES': phpjs.locale // for system responses (available if PHP was compiled with libintl)\n\t\t};\n\t}\n\t// END REDUNDANT\n\tif (locale === null || locale === '') {\n\t\tlocale = this.getenv(category) || this.getenv('LANG');\n\t} else if (Object.prototype.toString.call(locale) === '[object Array]') {\n\t\tfor (i = 0; i < locale.length; i++) {\n\t\t\tif (!(locale[i] in this.php_js.locales)) {\n\t\t\t\tif (i === locale.length - 1) {\n\t\t\t\t\treturn false; // none found\n\t\t\t\t}\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tlocale = locale[i];\n\t\t\tbreak;\n\t\t}\n\t}\n \n\t// Just get the locale\n\tif (locale === '0' || locale === 0) {\n\t\tif (category === 'LC_ALL') {\n\t\t\tfor (categ in this.php_js.localeCategories) {\n\t\t\t\tcats.push(categ + '=' + this.php_js.localeCategories[categ]); // Add \".UTF-8\" or allow \".@latint\", etc. to the end?\n\t\t\t}\n\t\t\treturn cats.join(';');\n\t\t}\n\t\treturn this.php_js.localeCategories[category];\n\t}\n \n\tif (!(locale in this.php_js.locales)) {\n\t\treturn false; // Locale not found\n\t}\n \n\t// Set and get locale\n\tif (category === 'LC_ALL') {\n\t\tfor (categ in this.php_js.localeCategories) {\n\t\t\tthis.php_js.localeCategories[categ] = locale;\n\t\t}\n\t} else {\n\t\tthis.php_js.localeCategories[category] = locale;\n\t}\n\treturn locale;\n}\n\n/**\n * @param {String} fmt format string (C library strftime-style)\n * @param {String} timestamp ISO 8601 formatted time string\n * @returns {String}\n */\nfunction strftime (fmt, timestamp) {\n\t// Format a local time/date according to locale settings  \n\t// \n\t// version: 1107.2516\n\t// discuss at: http://phpjs.org/functions/strftime\n\t// +      original by: Blues (http://tech.bluesmoon.info/)\n\t// + reimplemented by: Brett Zamir (http://brett-zamir.me)\n\t// +   input by: Alex\n\t// +   bugfixed by: Brett Zamir (http://brett-zamir.me)\n\t// +   improved by: Brett Zamir (http://brett-zamir.me)\n\t// -       depends on: setlocale\n\t// %        note 1: Uses global: php_js to store locale info\n\t// *        example 1: strftime(\"%A\", 1062462400); // Return value will depend on date and locale\n\t// *        returns 1: 'Tuesday'\n\t// BEGIN REDUNDANT\n\tthis.php_js = this.php_js || {};\n\tthis.setlocale('LC_ALL', 0); // ensure setup of localization variables takes place\n\t// END REDUNDANT\n\tvar phpjs = this.php_js;\n \n\t// BEGIN STATIC\n\tvar _xPad = function (x, pad, r) {\n\t\tif (typeof r === 'undefined') {\n\t\t\tr = 10;\n\t\t}\n\t\tfor (; parseInt(x, 10) < r && r > 1; r /= 10) {\n\t\t\tx = pad.toString() + x;\n\t\t}\n\t\treturn x.toString();\n\t};\n \n\tvar locale = phpjs.localeCategories.LC_TIME;\n\tvar locales = phpjs.locales;\n\tvar lc_time = locales[locale].LC_TIME;\n \n\tvar _formats = {\n\t\ta: function (d) {\n\t\t\treturn lc_time.a[d.getDay()];\n\t\t},\n\t\tA: function (d) {\n\t\t\treturn lc_time.A[d.getDay()];\n\t\t},\n\t\tb: function (d) {\n\t\t\treturn lc_time.b[d.getMonth()];\n\t\t},\n\t\tB: function (d) {\n\t\t\treturn lc_time.B[d.getMonth()];\n\t\t},\n\t\tC: function (d) {\n\t\t\treturn _xPad(parseInt(d.getFullYear() / 100, 10), 0);\n\t\t},\n\t\td: ['getDate', '0'],\n\t\te: ['getDate', ' '],\n\t\tg: function (d) {\n\t\t\treturn _xPad(parseInt(this.G(d) / 100, 10), 0);\n\t\t},\n\t\tG: function (d) {\n\t\t\tvar y = d.getFullYear();\n\t\t\tvar V = parseInt(_formats.V(d), 10);\n\t\t\tvar W = parseInt(_formats.W(d), 10);\n \n\t\t\tif (W > V) {\n\t\t\t\ty++;\n\t\t\t} else if (W === 0 && V >= 52) {\n\t\t\t\ty--;\n\t\t\t}\n \n\t\t\treturn y;\n\t\t},\n\t\tH: ['getHours', '0'],\n\t\tI: function (d) {\n\t\t\tvar I = d.getHours() % 12;\n\t\t\treturn _xPad(I === 0 ? 12 : I, 0);\n\t\t},\n\t\tj: function (d) {\n\t\t\tvar ms = d - new Date('' + d.getFullYear() + '/1/1 GMT');\n\t\t\tms += d.getTimezoneOffset() * 60000; // Line differs from Yahoo implementation which would be equivalent to replacing it here with:\n\t\t\t// ms = new Date('' + d.getFullYear() + '/' + (d.getMonth()+1) + '/' + d.getDate() + ' GMT') - ms;\n\t\t\tvar doy = parseInt(ms / 60000 / 60 / 24, 10) + 1;\n\t\t\treturn _xPad(doy, 0, 100);\n\t\t},\n\t\tk: ['getHours', '0'],\n\t\t// not in PHP, but implemented here (as in Yahoo)\n\t\tl: function (d) {\n\t\t\tvar l = d.getHours() % 12;\n\t\t\treturn _xPad(l === 0 ? 12 : l, ' ');\n\t\t},\n\t\tm: function (d) {\n\t\t\treturn _xPad(d.getMonth() + 1, 0);\n\t\t},\n\t\tM: ['getMinutes', '0'],\n\t\tp: function (d) {\n\t\t\treturn lc_time.p[d.getHours() >= 12 ? 1 : 0];\n\t\t},\n\t\tP: function (d) {\n\t\t\treturn lc_time.P[d.getHours() >= 12 ? 1 : 0];\n\t\t},\n\t\ts: function (d) { // Yahoo uses return parseInt(d.getTime()/1000, 10);\n\t\t\treturn Date.parse(d) / 1000;\n\t\t},\n\t\tS: ['getSeconds', '0'],\n\t\tu: function (d) {\n\t\t\tvar dow = d.getDay();\n\t\t\treturn ((dow === 0) ? 7 : dow);\n\t\t},\n\t\tU: function (d) {\n\t\t\tvar doy = parseInt(_formats.j(d), 10);\n\t\t\tvar rdow = 6 - d.getDay();\n\t\t\tvar woy = parseInt((doy + rdow) / 7, 10);\n\t\t\treturn _xPad(woy, 0);\n\t\t},\n\t\tV: function (d) {\n\t\t\tvar woy = parseInt(_formats.W(d), 10);\n\t\t\tvar dow1_1 = (new Date('' + d.getFullYear() + '/1/1')).getDay();\n\t\t\t// First week is 01 and not 00 as in the case of %U and %W,\n\t\t\t// so we add 1 to the final result except if day 1 of the year\n\t\t\t// is a Monday (then %W returns 01).\n\t\t\t// We also need to subtract 1 if the day 1 of the year is\n\t\t\t// Friday-Sunday, so the resulting equation becomes:\n\t\t\tvar idow = woy + (dow1_1 > 4 || dow1_1 <= 1 ? 0 : 1);\n\t\t\tif (idow === 53 && (new Date('' + d.getFullYear() + '/12/31')).getDay() < 4) {\n\t\t\t\tidow = 1;\n\t\t\t} else if (idow === 0) {\n\t\t\t\tidow = _formats.V(new Date('' + (d.getFullYear() - 1) + '/12/31'));\n\t\t\t}\n\t\t\treturn _xPad(idow, 0);\n\t\t},\n\t\tw: 'getDay',\n\t\tW: function (d) {\n\t\t\tvar doy = parseInt(_formats.j(d), 10);\n\t\t\tvar rdow = 7 - _formats.u(d);\n\t\t\tvar woy = parseInt((doy + rdow) / 7, 10);\n\t\t\treturn _xPad(woy, 0, 10);\n\t\t},\n\t\ty: function (d) {\n\t\t\treturn _xPad(d.getFullYear() % 100, 0);\n\t\t},\n\t\tY: 'getFullYear',\n\t\tz: function (d) {\n\t\t\tvar o = d.getTimezoneOffset();\n\t\t\tvar H = _xPad(parseInt(Math.abs(o / 60), 10), 0);\n\t\t\tvar M = _xPad(o % 60, 0);\n\t\t\treturn (o > 0 ? '-' : '+') + H + M;\n\t\t},\n\t\tZ: function (d) {\n\t\t\treturn d.toString().replace(/^.*\\(([^)]+)\\)$/, '$1');\n\t\t/*\n            // Yahoo's: Better?\n            var tz = d.toString().replace(/^.*:\\d\\d( GMT[+-]\\d+)? \\(?([A-Za-z ]+)\\)?\\d*$/, '$2').replace(/[a-z ]/g, '');\n            if(tz.length > 4) {\n                tz = Dt.formats.z(d);\n            }\n            return tz;\n            */\n\t\t},\n\t\t'%': function (d) {\n\t\t\treturn '%';\n\t\t}\n\t};\n\t// END STATIC\n\t/* Fix: Locale alternatives are supported though not documented in PHP; see http://linux.die.net/man/3/strptime */\n\n\tvar _date = ((typeof(timestamp) == 'undefined') ? new Date() : // Not provided\n\t\t(typeof(timestamp) == 'object') ? new Date(timestamp) : // Javascript Date()\n\t\tnew Date(timestamp * 1000) // PHP API expects UNIX timestamp (auto-convert to int)\n\t\t);\n\tvar _aggregates = {\n\t\tc: 'locale',\n\t\tD: '%m/%d/%y',\n\t\tF: '%y-%m-%d',\n\t\th: '%b',\n\t\tn: '\\n',\n\t\tr: 'locale',\n\t\tR: '%H:%M',\n\t\tt: '\\t',\n\t\tT: '%H:%M:%S',\n\t\tx: 'locale',\n\t\tX: 'locale'\n\t};\n \n \n\t// First replace aggregates (run in a loop because an agg may be made up of other aggs)\n\twhile (fmt.match(/%[cDFhnrRtTxX]/)) {\n\t\tfmt = fmt.replace(/%([cDFhnrRtTxX])/g, function (m0, m1) {\n\t\t\tvar f = _aggregates[m1];\n\t\t\treturn (f === 'locale' ? lc_time[m1] : f);\n\t\t});\n\t}\n \n\t// Now replace formats - we need a closure so that the date object gets passed through\n\tvar str = fmt.replace(/%([aAbBCdegGHIjklmMpPsSuUVwWyYzZ%])/g, function (m0, m1) {\n\t\tvar f = _formats[m1];\n\t\tif (typeof f === 'string') {\n\t\t\treturn _date[f]();\n\t\t} else if (typeof f === 'function') {\n\t\t\treturn f(_date);\n\t\t} else if (typeof f === 'object' && typeof(f[0]) === 'string') {\n\t\t\treturn _xPad(_date[f[0]](), f[1]);\n\t\t} else { // Shouldn't reach here\n\t\t\treturn m1;\n\t\t}\n\t});\n\treturn str;\n}\n","/*jslint browser:true, sloppy:true, white:true*/\n/*global $:true, Modernizr:true*/\n/*global deviceVars:true, MyAnswers:true, siteVars:true, log:true*/\n/*global currentConfig:true*/\n\nvar activityIndicatorTop, $navBar,\n    onDeviceReady = $.noop; // there are no gecko-based native applications\ndocument.getElementById('startUp-loadDevice').className = 'working';\nMyAnswers.deviceDeferred = new $.Deferred();\n\n// ** device-specific initialisation of variables and flags **\n\nfunction init_device() {\n  var $activityIndicator = $('#activityIndicator');\n  log('init_device()');\n  deviceVars.scrollProperty = 'top';\n  deviceVars.scrollValue = '$1px';\n\n  //    deviceVars.disableXSLT = true;\n\n  // caching frequently-accessed selectors\n  $navBar = $('#navBoxHeader');\n  activityIndicatorTop = Math.floor($(window).height() / 2);\n  $activityIndicator.css('top', activityIndicatorTop);\n  $('#startUp-initDevice').addClass('success');\n}\n\n(function(window) {\n  var $ = window.jQuery,\n  /* @inner */\n  MyAnswersDevice = function() {\n    var me = this;\n    /* END: var */\n    me.hideLocationBar = function() {\n      window.scrollTo(0, 1);\n    };\n    /**\n         * hide the current view, and prepare the new view for display\n         * @param {jQuery} $view the jQuery-selected element that will be shown.\n         * @param {Boolean} reverseTransition toggle transition direction.\n         * @return {jQueryPromise}\n         */\n    me.prepareView = function($view, reverseTransition) {\n      var deferred = new $.Deferred(),\n      $oldView = $('.view:visible').not($view[0]),\n      $navBoxHeader = $('#navBoxHeader');\n      /* END: var */\n      MyAnswers.dispatch.add(function() {\n        // move the incoming $view offscreen for compositing\n        $view.hide();\n        $view.css({\n          'z-index': 0,\n          position: 'absolute'\n        });\n        $oldView.css({\n          'z-index': 50,\n          position: 'absolute'\n        });\n        // add information about Interaction to DOM\n        if (currentMasterCategory) {\n          $view.attr({\n            'data-name': siteVars.config['m' + currentMasterCategory].pertinent.name\n          });\n        } else {\n          $('#categoriesView').removeAttr('data-name');\n        }\n\n\n        if (currentCategory) {\n          $view.attr({\n            'data-name': siteVars.config['c' + currentCategory].pertinent.name\n          });\n        } else {\n          $('#keywordListView').removeAttr('data-name');\n        }\n        if (currentInteraction) {\n\n          $view.attr({\n            'data-name': siteVars.config['i' + currentInteraction].pertinent.name,\n            'data-type': siteVars.config['i' + currentInteraction].pertinent.type\n          });\n        } else {\n          $('#answerView').removeAttr('data-name');\n          $('#answerView').removeAttr('data-type');\n        }\n\n        $view.show();\n        if (window.currentConfig.footerPosition !== 'screen-bottom') {\n          MyAnswers.$body.children('footer').hide();\n        }\n        $navBoxHeader.find('button').prop('disabled', true);\n        deferred.resolve();\n      });\n      return deferred.promise();\n    };\n    me.showView = function($view, reverseTransition) {\n      var deferred = new $.Deferred(),\n      $oldView = $('.view:visible').not($view[0]),\n      endPosition = (reverseTransition ? 'right' : 'left'),\n      startPosition = (reverseTransition ? 'left' : 'right');\n      /* END: var */\n      me.hideLocationBar();\n      MyAnswers.dispatch.add(function() {\n        if ($oldView.length !== 0) {\n          // transition the old view away\n          $oldView.hide('slide', {\n            direction: endPosition\n          }, 300, function() {\n            $oldView.css('z-index', '');\n            $oldView.css('position', '');\n            $view.css('z-index', '');\n            $view.css('position', '');\n            updateNavigationButtons();\n            MyAnswers.$body.children('footer').show();\n            deferred.resolve();\n            $view.trigger('viewShow');\n          });\n        } else {\n          $view.css('z-index', '');\n          $view.css('position', '');\n          updateNavigationButtons();\n          MyAnswers.$body.children('footer').show();\n          deferred.resolve();\n          $view.trigger('viewShow');\n        }\n      });\n      return deferred.promise();\n    };\n    return me;\n  };\n  /* END: var */\n  window.MyAnswersDevice = new MyAnswersDevice();\n}(this));\n\n/*\n ABOVE: all methods need implementation per device (directly called from main.js)\n BELOW: methods assisting the above methods (NOT directly called from main.js)\n*/\n\ndocument.getElementById('startUp-loadDevice').className = 'working success';\nMyAnswers.deviceDeferred.resolve();\n","/*jslint browser:true, devel:true, regexp:true, sloppy:true, white:true*/\n/*jslint nomen:true, plusplus:true*/\n\n/*global info, log, warn, error*/\n/*global computeTimeout, isBlinkGapDevice, MyAnswersDevice*/\n/*global init_device, onDeviceReady, prepareHistorySideBar*/\n/*global BlinkDispatch, BlinkForms, BlinkStorage*/\n\n/*global $, Hashtable, History, Modernizr*/\n/*global explode, implode*/\n/*global _Blink*/\n\nvar MyAnswers = MyAnswers || {},\n    siteVars = siteVars || {},\n    deviceVars = deviceVars || {},\n    hasCategories = false, hasMasterCategories = false,\n    hasInteractions = false,\n    answerSpaceOneKeyword = false,\n    currentInteraction, currentCategory, currentMasterCategory,\n    currentConfig = {},\n    starsProfile = {};\n/* END: var */\n\ndocument.getElementById('startUp-loadMain').className = 'working';\n\ncurrentConfig.downloadTimeout = 30;\ncurrentConfig.uploadTimeout = 45;\ndeviceVars.isOnline = true;\n\nMyAnswers.mainDeferred = new $.Deferred();\nMyAnswers.browserDeferred = new $.Deferred();\nMyAnswers.formsDeferred = new $.Deferred();\nMyAnswers.dfrdMoJOs = null; // processMoJOs() promise\nMyAnswers.dfrdGoogleMaps = null;\nsiteVars.mojos = siteVars.mojos || {};\nsiteVars.forms = siteVars.forms || {};\n\nMyAnswers.isLoggedIn = false;\nMyAnswers.isCustomLogin = false;\nMyAnswers.isEmptySpace = false; // empty except for loginUseInteractions\n\n// *** BEGIN UTILS ***\n\nfunction isCameraPresent() {\n  var test = isBlinkGapDevice();\n  info('isBlinkGapDevice(): ' + test);\n  return test && window.device.camerapresent;\n}\n\nfunction triggerScroll(event) {\n  $(window).trigger('scroll');\n}\n\nfunction insertHTML(element, html) {\n  if ($.type(element) === 'object') {\n    MyAnswers.dispatch.add(function() {\n      $(element).html(html);\n      $('img').off('error', siteVars.fixImages);\n      $('img').on('error', siteVars.fixImages);\n    });\n  }\n}\n\nfunction insertText(element, text) {\n  if ($.type(element) === 'object' && typeof text === 'string') {\n    MyAnswers.dispatch.add(function() {$(element).text(text);});\n  }\n}\n\nfunction setMainLabel(label) {\n  var mainLabel = document.getElementById('mainLabel');\n  insertText(mainLabel, label);\n}\n\n/**\n * convert 'argument=value&args[0]=value1&args[1]=value2'\n * into '{\"argument\":\"value\",\"args[0]\":\"value1\",\"args[1]\":\"value2\"}'\n */\nfunction deserialize(argsString) {\n  var args = argsString.split('&'),\n    result = { };\n  $.each(args, function(index, string) {\n    var equalIndex, name, value;\n    if (string.length !== 0 && (equalIndex = string.indexOf('=')) !== -1) {\n      name = string.substring(0, equalIndex);\n      value = string.substring(equalIndex + 1);\n      result[decodeURIComponent(name)] = decodeURIComponent(value);\n    }\n  });\n  return result;\n}\n\nfunction getURLParameters() {\n  var href = window.location.href,\n      matches,\n      parameters = {},\n      regexp = new RegExp('/' + siteVars.answerSpace + '/([^/?]*)', 'i');\n\n  if (href.indexOf('?') !== -1) {\n    matches = href.match(/\\?([^#]*)#?.*$/);\n    if (matches && matches.length >= 2) {\n      parameters = deserialize(matches[1]);\n      if (typeof parameters.keyword === 'string') {\n        parameters.keyword = parameters.keyword.replace('/', '');\n      }\n    }\n  }\n  matches = href.match(regexp);\n  if (matches && matches.length >= 2) {\n    parameters.keyword = matches[1];\n  }\n  return parameters;\n}\n\n// TODO: deprecate this function\nfunction isAJAXError(status)\n{\n  switch (status) {\n    case null:\n    case 'timeout':\n    case 'error':\n    case 'notmodified':\n    case 'parseerror':\n      return true;\n    default:\n      return false;\n  }\n}\n\nfunction populateDataTags($element, data) {\n  var d;\n  for (d in data) {\n    if (data.hasOwnProperty(d)) {\n      $element.attr('data-' + d, data[d]);\n    }\n  }\n}\n\nfunction processBlinkAnswerMessage(message) {\n  var i,\n      iLength,\n      isPersist = MyAnswers.device.persistentStorage;\n\n  message = $.parseJSON(message);\n  if (isPersist && typeof message.mojotarget === 'string') {\n    if (typeof message.mojoxml === 'string') {\n      log('controlMessage: populating Data Suitcase: ' + message.mojotarget);\n      MyAnswers.store.set('mojoXML:' + message.mojotarget, message.mojoxml);\n    } else if (message.mojodelete) {\n      log('controlMessage: deleting Data Suitcase: ' + message.mojotarget);\n      MyAnswers.store.remove('mojoXML:' + message.mojotarget);\n    }\n  }\n  if (isPersist && message.startype) {\n    starsProfile[message.startype] = starsProfile[message.startype] || {};\n    if (message.clearstars) {\n      delete starsProfile[message.startype];\n    }\n    if ($.type(message.staroff) === 'array') {\n      iLength = message.staroff.length;\n      for (i = 0; i < iLength; i++) {\n        delete starsProfile[message.startype][message.staroff[i]];\n      }\n    }\n    if ($.type(message.staron) === 'array') {\n      iLength = message.staron.length;\n      for (i = 0; i < iLength; i++) {\n        starsProfile[message.startype][message.staron[i]] = starsProfile[message.startype][message.staron[i]] || {};\n      }\n    }\n    MyAnswers.store.set('starsProfile', JSON.stringify(starsProfile));\n  }\n}\n\n// *** END OF UTILS ***\n\n/**\n * @param name\n * @param level \"interactions\" or \"categories\" or \"masterCategories\".\n * @return numeric identifier, or boolean false if not found\n */\nfunction resolveItemName(name, level) {\n  var prefix, list, l, lLength, id;\n  level = (typeof level === 'string' && level) || 'interactions';\n  prefix = level.substring(0, 1);\n  if (typeof name === 'number' && !isNaN(name) && $.type(siteVars.config[prefix + name]) === 'object') {\n    return name;\n  }\n  if (typeof name !== 'string') {return false;}\n  name = decodeURI(name.replace(/\\+/g, ' ').toLowerCase());\n  list = siteVars.map[level];\n  lLength = list.length;\n  for (l = 0; l < lLength; l++) {\n    id = prefix + list[l];\n    if ($.type(siteVars.config[id]) === 'object' && name === siteVars.config[id].pertinent.name.toLowerCase()) {\n      return list[l];\n    }\n  }\n  if ($.type(siteVars.config[prefix + name]) === 'object') {\n    return name;\n  }\n  return false;\n}\n\n//take 2 plain XML strings, then transform the first using the second (XSL)\n//insert the result into element\nfunction performXSLT(xmlString, xslString) {\n  var deferred = new $.Deferred(function(dfrd) {\n    var html, xml, xsl,\n        processor,\n        transformer,\n        ActiveXObject = window.ActiveXObject;\n    if (typeof xmlString !== 'string' || typeof(xslString) !== 'string') {\n      dfrd.reject('XSLT failed due to poorly formed XML or XSL.');\n      return;\n    }\n    xml = $.parseXML(xmlString);\n    xsl = $.parseXML(xslString);\n    /*\n     * if (deviceVars.hasWebWorkers === true) {\n     * log('performXSLT(): enlisting Web Worker to perform\n     * XSLT'); var message = { }; message.fn = 'processXSLT'; message.xml =\n     * xmlString; message.xsl = xslString; message.target = target;\n     * MyAnswers.webworker.postMessage(message); return '<p>This keyword is\n     * being constructed entirely on your device.</p><p>Please wait...</p>'; }\n     */\n    if (window.XSLTProcessor) {\n      log('performXSLT(): performing XSLT via XSLTProcessor (W3C)');\n      processor = new window.XSLTProcessor();\n      processor.importStylesheet(xsl);\n      html = processor.transformToFragment(xml, document);\n    } else if (typeof xml.transformNode !== 'undefined') {\n      // have to use typeof here, checking for \"truthy\" breaks in IE\n      log('performXSLT(): performing XSLT via transformNode (IE)');\n      html = xml.transformNode(xsl);\n    } else if (window.xsltProcess) {\n      log('performXSLT(): performing XSLT via AJAXSLT library');\n      html = window.xsltProcess(xml, xsl);\n    } else {\n      html = '<p>Your browser does not support Data Suitcase keywords.</p>';\n    }\n    dfrd.resolve(html);\n  });\n  return deferred.promise();\n}\n\n//test to see if the user it viewing the highest level screen\nfunction isHome() {\n  var siteStructure = siteVars.config['a' + siteVars.id].pertinent.siteStructure,\n    currentView = $('.view:visible').first().attr('id');\n  switch (siteStructure) {\n    case 'master categories':\n      return currentView === 'masterCategoriesView';\n    case 'categories':\n      return currentView === 'categoriesView';\n    default:\n      return currentView === 'keywordListView';\n  }\n}\n\n// perform all steps necessary to populate element with Data Suitcase result\nfunction generateMojoAnswer(args) {\n  log('generateMojoAnswer(): currentConfig=' + currentConfig.name);\n  var deferred = new $.Deferred(),\n      dfrdXml = new $.Deferred(), // promise for when we have XML\n      xml,\n      xsl = currentConfig.xsl,\n      placeholders, p, pLength,\n      value,\n      variable, condition,\n      starType,\n      starDetailFn = function(d, detail) {\n        xml += '<' + d + '>' + detail + '</' + d + '>';\n      },\n      conditionStarFn = function(star, details) {\n        condition += ' or ' + variable + '=\\'' + star + '\\'';\n      };\n  /* END: var */\n  if ($.type(xsl) !== 'string' || xsl.length === 0) {\n    deferred.reject('<p>Error: this Interaction does not have any XSL to transform.</p>');\n    return deferred.promise();\n  }\n  // adjust XSL for arguments\n  if (args) {\n    placeholders = xsl.match(/\\$args\\[[\\w\\:][\\w\\:\\-\\.]*\\]/g);\n    pLength = placeholders ? placeholders.length : 0;\n    for (p = 0; p < pLength; p++) {\n      value = typeof args[placeholders[p].substring(1)] === 'string' ? args[placeholders[p].substring(1)] : '';\n      // TODO: find a better solution upstream for having to decode this here\n      value = value.replace('\"', '');\n      value = value.replace(\"'\", '');\n      value = decodeURIComponent(value);\n      xsl = xsl.replace(placeholders[p], value);\n    }\n  }\n  // adjust XSL for Stars\n  starType = xsl.match(/blink-stars\\(([@\\w.]+),\\W*(\\w+)\\W*\\)/);\n  while (starType) {\n    condition = '';\n    variable = starType[1];\n    starType = starType[2];\n    if ($.type(starsProfile[starType]) === 'object') {\n      $.each(starsProfile[starType], conditionStarFn);\n      condition = condition.substr(4);\n    }\n    if (condition.length > 0) {\n      xsl = xsl.replace(/\\(?blink-stars\\(([@\\w.]+),\\W*(\\w+)\\W*\\)\\)?/, '(' + condition + ')');\n    } else {\n      xsl = xsl.replace(/\\(?blink-stars\\(([@\\w.]+),\\W*(\\w+)\\W*\\)\\)?/, '(false())');\n    }\n    starType = xsl.match(/blink-stars\\(([@\\w.]+),\\W*(\\w+)\\W*\\)/);\n  }\n  // resolve Data Suitcase type (legacy Stars format)\n  if ($.type(currentConfig.xml) === 'string'\n      && currentConfig.xml.indexOf('stars:') === 0) {\n    currentConfig.mojoType = 'stars';\n    currentConfig.xml = currentConfig.xml.replace(/^stars:/, '');\n  }\n  // make sure we have XML\n  if (currentConfig.mojoType === 'stars') { // use starred items\n    starType = currentConfig.xml;\n    xml = '';\n    if ($.type(starsProfile[starType]) !== 'object') {\n      xml = '<stars></stars>';\n    } else {\n      $.each(starsProfile[starType], function(s, details) {\n        xml += '<' + starType + ' id=\"' + s + '\">';\n        $.each(details, starDetailFn);\n        xml += '</' + starType + '>';\n      });\n      xml = '<stars>' + xml + '</stars>';\n    }\n    setTimeout(dfrdXml.resolve, 0);\n\n  } else if (currentConfig.mojoType === 'active-forms') {\n    $.when(window.getActiveFormsXML())\n    .always(function(formsXml) {\n          xml = formsXml;\n          setTimeout(dfrdXml.resolve, 0);\n        });\n\n  } else if ($.type(currentConfig.xml) === 'string' && !!currentConfig.xml) {\n    $.when(MyAnswers.store.get('mojoXML:' + currentConfig.xml))\n    .always(function(data) {\n//          var general = '<p>The data used to contruct this page is not currently stored on your device.</p>',\n//              hosted = '<p>Please try again in 30 seconds.</p>';\n          /* END: var */\n          xml = data;\n          if(!xml){\n            xml = '<xml />';\n          }\n          setTimeout(dfrdXml.resolve, 0);\n        });\n\n  } else {\n    xml = '<xml />';\n    setTimeout(dfrdXml.resolve, 0);\n  }\n  // only continue if we haven't already resolve / failed\n  if (deferred.state() !== 'pending') {\n    return deferred.promise();\n  }\n  // continue with processing\n  $.when(dfrdXml)\n  .always(function() {\n        $.when(performXSLT(xml, xsl)).done(function(html) {\n          deferred.resolve(html);\n        }).fail(function(html) {\n          deferred.resolve(html);\n        });\n      });\n  return deferred.promise();\n}\n\nfunction getActiveFormsXML() {\n  var dfrd = new $.Deferred(),\n      xml = '';\n  /* END: var */\n  $.when(MyAnswers.pendingStore.keys(), MyAnswers.pendingV1Store.keys())\n  .fail(function() {\n        xml = '<type>error</type>';\n        xml += '<message>Unable to list active form records.</message>';\n        xml = '<status>' + xml + '</status>';\n        dfrd.resolve('<?xml version=\"1.0\"?>\\n<records>' + xml + '</records>');\n      })\n  .then(function(keys, keysV1) {\n        var promises = [],\n            /**\n     * @inner\n     */\n            keysFn = function(index, key, version) {\n              var keyParts = key.split(':'),\n                  interaction = siteVars.config['i' + keyParts[0]],\n                  name = interaction ? interaction.pertinent.name : '* unknown *',\n                  label = interaction ? (interaction.pertinent.displayName || interaction.pertinent.name) : '* unknown *',\n                  form = keyParts[1],\n                  uuid = keyParts[2],\n                  record = '',\n                  dfrdSummary;\n              /* END: var */\n              record += '<id>' + key + '</id>\\n';\n              record += '<interaction>' + name + '</interaction>\\n';\n              record += '<interactionLabel>' + label + '</interactionLabel>\\n';\n              record += '<uuid>' + uuid + '</uuid>\\n';\n              record += '<form>' + form + '</form>\\n';\n              record += '<blinkFormsVersion>' + version + '</blinkFormsVersion>\\n';\n              if (version === 2) {\n                // relying on deferred callbacks running in attach-order\n                dfrdSummary = MyAnswers.pendingStore.get(key);\n                promises.push(dfrdSummary.promise());\n                $.when(dfrdSummary)\n        .fail(function() {\n                      xml += '<record>' + record + '</record>\\n';\n                    })\n        .then(function(json) {\n                      var fields = '',\n                          metadata;\n                      /* END: var */\n                      if (typeof json !== 'string' || json.length === 0) {\n                        return;\n                      }\n                      if ($.type(json) !== 'object') {\n                        json = $.parseJSON(json);\n                      }\n                      if ($.type(json) === 'array') {\n                        if (json.length >= 3) {\n                          // TODO: actually store this metadata so it can be retrieved here\n                          metadata = json[2];\n                          if (metadata.status) {\n                            record += '<status>' + metadata.status + '</status>\\n';\n                          }\n                        }\n                        $.each(json[1], function(name, value) {\n                          var field = '';\n                          field += '<name>' + name + '</name>\\n';\n                          field += '<value>' + htmlspecialchars(value) + '</value>\\n';\n                          // TODO: provide access to field type and label\n                          fields += '<field>' + field + '</field>\\n';\n                        });\n                        record += '<fields>' + fields + '</fields>\\n';\n                      }\n                      xml += '<record>' + record + '</record>\\n';\n                    });\n              } else { // version === 1\n                xml += '<record>' + record + '</record>\\n';\n              }\n            };\n        $.each(keys, function(index, key) {\n          keysFn(index, key, 2);\n        });\n        $.each(keysV1, function(index, key) {\n          keysFn(index, key, 1);\n        });\n        $.whenArray(promises)\n    .fail(function() {\n              xml = '<type>error</type>';\n              xml += '<message>Unable to list active form records.</message>';\n              xml = '<status>' + xml + '</status>';\n              dfrd.resolve('<?xml version=\"1.0\"?>\\n<records>' + xml + '</records>');\n            })\n    .then(function() {\n              dfrd.resolve('<?xml version=\"1.0\"?>\\n<records>' + xml + '</records>');\n            });\n      });\n  return dfrd.promise();\n}\n\nfunction setSubmitCachedFormButton() {\n  var $button = $('#pendingButton'),\n      count = 0;\n  /* END: var */\n  // update pending forms button if necessary\n  if ($button.length > 0) {\n    $.when(window.countPendingForms())\n    .fail(function() {\n          $button.hide();\n        })\n    .then(function(count) {\n          var buttonText = count + ' Pending';\n          MyAnswers.dispatch.add(function() {\n            if (typeof count === 'number' && count > 0) {\n              insertText($button[0], buttonText);\n              $button.show();\n            } else {\n              $button.hide();\n            }\n            log('setSubmitCachedFormButton(): ' + buttonText);\n          });\n        });\n  }\n}\n\n// *** END BLINK UTILS ***\n\n// *** BEGIN EVENT HANDLERS ***\n\nfunction onStarClick(event)\n{\n  var id = $(this).data('id'),\n    type = $(this).data('type'),\n    data = $(this).data(),\n    k,\n    date = new Date();\n  delete data.id;\n  delete data.type;\n  if ($(this).hasClass('blink-star-on'))\n  {\n    $(this).addClass('blink-star-off');\n    $(this).removeClass('blink-star-on');\n    delete starsProfile[type][id];\n    if ($.isEmptyObject(starsProfile[type])) {\n      delete starsProfile[type];\n    }\n  }\n  else if ($(this).hasClass('blink-star-off'))\n  {\n    $(this).addClass('blink-star-on');\n    $(this).removeClass('blink-star-off');\n    if ($.type(starsProfile[type]) !== 'object') {\n      starsProfile[type] = { };\n    }\n    starsProfile[type][id] = { };\n    for (k in data)  {\n      if (data.hasOwnProperty(k)) {\n        starsProfile[type][id][k.toUpperCase()] = data[k];\n      }\n    }\n    starsProfile[type][id].time = date.getTime();\n    starsProfile[type][id].type = type;\n    starsProfile[type][id].id = id;\n  }\n  MyAnswers.store.set('starsProfile', JSON.stringify(starsProfile));\n}\n\nfunction onLinkClick(event) {\n  var $element = $(this),\n  a, attributes = $element.attr(),\n  id,\n  isUnique = false, // true if we need to make the state unique\n  isPushState = true, // false if we should replace instead of push the state\n  data = null, title = null, url = null, // arguments for History\n  parts; // variables for working with legacy links\n\n  try {\n    log('onLinkClick(): ' + $(this).tagHTML());\n    // TODO: find a more efficient way to decide if we need to make the state unique\n    // turn any legacy links into new format before continuing\n    if (typeof attributes.href === 'string') {\n      attributes.href = $.trim(attributes.href);\n      parts = explode('?', attributes.href, 2);\n      if(parts[1]) {\n        $.each(deserialize(parts[1].trim()), function(key, value) {\n          attributes[key] = value;\n        });\n      }\n      if (attributes.href.indexOf('../') !== -1) {\n        parts[0] = parts[0].replace(/^\\.\\.\\//, '');\n        attributes.interaction = parts[0].replace(/^(.*)(?:\\/)$/g, '$1');\n        delete attributes.href;\n      }\n      if (attributes.href && attributes.href[0] === '#') {\n        // allow the browser to handle \"#...\"\n        return true;\n      }\n      if (attributes.href && attributes.href[0] === '?') {\n        delete attributes.interaction;\n        delete attributes.keyword;\n        delete attributes.style;\n        delete attributes['class'];\n        url = attributes.href;\n        data = History.getState().data;\n        data.arguments = attributes;\n        title = window.document.title;\n        if (isPushState) {\n          History.pushState(data, title, url);\n        } else {\n          History.replaceState(data, title, url);\n        }\n        event.preventDefault();\n        return false;\n      }\n    }\n    // process link\n    if (!attributes.href && !attributes.onclick) {\n      if (attributes.back) {\n        History.back();\n        event.preventDefault();\n        return false;\n      }\n      if (attributes.home) {\n        url = '/' + siteVars.answerSpace + '/';\n      } else if (attributes.login) {\n        data = {login: true};\n      } else if (attributes.interaction || attributes.keyword) {\n        id = resolveItemName(attributes.interaction || attributes.keyword, 'interactions');\n        if (id) {\n          $.each(attributes, function(key, value) {\n            if (key[0] === '_') {\n              attributes['args[' + key.substr(1) + ']'] = value;\n              delete attributes[key];\n            }\n          });\n          delete attributes.interaction;\n          delete attributes.keyword;\n          delete attributes.style;\n          delete attributes['class'];\n          if (attributes['data-submit-stars-type']) {\n            attributes._submitStarsType = $element.data('submitStarsType');\n            attributes._submitStarsPost = $element.data('submitStarsPost') || 'stars';\n          }\n          url = '/' + siteVars.answerSpace + '/' + siteVars.config['i' + id].pertinent.name + '/?' + $.param(attributes);\n          data = {m: currentMasterCategory, c: currentCategory, i: id, 'arguments': attributes};\n        }\n      } else if (attributes.category) {\n        id = resolveItemName(attributes.category, 'categories');\n        if (id) {\n          url = '/' + siteVars.answerSpace + '/?_c=' + id;\n          data = {m: currentMasterCategory, c: id};\n        }\n      } else if (attributes.mastercategory) {\n        id = resolveItemName(attributes.mastercategory, 'masterCategories');\n        if (id) {\n          url = '/' + siteVars.answerSpace + '/?_m=' + id;\n          data = {m: id};\n        }\n      }\n      if (isUnique) { // we need to make the state unique somehow\n        if ($.type(data) === 'object') {\n          data._timestamp = $.now();\n        } else {\n          data = {_timestamp: $.now()};\n        }\n      }\n      if (data || url) { // make sure we actually have a state to push\n        if (isPushState) {\n          History.pushState(data, title, url);\n        } else {\n          History.replaceState(data, title, url);\n        }\n      }\n      event.preventDefault();\n      return false;\n    }\n  } catch (e) {\n    error('Error in onLinkClick handler...');\n    error(e);\n  }\n  return true;\n}\n\n// *** END EVENT HANDLERS ***\n\n// *** PENDING QUEUE HELPERS ***\n\n\n/**\n * Count the number of stored submissions for both BlinkForms v1 and v2.\n * @return {jQueryPromise} number of stored forms\n */\nfunction countPendingForms() {\n  var deferred = new $.Deferred();\n  $.when(MyAnswers.pendingStore.count(), MyAnswers.pendingV1Store.count())\n  .then(function(size2, size1) {\n    deferred.resolve(size2 + size1);\n  })\n  .fail(function() {\n    error('countPendingForms() unable to query storage');\n    deferred.resolve(0);\n  });\n  return deferred.promise();\n}\n\n\n/**\n * Add a BlinkForms v2 submission to the queue.\n * @param {String} interaction ID.\n * @param {String} form name of the form object.\n * @param {String} uuid UUID.\n * @param {Object} data key=>value pairs to be JSON-encoded.\n * @param {Object} summary key=>value pairs to be JSON-encoded.\n * @return {jQueryPromise}\n */\nfunction pushPendingForm(interaction, form, uuid, data, summary) {\n  var deferred = new $.Deferred();\n  $.when(MyAnswers.pendingStore.set(interaction + ':' + form + ':' + uuid, JSON.stringify(data)))\n    .then(function() {\n      deferred.resolve();\n    })\n    .fail(function() {\n      deferred.reject();\n    })\n    .always(setSubmitCachedFormButton);\n  return deferred.promise();\n}\n\n\n/**\n * Remove a BlinkForms v2 submission from the queue.\n * @param {String} interaction ID.\n * @param {String} form name of the form object.\n * @param {String} uuid UUID.\n * @return {jQueryPromise}\n */\nfunction clearPendingForm(interaction, form, uuid) {\n  var deferred = new $.Deferred();\n  $.when(MyAnswers.pendingStore.remove(interaction + ':' + form + ':' + uuid))\n    .then(function() {\n      deferred.resolve();\n    })\n    .fail(function() {\n      deferred.reject();\n    })\n    .always(setSubmitCachedFormButton);\n  return deferred.promise();\n}\n\n\n/**\n * Add a BlinkForms v1 submission to the queue.\n * @param {String} interaction ID.\n * @param {String} form name of the form object.\n * @param {String} uuid UUID.\n * @param {Object} data key=>value pairs to be JSON-encoded.\n * @return {jQueryPromise}\n */\nfunction pushPendingFormV1(interaction, uuid, data) {\n  var deferred = new $.Deferred();\n  $.when(MyAnswers.pendingV1Store.set(interaction + ':' + uuid, JSON.stringify(data))).then(function() {\n    deferred.resolve(data);\n  }).fail(function() {\n    deferred.reject();\n  }).always(setSubmitCachedFormButton);\n  return deferred.promise();\n}\n\n\n/**\n * Remove a BlinkForms v2 submission from the queue.\n * @param {String} interaction ID.\n * @param {String} form name of the form object.\n * @param {String} uuid UUID.\n * @return {jQueryPromise}\n */\nfunction clearPendingFormV1(interaction, uuid) {\n  var deferred = new $.Deferred();\n  $.when(MyAnswers.pendingV1Store.remove(interaction + ':' + uuid)).then(function() {\n    deferred.resolve();\n  }).fail(function() {\n    deferred.reject();\n  }).always(setSubmitCachedFormButton);\n  return deferred.promise();\n}\n\n// *** END PENDING QUEUE HELPERS ***\n\nfunction requestMoJO(mojo) {\n  var deferred = new $.Deferred();\n  if ($.type(mojo) !== 'string' || mojo.length === 0) {\n    deferred.resolve();\n    return deferred.promise();\n  }\n  $.when(MyAnswers.store.get('mojoLastChecked:' + mojo)).done(function(value) {\n    var requestData = {\n        _id: siteVars.id,\n        _m: mojo\n      };\n    value = parseInt(value, 10);\n    if (typeof value === 'number' && !isNaN(value)) {\n      requestData._lc = value;\n    }\n    if (deviceVars.isOnline) {\n      $.ajax({\n        url: '/_R_/xhr/GetMoJO.php',\n        data: requestData,\n        dataType: 'xml',\n        complete: function(jqxhr, status) {\n          if (jqxhr.status === 200) {\n            $.when(MyAnswers.store.set('mojoXML:' + mojo, jqxhr.responseText))\n              .fail(deferred.reject)\n              .then(deferred.resolve);\n          //                MyAnswers.store.set('mojoLastUpdated:' + mojo, new Date(jqxhr.getResponseHeader('Last-Modified')).getTime());\n          //          } else if (jqxhr.status === 304) {\n          //            deferred.resolve();\n          } else {\n            //            deferred.reject();\n            deferred.resolve();\n          }\n        },\n        timeout: Math.max(currentConfig.downloadTimeout * 1000, computeTimeout(500 * 1024))\n      });\n    } else {\n      deferred.reject();\n    }\n  });\n  $.when(deferred.promise())\n    .then(function() {\n      MyAnswers.store.set('mojoLastChecked:' + mojo, $.now());\n    });\n  return deferred.promise();\n}\n\nfunction processMoJOs(interaction) {\n  var deferred = new $.Deferred(),\n  deferredFetches = {},\n  interactions = interaction ? [interaction] : siteVars.map.interactions,\n  i, iLength = interactions.length,\n  config;\n  /* END: var */\n  for (i = 0; i < iLength; i++) {\n    config = siteVars.config['i' + interactions[i]];\n    if ($.type(config) === 'object') {\n      config = config.pertinent;\n      if ($.type(config) === 'object' && config.type === 'xslt' && config.mojoType === 'server-hosted') {\n        if (typeof config.xml === 'string' && config.xml.substring(0, 6) !== 'stars:') {\n          if (!siteVars.mojos[config.xml]) {\n            siteVars.mojos[config.xml] = {\n              maximumAge: config.maximumAge || 0,\n              minimumAge: config.minimumAge || 0\n            };\n          } else {\n            siteVars.mojos[config.xml].maximumAge = config.maximumAge ? Math.min(config.maximumAge, siteVars.mojos[config.xml].maximumAge) : siteVars.mojos[config.xml].maximumAge;\n            siteVars.mojos[config.xml].minimumAge = config.minimumAge ? Math.max(config.minimumAge, siteVars.mojos[config.xml].minimumAge) : siteVars.mojos[config.xml].minimumAge;\n          }\n          if (!deferredFetches[config.xml]) {\n            deferredFetches[config.xml] = requestMoJO(config.xml);\n          }\n        }\n      }\n    }\n  }\n  deferredFetches = $.map(deferredFetches, function(value, key) {\n    return value;\n  });\n  $.whenArray(deferredFetches)\n  .fail(deferred.reject)\n  .then(deferred.resolve);\n  return deferred.promise();\n}\n\nfunction goBackToHome() {\n  History.replaceState(null, null, '/' + siteVars.answerSpace + '/');\n  MyAnswers.$body.trigger('taskComplete');\n  //  getSiteConfig();\n}\n\nfunction showLoginView(event) {\n  var id,\n    requestUri,\n    $view = $('#loginView');\n  if (!currentConfig.loginAccess) {\n    return false;\n  }\n  if (MyAnswers.isCustomLogin) {\n    id = resolveItemName(currentConfig.loginPromptInteraction, 'interactions');\n    if (!id) {\n      BMP.alert('error: interaction used for login prompt is inaccessible or misconfigured');\n      return false;\n    }\n    requestUri = '/' + siteVars.answerSpace + '/' + siteVars.config['i' + id].pertinent.name + '/?';\n    History.pushState({m: null, c: null, i: id}, null, requestUri);\n    return false;\n  }\n  $.when(MyAnswersDevice.prepareView($view)).always(function() {\n    MyAnswersDevice.showView($view);\n    setMainLabel('Login');\n  });\n}\n\nfunction updateLoginButtons() {\n  var loginStatus = document.getElementById('loginStatus'),\n      loginButton = document.getElementById('loginButton'),\n      logoutButton = document.getElementById('logoutButton'),\n      /** @inner */\n      submitLogoutFn = function(event) {\n        var id, requestUri;\n        log('submitLogout();');\n        if (!currentConfig.loginAccess) {\n          return false;\n        }\n        if (currentConfig.loginUseInteractions) {\n          id = resolveItemName(currentConfig.loginPromptInteraction, 'interactions');\n          if (!id) {\n            BMP.alert('error: login interaction is inaccessible or misconfigured');\n            return false;\n          }\n          requestUri = '/' + siteVars.answerSpace + '/' + siteVars.config['i' + id].pertinent.name + '/?';\n          History.pushState({\n            m: null,\n            c: null,\n            i: id\n          }, null, requestUri);\n          return false;\n        }\n        BMP.confirm('Log out?')\n            .then(function(result) {\n              if (result) {\n                $.ajax({\n                  type: 'GET',\n                  cache: 'false',\n                  url: '/_R_/xhr/GetLogin.php',\n                  data: {\n                    '_a': 'logout'\n                  },\n                  complete: function(xhr, textstatus) {\n                    if (xhr.status === 200) {\n                      var data = $.parseJSON(xhr.responseText);\n                      if (data) {\n                        if (data.status === 'LOGGED IN') {\n                          MyAnswers.loginAccount = data;\n                          MyAnswers.isLoggedIn = true;\n                        } else {\n                          MyAnswers.isLoggedIn = false;\n                          delete MyAnswers.loginAccount;\n                          window.location.reload();\n                        }\n                      }\n                      updateLoginButtons();\n                      //          getSiteConfig();\n                      goBackToHome();\n                    }\n                  },\n                  timeout: currentConfig.downloadTimeout * 1000\n                });\n              }\n            });\n\n        return false;\n      };\n  /* END: var */\n  if (!siteVars.hasLogin) {\n    return;\n  }\n  if (MyAnswers.isLoggedIn) {\n    if (MyAnswers.loginAccount && typeof MyAnswers.loginAccount !== 'boolean') {\n      MyAnswers.dispatch.add(function() {\n        var $loginStatus = $(loginStatus),\n            text = 'logged in as<br />';\n        if ($.type(MyAnswers.loginAccount) === 'object') {\n          text += '<span class=\"loginAccount\">' + MyAnswers.loginAccount.name || MyAnswers.loginAccount.username + '</span>';\n        } else {\n          text += '<span class=\"loginAccount\">' + MyAnswers.loginAccount + '</span>';\n        }\n        $loginStatus.empty();\n        $loginStatus.append(text);\n        $loginStatus.off();\n        $loginStatus.on('click', submitLogoutFn);\n      });\n      $(loginStatus).show();\n    } else {\n      $(logoutButton).show();\n    }\n    $(loginButton).hide();\n  } else {\n    $(loginStatus).hide();\n    $(logoutButton).hide();\n    $(loginButton).show();\n  }\n  if (currentCategory !== undefined) {\n    MyAnswers.populateItemListing('interactions', $('#keywordListView'));\n  }\n}\n\nfunction requestLoginStatus() {\n  var deferred = new $.Deferred();\n  if (!siteVars.hasLogin || !deviceVars.isOnline) {\n    deferred.reject();\n    return deferred.promise();\n  }\n  $.ajax({\n    url: '/_R_/xhr/GetLogin.php',\n    dataType: 'json',\n    complete: function(xhr, xhrStatus) {\n      if (isAJAXError(xhrStatus) || xhr.status !== 200) {\n        deferred.reject();\n        return;\n      }\n      var data = $.parseJSON(xhr.responseText);\n      if (data) {\n        if (data.status === 'LOGGED IN') {\n          MyAnswers.loginAccount = data;\n          MyAnswers.isLoggedIn = true;\n        } else {\n          MyAnswers.isLoggedIn = false;\n          delete MyAnswers.loginAccount;\n        }\n      }\n      updateLoginButtons();\n      deferred.resolve();\n    },\n    timeout: Math.max(currentConfig.downloadTimeout * 1000, computeTimeout(500))\n  });\n  return deferred.promise();\n}\n\nfunction submitLogin() {\n  log('submitLogin();');\n  $.ajax({\n    type: 'GET',\n    cache: 'false',\n    url: '/_R_/xhr/GetLogin.php',\n    data: $('#loginView').find('form').serializeArray(),\n    complete: function(xhr, textstatus) {\n      $('#loginView').find('input[type=password]').val('');\n      if (xhr.status === 200) {\n        var data = $.parseJSON(xhr.responseText);\n        if (data) {\n          if (data.status === 'LOGGED IN') {\n            MyAnswers.loginAccount = data;\n            MyAnswers.isLoggedIn = true;\n            //            window.location.reload();\n            $.when(window.requestConfig()).always(function() {\n              if (siteVars.map && siteVars.config) {\n                window.processConfig();\n                window.updateNavigationButtons();\n                // explicity do not implement loginToDefaultScreen here\n              } else {\n                BMP.alert('error: insufficient data, check network and reload / refresh');\n              }\n            });\n          } else {\n            MyAnswers.isLoggedIn = false;\n            delete MyAnswers.loginAccount;\n          }\n        }\n        updateLoginButtons();\n      //        getSiteConfig();\n      } else {\n        BMP.alert('Unable to login:  (' + textstatus + ' ' + xhr.status + ') ' + xhr.responseText);\n      }\n    },\n    timeout: currentConfig.downloadTimeout * 1000\n  });\n}\n\nMyAnswers.gotoDefaultScreen = function() {\n  var History = window.History,\n      requestUri;\n\n  if (currentConfig.defaultScreen === 'login' || MyAnswers.isLoginOnly) {\n    showLoginView();\n    /*History.pushState({\n      login: true\n    });*/\n  } else if (currentConfig.defaultScreen === 'interaction' && hasInteractions && typeof siteVars.config['i' + currentConfig.defaultInteraction] !== undefined) {\n    requestUri = '/' + siteVars.answerSpace + '/' + siteVars.config['i' + currentConfig.defaultInteraction].pertinent.name + '/?';\n    History.pushState({\n      i: currentConfig.defaultInteraction\n    }, null, requestUri);\n  } else if (currentConfig.defaultScreen === 'category' && hasCategories && typeof siteVars.config['c' + currentConfig.defaultCategory] !== undefined) {\n    requestUri = '/' + siteVars.answerSpace + '/?_c=' + currentConfig.defaultCategory;\n    History.pushState({\n      c: currentConfig.defaultCategory\n    }, null, requestUri);\n  } else if (currentConfig.defaultScreen === 'master category' && hasMasterCategories && typeof siteVars.config['m' + currentConfig.defaultMasterCategory] !== undefined) {\n    requestUri = '/' + siteVars.answerSpace + '/?_m=' + currentConfig.defaultMasterCategory;\n    History.pushState({\n      m: currentConfig.defaultMasterCategory\n    }, null, requestUri);\n  } else { // default \"home\"\n    History.replaceState({\n      _now: $.now()\n    }, null, '/' + siteVars.answerSpace + '/');\n  }\n};\n\nfunction updateNavigationButtons() {\n  var isPersist = MyAnswers.device.persistentStorage;\n  MyAnswers.dispatch.add(function() {\n    try {\n      var $navBars = $('.navBar'),\n          $navButtons = $('#homeButton, #backButton'),\n          $helpButton = $('#helpButton'),\n          $formsButton = $('#pendingButton'),\n          helpContents,\n          isHelp,\n          isLogin = siteVars.hasLogin,\n          isHome = window.isHome(),\n          isNoNavButtons = isHome || MyAnswers.isEmptySpace || MyAnswers.isLoginOnly,\n          isNoNavBar,\n          dfrdForms;\n      /* END: var */\n      // determine if we need the help button\n      switch ($('.view:visible').first().attr('id'))\n      {\n        case 'keywordView':\n        case 'answerView':\n        case 'answerView2':\n          if (currentInteraction) {\n            helpContents = siteVars.config['i' + currentInteraction].pertinent.help;\n          }\n          break;\n        case 'helpView':\n          helpContents = null;\n          break;\n        default:\n          helpContents = siteVars.config['a' + siteVars.id];\n          break;\n      }\n      isHelp = typeof helpContents === 'string';\n      if (isHelp) {\n        $helpButton.show();\n        $helpButton.removeAttr('disabled');\n      } else {\n        $helpButton.hide();\n      }\n      // determine if we need to count the active forms in the queue\n      if ($formsButton.length > 0 && isNoNavButtons) {\n        dfrdForms = countPendingForms();\n      } else {\n        dfrdForms = true;\n      }\n      $.when(dfrdForms) // after we've counted the forms (if necessary), ...\n      .always(function(formsCount) {\n            if (typeof formsCount !== 'number') {\n              formsCount = 0;\n            }\n            isNoNavBar = isNoNavButtons && !isLogin && !isHelp && !formsCount;\n            if (isNoNavBar) {\n              $navBars.hide();\n            } else if (isNoNavButtons) {\n              $navBars.show();\n              $navButtons.hide();\n            } else {\n              $navButtons.show();\n              $navButtons.prop('disabled', false);\n              $navBars.show();\n            }\n          });\n      $('#loginButton, #logoutButton, #pendingButton').removeAttr('disabled');\n      // update data suitcases if necessary\n      if (isPersist && isHome && MyAnswers.dfrdMoJOs.state() !== 'pending') {\n        processMoJOs();\n      }\n      // update the sidebar\n      MyAnswers.dispatch.add(function() {$(window).trigger('scroll');});\n      if (MyAnswers.sideBar) {\n        MyAnswers.sideBar.update();\n      }\n    } catch (e) {\n      error('Error in updateNavigationButtons...');\n      error(e);\n    }\n  });\n}\n\nfunction initialiseAnswerFeatures($view) {\n  log('initialiseAnswerFeatures(): view=' + $view.attr('id'));\n  var deferred = new $.Deferred(),\n    promises = [],\n    oldLoginStatus,\n    current = $.type(currentInteraction) === 'string' ? currentInteraction : String(currentInteraction),\n    prompt = $.type(currentConfig.loginPromptInteraction) === 'string' ? currentConfig.loginPromptInteraction : String(currentConfig.loginPromptInteraction);\n  // loginUseInteractions\n  if (currentConfig.loginAccess && currentConfig.loginUseInteractions && prompt === current) {\n    oldLoginStatus = MyAnswers.isLoggedIn;\n    $.when(requestLoginStatus()).always(function() {\n      if (MyAnswers.isLoggedIn !== oldLoginStatus) {\n        if (MyAnswers.isLoggedIn) {\n          $.when(window.requestConfig()).always(function() {\n            if (siteVars.map && siteVars.config) {\n              window.processConfig();\n              window.updateNavigationButtons();\n              if (currentConfig.loginToDefaultScreen) {\n                MyAnswers.gotoDefaultScreen();\n              }\n            } else {\n              BMP.alert('error: insufficient data, check network and reload / refresh');\n            }\n          });\n        } else {\n          window.location.reload();\n        }\n      }\n    });\n  }\n  // END: loginUseInteractions\n  MyAnswers.dispatch.add(function() {\n    var $inputs = $view.find('input, textarea, select'),\n      $form = $view.find('form').first(),\n      isGoogleJSLoaded = window.google && window.google.maps && window.google.maps.Map;\n    MyAnswers.$body.trigger('taskBegun');\n    $inputs.off('blur', triggerScroll);\n    $inputs.on('blur', triggerScroll);\n    if (MyAnswers.device.persistentStorage) {\n      $view.find('.blink-starrable').each(function(index, element) {\n        var $div = $('<div class=\"blink-starrable\" />'),\n          data = $(element).data();\n        populateDataTags($div, data);\n        $div.on('click', onStarClick);\n        if ($.type(starsProfile[$(element).data('type')]) !== 'object' || $.type(starsProfile[$(element).data('type')][$(element).data('id')]) !== 'object') {\n          $div.addClass('blink-star-off');\n        } else {\n          $div.addClass('blink-star-on');\n        }\n        $(element).replaceWith($div);\n      });\n    }\n    if ($view.find('div.googlemap').length > 0) { // check for items requiring Google features (so far only #map)\n      if (isGoogleJSLoaded) {\n        setTimeout(function() {\n          MyAnswers.setupGoogleMaps($view);\n        }, 1000);\n      } else {\n        MyAnswers.dfrdGoogleMaps = new $.Deferred();\n        $.getCachedScript('//maps.googleapis.com/maps/api/js?key=' + _Blink.cfg.GOOGLE_API_KEY + '&v=3&sensor=true&callback=MyAnswers.onGoogleMapsLoad')\n        .fail(function() {\n          throw ('unable to download Google Maps JavaScript library');\n        })\n        .then(function() {\n          $.when(MyAnswers.dfrdGoogleMaps.promise())\n          .fail(function() {\n            log('initialiseAnswerFeatures() error: unable to initialise Google Maps API');\n          })\n          .then(function() {\n            delete window.onGoogleMapsLoad;\n            delete MyAnswers.dfrdGoogleMaps;\n            MyAnswers.setupGoogleMaps($view);\n          });\n        });\n      }\n    }\n    if ($form.length !== 0) {\n      if (typeof $form.data('objectName') === 'string' && $form.data('objectName').length > 0) {\n        $.when(MyAnswers.formsDeferred.promise())\n        .always(function() {\n          promises.push(BlinkForms.initialiseForm($form));\n        });\n      }\n    }\n  });\n  MyAnswers.dispatch.add(function() {\n    $.when.apply($, promises).always(function() {\n      MyAnswers.$body.trigger('taskComplete');\n      deferred.resolve();\n      $view.trigger('viewReady');\n    });\n  });\n  return deferred.promise();\n}\n\n// run after any change to current*\nfunction updateCurrentConfig() {\n  var configs = [],\n      features = _.clone(deviceVars.features),\n      isRotating = $.inArray('portrait', deviceVars.features) !== -1 &&\n          $.inArray('landscape', deviceVars.features) !== -1,\n      a = 'a' + siteVars.id,\n      m = 'm' + currentMasterCategory,\n      c = 'c' + currentCategory,\n      i = 'i' + currentInteraction,\n      object,\n      /**\n       * for use with jQuery.map()\n       * @param {String} value the complete override string.\n       * @param {Number} index (not used).\n       * @return {String|Null} original value upon match, else null.\n       */\n      isFeatureMatch = function(value, index) {\n        // overrides are made up of mandatory sets\n        var sets = value.split('+'),\n            s, sLength = sets.length,\n            options, o, oLength,\n            isSetPresent,\n            isOptionPresent;\n\n        for (s = 0; s < sLength; s++) {\n          options = sets[s].split('|');\n          oLength = options.length;\n          isSetPresent = true;\n          isOptionPresent = false;\n\n          if (sets[s].indexOf('|') !== -1) {\n            // set contains multiple options (at least one must match)\n            for (o = 0; o < oLength; o++) {\n              if ($.inArray(options[o], features) !== -1) {\n                isOptionPresent = true;\n                break;\n              }\n            }\n            if (!isOptionPresent) {\n              isSetPresent = false;\n            }\n          } else if ($.inArray(sets[s], features) === -1) {\n            // set is simply a single condition\n            isSetPresent = false;\n          }\n          if (!isSetPresent) {\n            // part of the override did not match, exit early\n            return null;\n          }\n        }\n        // the entire override matches current features\n        return value;\n      },\n      /**\n       * @param {Array} override names of configuration sections.\n       * @return {Number} weight for Underscore.sortBy().\n       */\n      sortOverrides = function(override) {\n        if (!override || typeof override !== 'string' ||\n            override.indexOf('+') === -1) {\n          return 0;\n        }\n        return override.match(/\\+/g).length;\n      },\n      /**\n       * for use with jQuery.each()\n       * @param {Number} index 0-based position of value (not used).\n       * @param {String} value name of the particular override section.\n       */\n      pushConfig = function(index, value) {\n        configs.push(object[value]);\n      };\n\n  // TODO: need to fold orientation-specific config into this somewhere\n  log('updateCurrentConfig(): ' + a + ' ' + m + ' ' + c + ' ' + i);\n  currentConfig = {};\n  configs.push(currentConfig);\n  // setting current orientation\n  if (isRotating) {\n    features = _.without(features, 'portrait', 'landscape');\n    features.push(MyAnswers.orientation);\n  }\n  // populate the stack with configs we need to consider\n  $.each([a, m, c, i], function(index, id) {\n    var overrides,\n        isSimple;\n\n    object = siteVars.config[id];\n    if (!object || !$.isObject(object)) {\n      return;\n    }\n    overrides = _.keys(object);\n    isSimple = overrides.length === 1 && overrides[0] === 'pertinent';\n    if (isSimple) {\n      configs.push(object.pertinent);\n    } else {\n      configs.push(object.pertinent);\n      overrides = $.map(overrides, isFeatureMatch);\n      overrides = _.sortBy(overrides, sortOverrides);\n      $.each(overrides, pushConfig);\n    }\n  });\n  // flatten the stack\n  $.extend.apply(this, configs);\n\n  if(currentConfig.logoBanner) {\n    currentConfig.logoBanner = siteVars.cdnu.getURL(currentConfig.logoBanner);\n  }\n  if(currentConfig.splashImage) {\n    currentConfig.splashImage = siteVars.cdnu.getURL(currentConfig.splashImage);\n  }\n  if(currentConfig.icon) {\n    currentConfig.icon = siteVars.cdnu.getURL(currentConfig.icon);\n  }\n\n  // perform inherited changes\n  MyAnswers.dispatch.add(function() {\n    var $banner = $('#bannerBox'),\n      $image = $banner.find('img'),\n      imageSrc = currentConfig.logoBanner;\n    if (typeof currentConfig.logoBanner === 'string') {\n      if (imageSrc !== $image.attr('src')) {\n        $image.attr('src', imageSrc);\n      }\n      $banner.show();\n    } else {\n      $image.removeAttr('src');\n      $banner.hide();\n    }\n  });\n  // fix footer\n  MyAnswers.dispatch.add(function() {\n    if (MyAnswers.$footer.html() !== currentConfig.footer) {\n      MyAnswers.$footer.html(currentConfig.footer);\n    }\n    if (currentConfig.footerPosition === 'screen-bottom') {\n      MyAnswers.$footer.css({\n        position: 'fixed',\n        bottom: '0px',\n        'z-index': 1\n      });\n    } else {\n      MyAnswers.$footer.removeAttr('style');\n    }\n  });\n  // fix styles\n  MyAnswers.dispatch.add(function() {\n    var style = '',\n      $style = $('style[data-setting=\"styleSheet\"]');\n    style += currentConfig.styleSheet || '';\n    style += currentConfig.interfaceStyle ? 'body { ' + currentConfig.interfaceStyle + ' }\\n' : '';\n    style += currentConfig.backgroundStyle ? '.box { ' + currentConfig.backgroundStyle + ' }\\n' : '';\n    style += currentConfig.inputPromptStyle ? '#argsBox { ' + currentConfig.inputPromptStyle + ' }\\n' : '';\n    style += currentConfig.evenRowStyle ? 'ul.box > li:nth-child(even), tr.even { ' + currentConfig.evenRowStyle + ' }\\n' : '';\n    style += currentConfig.oddRowStyle ? 'ul.box > li:nth-child(odd), tr.odd { ' + currentConfig.oddRowStyle + ' }\\n' : '';\n    style += currentConfig.headerStyle ? 'body > header { ' + currentConfig.headerStyle + ' }\\n' : '';\n    style += currentConfig.footerStyle ? 'body > footer { ' + currentConfig.footerStyle + ' }\\n' : '';\n    style += currentConfig.masterCategoriesStyle ? '#masterCategoriesBox > .masterCategory { ' + currentConfig.masterCategoriesStyle + ' }\\n' : '';\n    style += currentConfig.categoriesStyle ? '#categoriesBox > .category { ' + currentConfig.categoriesStyle + ' }\\n' : '';\n    style += currentConfig.interactionsStyle ? '#keywordBox > .interaction, #keywordList > .interaction { ' + currentConfig.interactionsStyle + ' }\\n' : '';\n    if (!$style.length) {\n      return;\n    }\n    if ($style[0].styleSheet) {\n      // Internet Explorer 8\n      if (style !== $style[0].styleSheet.cssText) {\n        $style[0].styleSheet.cssText = style;\n      }\n    } else {\n      // other browsers\n      if (style !== $style.text()) {\n        $style.text(style);\n      }\n    }\n  });\n  MyAnswers.dispatch.add(function() {\n    var $view = $('.view:visible').last(),\n        level;\n    try {\n      if ($view.hasClass('listing')) {\n        switch ($view.attr('id')) {\n        case 'masterCategoriesView':\n          level = 'masterCategories';\n          break;\n        case 'categoriesView':\n          level = 'categories';\n          break;\n        default:\n          level = 'interactions';\n        }\n        MyAnswers.populateItemListing(level, $view);\n      }\n    } catch (error) {\n      error('Error in updateCurrentConfig...');\n    }\n  });\n}\n\n(function(window) {\n  var MyAnswers = window.MyAnswers;\n\n  function onMasterCategoryClick(event) {\n    History.pushState({\n      m: $(this).data('id')\n      } , null, '/' + siteVars.answerSpace + '/?_m=' + $(this).data('id'));\n  }\n  function onCategoryClick(event) {\n    History.pushState({\n      m: $(this).data('masterCategory'),\n      c: $(this).data('id')\n      }, null, '/' + siteVars.answerSpace + '/?_c=' + $(this).data('id'));\n  }\n  function onKeywordClick(event) {\n    var interaction = siteVars.config['i' + $(this).data('id')].pertinent.name;\n    History.pushState({\n      m: $(this).data('masterCategory'),\n      c: $(this).data('category'),\n      i: $(this).data('id')\n      }, null, '/' + siteVars.answerSpace + '/' + interaction + '/');\n  }\n  function onHyperlinkClick(event) {\n    //window.location.assign($(this).data('hyperlink'));\n    window.open($(this).data('hyperlink'),$(this).data('target'));\n  }\n\n  MyAnswers.populateItemListing = function(level, $view) {\n    var arrangement, display, order, list, $visualBox, $listBox, type,\n      name, $item, $label, $description,\n      hook = {},\n      o, oLength,\n      category, columns, $images,\n      itemConfig;\n    hook.interactions = function($item) {\n      var id = $item.attr('data-id'),\n          pertinent = siteVars.config['i' + id].pertinent;\n      if (pertinent.type === 'hyperlink' && pertinent.hyperlink) {\n        $item.attr('data-hyperlink', pertinent.hyperlink);\n        $item.attr('data-target', pertinent.hyperlinkTarget);\n        $item.on('click', onHyperlinkClick);\n      } else {\n        $item.on('click', onKeywordClick);\n      }\n    };\n    hook.categories = function($item) {\n      var id = $item.attr('data-id');\n      if (siteVars.map['c' + id].length === 1) {\n        $item.attr('data-category', id);\n        $item.attr('data-id', siteVars.map['c' + id][0]);\n        hook.interactions($item);\n      } else if (siteVars.map['c' + id].length > 0) {\n        $item.on('click', onCategoryClick);\n      }\n    };\n    hook.masterCategories = function($item) {\n      var id = $item.attr('data-id');\n      if (siteVars.map['m' + id].length === 1) {\n        $item.attr('data-master-category', id);\n        $item.attr('data-id', siteVars.map['m' + id][0]);\n        hook.categories($item);\n      } else if (siteVars.map['m' + id].length > 0) {\n        $item.on('click', onMasterCategoryClick);\n      }\n    };\n    MyAnswers.dispatch.add(function() {\n      $view.children('.box:not(.welcomeBox)').remove();\n      $visualBox = $('<div class=\"box bordered\" />');\n      $listBox = $('<ul class=\"box\" />');\n      switch (level) {\n        case 'masterCategories':\n          arrangement = currentConfig.masterCategoriesArrangement;\n          display = currentConfig.masterCategoriesDisplay;\n          order = siteVars.map.masterCategories;\n          list = order;\n          type = 'm';\n          break;\n        case 'categories':\n          arrangement = currentConfig.categoriesArrangement;\n          display = currentConfig.categoriesDisplay;\n          order = siteVars.map.categories;\n          list = siteVars.map['m' + currentMasterCategory] || order;\n          type = 'c';\n          break;\n        case 'interactions':\n          arrangement = currentConfig.interactionsArrangement;\n          display = currentConfig.interactionsDisplay;\n          order = siteVars.map.interactions;\n          list = siteVars.map['c' + currentCategory] || order;\n          type = 'i';\n          break;\n      }\n      if ($view.attr('id') === 'BlinkSideBar') {\n        arrangement = 'list';\n        display = currentConfig.sidebarDisplay;\n      }\n      log('MyAnswers.populateItemListing(): ' + level + ' ' + arrangement + ' ' + display + ' ' + type + '[' + list.join(',') + ']');\n      switch (arrangement) {\n        case 'list':\n          columns = 1;\n          break;\n        case '2 column':\n          columns = 2;\n          break;\n        case '3 column':\n          columns = 3;\n          break;\n        case '4 column':\n          columns = 4;\n          break;\n      }\n      oLength = order.length;\n      for (o = 0; o < oLength; o++) {\n        itemConfig = siteVars.config[type + order[o]];\n        if (itemConfig && $.inArray(order[o], list) !== -1 && itemConfig.pertinent.display !== 'hide') {\n          name = itemConfig.pertinent.displayName || itemConfig.pertinent.name;\n          if (display !== 'text only' && itemConfig.pertinent.icon) {\n            $item = $('<img />');\n            $item.attr({\n              'class': 'v' + columns + 'col',\n              'src': itemConfig.pertinent.icon,\n              'alt': name\n            });\n            $visualBox.append($item);\n          } else {\n            $item = $('<li />');\n            $label = $('<div class=\"label\" />');\n            $label.text(name);\n            $item.append($label);\n            if (typeof itemConfig.pertinent.description === 'string') {\n              $description = $('<div class=\"description\" />');\n              $description.text(itemConfig.pertinent.description);\n              $item.append($description);\n            }\n            $listBox.append($item);\n          }\n          $item.attr('data-id', order[o]);\n          hook[level]($item);\n        }\n      }\n    });\n    MyAnswers.dispatch.add(function() {\n      if ($visualBox.children().length > 0) {\n        $images = $visualBox.find('img');\n        if (columns === 1) {\n          $images.first().addClass('topLeft topRight');\n          $images.last().addClass('bottomLeft bottomRight');\n        } else {\n          $images.first().addClass('topLeft');\n          if ($images.length >= columns) {\n            $images.eq(columns - 1).addClass('topRight');\n          }\n          if ($images.length % columns === 0) {\n            $images.eq(columns * -1).addClass('bottomLeft');\n            $images.last().addClass('bottomRight');\n          }\n        }\n        $visualBox.appendTo($view);\n      }\n      if ($listBox.children().length > 0) {\n        $listBox.appendTo($view);\n      }\n    });\n  };\n\n}(this));\n\n(function(window) {\n  var $ = window.jQuery,\n    MyAnswers = window.MyAnswers,\n    deviceVars = window.deviceVars,\n    BlinkSideBar = {},\n    $sideBar = $('#BlinkSideBar'),\n    $stack = $('#stackLayout'),\n    currentLevel, oldLevel,\n    currentItem, oldItem;\n\n  BlinkSideBar.show = function() {\n    MyAnswers.dispatch.add(function() {\n      $stack.addClass('bSideBar-on');\n      $stack.find('.selected').removeClass('selected');\n      $stack.find('[data-id=' + currentCategory + ']').addClass('selected');\n    });\n  };\n  BlinkSideBar.hide = function() {\n    MyAnswers.dispatch.add(function() {\n      $stack.removeClass('bSideBar-on');\n    });\n  };\n  BlinkSideBar.update = function() {\n    var config = siteVars.config['a' + siteVars.id].pertinent;\n    if ($.inArray('phone', deviceVars.features) !== -1 || $(window).width() < 768 || config.sidebarDisplay === 'disabled') {\n      this.hide();\n      return;\n    }\n    if (hasMasterCategories && currentMasterCategory) {\n      currentLevel = 'masterCategories';\n      currentItem = currentMasterCategory;\n    } else if (hasCategories && currentCategory) {\n      currentLevel = 'categories';\n      currentItem = currentCategory;\n    } else if (hasInteractions && currentCategory) {\n      currentLevel = 'interactions';\n      currentItem = currentInteraction;\n    } else {\n      this.hide();\n      return;\n    }\n    if (oldLevel !== currentLevel) {\n      MyAnswers.populateItemListing(currentLevel, $sideBar);\n    }\n    oldLevel = currentLevel;\n    oldItem = currentItem;\n    this.show();\n  };\n\n  MyAnswers.sideBar = BlinkSideBar;\n}(this));\n\n\nfunction showMasterCategoriesView(reverse) {\n  var $view = $('#masterCategoriesView');\n  log('showMasterCategoriesView()');\n  currentInteraction = null;\n  currentCategory = null;\n  currentMasterCategory = null;\n  $.when(MyAnswersDevice.prepareView($view, reverse)).always(function() {\n    MyAnswers.populateItemListing('masterCategories', $view);\n    updateCurrentConfig();\n    setMainLabel('Master Categories');\n    MyAnswersDevice.showView($view, reverse);\n  });\n}\n\nfunction goBackToMasterCategoriesView() {\n  var $view = $('#masterCategoriesView');\n  log('goBackToMasterCategoriesView()');\n  $.when(MyAnswersDevice.prepareView($view, true)).always(function() {\n    updateCurrentConfig();\n    setMainLabel('Master Categories');\n    MyAnswersDevice.showView($('#masterCategoriesView'), true);\n  });\n}\n\nfunction showCategoriesView(masterCategory) {\n  var $view = $('#categoriesView');\n  log('showCategoriesView(): ' + masterCategory);\n  currentInteraction = null;\n  currentCategory = null;\n  if (hasMasterCategories && masterCategory) {\n    currentMasterCategory = masterCategory;\n  }\n  $.when(MyAnswersDevice.prepareView($view)).always(function() {\n    updateCurrentConfig();\n    setMainLabel(masterCategory ? siteVars.config['m' + masterCategory].pertinent.name : 'Categories');\n    MyAnswers.populateItemListing('categories', $view);\n    MyAnswersDevice.showView($view);\n  });\n}\n\nfunction goBackToCategoriesView() {\n  var $view = $('#categoriesView');\n  currentInteraction = null;\n  currentCategory = null;\n  log('goBackToCategoriesView()');\n  $.when(MyAnswersDevice.prepareView($view, true)).always(function() {\n    updateCurrentConfig();\n    setMainLabel(currentMasterCategory ? siteVars.config['m' + currentMasterCategory].pertinent.name : 'Categories');\n    MyAnswersDevice.showView($view, true);\n  });\n}\n\n/**\n * @param {jQuery} $xml XML document wrapped in a jQuery object.\n * @return {Object} plain Object { \"form\": { \"field\": \"subForm\", ... } }.\n * @private\n */\nfunction processFormsMap($xml) {\n  var map = {},\n      $form,\n      objectId;\n      // for use with jQuery.each\n      eachElement = function(index, element) {\n        var $element = $(element);\n        map[objectId][$element.attr('id')] = $element.attr('object');\n      };\n\n  if (! $xml instanceof jQuery || !$xml.length) {\n    return {};\n  }\n  $xml.children('formObject[id]').each(function(index, element) {\n    $form = $(element);\n    objectId = $form.attr('id');\n    map[objectId] = {};\n    $form.children('formElement[id][object]').each(eachElement);\n  });\n  return map;\n}\n\nfunction processForms() {\n  var dispatch = new BlinkDispatch(0),\n  ajaxDeferred = new $.Deferred(),\n  libraryDeferred = new $.Deferred(),\n  promises,\n  validActions = ['add', 'delete', 'edit', 'find', 'list', 'search', 'view'],\n  /* @inner */\n  formActionFn = function(id, element) {\n    var dfrd = new $.Deferred();\n    dispatch.add(function() {\n      var $action = $(element),\n        action = $action.tag(),\n        storeKey = 'formXML:' + id + ':' + action,\n        $children = $action.children(), c, cLength = $children.length,\n        xml,\n        html = '';\n      if (validActions.indexOf($action.tag()) !== -1) {\n        for (c = 0; c < cLength; c++) {\n          xml = _Blink.stringifyDOM($children[c]);\n          if (xml) {\n            html += xml;\n          }\n        }\n        $.when(MyAnswers.store.set(storeKey, html))\n        .fail(function() {\n          warn('processForms()->formActionFn(): failed storing ' + storeKey);\n          dfrd.reject();\n        })\n        .then(function() {\n          MyAnswers.store.set('formLastChecked:' + id + ':' + action, $.now());\n          if (MyAnswers.isDebug) {\n            log('processForms()->formActionFn(): formXML=' + storeKey);\n          }\n          dfrd.resolve();\n        });\n      } else {\n        dfrd.resolve();\n      }\n    });\n    return dfrd.promise();\n  },\n  /* @inner */\n  formObjectFn = function(index, element) {\n    var $formObject = $(element);\n    if ($formObject.tag() === '_map') {\n      siteVars.map.forms = processFormsMap($formObject);\n    } else {\n      $formObject.children().each(function(index, element) {\n        promises.push(formActionFn($formObject.attr('id'), element));\n      });\n    }\n  };\n  /* END: var */\n  if (window.BlinkForms && window.BlinkFormObject && window.BlinkFormElement) {\n    libraryDeferred = true;\n  } else {\n    libraryDeferred = $.getCachedScript('/_R_/forms2/forms2.min.js');\n  }\n  promises = [libraryDeferred];\n  if (MyAnswers.device.persistentStorage) {\n    promises.push(ajaxDeferred.promise());\n    if (deviceVars.isOnline) {\n      $.ajax({\n        // TODO: send through lastChecked time when updating forms\n        url: '/_R_/xhr-forms/GetForm.php',\n        dataType: 'xml',\n        complete: function(jqxhr, status) {\n          var $data;\n          if (jqxhr.status === 200 && typeof jqxhr.responseText === 'string') {\n            jqxhr.responseText = jqxhr.responseText.substring(jqxhr.responseText.indexOf('<formObjects>'));\n            $data = $($.parseXML(jqxhr.responseText));\n            // $data contains XMLDocument / <formObjects> / <formObject>s\n            $data.children().children().each(formObjectFn);\n    //      MyAnswers.store.set('formLastUpdated:' + form, new Date(jqxhr.getResponseHeader('Last-Modified')).getTime());\n          }\n          if (jqxhr.status === 200 || jqxhr.status === 304) {\n            ajaxDeferred.resolve();\n          } else {\n            warn('processForms()->GetForm.XHR: failed ' + jqxhr.status);\n            ajaxDeferred.reject();\n          }\n        },\n        timeout: Math.max(currentConfig.downloadTimeout * 1000, computeTimeout(500 * 1024))\n      });\n    } else {\n      ajaxDeferred.resolve();\n    }\n  }\n  $.whenArray(promises)\n  .fail(MyAnswers.formsDeferred.reject)\n  .then(MyAnswers.formsDeferred.resolve);\n}\n\nfunction processConfig() {\n  var siteStructure,\n  config;\n  /* END: var */\n  MyAnswers.isEmptySpace = false;\n  MyAnswers.isLoginOnly = false;\n  log('processConfig(): currentMasterCategory=' + currentMasterCategory + ' currentCategory=' + currentCategory + ' currentInteraction=' + currentInteraction);\n  if ($.type(siteVars.config['a' + siteVars.id]) === 'object') {\n    config = siteVars.config['a' + siteVars.id].pertinent;\n    siteStructure = config.siteStructure;\n    if (siteStructure === 'master categories') {\n      hasMasterCategories = siteVars.map.masterCategories.length > 0;\n    }\n    if (siteStructure !== 'interactions only') { // masterCategories or categories\n      hasCategories = siteVars.map.categories.length > 0;\n    }\n    hasInteractions = siteVars.map.interactions.length > 0;\n    answerSpaceOneKeyword = siteVars.map.interactions.length === 1;\n    if (config.loginAccess && config.loginUseInteractions\n          && config.loginPromptInteraction && config.loginStatusInteraction\n          && siteVars.config['i' + config.loginPromptInteraction]\n          && siteVars.config['i' + config.loginStatusInteraction]) {\n      MyAnswers.isCustomLogin = true;\n    }\n    if (siteVars.map && siteVars.map.masterCategories.length === 0 && siteVars.map.categories.length === 0\n          && siteVars.map.interactions.length === (MyAnswers.isCustomLogin ? 2 : 0)) {\n      MyAnswers.isEmptySpace = true;\n    }\n    if (config.loginAccess && !MyAnswers.isLoggedIn) {\n      if (config.registeredOnly === 'deny anonymous' || MyAnswers.isEmptySpace) {\n        MyAnswers.isLoginOnly = true;\n      }\n    }\n  } else {\n    log('processConfig(): unable to retrieve answerSpace config');\n  }\n  processForms();\n}\n\nfunction requestConfig() {\n  var now = $.now(),\n      dfrd = new $.Deferred(),\n      isPersist = MyAnswers.device.persistentStorage,\n      url = '/_R_/xhr/GetConfig.php';\n\n  if (!deviceVars.isOnline) {\n    dfrd.reject();\n    return dfrd.promise();\n  }\n  url += '?_asn=' + siteVars.answerSpace;\n  if (MyAnswers.isLoggedIn) {\n    if ($.type(MyAnswers.loginAccount) === 'object') {\n       url += '&_username=' + (MyAnswers.loginAccount.username);\n     }\n  }\n\n  $.ajax({\n    url: url,\n    type: 'POST',\n    dataType: 'json',\n    timeout: computeTimeout(40 * 1024),\n    complete: function(jqxhr, status) {\n      var data,\n          items = ['a' + siteVars.id],\n          siteStructure;\n\n      if (jqxhr.status === 200) {\n        data = $.parseJSON(jqxhr.responseText);\n        if ($.type(data.map) === 'object') {\n          siteVars.map = data.map;\n          if (isPersist) {\n            MyAnswers.siteStore.set('map', JSON.stringify(siteVars.map));\n          }\n        }\n        if ($.type(data['a' + siteVars.id]) === 'object') {\n          siteStructure = data['a' + siteVars.id].pertinent.siteStructure;\n          siteVars.cdnu = new _Blink.AnswerSpaceCDN(data['a' + siteVars.id].pertinent.cdnLocation);\n        }\n        if (siteVars.map) {\n          if (siteStructure === 'master categories' &&\n              siteVars.map.masterCategories.length > 0) {\n            items = items.concat($.map(siteVars.map.masterCategories,\n                                       function(element, index) {\n              return 'm' + element;\n            }));\n          }\n          if (siteStructure !== 'interactions only' &&\n              siteVars.map.categories.length > 0) {\n            // masterCategories or categories\n            items = items.concat($.map(siteVars.map.categories,\n                                       function(element, index) {\n              return 'c' + element;\n            }));\n          }\n          if (siteVars.map.interactions.length > 0) {\n            items = items.concat($.map(siteVars.map.interactions,\n                                       function(element, index) {\n              return 'i' + element;\n            }));\n          }\n        }\n      }\n      if (data) {\n        if ($.type(siteVars.config) !== 'object' || items.length > 0) {\n          siteVars.config = {};\n        }\n\n        $.each(items, function(index, id) {\n          if ($.type(data[id]) === 'object') {\n            siteVars.config[id] = data[id];\n          }\n        });\n        if (isPersist) {\n          MyAnswers.siteStore.set('config', JSON.stringify(siteVars.config));\n        }\n        deviceVars.features = data.deviceFeatures;\n      }\n      if (jqxhr.status === 200 || jqxhr.status === 304 || jqxhr.status === 0) {\n        dfrd.resolve();\n      } else {\n        dfrd.reject();\n      }\n    }\n  });\n  return dfrd.promise();\n}\n\nMyAnswers.dumpLocalStorage = function() {\n  $.when(MyAnswers.store.keys()).done(function(keys) {\n    var k, kLength = keys.length,\n      getFn = function(value) {\n        value = value.length > 20 ? value.substring(0, 20) + '...' : value;\n        log('dumpLocalStorage(): found value: ' + value);\n      };\n    for (k = 0; k < kLength; k++) {\n      log('dumpLocalStorage(): found key: ' + keys[k]);\n      $.when(MyAnswers.store.get(keys[k])).done(getFn);\n    }\n  });\n};\n\nfunction gotoStorageView() {\n  var interaction,\n      url;\n  /* END: var */\n  if (currentConfig.activeFormsUseInteraction) {\n    interaction = siteVars.config['i' + currentConfig.activeFormsInteraction];\n    if ($.type(interaction) === 'object') {\n      url = '/' + siteVars.answerSpace + '/' + interaction.pertinent.name + '/?';\n      History.pushState({ i: currentConfig.activeFormsInteraction }, null, url);\n    } else {\n      BMP.alert('Interaction for active forms listing could not be found.');\n      return;\n    }\n  } else {\n    url = '/' + siteVars.answerSpace + '/?_storage=true';\n    History.pushState({storage: true}, null, url);\n  }\n}\n\nfunction showPendingView() {\n  var $view = $('#pendingView'),\n      $box = $('#pendingBox'),\n      $section = $box.children('[data-blink-form-version=2]'),\n      $sectionV1 = $box.children('[data-blink-form-version=1]'),\n      $noMessage = $box.children('.bForm-noPending');\n  /* END: var */\n  // update pending forms listing if necessary\n  $.when(MyAnswers.pendingStore.keys(), MyAnswers.pendingV1Store.keys())\n  .then(function(keys, keysV1) {\n        var count = keys.length + keysV1.length,\n            buttonText = count + ' Pending',\n            /**\n      * @inner\n      */\n            keysFn = function(index, key, $section) {\n              var version = $section.data('blinkFormVersion'),\n                  $template = $section.children('.template'),\n                  $entry = $template.clone(),\n                  keyParts = key.split(':'),\n                  interaction = siteVars.config['i' + keyParts[0]],\n                  name = interaction ? (interaction.pertinent.displayName || interaction.pertinent.name) : '* unknown *',\n                  form = keyParts[1],\n                  uuid = keyParts[2],\n                  $summary;\n              /* END: var */\n              $entry.children('h3').text(name);\n              $entry.children('pre.uuid').text(uuid);\n              $entry.attr('data-id', key);\n              // populate summary \"list\" fields in the <dl />\n              if (version === 2) {\n                $.when(MyAnswers.pendingStore.get(key))\n          .then(function(json) {\n                      if (typeof json !== 'string' || json.length === 0) {\n                        return;\n                      }\n                      if ($.type(json) !== 'object') {\n                        json = $.parseJSON(json);\n                      }\n                      if ($.type(json) === 'array') {\n                        $summary = $entry.children('dl');\n                        $.each(json[1], function(name, value) {\n                          $summary.append('<dt>' + name + '</dt><dd>' + value + '</dd>');\n                        });\n                      }\n                    });\n              }\n              $entry.data('interaction', keyParts[0]);\n              $entry.data('form', form);\n              MyAnswers.dispatch.add(function() {\n                $entry.appendTo($section);\n                $entry.show().removeClass('template');\n              });\n            };\n        /* END: var */\n        MyAnswers.dispatch.add(function() {\n          $section.children('.bForm-pending:not(.template)').remove();\n          if (keys.length > 0) {\n            $.each(keys, function(index, key) {\n              keysFn(index, key, $section);\n            });\n            $section.show();\n          } else {\n            $section.hide();\n          }\n          $sectionV1.children('.bForm-pending:not(.template)').remove();\n          if (keysV1.length > 0) {\n            $.each(keysV1, function(index, key) {\n              keysFn(index, key, $sectionV1);\n            });\n            $sectionV1.show();\n          } else {\n            $sectionV1.hide();\n          }\n          if ((keysV1.length + keys.length) > 0) {\n            $noMessage.hide();\n          } else {\n            $noMessage.show();\n          }\n        });\n        MyAnswers.dispatch.add(function() {\n          $.when(MyAnswersDevice.prepareView($view)).always(function() {\n            MyAnswersDevice.showView($view);\n          });\n        });\n      });\n}\n\nfunction createParamsAndArgs(keywordID) {\n  var config = siteVars.config['i' + keywordID],\n    returnValue = 'asn=' + siteVars.answerSpace + '&iact=' + encodeURIComponent(config.pertinent.name),\n    args = '',\n    argElements = $('#argsBox').find('input, textarea, select');\n  if (!config || !config.pertinent.inputPrompt) {return returnValue;}\n  args = '';\n  argElements.each(function(index, element) {\n    if (this.type && (this.type.toLowerCase() === 'radio' || this.type.toLowerCase() === 'checkbox') && !this.checked) {\n      $.noop(); // do nothing if not checked\n    } else if (this.name) {\n      args += '&' + this.name + '=' + (this.value ? encodeURIComponent(this.value) : '');\n    } else if (this.id && this.id.match(/\\d+/g)) {\n      args += '&args[' + this.id.match(/\\d+/g) + ']=' + (this.value ? encodeURIComponent(this.value) : '');\n    }\n  });\n  if (args.length > 0) {\n    returnValue += encodeURI(args);\n  } else if (argElements.length === 1 && this.value) {\n    returnValue += '&args=' + encodeURIComponent(this.value);\n  }\n  return returnValue;\n}\n\nfunction showAnswerView(interaction, argsString, reverse) {\n  log('showAnswerView(): interaction=' + interaction + ' args=' + argsString);\n  var html, args,\n    $view = $('#answerView'),\n    $answerBox = $('#answerBox'),\n    answerBox = $answerBox[0],\n    completeFn = function() {\n      $.when(initialiseAnswerFeatures($view)).always(function() {\n        setMainLabel(currentConfig.displayName || currentConfig.name);\n        MyAnswersDevice.showView($view, reverse);\n        MyAnswers.dispatch.add(function() {\n          MyAnswers.$body.trigger('taskComplete');\n        });\n      });\n    },\n    isPersist = MyAnswers.device.persistentStorage,\n    isLocalXSLT = !deviceVars.disableXSLT && isPersist;\n\n  interaction = resolveItemName(interaction);\n  if (interaction === false) {\n    BMP.alert('The requested Interaction could not be found.');\n    return;\n  }\n  MyAnswers.$body.trigger('taskBegun');\n  $.when(MyAnswersDevice.prepareView($view, reverse)).always(function() {\n    currentInteraction = interaction;\n    updateCurrentConfig();\n    if (typeof currentConfig.xml === 'string' && currentConfig.xml.substring(0, 6) !== 'stars:') {\n      if (currentConfig.mojoType === 'server-hosted' &&\n          MyAnswers.dfrdMoJOs.state() !== 'pending') {\n        requestMoJO(currentConfig.xml);\n      }\n    }\n    if (typeof argsString === 'string' && argsString.length > 0) {\n      args = {};\n      $.extend(args, deserialize(argsString));\n    } else if ($.type(argsString) === 'object') {\n      args = argsString;\n    } else {\n      args = {};\n    }\n    if (currentConfig.inputPrompt && !argsString) {\n      $.extend(args, deserialize(createParamsAndArgs(interaction)));\n      delete args.answerSpace;\n      delete args.interaction;\n    }\n    if (currentConfig.type === 'hyperlink') {\n      window.open(currentConfig.hyperlink,currentConfig.hyperlinkTarget);\n    } else if (currentConfig.type === 'message') {\n      insertHTML(answerBox, currentConfig.message);\n      completeFn();\n    } else if (currentConfig.type === 'xslt' && isLocalXSLT) {\n      $.when(MyAnswers.dfrdMoJOs)\n      .always(function() {\n        $.when(generateMojoAnswer(args))\n        .always(function(html) {\n          insertHTML(answerBox, html);\n          completeFn();\n        });\n      });\n\n    } else if (reverse && isPersist) {\n      $.when(MyAnswers.store.get('answer___' + interaction)).done(function(html) {\n        insertHTML(answerBox, html);\n        completeFn();\n      });\n    } else if (currentConfig.type === 'form' && currentConfig.blinkFormObjectName && currentConfig.blinkFormAction) {\n      $.when(MyAnswers.dfrdMoJOs, MyAnswers.formsDeferred.promise())\n      .fail(function() {\n        html = '<p>Error: forms Interactions are currently unavailable. Reload the application and try again.</p>';\n      })\n      .then(function() {\n        html = $('<form data-object-name=\"' + currentConfig.blinkFormObjectName + '\" novalidate=\"novalidate\" data-action=\"' + currentConfig.blinkFormAction + '\" />');\n        html.data(args);\n      })\n      .always(function() {\n        insertHTML(answerBox, html);\n        completeFn();\n      });\n    } else {\n      var answerUrl = '/_R_/xhr/GetAnswer.php',\n      requestData = {\n        asn: siteVars.answerSpace,\n        iact: currentConfig.name\n      },\n      fallbackToStorage = function() {\n        if (isPersist) {\n          $.when(MyAnswers.store.get('answer___' + interaction)).done(function(html) {\n            if (!html) {\n              html = '<p>Unable to reach server, and unable to display previously stored content.</p>';\n            }\n            insertHTML(answerBox, html);\n            completeFn();\n          });\n        } else {\n          html = '<p>Unable to reach server.</p>';\n          insertHTML(answerBox, html);\n          completeFn();\n        }\n      },\n      postData = {},\n      starsData = {},\n      method = 'GET';\n      /* END :var */\n      if (!$.isEmptyObject(args)) {\n        $.extend(requestData, args);\n      }\n      if (requestData._submitStarsType) {\n        method = 'POST';\n        if ($.type(requestData._submitStarsType) === 'string') {\n          requestData._submitStarsType = [requestData._submitStarsType];\n        }\n        if ($.type(requestData._submitStarsType) === 'array') {\n          $.each(requestData._submitStarsType, function(index, value) {\n            starsData[value] = starsProfile[value] || {};\n          });\n        }\n        postData[requestData._submitStarsPost || 'stars'] = starsData;\n        delete requestData._submitStarsPost;\n        delete requestData._submitStarsType;\n        answerUrl += '?' + $.param(requestData);\n        requestData = postData;\n      }\n      $.ajax({\n        type: method,\n        url: answerUrl,\n        data: requestData,\n        complete: function(xhr, textstatus) { // readystate === 4\n          if (textstatus === 'timeout') {\n            insertHTML(answerBox, 'Error: the server has taken too long to respond.  (' + textstatus + ' ' + xhr.status + ')');\n            completeFn();\n          } else if (isAJAXError(textstatus) || xhr.status !== 200) {fallbackToStorage();}\n          else {\n            log('GetAnswer: storing server response');\n            html = xhr.responseText;\n            var blinkAnswerMessage = html.match(/<!-- blinkAnswerMessage:\\{.*\\} -->/g),\n              b, bLength;\n            if ($.type(blinkAnswerMessage) === 'array') {\n              bLength = blinkAnswerMessage.length;\n              for (b = 0; b < bLength; b++) {\n                processBlinkAnswerMessage(blinkAnswerMessage[b].substring(24, blinkAnswerMessage[b].length - 4));\n              }\n            }\n            if (isPersist) {\n              MyAnswers.store.set('answer___' + interaction, html);\n            }\n            insertHTML(answerBox, html);\n            completeFn();\n          }\n        },\n        timeout: Math.max(currentConfig.downloadTimeout * 1000, 60 * 1000)\n      });\n    }\n  });\n}\n\n/*\n * event handler for the \"go\" button on inputPrompt screens\n */\nfunction getAnswer(event) {\n  var id = resolveItemName(currentInteraction, 'interactions'),\n    requestUri,\n    args, argsString;\n  if (id) {\n    args = deserialize(createParamsAndArgs(currentInteraction));\n    delete args.asn;\n    delete args.iact;\n    argsString = $.param(args);\n    requestUri = '/' + siteVars.answerSpace + '/' + siteVars.config['i' + id].pertinent.name + '/?' + argsString;\n    History.pushState({m: currentMasterCategory, c: currentCategory, i: id, 'arguments': args}, null, requestUri);\n  }\n}\n\nfunction showKeywordView(keyword) {\n  var $view = $('#keywordView');\n  $.when(MyAnswersDevice.prepareView($view)).always(function() {\n    var config = siteVars.config['i' + keyword].pertinent,\n      argsBox = $('#argsBox')[0];\n    currentInteraction = keyword;\n    updateCurrentConfig();\n    insertHTML(argsBox, config.inputPrompt);\n    MyAnswersDevice.showView($view);\n    setMainLabel(config.displayName || config.name);\n  });\n}\n\nfunction goBackToKeywordView(keyword) {\n  var $view = $('#keywordView');\n  $.when(MyAnswersDevice.prepareView($view, true)).always(function() {\n    var config = siteVars.config['i' + keyword].pertinent;\n    currentInteraction = keyword;\n    updateCurrentConfig();\n    MyAnswersDevice.showView($view, true);\n    setMainLabel(config.displayName || config.name);\n  });\n}\n\nfunction gotoNextScreen(keyword, category, masterCategory) {\n  var config,\n    i, iLength = siteVars.map.interactions.length;\n  log('gotoNextScreen(): ' + keyword);\n  keyword = resolveItemName(keyword);\n  if (keyword === false) {\n    BMP.alert('The requested Interaction could not be found.');\n    return;\n  }\n  config = siteVars.config['i' + keyword];\n  if (hasMasterCategories && masterCategory) {\n    currentMasterCategory = masterCategory;\n  }\n  if (hasCategories && category) {\n    currentCategory = category;\n  }\n  currentInteraction = keyword;\n  if (config.pertinent.inputPrompt) {\n    showKeywordView(keyword);\n  } else {\n    showAnswerView(keyword);\n  }\n}\n\nfunction showSecondLevelAnswerView(keyword, arg0, reverse) {\n  var id = resolveItemName(keyword, 'interactions'),\n    requestUri;\n  log('showSecondLevelAnswerView(): keyword=' + keyword + ' args=' + arg0);\n  if (id) {\n    requestUri = '/' + siteVars.answerSpace + '/' + siteVars.config['i' + id].pertinent.name + '/?' + arg0;\n    History.pushState({m: currentMasterCategory, c: currentCategory, i: id, 'arguments': deserialize(arg0)}, null, requestUri);\n  }\n}\n\nfunction showKeywordListView(category, masterCategory) {\n  var mainLabel,\n    $view = $('#keywordListView');\n  currentInteraction = null;\n  currentCategory = category;\n  if (hasMasterCategories && masterCategory) {\n    currentMasterCategory = masterCategory;\n  }\n  log('showKeywordListView(): hasCategories=' + hasCategories + ' currentCategory=' + currentCategory);\n  $.when(MyAnswersDevice.prepareView($view)).always(function() {\n    updateCurrentConfig();\n    if (hasCategories) {\n      if (typeof prepareHistorySideBar === 'function') {\n        prepareHistorySideBar();\n      }\n      mainLabel = currentConfig.displayName || currentConfig.name;\n    } else {\n      mainLabel = 'Interactions';\n    }\n    MyAnswers.populateItemListing('interactions', $view);\n    MyAnswersDevice.showView($view);\n    setMainLabel(mainLabel);\n  });\n}\n\nfunction goBackToKeywordListView(event) {\n  var mainLabel,\n    config,\n    $view = $('#keywordListView');\n  currentInteraction = null;\n  // log('goBackToKeywordListView()');\n  if (answerSpaceOneKeyword) {\n    showKeywordView(0);\n    return;\n  }\n  if (hasMasterCategories && currentMasterCategory === null) {\n    goBackToMasterCategoriesView();\n    return;\n  }\n  if (hasCategories && currentCategory === null) {\n    goBackToCategoriesView(hasMasterCategories ? currentCategory : null);\n    return;\n  }\n  if (hasCategories) {\n    config = siteVars.config['c' + currentCategory].pertinent;\n    mainLabel = config.displayName || config.name;\n  } else {\n    mainLabel = 'Interactions';\n  }\n  $.when(MyAnswersDevice.prepareView($view, true)).always(function() {\n    updateCurrentConfig();\n    MyAnswersDevice.showView($view, true);\n    setMainLabel(mainLabel);\n  });\n}\n\nfunction showHelpView(event)\n{\n  var helpContents,\n    helpBox = document.getElementById('helpBox'),\n    $view = $('#helpView');\n  $.when(MyAnswersDevice.prepareView($view)).always(function() {\n    switch ($('.view:visible').first().attr('id'))\n    {\n      case 'keywordView':\n      case 'answerView':\n      case 'answerView2':\n        if (currentInteraction) {\n          helpContents = siteVars.config['i' + currentInteraction].pertinent.help || 'Sorry, no guidance has been prepared for this item.';\n        }\n        break;\n      default:\n        helpContents = siteVars.config['a' + siteVars.id].pertinent.help || 'Sorry, no guidance has been prepared for this item.';\n    }\n    insertHTML(helpBox, helpContents);\n    MyAnswersDevice.showView($view);\n  });\n}\n\nfunction goBackToTopLevelAnswerView(event) {\n  var $view = $('#answerView');\n  log('goBackToTopLevelAnswerView()');\n  $.when(MyAnswersDevice.prepareView($view, true)).always(function() {\n    MyAnswersDevice.showView($view, true);\n  });\n}\n\nfunction submitFormWithRetry(data) {\n  var str, arr, method, uuid,\n  localKeyword,\n  answerUrl = '/_R_/xhr/GetAnswer.php?',\n  $view = $('.view:visible'),\n  $box = $view.children('.box').first(),\n  requestData;\n  /* END: var */\n  if ($.type(data) === 'object') {\n    str = data.data;\n    arr = data.action.split('/');\n    method = data.method;\n    uuid = data.uuid;\n    if (arr[0] === '..') {\n      answerUrl += 'asn=' + siteVars.answerSpace + '&iact=' + encodeURIComponent(arr[1]) + (arr[2].length > 1 ? '&' + arr[2].substring(1) : '');\n      localKeyword = arr[1];\n    } else {\n      answerUrl += 'asn=' + arr[1] + '&iact=' + encodeURIComponent(arr[2]);\n      localKeyword = arr[2];\n    }\n    if (method === 'GET') {\n      requestData = '&' + str;\n    } else {\n      method = 'POST';\n      requestData = str;\n    }\n\n    MyAnswers.$body.trigger('taskBegun');\n    $.ajax({\n      type: method,\n      cache: 'false',\n      url: answerUrl,\n      data: requestData,\n      complete: function(xhr, textstatus) { // readystate === 4\n        var html;\n        if (isAJAXError(textstatus) || xhr.status !== 200) {\n          html = 'Unable to contact server. Your submission has been stored for future attempts.  (' + textstatus + ' ' + xhr.status + ')';\n        } else {\n          if (MyAnswers.device.persistentStorage) {\n            clearPendingFormV1(data.interaction, uuid);\n          }\n          html = xhr.responseText;\n        }\n        $.when(MyAnswersDevice.prepareView($view)).always(function() {\n          insertHTML($box[0], html);\n          $.when(initialiseAnswerFeatures($box)).always(function() {\n            MyAnswersDevice.showView($view);\n          });\n          MyAnswers.$body.trigger('taskComplete');\n        });\n      },\n      timeout: Math.max(currentConfig.uploadTimeout * 1000, computeTimeout(answerUrl.length + requestData.length))\n    });\n  } else {\n    log('submitFormWithRetry(): error: no forms in the queue');\n  }\n}\n\nfunction submitForm() {\n  var str = '',\n    $form = $('.view:visible').find('form').first(),\n    action = $form.attr('action'),\n    method = $form.attr('method'),\n    uuid = Math.uuid(),\n    data;\n\n  $form.find('input, textarea, select').each(function(index, element) {\n    if (element.name)\n    {\n      if (element.type && (element.type.toLowerCase() === 'radio' || element.type.toLowerCase() === 'checkbox') && element.checked === false)\n      {\n        $.noop(); // do nothing for unchecked radio or checkbox\n      }\n      else\n      {\n        if (element.type && (element.type.toLowerCase() === 'button')) {\n          str += '&' + element.name + '=';\n        }\n        else\n        {\n          str += '&' + element.name + '=' + encodeURIComponent(element.value);\n        }\n      }\n    }\n  });\n\n  // var str = $('form').first().find('input, textarea, select').serialize();\n  log('submitForm(2): ' + document.forms[0].action);\n  // log(\"submitForm(2a): \" + str);\n\n  data = {\n    data: str,\n    'action': action,\n    'method': $.type(method) === 'string' ? method.toUpperCase() : 'post',\n    'uuid': uuid,\n    interaction: currentInteraction\n  };\n\n  if (MyAnswers.device.persistentStorage) {\n    $.when(pushPendingFormV1(currentInteraction, uuid, data))\n      .fail(function() {\n        BMP.alert('Error: unable to feed submission through queue.');\n      })\n      .then(submitFormWithRetry);\n    // queuePendingFormData(str, document.forms[0].action, document.forms[0].method.toLowerCase(), Math.uuid(), submitFormWithRetry);\n  } else {\n    submitFormWithRetry(data);\n  }\n  return false;\n}\n\nfunction submitAction(keyword, action) {\n  log('submitAction(): keyword=' + keyword + ' action=' + action);\n  var $view = $('.view:visible,'),\n    $box = $view.children('.box'),\n    form = $box.find('form').first(),\n    $submits = form.find('input[type=submit]'),\n    sessionInput = form.find('input[name=blink_session_data]'),\n    formData = (action === 'cancel=Cancel') ? '' : form.find('input, textarea, select').serialize(),\n    method = form.attr('method'),\n    requestData, requestUrl,\n    serializedProfile;\n  if ($submits.length === 1 && $submits.attr('name') && $submits.val()) {\n    formData += '&' + $submits.attr('name') + '=' + $submits.val();\n  }\n  if (sessionInput.length === 1 && ! $.isEmptyObject(starsProfile)) {\n    serializedProfile = '{\"stars\":' + JSON.stringify(starsProfile) + '}';\n    formData = formData.replace('blink_session_data=', 'blink_session_data=' + encodeURIComponent(serializedProfile));\n    method = 'post';\n  }\n  if ($.type(method) === 'string' && method.toLowerCase() === 'get') {\n    method = 'GET';\n    requestUrl = '/_R_/xhr/GetAnswer.php?asn=' + siteVars.answerSpace + '&iact=' + keyword;\n    requestData = '&' + formData + (typeof action === 'string' && action.length > 0 ? '&' + action : '');\n  } else {\n    method = 'POST';\n    requestUrl = '/_R_/xhr/GetAnswer.php?asn=' + siteVars.answerSpace + '&iact=' + keyword + (typeof action === 'string' && action.length > 0 ? '&' + action : '');\n    requestData = formData;\n  }\n  MyAnswers.$body.trigger('taskBegun');\n  $.ajax({\n    type: method,\n    cache: 'false',\n    url: requestUrl,\n    data: requestData,\n    complete: function(xhr, textstatus) { // readystate === 4\n      var html,\n          b, bLength,\n          blinkAnswerMessage;\n      /* END: var */\n      if (isAJAXError(textstatus) || xhr.status !== 200) {\n        html = 'Unable to contact server.';\n      } else {\n        html = xhr.responseText;\n      }\n      blinkAnswerMessage = html.match(/<!-- blinkAnswerMessage:\\{.*\\} -->/g);\n      if ($.type(blinkAnswerMessage) === 'array') {\n        bLength = blinkAnswerMessage.length;\n        for (b = 0; b < bLength; b++) {\n          processBlinkAnswerMessage(blinkAnswerMessage[b].substring(24, blinkAnswerMessage[b].length - 4));\n        }\n      }\n      $.when(MyAnswersDevice.prepareView($view)).always(function() {\n        insertHTML($box[0], html);\n        $.when(initialiseAnswerFeatures($box)).always(function() {\n          MyAnswersDevice.showView($view);\n        });\n        MyAnswers.$body.trigger('taskComplete');\n      });\n    },\n    timeout: Math.max(currentConfig.downloadTimeout * 1000, computeTimeout(requestUrl.length + requestData.length))\n  });\n  return false;\n}\n\nMyAnswers.determineBlinkStorageEngine = function (userAgent) {\n  var storeEngine, userAgent;\n  userAgent = userAgent !== undefined ? userAgent : navigator.userAgent;\n  userAgent = userAgent || '';\n  storeEngine = null;\n  if (isBlinkGapDevice() || /\\bchrom/i.test(userAgent)) {\n    storeEngine = null; // native application and Chrome should always auto-select\n  } else if (userAgent.indexOf('Android') !== -1) {\n    // Android has problems with persistent storage\n    storeEngine = 'sessionstorage';\n  }\n  return storeEngine;\n};\n\n// *** BEGIN APPLICATION INIT ***\n\n/* moving non-public functions into a closure for safety */\n(function(window) {\n  var document = window.document,\n    siteVars = window.siteVars,\n    deviceVars = window.deviceVars,\n    MyAnswers = window.MyAnswers,\n    $ = window.jQuery,\n    $startup = $('#startUp'),\n    navigator = window.navigator,\n    $window = $(window),\n    History, _pushState, _replaceState,  // defined in onBrowserReady\n    google; // defined in MyAnswers.setupGoogleMaps\n\n  /* *** BLINKGAP FUNCTIONS *** */\n  siteVars.fixImages = function () {\n    var src;\n    src = $(this).attr(\"src\");\n    src = siteVars.cdnu.getURL(src);\n    $(this).off(\"error\").attr(\"src\", src);\n  };\n\n  /**\n   * @return {jQueryPromise}\n   */\n  function waitForBlinkGap() {\n    var dfrd = new $.Deferred(),\n        start = $.now(),\n        $progressDot = $('#startUp-initBlinkGap'),\n        /** @inner */\n        checkFn = function() {\n          if (window.PhoneGap) {\n            if (window.PhoneGap.available) {\n              dfrd.resolve();\n            } else {\n              $(document).on('deviceready', dfrd.resolve);\n            }\n          } else if (($.now() - start) > 10 * 1000) {\n            warn('waitForBlinkGap(): still no PhoneGap after 10 seconds');\n            dfrd.reject();\n          } else {\n            setTimeout(checkFn, 197);\n          }\n        };\n    /* END: var */\n    if (!window.isBlinkGap) {\n      log('waitForBlinkGap(): native application not detected');\n      $progressDot.remove();\n      dfrd.resolve();\n      return dfrd.promise();\n    }\n    log('waitForBlinkGap(): native application detected');\n    $progressDot.addClass('working');\n    checkFn();\n    $.when(dfrd.promise())\n    .fail(function() {\n          $progressDot.addClass('error');\n        })\n    .then(function() {\n          $progressDot.addClass('success');\n        });\n    return dfrd.promise();\n  }\n\n  /**\n   * @return {jQueryPromise}\n   */\n  function fixWebSQL() {\n    var deferred = new $.Deferred(),\n    db = null,\n    /* @inner */\n    increaseQuota_Success = function(quotaIncrease) {\n      db = null;\n      navigator.notification.alert('Database installed, please restart the App.',\n                                   function() {\n                                     navigator.gap_database.requestTerminate();\n                                   },\n                                   'First Run',\n                                   'Close App');\n      // we do not resolve here, the only way out is to terminate\n      log('fixWebSQL(): quota increase: ' + quotaIncrease);\n    },\n    /* @inner */\n    getDBLimits_Success = function(results) {\n      var options = {quotaIncrease: String(MyAnswers.device.storageQuota)},\n      allocatedSpace = results.allocatedSpace,\n      currentQuota = results.currentQuota;\n      /* END: var */\n      log('fixWebSQL(): allocatedSpace=' + allocatedSpace + ' currentQuota=' + currentQuota);\n      if (currentQuota < MyAnswers.device.storageQuota) {\n        navigator.gap_database.increaseQuota(increaseQuota_Success, deferred.reject, options);\n      } else {\n        deferred.resolve();\n      }\n    };\n    /* END: var */\n    if (MyAnswers && MyAnswers.device && MyAnswers.device.storageQuota\n        && $.type(MyAnswers.device.storageQuota) === 'number'\n        && MyAnswers.device.storageQuota > 0) {\n      log('fixWebSQL(): requestedQuota=' + MyAnswers.device.storageQuota);\n      try {\n        db = window.openDatabase(siteVars.answerSpace, '1.0', siteVars.answerSpace, 1024 * 1024);\n        navigator.gap_database.getLimits(getDBLimits_Success, deferred.reject, null);\n      } catch (error) {\n        deferred.reject();\n        error(error);\n        log('*** Open/Increase quota for database failed');\n        throw 'fixWebSQL(): ' + error;\n      }\n    } else {\n      log('fixWebSQL(): nothing to do');\n      deferred.resolve();\n    }\n    return deferred.promise();\n  }\n\n  /* *** HELPER FUNCTIONS *** */\n\n  function updateLocalStorage() {\n    /*\n     * version 0 = MoJOs stored in new format, old siteConfig removed\n     */\n    var dfrd = new $.Deferred();\n    if (MyAnswers.store) {\n      $.when(MyAnswers.store.get('storageVersion'))\n      .always(function(value) {\n        if (!value) {\n          $.when(\n            MyAnswers.store.set('storageVersion', 0),\n            MyAnswers.store.remove('siteConfigMessage'),\n            MyAnswers.store.removeKeysRegExp(/^mojoMessage-/)\n          ).always(function() {\n            dfrd.resolve();\n          });\n        } else {\n          dfrd.resolve();\n        }\n      });\n    } else {\n      dfrd.resolve();\n    }\n    return dfrd.promise();\n  }\n\n  /**\n   * remove hash / anchor / fragments from a state object destined for History\n   */\n  function trimHistoryState(state) {\n    var index, array, object,\n    type = $.type(state);\n    /* END: var */\n    if (type === 'string' && state.length > 0) {\n      index = state.indexOf('#');\n      if (index !== -1) {\n        state = state.substring(0, index);\n      }\n    } else if (type === 'array' && state.length > 0) {\n      array = [];\n      $.each(state, function(index, value) {\n        array.push(trimHistoryState(value));\n      });\n      state = array;\n    } else if (type === 'object') {\n      object = {};\n      $.each(state, function(key, value) {\n        object[key] = trimHistoryState(value);\n      });\n      state = object;\n    }\n    return state;\n  }\n\n  function networkReachableFn(state) {\n    state = state.code || state;\n    deviceVars.isOnline = state > 0;\n    deviceVars.isOnlineCell = state === 1;\n    deviceVars.isOnlineWiFi = state === 2;\n    log('BlinkGap.networkReachable(): online=' + deviceVars.isOnline + ' cell=' + deviceVars.isOnlineCell + ' wifi=' + deviceVars.isOnlineWiFi);\n  }\n\n  /* *** EVENT HANDLERS *** */\n\n  MyAnswers.cacheDfrd = new $.Deferred();\n  if (!$(document.body).closest('html[manifest]').length) {\n    log('applicationCache: uncached');\n    MyAnswers.cacheDfrd.resolve();\n\n  } else if (window.applicationCache) {\n    $(window.applicationCache).on({\n      checking: function (event) {\n        log('applicationCache: status=' + this.status + ' event=' + event.type);\n        MyAnswers.cacheDfrd.resolve();\n      },\n      noupdate: function (event) {\n        log('applicationCache: status=' + this.status + ' event=' + event.type);\n        MyAnswers.cacheDfrd.resolve();\n      },\n      cached: function (event) {\n        log('applicationCache: status=' + this.status + ' event=' + event.type);\n        MyAnswers.cacheDfrd.resolve();\n      },\n      obsolete: function (event) {\n        log('applicationCache: status=' + this.status + ' event=' + event.type);\n        MyAnswers.cacheDfrd.resolve();\n      },\n      updateready: function (event) {\n        log('applicationCache: status=' + this.status + ' event=' + event.type);\n        log('applicationCache: reloading to use updated resources...');\n        window.location.reload();\n      },\n      error: function (event) {\n        log('applicationCache: status=' + this.status + ' event=' + event.type);\n        error('Application Cache: ' + this.status);\n        MyAnswers.cacheDfrd.resolve();\n      }\n    });\n\n  } else {\n    log('applicationCache: unsupported');\n    MyAnswers.cacheDfrd.resolve();\n  }\n\n  function onOrientationChange(event) {\n    var screenX,\n        screenY,\n        windowX,\n        windowY,\n        orientation,\n        oldOrientation = MyAnswers.orientation,\n        isRotated;\n\n    if ($.inArray('ios', deviceVars.features) !== -1\n        && Math.abs(window.orientation || 0) === 90) {\n      screenX = window.screen.height;\n      screenY = window.screen.width;\n    } else {\n      screenX = window.screen.width;\n      screenY = window.screen.height;\n    }\n    windowX = window.innerWidth;\n    windowY = window.innerHeight;\n    orientation = windowX > windowY ? 'landscape' : 'portrait';\n    $.extend(MyAnswers, {\n      screenX: screenX,\n      screenY: screenY,\n      windowX: windowX,\n      windowY: windowY,\n      orientation: orientation\n    });\n    if (oldOrientation && oldOrientation !== orientation) {\n      log('onOrientationChange(): rotated!');\n      updateCurrentConfig();\n    }\n    $window.trigger('scroll');\n  }\n\n  function onNetworkChange() {\n    var host;\n    //    if (window.device && navigator.network) { // TODO: check when this BlinkGap code will actually work (state.code === undefined)\n    //      host = siteVars.serverDomain ? siteVars.serverDomain.split(':')[0] : 'blinkm.co';\n    //      navigator.network.isReachable(host, networkReachableFn);\n    //    } else {\n      deviceVars.isOnline = navigator.onLine === true;\n      log('onNetworkChange(): online=' + deviceVars.isOnline);\n    //    }\n  }\n\n  // TODO: a window resize event _may_ cause DOM issues with out transitions\n  /*  function onWindowResize(event) {\n    $('html').css('min-height', window.innerHeight);\n  } */\n\n  function onPendingClick(event) {\n    var $button = $(event.target),\n        action = $button.data('action'),\n        requestUri,\n        $box,\n        dispatch,\n        networkText = 'Check your network connectivity and try again.',\n        cancelText = 'Are you sure you wish to discard this pending record?',\n        submitAllText = 'Submitting all records may take some time, continue?',\n        // variables needed for record-specific actions\n        $entry,\n        version,\n        id,\n        idParts,\n        interaction,\n        form,\n        uuid,\n        /**\n     * @inner\n     */\n        submitFn = function($entry) {\n          var dfrd = new $.Deferred(),\n              id = $entry.data('id'),\n              idParts = id.split(':'),\n              interaction = idParts[0],\n              interactionName,\n              form = idParts[1],\n              uuid = idParts[2];\n          /* END: var */\n          if (siteVars.config['i' + interaction]) {\n            interactionName = siteVars.config['i' + interaction].pertinent.name;\n          } else {\n            BMP.alert('Error: this record requires an Interaction that not currently available');\n            return;\n          }\n          $button.prop('disabled', true);\n          $.when(MyAnswers.pendingStore.get(interaction + ':' + form + ':' + uuid))\n      .fail(function() {\n                BMP.alert('Error: unable to retrieve this form');\n                $button.prop('disabled', false);\n              })\n      .then(function(json) {\n                var formData;\n                if (typeof json !== 'string' || json.length === 0) {\n                  $button.prop('disabled', false);\n                  return;\n                }\n                if ($.type(json) !== 'object') {\n                  json = $.parseJSON(json);\n                }\n                switch ($.type(json)) {\n                  case 'array':\n                    formData = json[0];\n                    break;\n                  case 'object':\n                    formData = json;\n                    break;\n                }\n                $entry.addClass('s-working');\n                $.when(BlinkForms.submitData(interactionName, form, formData))\n        .always(function(response, status, jqxhr) {\n                      var swap;\n                      if (!jqxhr || $.type(jqxhr.promise) !== 'function') {\n                        swap = jqxhr;\n                        jqxhr = response;\n                        response = swap;\n                      }\n                      $button.prop('disabled', false);\n                      if (jqxhr.status === 200 && response) {\n                        if (MyAnswers.store) {\n                          clearPendingForm(interaction, form, uuid);\n                          $entry.remove();\n                        }\n                      } else {\n                        $entry.toggleClass('s-working s-error');\n                      }\n                      dfrd.resolve();\n                    });\n              });\n          return dfrd.promise();\n        };\n    /* END: var */\n    if (action === 'submit-all') {\n      if (!deviceVars.isOnline) {\n        BMP.alert(networkText, { title: 'Forms Queue' });\n        return;\n      }\n      BMP.confirm(submitAllText, { title: 'Forms Queue' })\n          .then(function(result) {\n            if (result) {\n              dispatch = new BlinkDispatch(197);\n              $box = $button.closest('.box, .view');\n              $box.find('[data-blink=\"active-form\"][data-id]')\n                  .each(function(index, element) {\n                    dispatch.add(function() {\n                      return submitFn($(element));\n                    });\n                  });\n            }\n          });\n\n    } else {\n      $entry = $button.closest('[data-blink=\"active-form\"]');\n      version = $entry.data('version');\n      id = $entry.data('id');\n      idParts = id.split(':');\n      interaction = idParts[0];\n      form = idParts[1];\n      uuid = idParts[2];\n      if (version === 2) {\n        if (action === 'clear') {\n          BMP.confirm(cancelText, { title: 'Forms Queue' }).then(function(result) {\n            if (result) {\n              $.when(clearPendingForm(interaction, form, uuid))\n                  .then(function() {\n                    $entry.remove();\n                  });\n            }\n          })\n\n        } else if (action === 'resume') {\n          requestUri = '/' + siteVars.answerSpace + '/' + siteVars.config['i' + interaction].pertinent.name + '/?_uuid=' + uuid;\n          History.pushState({m: currentMasterCategory, c: currentCategory, i: interaction, 'arguments': {pendingForm: id}}, null, requestUri);\n\n        } else if (action === 'submit') {\n          submitFn($entry);\n\n        }\n      } else if (version === 1) {\n        if (action === 'clear') {\n          BMP.confirm(cancelText, { title: 'Forms Queue' }).then(function(result) {\n            if (result) {\n              $.when(clearPendingFormV1(interaction, uuid))\n                  .then(function() {\n                    $entry.remove();\n                  });\n            }\n          });\n\n        } else if (action === 'submit') {\n          $.when(MyAnswers.pendingV1Store.get(interaction + ':' + uuid))\n              .fail(function() {\n                BMP.alert('Unable to retrieve record from storage.', { title: 'Forms Queue' });\n              })\n              .then(function(data) {\n                data = $.parseJSON(data);\n                submitFormWithRetry(data);\n              });\n        }\n      }\n    }\n  }\n\n  function onTaskBegun(event) {\n    MyAnswers.runningTasks++;\n    if ($('#startUp').length > 0) {return true;}\n    if (typeof MyAnswers.activityIndicatorTimer === 'number') {return true;}\n    MyAnswers.activityIndicatorTimer = setTimeout(function() {\n      clearTimeout(MyAnswers.activityIndicatorTimer);\n      MyAnswers.activityIndicatorTimer = null;\n      $(MyAnswers.activityIndicator).show();\n    }, 1000);\n    return true;\n  }\n\n  function onTaskComplete(event) {\n    if (MyAnswers.runningTasks > 0) {\n      MyAnswers.runningTasks--;\n    }\n    if (MyAnswers.runningTasks <= 0) {\n      if (MyAnswers.activityIndicatorTimer !== null) {\n        clearTimeout(MyAnswers.activityIndicatorTimer);\n      }\n      MyAnswers.activityIndicatorTimer = null;\n      $(MyAnswers.activityIndicator).hide();\n    }\n    return true;\n  }\n\n  /* *** INITIALISATION FUNCTIONS *** */\n\n  function displayAnswerSpace() {\n    var startUp = $('#startUp'),\n        $masterCategoriesView = $('#masterCategoriesView'),\n        $categoriesView = $('#categoriesView'),\n        $keywordListView = $('#keywordListView');\n    /* END: var */\n    if (startUp.length > 0 && siteVars.config) {\n      if ($.inArray('phone', deviceVars.features) !== -1 || $(window).width() < 768) {\n        $('#mainLabel').remove(); //  TODO: fix the main navigation label\n      }\n      currentConfig = siteVars.config['a' + siteVars.id].pertinent;\n      // identifying landing page\n      switch (siteVars.config['a' + siteVars.id].pertinent.siteStructure) {\n        case 'interactions only':\n          $masterCategoriesView.remove();\n          $categoriesView.remove();\n          break;\n        case 'categories':\n          $masterCategoriesView.remove();\n          $keywordListView.find('.welcomeBox').remove();\n          break;\n        case 'master categories':\n          $categoriesView.find('.welcomeBox').remove();\n          $keywordListView.find('.welcomeBox').remove();\n          break;\n      }\n      $('#answerSpacesListView').remove();\n      MyAnswers.gotoDefaultScreen();\n      (function() {\n        var interaction = resolveItemName(siteVars.queryParameters.keyword),\n            config = siteVars.config['a' + siteVars.id].pertinent,\n            requestUri;\n        /* END: var */\n        delete siteVars.queryParameters.keyword;\n        if (interaction && ! $.isEmptyObject(siteVars.queryParameters)) {\n          requestUri = '/' + siteVars.answerSpace + '/' + siteVars.config['i' + interaction].pertinent.name + '/?' + $.param(siteVars.queryParameters);\n          History.pushState({\n            i: interaction,\n            'arguments': siteVars.queryParameters\n          }, null, requestUri);\n        } else if (interaction) {\n          requestUri = '/' + siteVars.answerSpace + '/' + siteVars.config['i' + interaction].pertinent.name + '/?';\n          History.pushState({\n            i: interaction\n          }, null, requestUri);\n        } else if (typeof siteVars.queryParameters._c === 'string') {\n          requestUri = '/' + siteVars.answerSpace + '/?_c=' + siteVars.queryParameters._c;\n          History.pushState({\n            c: siteVars.queryParameters._c\n          }, null, requestUri);\n        } else if (typeof siteVars.queryParameters._m === 'string') {\n          requestUri = '/' + siteVars.answerSpace + '/?_m=' + siteVars.queryParameters._m;\n          History.pushState({\n            m: siteVars.queryParameters._m\n          }, null, requestUri);\n        }\n        delete siteVars.queryParameters;\n      }());\n    }\n    startUp.remove();\n    $('#content').show();\n    setSubmitCachedFormButton();\n    if (MyAnswers.device.persistentStorage) {\n      MyAnswers.dfrdMoJOs = processMoJOs();\n    }\n  }\n\n  function loaded() {\n    var isPersist = MyAnswers.device.persistentStorage;\n    log('loaded():');\n    try {\n      if (isPersist) {\n        MyAnswers.store.set('answerSpace', siteVars.answerSpace);\n      }\n      $.when(isPersist ? MyAnswers.siteStore.get('config') : true)\n      .then(function(data) {\n        if (typeof data === 'string') {\n          data = $.parseJSON(data);\n        }\n        if ($.type(data) === 'object') {\n          siteVars.config = data;\n        }\n      }).always(function() {\n        $.when(isPersist ? MyAnswers.siteStore.get('map') : true)\n        .then(function(data) {\n          if (typeof data === 'string') {\n            data = $.parseJSON(data);\n          }\n          if ($.type(data) === 'object') {\n            siteVars.map = data;\n          }\n        })\n        .always(function() {\n          $.when(requestLoginStatus())\n          .always(function() {\n            $.when(requestConfig())\n            .always(function() {\n              if (siteVars.map && siteVars.config) {\n                processConfig();\n                displayAnswerSpace();\n\n                // hook orientation events\n                if (Modernizr.orientation) {\n                  $window.on('orientationchange', onOrientationChange);\n                }\n                $window.on('resize', onOrientationChange);\n                onOrientationChange();\n              } else {\n                $startup.append('error: unable to contact server, insufficient data found in local storage');\n              }\n            });\n          });\n        });\n      });\n      $.when(isPersist ? MyAnswers.store.get('starsProfile') : true)\n      .then(function(stars) {\n        if ($.type(stars) === 'string') {\n          stars = $.parseJSON(stars);\n        }\n        if ($.type(stars) === 'object') {\n          starsProfile = stars;\n        }\n      });\n      $('#startUp-initLoaded').addClass('success');\n    } catch (e) {\n      log('loaded(): exception:');\n      error(e);\n      $('#startUp-initLoaded').addClass('error');\n      $startup.append('loading error: ' + e);\n    }\n  }\n\n  function init_main() {\n    var storeEngine = null, // pick automatic engine by default\n    loadedPromises = [],\n    dfrdFixWebSQL,\n        userAgent = navigator.userAgent,\n        domainWhitelist;\n    /* END: var */\n\n    log('init_main(): ');\n    siteVars.requestsCounter = 0;\n\n    $.fx.interval = 27; // default is 13, larger is kinder on devices\n\n    MyAnswers.dispatch = new BlinkDispatch(isBlinkGapDevice() ? 149 : 47);\n\n    MyAnswers.runningTasks = 0; // track the number of tasks in progress\n\n    // to facilitate building regex replacements\n    RegExp.quote = function(str) {return str.replace(/([.?*+\\^$\\[\\]\\\\(){}\\-])/g, '\\\\$1');};\n\n    MyAnswers.activityIndicator = document.getElementById('activityIndicator');\n    MyAnswers.activityIndicatorTimer = null;\n\n    MyAnswers.$body.on('taskBegun', onTaskBegun);\n    MyAnswers.$body.on('taskComplete', onTaskComplete);\n    MyAnswers.$body.delegate('a:not([href=\"#\"])', 'click', onLinkClick);\n    MyAnswers.$body.delegate('a[href=\"#\"]', 'click', false);\n    MyAnswers.$body.on('click', '[data-blink=\"active-form\"] button', function(event) {\n      event.preventDefault();\n      onPendingClick(event);\n      return false;\n    });\n\n    if (!_Blink.isPhantomJS) {\n      // enable network detection, but not for PhantomJS (it's broken)\n      $window.on('online', onNetworkChange);\n      $window.on('offline', onNetworkChange);\n      onNetworkChange(); // $window.trigger('online');\n    }\n\n    // pre-configure storage system for BlinkGap if necessary\n    if (isBlinkGapDevice()) {\n      if (navigator.gap_database && $.inArray('websqldatabase', BlinkStorage.prototype.available) !== -1) {\n        dfrdFixWebSQL = fixWebSQL();\n      } else {\n        dfrdFixWebSQL = true; // will count as an instantly resolved Deferred Promise\n      }\n    }\n\n    // pre-configure domain whitelist for BlinkGap if necessary\n    if (isBlinkGapDevice() && MyAnswers.device.domainWhitelist\n        && window.navigator.whitelistmanage) {\n      domainWhitelist = MyAnswers.device.domainWhitelist;\n      if ($.type(domainWhitelist) === 'array') {\n        log('BlinkGap: replacing domain whitelist...');\n        try {\n          navigator.whitelistmanage.appendToWhitelist($.noop, $.noop, {\n            externalHosts: domainWhitelist\n          });\n        } catch (e) {\n          log('BlinkGap: domain whitelist error...');\n          error(e);\n        }\n        log('BlinkGap: domain whitelist replaced!');\n      }\n    }\n\n    // wait for Application Cache\n    loadedPromises.push(MyAnswers.cacheDfrd.promise());\n\n    // fix the WebSQL quota is necessary and open required persistent stores\n    $.when(dfrdFixWebSQL)\n    .always(function() {\n      if (MyAnswers.device.persistentStorage) {\n        storeEngine = MyAnswers.determineBlinkStorageEngine();\n\n          try {\n            MyAnswers.store = new BlinkStorage(storeEngine, siteVars.answerSpace, 'jstore');\n            loadedPromises.push(MyAnswers.store.ready());\n            MyAnswers.siteStore = new BlinkStorage(storeEngine, siteVars.answerSpace, 'site');\n            loadedPromises.push(MyAnswers.siteStore.ready());\n            MyAnswers.pendingStore = new BlinkStorage(null, siteVars.answerSpace, 'pending');\n            loadedPromises.push(MyAnswers.pendingStore.ready());\n            MyAnswers.pendingV1Store = new BlinkStorage(null, siteVars.answerSpace, 'pendingV1');\n            loadedPromises.push(MyAnswers.pendingV1Store.ready());\n          } catch (e) {\n            $startup.addClass('s-error');\n            $('#startUp-initMain').addClass('error');\n            if (e.toString) {\n              $startup.children('output').text(e.toString());\n            }\n            $startup.children('article[data-name=\"persistentfull\"]').show();\n            return;\n          }\n      }\n\n      $.whenArray(loadedPromises)\n      .fail(function() {\n        $('#startUp-initMain').addClass('error');\n        throw ('initMain(): unable to initialise device storage');\n      })\n      .then(function() {\n        $.when(updateLocalStorage())\n        .always(function() {\n          $('#startUp-initMain').addClass('success');\n          $('#startUp-initLoaded').addClass('working');\n          loaded();\n          log('loaded(): returned after call by BlinkStorage');\n        });\n      });\n      log('init_main(): finished...');\n    });\n  }\n\n  function onBrowserReady() {\n    var $startup = $('#startUp');\n    log('onBrowserReady: ' + window.location.href);\n    try {\n      History = window.History;\n      // duck-punching some History functions to fix states early\n      _pushState = History.pushState;\n      History.pushState = function() {\n        var args = $.makeArray(arguments);\n        if (args.length >= 1) {\n          args[0] = trimHistoryState(args[0]);\n        }\n        if (args.length >= 3) {\n          args[2] = trimHistoryState(args[2]);\n        }\n        _pushState.apply(History, args);\n      };\n      _replaceState = History.replaceState;\n      History.replaceState = function() {\n        var args = $.makeArray(arguments);\n        if (args.length >= 1) {\n          args[0] = trimHistoryState(args[0]);\n        }\n        if (args.length >= 3) {\n          args[2] = trimHistoryState(args[2]);\n        }\n        _replaceState.apply(History, args);\n      };\n\n      log('domain=' + siteVars.serverDomain + ' branch=' + siteVars.serverAppBranch + ' version=' + siteVars.serverAppVersion + ' device=' + deviceVars.device);\n\n      siteVars.serverAppPath = '/_' + siteVars.serverAppBranch + '_/common/' + siteVars.serverAppVersion;\n      siteVars.serverDevicePath = '/_' + siteVars.serverAppBranch + '_/' + deviceVars.device + '/' + siteVars.serverAppVersion;\n      siteVars.queryParameters = getURLParameters();\n      delete siteVars.queryParameters.uid;\n      delete siteVars.queryParameters.answerSpace;\n\n      MyAnswers.$html = $('html');\n      MyAnswers.$body = MyAnswers.$html.children('body');\n      MyAnswers.$document = $(window.document);\n      MyAnswers.$window = $window;\n      MyAnswers.$footer = MyAnswers.$body.children('footer');\n\n      $window.on('statechange', function(event) {\n        var state = History.getState(),\n            args = state.data['arguments'];\n        // TODO: work out a way to detect Back-navigation so reverse transitions can be used\n        try {\n          log('History.stateChange: ' + $.param(state.data) + ' ' + state.url);\n          if ($.type(siteVars.config) !== 'object' || $.isEmptyObject(currentConfig)) {\n            $.noop(); // do we need to do something if we have fired this early?\n          } else if (state.data.storage) {\n            showPendingView();\n          } else if (siteVars.hasLogin && state.data.login) {\n            showLoginView();\n          } else if (hasInteractions && state.data.i) {\n            if ($.isEmptyObject(args) || args.inputs) {\n              gotoNextScreen(state.data.i);\n            } else {\n              showAnswerView(state.data.i, args);\n            }\n          } else if (hasCategories && state.data.c) {\n            showKeywordListView(state.data.c);\n          } else if (hasMasterCategories && state.data.m) {\n            showCategoriesView(state.data.m);\n          } else {\n            if (hasMasterCategories) {\n              showMasterCategoriesView();\n            } else if (hasCategories) {\n              showCategoriesView();\n            } else if (answerSpaceOneKeyword) {\n              gotoNextScreen(siteVars.map.interactions[0]);\n            } else {\n              showKeywordListView();\n            }\n          }\n        } catch (error) {\n          error('Error in onStateChange handler...');\n        }\n        event.preventDefault();\n        return false;\n      });\n\n      if (location.href.indexOf('index.php?answerSpace=') !== -1) {\n        History.replaceState(null, null, '/' + siteVars.answerSpace + '/');\n      }\n      if (document.getElementById('loginButton') !== null) {\n        // TODO: get hasLogin working directly off new config field\n        siteVars.hasLogin = true;\n      }\n\n      $.when(waitForBlinkGap())\n      .then(function() {\n            if (isBlinkGapDevice() && $.type(onDeviceReady) === 'function') {\n              onDeviceReady();\n            }\n          })\n      .always(function() {\n            MyAnswers.browserDeferred.resolve();\n          });\n\n      $('#startUp-initBrowser').addClass('success');\n    } catch (e) {\n      log('onBrowserReady: Exception');\n      error(e);\n      $startup.append('browser error: ' + e);\n      $('#startUp-initBrowser').addClass('error');\n    }\n  }\n\n  MyAnswers.bootPromises = [\n    MyAnswers.deviceDeferred.promise(),\n    MyAnswers.browserDeferred.promise(),\n    MyAnswers.mainDeferred.promise()\n  ];\n  $.whenArray(MyAnswers.bootPromises).done(function() {\n    log('all promises kept, initialising...');\n    try {\n      $('#startUp-initMain').addClass('working');\n      init_main();\n      $('#startUp-initDevice').addClass('working');\n      init_device();\n    } catch (e) {\n      log('exception in init_?():');\n      error(e);\n      $startup.append('initialisation error: ' + e);\n    }\n    log('User-Agent: ' + window.navigator.userAgent);\n    delete MyAnswers.bootPromises;\n    delete MyAnswers.deviceDeferred;\n    delete MyAnswers.browserDeferred;\n    delete MyAnswers.mainDeferred;\n  }).fail(function() {\n    log('init failed, not all promises kept');\n  });\n\n  // *** DOM DOCUMENT READY ***\n\n  $(document).ready(function() {\n    var userAgent = navigator.userAgent,\n        safariTest;\n    /* END: var */\n\n    // check if Safari's Private Browsing is enabled\n    if (userAgent.indexOf('Safari') !== -1 && window.localStorage) {\n      safariTest = 'SafariTest-' + (Math.random() * Math.pow(10, 16));\n      try {\n        window.localStorage.setItem(safariTest, safariTest);\n        window.localStorage.removeItem(safariTest);\n      } catch (e) {\n        $startup.addClass('s-error');\n        if (e.toString) {\n          $startup.children('output').text(e.toString());\n        }\n        $startup.children('article[data-name=\"privatesafari\"]').show();\n        return;\n      }\n    }\n\n    $('#startUp-loadPolyFills').addClass('working');\n\n    $('img').off('error', siteVars.fixImages);\n    $('img').on('error', siteVars.fixImages);\n\n    // set default options / headers for $.ajax()\n    $.ajaxPrefilter(function(options, original, jqxhr) {\n        var url = decodeURI(options.url),\n          config = {\n            answerSpaceId: siteVars.id,\n            answerSpace: siteVars.answerSpace,\n            conditions: deviceVars.features\n          };\n        /*\n         * xhr.onprogress = function(e) { var string = 'AJAX progress: ' +\n         * phpName; log(string + ' ' + e.position + ' ' +\n         * e.total + ' ' + xhr + ' ' + options); }\n         */\n        if (url.length > 100) {\n          url = url.substring(0, 100) + '...';\n        }\n        jqxhr.setRequestHeader('X-Blink-Config', JSON.stringify(config));\n        jqxhr.setRequestHeader('X-Blink-Statistics', $.param({\n          'requests': ++siteVars.requestsCounter\n        }));\n        // prevent jQuery from disabling cache mechanisms\n        options.cache = 'true';\n        log('AJAX start: ' + url);\n    });\n\n    // define linear multi-getScript method\n    $.getScripts = function(urls) {\n      var dfrd = new $.Deferred();\n      if ($.type(urls) !== 'array') {\n        dfrd.reject();\n      } else if (!urls.length) {\n        dfrd.resolve();\n      } else {\n        $.getCachedScript(urls.shift())\n        .fail(dfrd.reject)\n        .then(function() {\n          $.getScripts(urls)\n          .fail(dfrd.reject)\n          .then(dfrd.resolve);\n        });\n      }\n      return dfrd.promise();\n    };\n\n    $.when(MyAnswers.mainDeferred.promise())\n    .then(function() { // load in JSON and XSLT polyfills if necessary\n      var dfrdJSON,\n          dfrdXPath = new $.Deferred(),\n          dfrdXSLT;\n\n      // poly-fill JSON\n      if (window.JSON && window.JSON.stringify) {\n        dfrdJSON = true;\n      } else {\n        dfrdJSON = $.getCachedScript(_Blink.cdnp.getURL('json2.min.js'));\n      }\n\n      // poly-fill XPath\n      if (window.XSLTProcessor && Modernizr.xpath) {\n        log('XPath supported natively');\n        dfrdXPath.resolve();\n      } else if (window.xpathParse) {\n        log('XPath supported via AJAXSLT');\n        dfrdXPath.resolve();\n      } else {\n        $.getScripts([\n          _Blink.cdnp.getURL('ajaxslt/0.8.1-r61/xmltoken.min.js'),\n          _Blink.cdnp.getURL('ajaxslt/0.8.1-r61/util.min.js'),\n          _Blink.cdnp.getURL('ajaxslt/0.8.1-r61/dom.min.js'),\n          // TODO: figure out how to test if the above scripts are needed\n          _Blink.cdnp.getURL('ajaxslt/0.8.1-r61/xpath.min.js')\n        ])\n        .fail(dfrdXPath.reject)\n        .then(dfrdXPath.resolve);\n      }\n\n      // poly-fill XSLT, after XPath\n      if (window.XSLTProcessor) {\n        log('XSLT supported natively');\n        dfrdXSLT = true;\n      } else if (window.xsltProcess) {\n        log('XSLT supported via AJAXSLT');\n        dfrdXSLT = true;\n      } else {\n        dfrdXSLT = dfrdXPath.pipe(function() {\n          return $.getCachedScript(_Blink.cdnp.getURL('ajaxslt/0.8.1-r61/xslt.min.js'));\n        });\n      }\n\n      $.when(dfrdJSON, dfrdXPath.promise(), dfrdXSLT)\n      .fail(function() {\n        $('#startUp-loadPolyFills').addClass('error');\n        $('#startUp').append('<p>error: refresh the application or clear cache and try again</p>');\n      })\n      .then(function() {\n        $('#startUp-loadPolyFills').addClass('success');\n        $('#startUp-initBrowser').addClass('working');\n        setTimeout(onBrowserReady, window.device ? 2000 : 193);\n      });\n    });\n  });\n\n}(this));\n\n// END APPLICATION INIT\n\ndocument.getElementById('startUp-loadMain').className = 'working success';\nMyAnswers.mainDeferred.resolve();\n","/*jslint browser:true, indent:2*/\n/*jslint es5:true, nomen:true*/ // __proto__\n\n// https://github.com/es-shims/es5-shim/blob/ad5e68434ea9b08279aec78ab6661c100cb9b04f/es5-sham.js#L160\n\n// ES5 15.2.3.5\n// http://es5.github.com/#x15.2.3.5\nif (!Object.create) {\n\n  Object.create = function create(prototype, properties) {\n    'use strict';\n    var object;\n    function Type() { return this; }  // An empty constructor.\n\n    if (prototype === null) {\n      // BLINK: prevent sham-usage (arguments[0] === null)\n      throw new TypeError(\"Object.create(null) is a sham in this implementation\");\n    } else {\n      if (typeof prototype !== \"object\" && typeof prototype !== \"function\") {\n        // In the native implementation `parent` can be `null`\n        // OR *any* `instanceof Object`  (Object|Function|Array|RegExp|etc)\n        // Use `typeof` tho, b/c in old IE, DOM elements are not `instanceof Object`\n        // like they are in modern browsers. Using `Object.create` on DOM elements\n        // is...err...probably inappropriate, but the native version allows for it.\n        throw new TypeError(\"Object prototype may only be an Object or null\"); // same msg as Chrome\n      }\n      Type.prototype = prototype;\n      object = new Type();\n      // BLINK: don't bother setting object.__proto__ (fixes shim-compatibility with IE8)\n      // BLINK: we just need to make sure that object.prototype.constructor is appropriate where necessary\n    }\n\n    // BLINK: assume that undefined is undefined\n    if (properties !== undefined) {\n      // BLINK: prevent sham-usage (arguments[1] !== null)\n      throw new TypeError(\"Object.create(prototype, properties) is a sham in this implementation\");\n    }\n\n    return object;\n  };\n}\n\n","/**\n * Copyright 2010 Tim Down.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * jshashtable\n *\n * jshashtable is a JavaScript implementation of a hash table. It creates a single constructor function called Hashtable\n * in the global scope.\n *\n * Author: Tim Down <tim@timdown.co.uk>\n * Version: 2.1\n * Build date: 21 March 2010\n * Website: http://www.timdown.co.uk/jshashtable\n */\n\nvar Hashtable = (function() {\n\tvar FUNCTION = \"function\";\n\n\tvar arrayRemoveAt = (typeof Array.prototype.splice == FUNCTION) ?\n\t\tfunction(arr, idx) {\n\t\t\tarr.splice(idx, 1);\n\t\t} :\n\n\t\tfunction(arr, idx) {\n\t\t\tvar itemsAfterDeleted, i, len;\n\t\t\tif (idx === arr.length - 1) {\n\t\t\t\tarr.length = idx;\n\t\t\t} else {\n\t\t\t\titemsAfterDeleted = arr.slice(idx + 1);\n\t\t\t\tarr.length = idx;\n\t\t\t\tfor (i = 0, len = itemsAfterDeleted.length; i < len; ++i) {\n\t\t\t\t\tarr[idx + i] = itemsAfterDeleted[i];\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\tfunction hashObject(obj) {\n\t\tvar hashCode;\n\t\tif (typeof obj == \"string\") {\n\t\t\treturn obj;\n\t\t} else if (typeof obj.hashCode == FUNCTION) {\n\t\t\t// Check the hashCode method really has returned a string\n\t\t\thashCode = obj.hashCode();\n\t\t\treturn (typeof hashCode == \"string\") ? hashCode : hashObject(hashCode);\n\t\t} else if (typeof obj.toString == FUNCTION) {\n\t\t\treturn obj.toString();\n\t\t} else {\n\t\t\ttry {\n\t\t\t\treturn String(obj);\n\t\t\t} catch (ex) {\n\t\t\t\t// For host objects (such as ActiveObjects in IE) that have no toString() method and throw an error when\n\t\t\t\t// passed to String()\n\t\t\t\treturn Object.prototype.toString.call(obj);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction equals_fixedValueHasEquals(fixedValue, variableValue) {\n\t\treturn fixedValue.equals(variableValue);\n\t}\n\n\tfunction equals_fixedValueNoEquals(fixedValue, variableValue) {\n\t\treturn (typeof variableValue.equals == FUNCTION) ?\n\t\t\t   variableValue.equals(fixedValue) : (fixedValue === variableValue);\n\t}\n\n\tfunction createKeyValCheck(kvStr) {\n\t\treturn function(kv) {\n\t\t\tif (kv === null) {\n\t\t\t\tthrow new Error(\"null is not a valid \" + kvStr);\n\t\t\t} else if (typeof kv == \"undefined\") {\n\t\t\t\tthrow new Error(kvStr + \" must not be undefined\");\n\t\t\t}\n\t\t};\n\t}\n\n\tvar checkKey = createKeyValCheck(\"key\"), checkValue = createKeyValCheck(\"value\");\n\n\t/*----------------------------------------------------------------------------------------------------------------*/\n\n\tfunction Bucket(hash, firstKey, firstValue, equalityFunction) {\n        this[0] = hash;\n\t\tthis.entries = [];\n\t\tthis.addEntry(firstKey, firstValue);\n\n\t\tif (equalityFunction !== null) {\n\t\t\tthis.getEqualityFunction = function() {\n\t\t\t\treturn equalityFunction;\n\t\t\t};\n\t\t}\n\t}\n\n\tvar EXISTENCE = 0, ENTRY = 1, ENTRY_INDEX_AND_VALUE = 2;\n\n\tfunction createBucketSearcher(mode) {\n\t\treturn function(key) {\n\t\t\tvar i = this.entries.length, entry, equals = this.getEqualityFunction(key);\n\t\t\twhile (i--) {\n\t\t\t\tentry = this.entries[i];\n\t\t\t\tif ( equals(key, entry[0]) ) {\n\t\t\t\t\tswitch (mode) {\n\t\t\t\t\t\tcase EXISTENCE:\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\tcase ENTRY:\n\t\t\t\t\t\t\treturn entry;\n\t\t\t\t\t\tcase ENTRY_INDEX_AND_VALUE:\n\t\t\t\t\t\t\treturn [ i, entry[1] ];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\t}\n\n\tfunction createBucketLister(entryProperty) {\n\t\treturn function(aggregatedArr) {\n\t\t\tvar startIndex = aggregatedArr.length;\n\t\t\tfor (var i = 0, len = this.entries.length; i < len; ++i) {\n\t\t\t\taggregatedArr[startIndex + i] = this.entries[i][entryProperty];\n\t\t\t}\n\t\t};\n\t}\n\n\tBucket.prototype = {\n\t\tgetEqualityFunction: function(searchValue) {\n\t\t\treturn (typeof searchValue.equals == FUNCTION) ? equals_fixedValueHasEquals : equals_fixedValueNoEquals;\n\t\t},\n\n\t\tgetEntryForKey: createBucketSearcher(ENTRY),\n\n\t\tgetEntryAndIndexForKey: createBucketSearcher(ENTRY_INDEX_AND_VALUE),\n\n\t\tremoveEntryForKey: function(key) {\n\t\t\tvar result = this.getEntryAndIndexForKey(key);\n\t\t\tif (result) {\n\t\t\t\tarrayRemoveAt(this.entries, result[0]);\n\t\t\t\treturn result[1];\n\t\t\t}\n\t\t\treturn null;\n\t\t},\n\n\t\taddEntry: function(key, value) {\n\t\t\tthis.entries[this.entries.length] = [key, value];\n\t\t},\n\n\t\tkeys: createBucketLister(0),\n\n\t\tvalues: createBucketLister(1),\n\n\t\tgetEntries: function(entries) {\n\t\t\tvar startIndex = entries.length;\n\t\t\tfor (var i = 0, len = this.entries.length; i < len; ++i) {\n\t\t\t\t// Clone the entry stored in the bucket before adding to array\n\t\t\t\tentries[startIndex + i] = this.entries[i].slice(0);\n\t\t\t}\n\t\t},\n\n\t\tcontainsKey: createBucketSearcher(EXISTENCE),\n\n\t\tcontainsValue: function(value) {\n\t\t\tvar i = this.entries.length;\n\t\t\twhile (i--) {\n\t\t\t\tif ( value === this.entries[i][1] ) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t};\n\n\t/*----------------------------------------------------------------------------------------------------------------*/\n\n\t// Supporting functions for searching hashtable buckets\n\n\tfunction searchBuckets(buckets, hash) {\n\t\tvar i = buckets.length, bucket;\n\t\twhile (i--) {\n\t\t\tbucket = buckets[i];\n\t\t\tif (hash === bucket[0]) {\n\t\t\t\treturn i;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tfunction getBucketForHash(bucketsByHash, hash) {\n\t\tvar bucket = bucketsByHash[hash];\n\n\t\t// Check that this is a genuine bucket and not something inherited from the bucketsByHash's prototype\n\t\treturn ( bucket && (bucket instanceof Bucket) ) ? bucket : null;\n\t}\n\n\t/*----------------------------------------------------------------------------------------------------------------*/\n\n\tfunction Hashtable(hashingFunctionParam, equalityFunctionParam) {\n\t\tvar that = this;\n\t\tvar buckets = [];\n\t\tvar bucketsByHash = {};\n\n\t\tvar hashingFunction = (typeof hashingFunctionParam == FUNCTION) ? hashingFunctionParam : hashObject;\n\t\tvar equalityFunction = (typeof equalityFunctionParam == FUNCTION) ? equalityFunctionParam : null;\n\n\t\tthis.put = function(key, value) {\n\t\t\tcheckKey(key);\n\t\t\tcheckValue(value);\n\t\t\tvar hash = hashingFunction(key), bucket, bucketEntry, oldValue = null;\n\n\t\t\t// Check if a bucket exists for the bucket key\n\t\t\tbucket = getBucketForHash(bucketsByHash, hash);\n\t\t\tif (bucket) {\n\t\t\t\t// Check this bucket to see if it already contains this key\n\t\t\t\tbucketEntry = bucket.getEntryForKey(key);\n\t\t\t\tif (bucketEntry) {\n\t\t\t\t\t// This bucket entry is the current mapping of key to value, so replace old value and we're done.\n\t\t\t\t\toldValue = bucketEntry[1];\n\t\t\t\t\tbucketEntry[1] = value;\n\t\t\t\t} else {\n\t\t\t\t\t// The bucket does not contain an entry for this key, so add one\n\t\t\t\t\tbucket.addEntry(key, value);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// No bucket exists for the key, so create one and put our key/value mapping in\n\t\t\t\tbucket = new Bucket(hash, key, value, equalityFunction);\n\t\t\t\tbuckets[buckets.length] = bucket;\n\t\t\t\tbucketsByHash[hash] = bucket;\n\t\t\t}\n\t\t\treturn oldValue;\n\t\t};\n\n\t\tthis.get = function(key) {\n\t\t\tcheckKey(key);\n\n\t\t\tvar hash = hashingFunction(key);\n\n\t\t\t// Check if a bucket exists for the bucket key\n\t\t\tvar bucket = getBucketForHash(bucketsByHash, hash);\n\t\t\tif (bucket) {\n\t\t\t\t// Check this bucket to see if it contains this key\n\t\t\t\tvar bucketEntry = bucket.getEntryForKey(key);\n\t\t\t\tif (bucketEntry) {\n\t\t\t\t\t// This bucket entry is the current mapping of key to value, so return the value.\n\t\t\t\t\treturn bucketEntry[1];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn null;\n\t\t};\n\n\t\tthis.containsKey = function(key) {\n\t\t\tcheckKey(key);\n\t\t\tvar bucketKey = hashingFunction(key);\n\n\t\t\t// Check if a bucket exists for the bucket key\n\t\t\tvar bucket = getBucketForHash(bucketsByHash, bucketKey);\n\n\t\t\treturn bucket ? bucket.containsKey(key) : false;\n\t\t};\n\n\t\tthis.containsValue = function(value) {\n\t\t\tcheckValue(value);\n\t\t\tvar i = buckets.length;\n\t\t\twhile (i--) {\n\t\t\t\tif (buckets[i].containsValue(value)) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn false;\n\t\t};\n\n\t\tthis.clear = function() {\n\t\t\tbuckets.length = 0;\n\t\t\tbucketsByHash = {};\n\t\t};\n\n\t\tthis.isEmpty = function() {\n\t\t\treturn !buckets.length;\n\t\t};\n\n\t\tvar createBucketAggregator = function(bucketFuncName) {\n\t\t\treturn function() {\n\t\t\t\tvar aggregated = [], i = buckets.length;\n\t\t\t\twhile (i--) {\n\t\t\t\t\tbuckets[i][bucketFuncName](aggregated);\n\t\t\t\t}\n\t\t\t\treturn aggregated;\n\t\t\t};\n\t\t};\n\n\t\tthis.keys = createBucketAggregator(\"keys\");\n\t\tthis.values = createBucketAggregator(\"values\");\n\t\tthis.entries = createBucketAggregator(\"getEntries\");\n\n\t\tthis.remove = function(key) {\n\t\t\tcheckKey(key);\n\n\t\t\tvar hash = hashingFunction(key), bucketIndex, oldValue = null;\n\n\t\t\t// Check if a bucket exists for the bucket key\n\t\t\tvar bucket = getBucketForHash(bucketsByHash, hash);\n\n\t\t\tif (bucket) {\n\t\t\t\t// Remove entry from this bucket for this key\n\t\t\t\toldValue = bucket.removeEntryForKey(key);\n\t\t\t\tif (oldValue !== null) {\n\t\t\t\t\t// Entry was removed, so check if bucket is empty\n\t\t\t\t\tif (!bucket.entries.length) {\n\t\t\t\t\t\t// Bucket is empty, so remove it from the bucket collections\n\t\t\t\t\t\tbucketIndex = searchBuckets(buckets, hash);\n\t\t\t\t\t\tarrayRemoveAt(buckets, bucketIndex);\n\t\t\t\t\t\tdelete bucketsByHash[hash];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn oldValue;\n\t\t};\n\n\t\tthis.size = function() {\n\t\t\tvar total = 0, i = buckets.length;\n\t\t\twhile (i--) {\n\t\t\t\ttotal += buckets[i].entries.length;\n\t\t\t}\n\t\t\treturn total;\n\t\t};\n\n\t\tthis.each = function(callback) {\n\t\t\tvar entries = that.entries(), i = entries.length, entry;\n\t\t\twhile (i--) {\n\t\t\t\tentry = entries[i];\n\t\t\t\tcallback(entry[0], entry[1]);\n\t\t\t}\n\t\t};\n\n\t\tthis.putAll = function(hashtable, conflictCallback) {\n\t\t\tvar entries = hashtable.entries();\n\t\t\tvar entry, key, value, thisValue, i = entries.length;\n\t\t\tvar hasConflictCallback = (typeof conflictCallback == FUNCTION);\n\t\t\twhile (i--) {\n\t\t\t\tentry = entries[i];\n\t\t\t\tkey = entry[0];\n\t\t\t\tvalue = entry[1];\n\n\t\t\t\t// Check for a conflict. The default behaviour is to overwrite the value for an existing key\n\t\t\t\tif ( hasConflictCallback && (thisValue = that.get(key)) ) {\n\t\t\t\t\tvalue = conflictCallback(key, thisValue, value);\n\t\t\t\t}\n\t\t\t\tthat.put(key, value);\n\t\t\t}\n\t\t};\n\n\t\tthis.clone = function() {\n\t\t\tvar clone = new Hashtable(hashingFunctionParam, equalityFunctionParam);\n\t\t\tclone.putAll(that);\n\t\t\treturn clone;\n\t\t};\n\t}\n\n\treturn Hashtable;\n})();\n","//     Underscore.js 1.5.2\n//     http://underscorejs.org\n//     (c) 2009-2013 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n//     Underscore may be freely distributed under the MIT license.\n\n(function() {\n\n  // Baseline setup\n  // --------------\n\n  // Establish the root object, `window` in the browser, or `exports` on the server.\n  var root = this;\n\n  // Save the previous value of the `_` variable.\n  var previousUnderscore = root._;\n\n  // Establish the object that gets returned to break out of a loop iteration.\n  var breaker = {};\n\n  // Save bytes in the minified (but not gzipped) version:\n  var ArrayProto = Array.prototype, ObjProto = Object.prototype, FuncProto = Function.prototype;\n\n  // Create quick reference variables for speed access to core prototypes.\n  var\n    push             = ArrayProto.push,\n    slice            = ArrayProto.slice,\n    concat           = ArrayProto.concat,\n    toString         = ObjProto.toString,\n    hasOwnProperty   = ObjProto.hasOwnProperty;\n\n  // All **ECMAScript 5** native function implementations that we hope to use\n  // are declared here.\n  var\n    nativeForEach      = ArrayProto.forEach,\n    nativeMap          = ArrayProto.map,\n    nativeReduce       = ArrayProto.reduce,\n    nativeReduceRight  = ArrayProto.reduceRight,\n    nativeFilter       = ArrayProto.filter,\n    nativeEvery        = ArrayProto.every,\n    nativeSome         = ArrayProto.some,\n    nativeIndexOf      = ArrayProto.indexOf,\n    nativeLastIndexOf  = ArrayProto.lastIndexOf,\n    nativeIsArray      = Array.isArray,\n    nativeKeys         = Object.keys,\n    nativeBind         = FuncProto.bind;\n\n  // Create a safe reference to the Underscore object for use below.\n  var _ = function(obj) {\n    if (obj instanceof _) return obj;\n    if (!(this instanceof _)) return new _(obj);\n    this._wrapped = obj;\n  };\n\n  // Export the Underscore object for **Node.js**, with\n  // backwards-compatibility for the old `require()` API. If we're in\n  // the browser, add `_` as a global object via a string identifier,\n  // for Closure Compiler \"advanced\" mode.\n  if (typeof exports !== 'undefined') {\n    if (typeof module !== 'undefined' && module.exports) {\n      exports = module.exports = _;\n    }\n    exports._ = _;\n  } else {\n    root._ = _;\n  }\n\n  // Current version.\n  _.VERSION = '1.5.2';\n\n  // Collection Functions\n  // --------------------\n\n  // The cornerstone, an `each` implementation, aka `forEach`.\n  // Handles objects with the built-in `forEach`, arrays, and raw objects.\n  // Delegates to **ECMAScript 5**'s native `forEach` if available.\n  var each = _.each = _.forEach = function(obj, iterator, context) {\n    if (obj == null) return;\n    if (nativeForEach && obj.forEach === nativeForEach) {\n      obj.forEach(iterator, context);\n    } else if (obj.length === +obj.length) {\n      for (var i = 0, length = obj.length; i < length; i++) {\n        if (iterator.call(context, obj[i], i, obj) === breaker) return;\n      }\n    } else {\n      var keys = _.keys(obj);\n      for (var i = 0, length = keys.length; i < length; i++) {\n        if (iterator.call(context, obj[keys[i]], keys[i], obj) === breaker) return;\n      }\n    }\n  };\n\n  // Return the results of applying the iterator to each element.\n  // Delegates to **ECMAScript 5**'s native `map` if available.\n  _.map = _.collect = function(obj, iterator, context) {\n    var results = [];\n    if (obj == null) return results;\n    if (nativeMap && obj.map === nativeMap) return obj.map(iterator, context);\n    each(obj, function(value, index, list) {\n      results.push(iterator.call(context, value, index, list));\n    });\n    return results;\n  };\n\n  var reduceError = 'Reduce of empty array with no initial value';\n\n  // **Reduce** builds up a single result from a list of values, aka `inject`,\n  // or `foldl`. Delegates to **ECMAScript 5**'s native `reduce` if available.\n  _.reduce = _.foldl = _.inject = function(obj, iterator, memo, context) {\n    var initial = arguments.length > 2;\n    if (obj == null) obj = [];\n    if (nativeReduce && obj.reduce === nativeReduce) {\n      if (context) iterator = _.bind(iterator, context);\n      return initial ? obj.reduce(iterator, memo) : obj.reduce(iterator);\n    }\n    each(obj, function(value, index, list) {\n      if (!initial) {\n        memo = value;\n        initial = true;\n      } else {\n        memo = iterator.call(context, memo, value, index, list);\n      }\n    });\n    if (!initial) throw new TypeError(reduceError);\n    return memo;\n  };\n\n  // The right-associative version of reduce, also known as `foldr`.\n  // Delegates to **ECMAScript 5**'s native `reduceRight` if available.\n  _.reduceRight = _.foldr = function(obj, iterator, memo, context) {\n    var initial = arguments.length > 2;\n    if (obj == null) obj = [];\n    if (nativeReduceRight && obj.reduceRight === nativeReduceRight) {\n      if (context) iterator = _.bind(iterator, context);\n      return initial ? obj.reduceRight(iterator, memo) : obj.reduceRight(iterator);\n    }\n    var length = obj.length;\n    if (length !== +length) {\n      var keys = _.keys(obj);\n      length = keys.length;\n    }\n    each(obj, function(value, index, list) {\n      index = keys ? keys[--length] : --length;\n      if (!initial) {\n        memo = obj[index];\n        initial = true;\n      } else {\n        memo = iterator.call(context, memo, obj[index], index, list);\n      }\n    });\n    if (!initial) throw new TypeError(reduceError);\n    return memo;\n  };\n\n  // Return the first value which passes a truth test. Aliased as `detect`.\n  _.find = _.detect = function(obj, iterator, context) {\n    var result;\n    any(obj, function(value, index, list) {\n      if (iterator.call(context, value, index, list)) {\n        result = value;\n        return true;\n      }\n    });\n    return result;\n  };\n\n  // Return all the elements that pass a truth test.\n  // Delegates to **ECMAScript 5**'s native `filter` if available.\n  // Aliased as `select`.\n  _.filter = _.select = function(obj, iterator, context) {\n    var results = [];\n    if (obj == null) return results;\n    if (nativeFilter && obj.filter === nativeFilter) return obj.filter(iterator, context);\n    each(obj, function(value, index, list) {\n      if (iterator.call(context, value, index, list)) results.push(value);\n    });\n    return results;\n  };\n\n  // Return all the elements for which a truth test fails.\n  _.reject = function(obj, iterator, context) {\n    return _.filter(obj, function(value, index, list) {\n      return !iterator.call(context, value, index, list);\n    }, context);\n  };\n\n  // Determine whether all of the elements match a truth test.\n  // Delegates to **ECMAScript 5**'s native `every` if available.\n  // Aliased as `all`.\n  _.every = _.all = function(obj, iterator, context) {\n    iterator || (iterator = _.identity);\n    var result = true;\n    if (obj == null) return result;\n    if (nativeEvery && obj.every === nativeEvery) return obj.every(iterator, context);\n    each(obj, function(value, index, list) {\n      if (!(result = result && iterator.call(context, value, index, list))) return breaker;\n    });\n    return !!result;\n  };\n\n  // Determine if at least one element in the object matches a truth test.\n  // Delegates to **ECMAScript 5**'s native `some` if available.\n  // Aliased as `any`.\n  var any = _.some = _.any = function(obj, iterator, context) {\n    iterator || (iterator = _.identity);\n    var result = false;\n    if (obj == null) return result;\n    if (nativeSome && obj.some === nativeSome) return obj.some(iterator, context);\n    each(obj, function(value, index, list) {\n      if (result || (result = iterator.call(context, value, index, list))) return breaker;\n    });\n    return !!result;\n  };\n\n  // Determine if the array or object contains a given value (using `===`).\n  // Aliased as `include`.\n  _.contains = _.include = function(obj, target) {\n    if (obj == null) return false;\n    if (nativeIndexOf && obj.indexOf === nativeIndexOf) return obj.indexOf(target) != -1;\n    return any(obj, function(value) {\n      return value === target;\n    });\n  };\n\n  // Invoke a method (with arguments) on every item in a collection.\n  _.invoke = function(obj, method) {\n    var args = slice.call(arguments, 2);\n    var isFunc = _.isFunction(method);\n    return _.map(obj, function(value) {\n      return (isFunc ? method : value[method]).apply(value, args);\n    });\n  };\n\n  // Convenience version of a common use case of `map`: fetching a property.\n  _.pluck = function(obj, key) {\n    return _.map(obj, function(value){ return value[key]; });\n  };\n\n  // Convenience version of a common use case of `filter`: selecting only objects\n  // containing specific `key:value` pairs.\n  _.where = function(obj, attrs, first) {\n    if (_.isEmpty(attrs)) return first ? void 0 : [];\n    return _[first ? 'find' : 'filter'](obj, function(value) {\n      for (var key in attrs) {\n        if (attrs[key] !== value[key]) return false;\n      }\n      return true;\n    });\n  };\n\n  // Convenience version of a common use case of `find`: getting the first object\n  // containing specific `key:value` pairs.\n  _.findWhere = function(obj, attrs) {\n    return _.where(obj, attrs, true);\n  };\n\n  // Return the maximum element or (element-based computation).\n  // Can't optimize arrays of integers longer than 65,535 elements.\n  // See [WebKit Bug 80797](https://bugs.webkit.org/show_bug.cgi?id=80797)\n  _.max = function(obj, iterator, context) {\n    if (!iterator && _.isArray(obj) && obj[0] === +obj[0] && obj.length < 65535) {\n      return Math.max.apply(Math, obj);\n    }\n    if (!iterator && _.isEmpty(obj)) return -Infinity;\n    var result = {computed : -Infinity, value: -Infinity};\n    each(obj, function(value, index, list) {\n      var computed = iterator ? iterator.call(context, value, index, list) : value;\n      computed > result.computed && (result = {value : value, computed : computed});\n    });\n    return result.value;\n  };\n\n  // Return the minimum element (or element-based computation).\n  _.min = function(obj, iterator, context) {\n    if (!iterator && _.isArray(obj) && obj[0] === +obj[0] && obj.length < 65535) {\n      return Math.min.apply(Math, obj);\n    }\n    if (!iterator && _.isEmpty(obj)) return Infinity;\n    var result = {computed : Infinity, value: Infinity};\n    each(obj, function(value, index, list) {\n      var computed = iterator ? iterator.call(context, value, index, list) : value;\n      computed < result.computed && (result = {value : value, computed : computed});\n    });\n    return result.value;\n  };\n\n  // Shuffle an array, using the modern version of the \n  // [Fisher-Yates shuffle](http://en.wikipedia.org/wiki/Fisher–Yates_shuffle).\n  _.shuffle = function(obj) {\n    var rand;\n    var index = 0;\n    var shuffled = [];\n    each(obj, function(value) {\n      rand = _.random(index++);\n      shuffled[index - 1] = shuffled[rand];\n      shuffled[rand] = value;\n    });\n    return shuffled;\n  };\n\n  // Sample **n** random values from an array.\n  // If **n** is not specified, returns a single random element from the array.\n  // The internal `guard` argument allows it to work with `map`.\n  _.sample = function(obj, n, guard) {\n    if (arguments.length < 2 || guard) {\n      return obj[_.random(obj.length - 1)];\n    }\n    return _.shuffle(obj).slice(0, Math.max(0, n));\n  };\n\n  // An internal function to generate lookup iterators.\n  var lookupIterator = function(value) {\n    return _.isFunction(value) ? value : function(obj){ return obj[value]; };\n  };\n\n  // Sort the object's values by a criterion produced by an iterator.\n  _.sortBy = function(obj, value, context) {\n    var iterator = lookupIterator(value);\n    return _.pluck(_.map(obj, function(value, index, list) {\n      return {\n        value: value,\n        index: index,\n        criteria: iterator.call(context, value, index, list)\n      };\n    }).sort(function(left, right) {\n      var a = left.criteria;\n      var b = right.criteria;\n      if (a !== b) {\n        if (a > b || a === void 0) return 1;\n        if (a < b || b === void 0) return -1;\n      }\n      return left.index - right.index;\n    }), 'value');\n  };\n\n  // An internal function used for aggregate \"group by\" operations.\n  var group = function(behavior) {\n    return function(obj, value, context) {\n      var result = {};\n      var iterator = value == null ? _.identity : lookupIterator(value);\n      each(obj, function(value, index) {\n        var key = iterator.call(context, value, index, obj);\n        behavior(result, key, value);\n      });\n      return result;\n    };\n  };\n\n  // Groups the object's values by a criterion. Pass either a string attribute\n  // to group by, or a function that returns the criterion.\n  _.groupBy = group(function(result, key, value) {\n    (_.has(result, key) ? result[key] : (result[key] = [])).push(value);\n  });\n\n  // Indexes the object's values by a criterion, similar to `groupBy`, but for\n  // when you know that your index values will be unique.\n  _.indexBy = group(function(result, key, value) {\n    result[key] = value;\n  });\n\n  // Counts instances of an object that group by a certain criterion. Pass\n  // either a string attribute to count by, or a function that returns the\n  // criterion.\n  _.countBy = group(function(result, key) {\n    _.has(result, key) ? result[key]++ : result[key] = 1;\n  });\n\n  // Use a comparator function to figure out the smallest index at which\n  // an object should be inserted so as to maintain order. Uses binary search.\n  _.sortedIndex = function(array, obj, iterator, context) {\n    iterator = iterator == null ? _.identity : lookupIterator(iterator);\n    var value = iterator.call(context, obj);\n    var low = 0, high = array.length;\n    while (low < high) {\n      var mid = (low + high) >>> 1;\n      iterator.call(context, array[mid]) < value ? low = mid + 1 : high = mid;\n    }\n    return low;\n  };\n\n  // Safely create a real, live array from anything iterable.\n  _.toArray = function(obj) {\n    if (!obj) return [];\n    if (_.isArray(obj)) return slice.call(obj);\n    if (obj.length === +obj.length) return _.map(obj, _.identity);\n    return _.values(obj);\n  };\n\n  // Return the number of elements in an object.\n  _.size = function(obj) {\n    if (obj == null) return 0;\n    return (obj.length === +obj.length) ? obj.length : _.keys(obj).length;\n  };\n\n  // Array Functions\n  // ---------------\n\n  // Get the first element of an array. Passing **n** will return the first N\n  // values in the array. Aliased as `head` and `take`. The **guard** check\n  // allows it to work with `_.map`.\n  _.first = _.head = _.take = function(array, n, guard) {\n    if (array == null) return void 0;\n    return (n == null) || guard ? array[0] : slice.call(array, 0, n);\n  };\n\n  // Returns everything but the last entry of the array. Especially useful on\n  // the arguments object. Passing **n** will return all the values in\n  // the array, excluding the last N. The **guard** check allows it to work with\n  // `_.map`.\n  _.initial = function(array, n, guard) {\n    return slice.call(array, 0, array.length - ((n == null) || guard ? 1 : n));\n  };\n\n  // Get the last element of an array. Passing **n** will return the last N\n  // values in the array. The **guard** check allows it to work with `_.map`.\n  _.last = function(array, n, guard) {\n    if (array == null) return void 0;\n    if ((n == null) || guard) {\n      return array[array.length - 1];\n    } else {\n      return slice.call(array, Math.max(array.length - n, 0));\n    }\n  };\n\n  // Returns everything but the first entry of the array. Aliased as `tail` and `drop`.\n  // Especially useful on the arguments object. Passing an **n** will return\n  // the rest N values in the array. The **guard**\n  // check allows it to work with `_.map`.\n  _.rest = _.tail = _.drop = function(array, n, guard) {\n    return slice.call(array, (n == null) || guard ? 1 : n);\n  };\n\n  // Trim out all falsy values from an array.\n  _.compact = function(array) {\n    return _.filter(array, _.identity);\n  };\n\n  // Internal implementation of a recursive `flatten` function.\n  var flatten = function(input, shallow, output) {\n    if (shallow && _.every(input, _.isArray)) {\n      return concat.apply(output, input);\n    }\n    each(input, function(value) {\n      if (_.isArray(value) || _.isArguments(value)) {\n        shallow ? push.apply(output, value) : flatten(value, shallow, output);\n      } else {\n        output.push(value);\n      }\n    });\n    return output;\n  };\n\n  // Flatten out an array, either recursively (by default), or just one level.\n  _.flatten = function(array, shallow) {\n    return flatten(array, shallow, []);\n  };\n\n  // Return a version of the array that does not contain the specified value(s).\n  _.without = function(array) {\n    return _.difference(array, slice.call(arguments, 1));\n  };\n\n  // Produce a duplicate-free version of the array. If the array has already\n  // been sorted, you have the option of using a faster algorithm.\n  // Aliased as `unique`.\n  _.uniq = _.unique = function(array, isSorted, iterator, context) {\n    if (_.isFunction(isSorted)) {\n      context = iterator;\n      iterator = isSorted;\n      isSorted = false;\n    }\n    var initial = iterator ? _.map(array, iterator, context) : array;\n    var results = [];\n    var seen = [];\n    each(initial, function(value, index) {\n      if (isSorted ? (!index || seen[seen.length - 1] !== value) : !_.contains(seen, value)) {\n        seen.push(value);\n        results.push(array[index]);\n      }\n    });\n    return results;\n  };\n\n  // Produce an array that contains the union: each distinct element from all of\n  // the passed-in arrays.\n  _.union = function() {\n    return _.uniq(_.flatten(arguments, true));\n  };\n\n  // Produce an array that contains every item shared between all the\n  // passed-in arrays.\n  _.intersection = function(array) {\n    var rest = slice.call(arguments, 1);\n    return _.filter(_.uniq(array), function(item) {\n      return _.every(rest, function(other) {\n        return _.indexOf(other, item) >= 0;\n      });\n    });\n  };\n\n  // Take the difference between one array and a number of other arrays.\n  // Only the elements present in just the first array will remain.\n  _.difference = function(array) {\n    var rest = concat.apply(ArrayProto, slice.call(arguments, 1));\n    return _.filter(array, function(value){ return !_.contains(rest, value); });\n  };\n\n  // Zip together multiple lists into a single array -- elements that share\n  // an index go together.\n  _.zip = function() {\n    var length = _.max(_.pluck(arguments, \"length\").concat(0));\n    var results = new Array(length);\n    for (var i = 0; i < length; i++) {\n      results[i] = _.pluck(arguments, '' + i);\n    }\n    return results;\n  };\n\n  // Converts lists into objects. Pass either a single array of `[key, value]`\n  // pairs, or two parallel arrays of the same length -- one of keys, and one of\n  // the corresponding values.\n  _.object = function(list, values) {\n    if (list == null) return {};\n    var result = {};\n    for (var i = 0, length = list.length; i < length; i++) {\n      if (values) {\n        result[list[i]] = values[i];\n      } else {\n        result[list[i][0]] = list[i][1];\n      }\n    }\n    return result;\n  };\n\n  // If the browser doesn't supply us with indexOf (I'm looking at you, **MSIE**),\n  // we need this function. Return the position of the first occurrence of an\n  // item in an array, or -1 if the item is not included in the array.\n  // Delegates to **ECMAScript 5**'s native `indexOf` if available.\n  // If the array is large and already in sort order, pass `true`\n  // for **isSorted** to use binary search.\n  _.indexOf = function(array, item, isSorted) {\n    if (array == null) return -1;\n    var i = 0, length = array.length;\n    if (isSorted) {\n      if (typeof isSorted == 'number') {\n        i = (isSorted < 0 ? Math.max(0, length + isSorted) : isSorted);\n      } else {\n        i = _.sortedIndex(array, item);\n        return array[i] === item ? i : -1;\n      }\n    }\n    if (nativeIndexOf && array.indexOf === nativeIndexOf) return array.indexOf(item, isSorted);\n    for (; i < length; i++) if (array[i] === item) return i;\n    return -1;\n  };\n\n  // Delegates to **ECMAScript 5**'s native `lastIndexOf` if available.\n  _.lastIndexOf = function(array, item, from) {\n    if (array == null) return -1;\n    var hasIndex = from != null;\n    if (nativeLastIndexOf && array.lastIndexOf === nativeLastIndexOf) {\n      return hasIndex ? array.lastIndexOf(item, from) : array.lastIndexOf(item);\n    }\n    var i = (hasIndex ? from : array.length);\n    while (i--) if (array[i] === item) return i;\n    return -1;\n  };\n\n  // Generate an integer Array containing an arithmetic progression. A port of\n  // the native Python `range()` function. See\n  // [the Python documentation](http://docs.python.org/library/functions.html#range).\n  _.range = function(start, stop, step) {\n    if (arguments.length <= 1) {\n      stop = start || 0;\n      start = 0;\n    }\n    step = arguments[2] || 1;\n\n    var length = Math.max(Math.ceil((stop - start) / step), 0);\n    var idx = 0;\n    var range = new Array(length);\n\n    while(idx < length) {\n      range[idx++] = start;\n      start += step;\n    }\n\n    return range;\n  };\n\n  // Function (ahem) Functions\n  // ------------------\n\n  // Reusable constructor function for prototype setting.\n  var ctor = function(){};\n\n  // Create a function bound to a given object (assigning `this`, and arguments,\n  // optionally). Delegates to **ECMAScript 5**'s native `Function.bind` if\n  // available.\n  _.bind = function(func, context) {\n    var args, bound;\n    if (nativeBind && func.bind === nativeBind) return nativeBind.apply(func, slice.call(arguments, 1));\n    if (!_.isFunction(func)) throw new TypeError;\n    args = slice.call(arguments, 2);\n    return bound = function() {\n      if (!(this instanceof bound)) return func.apply(context, args.concat(slice.call(arguments)));\n      ctor.prototype = func.prototype;\n      var self = new ctor;\n      ctor.prototype = null;\n      var result = func.apply(self, args.concat(slice.call(arguments)));\n      if (Object(result) === result) return result;\n      return self;\n    };\n  };\n\n  // Partially apply a function by creating a version that has had some of its\n  // arguments pre-filled, without changing its dynamic `this` context.\n  _.partial = function(func) {\n    var args = slice.call(arguments, 1);\n    return function() {\n      return func.apply(this, args.concat(slice.call(arguments)));\n    };\n  };\n\n  // Bind all of an object's methods to that object. Useful for ensuring that\n  // all callbacks defined on an object belong to it.\n  _.bindAll = function(obj) {\n    var funcs = slice.call(arguments, 1);\n    if (funcs.length === 0) throw new Error(\"bindAll must be passed function names\");\n    each(funcs, function(f) { obj[f] = _.bind(obj[f], obj); });\n    return obj;\n  };\n\n  // Memoize an expensive function by storing its results.\n  _.memoize = function(func, hasher) {\n    var memo = {};\n    hasher || (hasher = _.identity);\n    return function() {\n      var key = hasher.apply(this, arguments);\n      return _.has(memo, key) ? memo[key] : (memo[key] = func.apply(this, arguments));\n    };\n  };\n\n  // Delays a function for the given number of milliseconds, and then calls\n  // it with the arguments supplied.\n  _.delay = function(func, wait) {\n    var args = slice.call(arguments, 2);\n    return setTimeout(function(){ return func.apply(null, args); }, wait);\n  };\n\n  // Defers a function, scheduling it to run after the current call stack has\n  // cleared.\n  _.defer = function(func) {\n    return _.delay.apply(_, [func, 1].concat(slice.call(arguments, 1)));\n  };\n\n  // Returns a function, that, when invoked, will only be triggered at most once\n  // during a given window of time. Normally, the throttled function will run\n  // as much as it can, without ever going more than once per `wait` duration;\n  // but if you'd like to disable the execution on the leading edge, pass\n  // `{leading: false}`. To disable execution on the trailing edge, ditto.\n  _.throttle = function(func, wait, options) {\n    var context, args, result;\n    var timeout = null;\n    var previous = 0;\n    options || (options = {});\n    var later = function() {\n      previous = options.leading === false ? 0 : new Date;\n      timeout = null;\n      result = func.apply(context, args);\n    };\n    return function() {\n      var now = new Date;\n      if (!previous && options.leading === false) previous = now;\n      var remaining = wait - (now - previous);\n      context = this;\n      args = arguments;\n      if (remaining <= 0) {\n        clearTimeout(timeout);\n        timeout = null;\n        previous = now;\n        result = func.apply(context, args);\n      } else if (!timeout && options.trailing !== false) {\n        timeout = setTimeout(later, remaining);\n      }\n      return result;\n    };\n  };\n\n  // Returns a function, that, as long as it continues to be invoked, will not\n  // be triggered. The function will be called after it stops being called for\n  // N milliseconds. If `immediate` is passed, trigger the function on the\n  // leading edge, instead of the trailing.\n  _.debounce = function(func, wait, immediate) {\n    var timeout, args, context, timestamp, result;\n    return function() {\n      context = this;\n      args = arguments;\n      timestamp = new Date();\n      var later = function() {\n        var last = (new Date()) - timestamp;\n        if (last < wait) {\n          timeout = setTimeout(later, wait - last);\n        } else {\n          timeout = null;\n          if (!immediate) result = func.apply(context, args);\n        }\n      };\n      var callNow = immediate && !timeout;\n      if (!timeout) {\n        timeout = setTimeout(later, wait);\n      }\n      if (callNow) result = func.apply(context, args);\n      return result;\n    };\n  };\n\n  // Returns a function that will be executed at most one time, no matter how\n  // often you call it. Useful for lazy initialization.\n  _.once = function(func) {\n    var ran = false, memo;\n    return function() {\n      if (ran) return memo;\n      ran = true;\n      memo = func.apply(this, arguments);\n      func = null;\n      return memo;\n    };\n  };\n\n  // Returns the first function passed as an argument to the second,\n  // allowing you to adjust arguments, run code before and after, and\n  // conditionally execute the original function.\n  _.wrap = function(func, wrapper) {\n    return function() {\n      var args = [func];\n      push.apply(args, arguments);\n      return wrapper.apply(this, args);\n    };\n  };\n\n  // Returns a function that is the composition of a list of functions, each\n  // consuming the return value of the function that follows.\n  _.compose = function() {\n    var funcs = arguments;\n    return function() {\n      var args = arguments;\n      for (var i = funcs.length - 1; i >= 0; i--) {\n        args = [funcs[i].apply(this, args)];\n      }\n      return args[0];\n    };\n  };\n\n  // Returns a function that will only be executed after being called N times.\n  _.after = function(times, func) {\n    return function() {\n      if (--times < 1) {\n        return func.apply(this, arguments);\n      }\n    };\n  };\n\n  // Object Functions\n  // ----------------\n\n  // Retrieve the names of an object's properties.\n  // Delegates to **ECMAScript 5**'s native `Object.keys`\n  _.keys = nativeKeys || function(obj) {\n    if (obj !== Object(obj)) throw new TypeError('Invalid object');\n    var keys = [];\n    for (var key in obj) if (_.has(obj, key)) keys.push(key);\n    return keys;\n  };\n\n  // Retrieve the values of an object's properties.\n  _.values = function(obj) {\n    var keys = _.keys(obj);\n    var length = keys.length;\n    var values = new Array(length);\n    for (var i = 0; i < length; i++) {\n      values[i] = obj[keys[i]];\n    }\n    return values;\n  };\n\n  // Convert an object into a list of `[key, value]` pairs.\n  _.pairs = function(obj) {\n    var keys = _.keys(obj);\n    var length = keys.length;\n    var pairs = new Array(length);\n    for (var i = 0; i < length; i++) {\n      pairs[i] = [keys[i], obj[keys[i]]];\n    }\n    return pairs;\n  };\n\n  // Invert the keys and values of an object. The values must be serializable.\n  _.invert = function(obj) {\n    var result = {};\n    var keys = _.keys(obj);\n    for (var i = 0, length = keys.length; i < length; i++) {\n      result[obj[keys[i]]] = keys[i];\n    }\n    return result;\n  };\n\n  // Return a sorted list of the function names available on the object.\n  // Aliased as `methods`\n  _.functions = _.methods = function(obj) {\n    var names = [];\n    for (var key in obj) {\n      if (_.isFunction(obj[key])) names.push(key);\n    }\n    return names.sort();\n  };\n\n  // Extend a given object with all the properties in passed-in object(s).\n  _.extend = function(obj) {\n    each(slice.call(arguments, 1), function(source) {\n      if (source) {\n        for (var prop in source) {\n          obj[prop] = source[prop];\n        }\n      }\n    });\n    return obj;\n  };\n\n  // Return a copy of the object only containing the whitelisted properties.\n  _.pick = function(obj) {\n    var copy = {};\n    var keys = concat.apply(ArrayProto, slice.call(arguments, 1));\n    each(keys, function(key) {\n      if (key in obj) copy[key] = obj[key];\n    });\n    return copy;\n  };\n\n   // Return a copy of the object without the blacklisted properties.\n  _.omit = function(obj) {\n    var copy = {};\n    var keys = concat.apply(ArrayProto, slice.call(arguments, 1));\n    for (var key in obj) {\n      if (!_.contains(keys, key)) copy[key] = obj[key];\n    }\n    return copy;\n  };\n\n  // Fill in a given object with default properties.\n  _.defaults = function(obj) {\n    each(slice.call(arguments, 1), function(source) {\n      if (source) {\n        for (var prop in source) {\n          if (obj[prop] === void 0) obj[prop] = source[prop];\n        }\n      }\n    });\n    return obj;\n  };\n\n  // Create a (shallow-cloned) duplicate of an object.\n  _.clone = function(obj) {\n    if (!_.isObject(obj)) return obj;\n    return _.isArray(obj) ? obj.slice() : _.extend({}, obj);\n  };\n\n  // Invokes interceptor with the obj, and then returns obj.\n  // The primary purpose of this method is to \"tap into\" a method chain, in\n  // order to perform operations on intermediate results within the chain.\n  _.tap = function(obj, interceptor) {\n    interceptor(obj);\n    return obj;\n  };\n\n  // Internal recursive comparison function for `isEqual`.\n  var eq = function(a, b, aStack, bStack) {\n    // Identical objects are equal. `0 === -0`, but they aren't identical.\n    // See the [Harmony `egal` proposal](http://wiki.ecmascript.org/doku.php?id=harmony:egal).\n    if (a === b) return a !== 0 || 1 / a == 1 / b;\n    // A strict comparison is necessary because `null == undefined`.\n    if (a == null || b == null) return a === b;\n    // Unwrap any wrapped objects.\n    if (a instanceof _) a = a._wrapped;\n    if (b instanceof _) b = b._wrapped;\n    // Compare `[[Class]]` names.\n    var className = toString.call(a);\n    if (className != toString.call(b)) return false;\n    switch (className) {\n      // Strings, numbers, dates, and booleans are compared by value.\n      case '[object String]':\n        // Primitives and their corresponding object wrappers are equivalent; thus, `\"5\"` is\n        // equivalent to `new String(\"5\")`.\n        return a == String(b);\n      case '[object Number]':\n        // `NaN`s are equivalent, but non-reflexive. An `egal` comparison is performed for\n        // other numeric values.\n        return a != +a ? b != +b : (a == 0 ? 1 / a == 1 / b : a == +b);\n      case '[object Date]':\n      case '[object Boolean]':\n        // Coerce dates and booleans to numeric primitive values. Dates are compared by their\n        // millisecond representations. Note that invalid dates with millisecond representations\n        // of `NaN` are not equivalent.\n        return +a == +b;\n      // RegExps are compared by their source patterns and flags.\n      case '[object RegExp]':\n        return a.source == b.source &&\n               a.global == b.global &&\n               a.multiline == b.multiline &&\n               a.ignoreCase == b.ignoreCase;\n    }\n    if (typeof a != 'object' || typeof b != 'object') return false;\n    // Assume equality for cyclic structures. The algorithm for detecting cyclic\n    // structures is adapted from ES 5.1 section 15.12.3, abstract operation `JO`.\n    var length = aStack.length;\n    while (length--) {\n      // Linear search. Performance is inversely proportional to the number of\n      // unique nested structures.\n      if (aStack[length] == a) return bStack[length] == b;\n    }\n    // Objects with different constructors are not equivalent, but `Object`s\n    // from different frames are.\n    var aCtor = a.constructor, bCtor = b.constructor;\n    if (aCtor !== bCtor && !(_.isFunction(aCtor) && (aCtor instanceof aCtor) &&\n                             _.isFunction(bCtor) && (bCtor instanceof bCtor))) {\n      return false;\n    }\n    // Add the first object to the stack of traversed objects.\n    aStack.push(a);\n    bStack.push(b);\n    var size = 0, result = true;\n    // Recursively compare objects and arrays.\n    if (className == '[object Array]') {\n      // Compare array lengths to determine if a deep comparison is necessary.\n      size = a.length;\n      result = size == b.length;\n      if (result) {\n        // Deep compare the contents, ignoring non-numeric properties.\n        while (size--) {\n          if (!(result = eq(a[size], b[size], aStack, bStack))) break;\n        }\n      }\n    } else {\n      // Deep compare objects.\n      for (var key in a) {\n        if (_.has(a, key)) {\n          // Count the expected number of properties.\n          size++;\n          // Deep compare each member.\n          if (!(result = _.has(b, key) && eq(a[key], b[key], aStack, bStack))) break;\n        }\n      }\n      // Ensure that both objects contain the same number of properties.\n      if (result) {\n        for (key in b) {\n          if (_.has(b, key) && !(size--)) break;\n        }\n        result = !size;\n      }\n    }\n    // Remove the first object from the stack of traversed objects.\n    aStack.pop();\n    bStack.pop();\n    return result;\n  };\n\n  // Perform a deep comparison to check if two objects are equal.\n  _.isEqual = function(a, b) {\n    return eq(a, b, [], []);\n  };\n\n  // Is a given array, string, or object empty?\n  // An \"empty\" object has no enumerable own-properties.\n  _.isEmpty = function(obj) {\n    if (obj == null) return true;\n    if (_.isArray(obj) || _.isString(obj)) return obj.length === 0;\n    for (var key in obj) if (_.has(obj, key)) return false;\n    return true;\n  };\n\n  // Is a given value a DOM element?\n  _.isElement = function(obj) {\n    return !!(obj && obj.nodeType === 1);\n  };\n\n  // Is a given value an array?\n  // Delegates to ECMA5's native Array.isArray\n  _.isArray = nativeIsArray || function(obj) {\n    return toString.call(obj) == '[object Array]';\n  };\n\n  // Is a given variable an object?\n  _.isObject = function(obj) {\n    return obj === Object(obj);\n  };\n\n  // Add some isType methods: isArguments, isFunction, isString, isNumber, isDate, isRegExp.\n  each(['Arguments', 'Function', 'String', 'Number', 'Date', 'RegExp'], function(name) {\n    _['is' + name] = function(obj) {\n      return toString.call(obj) == '[object ' + name + ']';\n    };\n  });\n\n  // Define a fallback version of the method in browsers (ahem, IE), where\n  // there isn't any inspectable \"Arguments\" type.\n  if (!_.isArguments(arguments)) {\n    _.isArguments = function(obj) {\n      return !!(obj && _.has(obj, 'callee'));\n    };\n  }\n\n  // Optimize `isFunction` if appropriate.\n  if (typeof (/./) !== 'function') {\n    _.isFunction = function(obj) {\n      return typeof obj === 'function';\n    };\n  }\n\n  // Is a given object a finite number?\n  _.isFinite = function(obj) {\n    return isFinite(obj) && !isNaN(parseFloat(obj));\n  };\n\n  // Is the given value `NaN`? (NaN is the only number which does not equal itself).\n  _.isNaN = function(obj) {\n    return _.isNumber(obj) && obj != +obj;\n  };\n\n  // Is a given value a boolean?\n  _.isBoolean = function(obj) {\n    return obj === true || obj === false || toString.call(obj) == '[object Boolean]';\n  };\n\n  // Is a given value equal to null?\n  _.isNull = function(obj) {\n    return obj === null;\n  };\n\n  // Is a given variable undefined?\n  _.isUndefined = function(obj) {\n    return obj === void 0;\n  };\n\n  // Shortcut function for checking if an object has a given property directly\n  // on itself (in other words, not on a prototype).\n  _.has = function(obj, key) {\n    return hasOwnProperty.call(obj, key);\n  };\n\n  // Utility Functions\n  // -----------------\n\n  // Run Underscore.js in *noConflict* mode, returning the `_` variable to its\n  // previous owner. Returns a reference to the Underscore object.\n  _.noConflict = function() {\n    root._ = previousUnderscore;\n    return this;\n  };\n\n  // Keep the identity function around for default iterators.\n  _.identity = function(value) {\n    return value;\n  };\n\n  // Run a function **n** times.\n  _.times = function(n, iterator, context) {\n    var accum = Array(Math.max(0, n));\n    for (var i = 0; i < n; i++) accum[i] = iterator.call(context, i);\n    return accum;\n  };\n\n  // Return a random integer between min and max (inclusive).\n  _.random = function(min, max) {\n    if (max == null) {\n      max = min;\n      min = 0;\n    }\n    return min + Math.floor(Math.random() * (max - min + 1));\n  };\n\n  // List of HTML entities for escaping.\n  var entityMap = {\n    escape: {\n      '&': '&amp;',\n      '<': '&lt;',\n      '>': '&gt;',\n      '\"': '&quot;',\n      \"'\": '&#x27;'\n    }\n  };\n  entityMap.unescape = _.invert(entityMap.escape);\n\n  // Regexes containing the keys and values listed immediately above.\n  var entityRegexes = {\n    escape:   new RegExp('[' + _.keys(entityMap.escape).join('') + ']', 'g'),\n    unescape: new RegExp('(' + _.keys(entityMap.unescape).join('|') + ')', 'g')\n  };\n\n  // Functions for escaping and unescaping strings to/from HTML interpolation.\n  _.each(['escape', 'unescape'], function(method) {\n    _[method] = function(string) {\n      if (string == null) return '';\n      return ('' + string).replace(entityRegexes[method], function(match) {\n        return entityMap[method][match];\n      });\n    };\n  });\n\n  // If the value of the named `property` is a function then invoke it with the\n  // `object` as context; otherwise, return it.\n  _.result = function(object, property) {\n    if (object == null) return void 0;\n    var value = object[property];\n    return _.isFunction(value) ? value.call(object) : value;\n  };\n\n  // Add your own custom functions to the Underscore object.\n  _.mixin = function(obj) {\n    each(_.functions(obj), function(name) {\n      var func = _[name] = obj[name];\n      _.prototype[name] = function() {\n        var args = [this._wrapped];\n        push.apply(args, arguments);\n        return result.call(this, func.apply(_, args));\n      };\n    });\n  };\n\n  // Generate a unique integer id (unique within the entire client session).\n  // Useful for temporary DOM ids.\n  var idCounter = 0;\n  _.uniqueId = function(prefix) {\n    var id = ++idCounter + '';\n    return prefix ? prefix + id : id;\n  };\n\n  // By default, Underscore uses ERB-style template delimiters, change the\n  // following template settings to use alternative delimiters.\n  _.templateSettings = {\n    evaluate    : /<%([\\s\\S]+?)%>/g,\n    interpolate : /<%=([\\s\\S]+?)%>/g,\n    escape      : /<%-([\\s\\S]+?)%>/g\n  };\n\n  // When customizing `templateSettings`, if you don't want to define an\n  // interpolation, evaluation or escaping regex, we need one that is\n  // guaranteed not to match.\n  var noMatch = /(.)^/;\n\n  // Certain characters need to be escaped so that they can be put into a\n  // string literal.\n  var escapes = {\n    \"'\":      \"'\",\n    '\\\\':     '\\\\',\n    '\\r':     'r',\n    '\\n':     'n',\n    '\\t':     't',\n    '\\u2028': 'u2028',\n    '\\u2029': 'u2029'\n  };\n\n  var escaper = /\\\\|'|\\r|\\n|\\t|\\u2028|\\u2029/g;\n\n  // JavaScript micro-templating, similar to John Resig's implementation.\n  // Underscore templating handles arbitrary delimiters, preserves whitespace,\n  // and correctly escapes quotes within interpolated code.\n  _.template = function(text, data, settings) {\n    var render;\n    settings = _.defaults({}, settings, _.templateSettings);\n\n    // Combine delimiters into one regular expression via alternation.\n    var matcher = new RegExp([\n      (settings.escape || noMatch).source,\n      (settings.interpolate || noMatch).source,\n      (settings.evaluate || noMatch).source\n    ].join('|') + '|$', 'g');\n\n    // Compile the template source, escaping string literals appropriately.\n    var index = 0;\n    var source = \"__p+='\";\n    text.replace(matcher, function(match, escape, interpolate, evaluate, offset) {\n      source += text.slice(index, offset)\n        .replace(escaper, function(match) { return '\\\\' + escapes[match]; });\n\n      if (escape) {\n        source += \"'+\\n((__t=(\" + escape + \"))==null?'':_.escape(__t))+\\n'\";\n      }\n      if (interpolate) {\n        source += \"'+\\n((__t=(\" + interpolate + \"))==null?'':__t)+\\n'\";\n      }\n      if (evaluate) {\n        source += \"';\\n\" + evaluate + \"\\n__p+='\";\n      }\n      index = offset + match.length;\n      return match;\n    });\n    source += \"';\\n\";\n\n    // If a variable is not specified, place data values in local scope.\n    if (!settings.variable) source = 'with(obj||{}){\\n' + source + '}\\n';\n\n    source = \"var __t,__p='',__j=Array.prototype.join,\" +\n      \"print=function(){__p+=__j.call(arguments,'');};\\n\" +\n      source + \"return __p;\\n\";\n\n    try {\n      render = new Function(settings.variable || 'obj', '_', source);\n    } catch (e) {\n      e.source = source;\n      throw e;\n    }\n\n    if (data) return render(data, _);\n    var template = function(data) {\n      return render.call(this, data, _);\n    };\n\n    // Provide the compiled function source as a convenience for precompilation.\n    template.source = 'function(' + (settings.variable || 'obj') + '){\\n' + source + '}';\n\n    return template;\n  };\n\n  // Add a \"chain\" function, which will delegate to the wrapper.\n  _.chain = function(obj) {\n    return _(obj).chain();\n  };\n\n  // OOP\n  // ---------------\n  // If Underscore is called as a function, it returns a wrapped object that\n  // can be used OO-style. This wrapper holds altered versions of all the\n  // underscore functions. Wrapped objects may be chained.\n\n  // Helper function to continue chaining intermediate results.\n  var result = function(obj) {\n    return this._chain ? _(obj).chain() : obj;\n  };\n\n  // Add all of the Underscore functions to the wrapper object.\n  _.mixin(_);\n\n  // Add all mutator Array functions to the wrapper.\n  each(['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'], function(name) {\n    var method = ArrayProto[name];\n    _.prototype[name] = function() {\n      var obj = this._wrapped;\n      method.apply(obj, arguments);\n      if ((name == 'shift' || name == 'splice') && obj.length === 0) delete obj[0];\n      return result.call(this, obj);\n    };\n  });\n\n  // Add all accessor Array functions to the wrapper.\n  each(['concat', 'join', 'slice'], function(name) {\n    var method = ArrayProto[name];\n    _.prototype[name] = function() {\n      return result.call(this, method.apply(this._wrapped, arguments));\n    };\n  });\n\n  _.extend(_.prototype, {\n\n    // Start chaining a wrapped Underscore object.\n    chain: function() {\n      this._chain = true;\n      return this;\n    },\n\n    // Extracts the result from a wrapped and chained object.\n    value: function() {\n      return this._wrapped;\n    }\n\n  });\n\n}).call(this);\n","/*!\n * https://github.com/es-shims/es5-shim\n * @license es5-shim Copyright 2009-2014 by contributors, MIT License\n * see https://github.com/es-shims/es5-shim/blob/master/LICENSE\n */\n\n// vim: ts=4 sts=4 sw=4 expandtab\n\n//Add semicolon to prevent IIFE from being passed as argument to concated code.\n;\n\n// UMD (Universal Module Definition)\n// see https://github.com/umdjs/umd/blob/master/returnExports.js\n(function (root, factory) {\n    if (typeof define === 'function' && define.amd) {\n        // AMD. Register as an anonymous module.\n        define(factory);\n    } else if (typeof exports === 'object') {\n        // Node. Does not work with strict CommonJS, but\n        // only CommonJS-like enviroments that support module.exports,\n        // like Node.\n        module.exports = factory();\n    } else {\n        // Browser globals (root is window)\n        root.returnExports = factory();\n    }\n}(this, function () {\n\n/**\n * Brings an environment as close to ECMAScript 5 compliance\n * as is possible with the facilities of erstwhile engines.\n *\n * Annotated ES5: http://es5.github.com/ (specific links below)\n * ES5 Spec: http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf\n * Required reading: http://javascriptweblog.wordpress.com/2011/12/05/extending-javascript-natives/\n */\n\n// Shortcut to an often accessed properties, in order to avoid multiple\n// dereference that costs universally.\nvar call = Function.prototype.call;\nvar prototypeOfArray = Array.prototype;\nvar prototypeOfObject = Object.prototype;\nvar _Array_slice_ = prototypeOfArray.slice;\nvar array_splice = Array.prototype.splice;\nvar array_push = Array.prototype.push;\nvar array_unshift = Array.prototype.unshift;\n\n// Having a toString local variable name breaks in Opera so use _toString.\nvar _toString = prototypeOfObject.toString;\n\nvar isFunction = function (val) {\n    return prototypeOfObject.toString.call(val) === '[object Function]';\n};\nvar isRegex = function (val) {\n    return prototypeOfObject.toString.call(val) === '[object RegExp]';\n};\nvar isArray = function isArray(obj) {\n    return _toString.call(obj) === \"[object Array]\";\n};\nvar isArguments = function isArguments(value) {\n    var str = _toString.call(value);\n    var isArgs = str === '[object Arguments]';\n    if (!isArgs) {\n        isArgs = !isArray(str)\n            && value !== null\n            && typeof value === 'object'\n            && typeof value.length === 'number'\n            && value.length >= 0\n            && isFunction(value.callee);\n    }\n    return isArgs;\n};\n\n//\n// Function\n// ========\n//\n\n// ES-5 15.3.4.5\n// http://es5.github.com/#x15.3.4.5\n\nfunction Empty() {}\n\nif (!Function.prototype.bind) {\n    Function.prototype.bind = function bind(that) { // .length is 1\n        // 1. Let Target be the this value.\n        var target = this;\n        // 2. If IsCallable(Target) is false, throw a TypeError exception.\n        if (!isFunction(target)) {\n            throw new TypeError(\"Function.prototype.bind called on incompatible \" + target);\n        }\n        // 3. Let A be a new (possibly empty) internal list of all of the\n        //   argument values provided after thisArg (arg1, arg2 etc), in order.\n        // XXX slicedArgs will stand in for \"A\" if used\n        var args = _Array_slice_.call(arguments, 1); // for normal call\n        // 4. Let F be a new native ECMAScript object.\n        // 11. Set the [[Prototype]] internal property of F to the standard\n        //   built-in Function prototype object as specified in 15.3.3.1.\n        // 12. Set the [[Call]] internal property of F as described in\n        //   15.3.4.5.1.\n        // 13. Set the [[Construct]] internal property of F as described in\n        //   15.3.4.5.2.\n        // 14. Set the [[HasInstance]] internal property of F as described in\n        //   15.3.4.5.3.\n        var binder = function () {\n\n            if (this instanceof bound) {\n                // 15.3.4.5.2 [[Construct]]\n                // When the [[Construct]] internal method of a function object,\n                // F that was created using the bind function is called with a\n                // list of arguments ExtraArgs, the following steps are taken:\n                // 1. Let target be the value of F's [[TargetFunction]]\n                //   internal property.\n                // 2. If target has no [[Construct]] internal method, a\n                //   TypeError exception is thrown.\n                // 3. Let boundArgs be the value of F's [[BoundArgs]] internal\n                //   property.\n                // 4. Let args be a new list containing the same values as the\n                //   list boundArgs in the same order followed by the same\n                //   values as the list ExtraArgs in the same order.\n                // 5. Return the result of calling the [[Construct]] internal\n                //   method of target providing args as the arguments.\n\n                var result = target.apply(\n                    this,\n                    args.concat(_Array_slice_.call(arguments))\n                );\n                if (Object(result) === result) {\n                    return result;\n                }\n                return this;\n\n            } else {\n                // 15.3.4.5.1 [[Call]]\n                // When the [[Call]] internal method of a function object, F,\n                // which was created using the bind function is called with a\n                // this value and a list of arguments ExtraArgs, the following\n                // steps are taken:\n                // 1. Let boundArgs be the value of F's [[BoundArgs]] internal\n                //   property.\n                // 2. Let boundThis be the value of F's [[BoundThis]] internal\n                //   property.\n                // 3. Let target be the value of F's [[TargetFunction]] internal\n                //   property.\n                // 4. Let args be a new list containing the same values as the\n                //   list boundArgs in the same order followed by the same\n                //   values as the list ExtraArgs in the same order.\n                // 5. Return the result of calling the [[Call]] internal method\n                //   of target providing boundThis as the this value and\n                //   providing args as the arguments.\n\n                // equiv: target.call(this, ...boundArgs, ...args)\n                return target.apply(\n                    that,\n                    args.concat(_Array_slice_.call(arguments))\n                );\n\n            }\n\n        };\n\n        // 15. If the [[Class]] internal property of Target is \"Function\", then\n        //     a. Let L be the length property of Target minus the length of A.\n        //     b. Set the length own property of F to either 0 or L, whichever is\n        //       larger.\n        // 16. Else set the length own property of F to 0.\n\n        var boundLength = Math.max(0, target.length - args.length);\n\n        // 17. Set the attributes of the length own property of F to the values\n        //   specified in 15.3.5.1.\n        var boundArgs = [];\n        for (var i = 0; i < boundLength; i++) {\n            boundArgs.push(\"$\" + i);\n        }\n\n        // XXX Build a dynamic function with desired amount of arguments is the only\n        // way to set the length property of a function.\n        // In environments where Content Security Policies enabled (Chrome extensions,\n        // for ex.) all use of eval or Function costructor throws an exception.\n        // However in all of these environments Function.prototype.bind exists\n        // and so this code will never be executed.\n        var bound = Function(\"binder\", \"return function (\" + boundArgs.join(\",\") + \"){return binder.apply(this,arguments)}\")(binder);\n\n        if (target.prototype) {\n            Empty.prototype = target.prototype;\n            bound.prototype = new Empty();\n            // Clean up dangling references.\n            Empty.prototype = null;\n        }\n\n        // TODO\n        // 18. Set the [[Extensible]] internal property of F to true.\n\n        // TODO\n        // 19. Let thrower be the [[ThrowTypeError]] function Object (13.2.3).\n        // 20. Call the [[DefineOwnProperty]] internal method of F with\n        //   arguments \"caller\", PropertyDescriptor {[[Get]]: thrower, [[Set]]:\n        //   thrower, [[Enumerable]]: false, [[Configurable]]: false}, and\n        //   false.\n        // 21. Call the [[DefineOwnProperty]] internal method of F with\n        //   arguments \"arguments\", PropertyDescriptor {[[Get]]: thrower,\n        //   [[Set]]: thrower, [[Enumerable]]: false, [[Configurable]]: false},\n        //   and false.\n\n        // TODO\n        // NOTE Function objects created using Function.prototype.bind do not\n        // have a prototype property or the [[Code]], [[FormalParameters]], and\n        // [[Scope]] internal properties.\n        // XXX can't delete prototype in pure-js.\n\n        // 22. Return F.\n        return bound;\n    };\n}\n\n// _Please note: Shortcuts are defined after `Function.prototype.bind` as we\n// us it in defining shortcuts.\nvar owns = call.bind(prototypeOfObject.hasOwnProperty);\n\n// If JS engine supports accessors creating shortcuts.\nvar defineGetter;\nvar defineSetter;\nvar lookupGetter;\nvar lookupSetter;\nvar supportsAccessors;\nif ((supportsAccessors = owns(prototypeOfObject, \"__defineGetter__\"))) {\n    defineGetter = call.bind(prototypeOfObject.__defineGetter__);\n    defineSetter = call.bind(prototypeOfObject.__defineSetter__);\n    lookupGetter = call.bind(prototypeOfObject.__lookupGetter__);\n    lookupSetter = call.bind(prototypeOfObject.__lookupSetter__);\n}\n\n//\n// Array\n// =====\n//\n\n// ES5 15.4.4.12\n// http://es5.github.com/#x15.4.4.12\nvar spliceWorksWithEmptyObject = (function () {\n    var obj = {};\n    Array.prototype.splice.call(obj, 0, 0, 1);\n    return obj.length === 1;\n}());\nvar omittingSecondSpliceArgIsNoop = [1].splice(0).length === 0;\nvar spliceNoopReturnsEmptyArray = (function () {\n    var a = [1, 2];\n    var result = a.splice();\n    return a.length === 2 && isArray(result) && result.length === 0;\n}());\nif (spliceNoopReturnsEmptyArray) {\n    // Safari 5.0 bug where .split() returns undefined\n    Array.prototype.splice = function splice(start, deleteCount) {\n        if (arguments.length === 0) { return []; }\n        else { return array_splice.apply(this, arguments); }\n    };\n}\nif (!omittingSecondSpliceArgIsNoop || !spliceWorksWithEmptyObject) {\n    Array.prototype.splice = function splice(start, deleteCount) {\n        if (arguments.length === 0) { return []; }\n        var args = arguments;\n        this.length = Math.max(toInteger(this.length), 0);\n        if (arguments.length > 0 && typeof deleteCount !== 'number') {\n            args = _Array_slice_.call(arguments);\n            if (args.length < 2) { args.push(toInteger(deleteCount)); }\n            else { args[1] = toInteger(deleteCount); }\n        }\n        return array_splice.apply(this, args);\n    };\n}\n\n// ES5 15.4.4.12\n// http://es5.github.com/#x15.4.4.13\n// Return len+argCount.\n// [bugfix, ielt8]\n// IE < 8 bug: [].unshift(0) === undefined but should be \"1\"\nif ([].unshift(0) !== 1) {\n    Array.prototype.unshift = function () {\n        array_unshift.apply(this, arguments);\n        return this.length;\n    };\n}\n\n// ES5 15.4.3.2\n// http://es5.github.com/#x15.4.3.2\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/isArray\nif (!Array.isArray) {\n    Array.isArray = isArray;\n}\n\n// The IsCallable() check in the Array functions\n// has been replaced with a strict check on the\n// internal class of the object to trap cases where\n// the provided function was actually a regular\n// expression literal, which in V8 and\n// JavaScriptCore is a typeof \"function\".  Only in\n// V8 are regular expression literals permitted as\n// reduce parameters, so it is desirable in the\n// general case for the shim to match the more\n// strict and common behavior of rejecting regular\n// expressions.\n\n// ES5 15.4.4.18\n// http://es5.github.com/#x15.4.4.18\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/array/forEach\n\n// Check failure of by-index access of string characters (IE < 9)\n// and failure of `0 in boxedString` (Rhino)\nvar boxedString = Object(\"a\");\nvar splitString = boxedString[0] !== \"a\" || !(0 in boxedString);\n\nvar properlyBoxesContext = function properlyBoxed(method) {\n    // Check node 0.6.21 bug where third parameter is not boxed\n    var properlyBoxesNonStrict = true;\n    var properlyBoxesStrict = true;\n    if (method) {\n        method.call('foo', function (_, __, context) {\n            if (typeof context !== 'object') { properlyBoxesNonStrict = false; }\n        });\n\n        method.call([1], function () {\n            'use strict';\n            properlyBoxesStrict = typeof this === 'string';\n        }, 'x');\n    }\n    return !!method && properlyBoxesNonStrict && properlyBoxesStrict;\n};\n\nif (!Array.prototype.forEach || !properlyBoxesContext(Array.prototype.forEach)) {\n    Array.prototype.forEach = function forEach(fun /*, thisp*/) {\n        var object = toObject(this),\n            self = splitString && _toString.call(this) === \"[object String]\" ?\n                this.split(\"\") :\n                object,\n            thisp = arguments[1],\n            i = -1,\n            length = self.length >>> 0;\n\n        // If no callback function or if callback is not a callable function\n        if (!isFunction(fun)) {\n            throw new TypeError(); // TODO message\n        }\n\n        while (++i < length) {\n            if (i in self) {\n                // Invoke the callback function with call, passing arguments:\n                // context, property value, property key, thisArg object\n                // context\n                fun.call(thisp, self[i], i, object);\n            }\n        }\n    };\n}\n\n// ES5 15.4.4.19\n// http://es5.github.com/#x15.4.4.19\n// https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Array/map\nif (!Array.prototype.map || !properlyBoxesContext(Array.prototype.map)) {\n    Array.prototype.map = function map(fun /*, thisp*/) {\n        var object = toObject(this),\n            self = splitString && _toString.call(this) === \"[object String]\" ?\n                this.split(\"\") :\n                object,\n            length = self.length >>> 0,\n            result = Array(length),\n            thisp = arguments[1];\n\n        // If no callback function or if callback is not a callable function\n        if (!isFunction(fun)) {\n            throw new TypeError(fun + \" is not a function\");\n        }\n\n        for (var i = 0; i < length; i++) {\n            if (i in self) {\n                result[i] = fun.call(thisp, self[i], i, object);\n            }\n        }\n        return result;\n    };\n}\n\n// ES5 15.4.4.20\n// http://es5.github.com/#x15.4.4.20\n// https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Array/filter\nif (!Array.prototype.filter || !properlyBoxesContext(Array.prototype.filter)) {\n    Array.prototype.filter = function filter(fun /*, thisp */) {\n        var object = toObject(this),\n            self = splitString && _toString.call(this) === \"[object String]\" ?\n                this.split(\"\") :\n                    object,\n            length = self.length >>> 0,\n            result = [],\n            value,\n            thisp = arguments[1];\n\n        // If no callback function or if callback is not a callable function\n        if (!isFunction(fun)) {\n            throw new TypeError(fun + \" is not a function\");\n        }\n\n        for (var i = 0; i < length; i++) {\n            if (i in self) {\n                value = self[i];\n                if (fun.call(thisp, value, i, object)) {\n                    result.push(value);\n                }\n            }\n        }\n        return result;\n    };\n}\n\n// ES5 15.4.4.16\n// http://es5.github.com/#x15.4.4.16\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/every\nif (!Array.prototype.every || !properlyBoxesContext(Array.prototype.every)) {\n    Array.prototype.every = function every(fun /*, thisp */) {\n        var object = toObject(this),\n            self = splitString && _toString.call(this) === \"[object String]\" ?\n                this.split(\"\") :\n                object,\n            length = self.length >>> 0,\n            thisp = arguments[1];\n\n        // If no callback function or if callback is not a callable function\n        if (!isFunction(fun)) {\n            throw new TypeError(fun + \" is not a function\");\n        }\n\n        for (var i = 0; i < length; i++) {\n            if (i in self && !fun.call(thisp, self[i], i, object)) {\n                return false;\n            }\n        }\n        return true;\n    };\n}\n\n// ES5 15.4.4.17\n// http://es5.github.com/#x15.4.4.17\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/some\nif (!Array.prototype.some || !properlyBoxesContext(Array.prototype.some)) {\n    Array.prototype.some = function some(fun /*, thisp */) {\n        var object = toObject(this),\n            self = splitString && _toString.call(this) === \"[object String]\" ?\n                this.split(\"\") :\n                object,\n            length = self.length >>> 0,\n            thisp = arguments[1];\n\n        // If no callback function or if callback is not a callable function\n        if (!isFunction(fun)) {\n            throw new TypeError(fun + \" is not a function\");\n        }\n\n        for (var i = 0; i < length; i++) {\n            if (i in self && fun.call(thisp, self[i], i, object)) {\n                return true;\n            }\n        }\n        return false;\n    };\n}\n\n// ES5 15.4.4.21\n// http://es5.github.com/#x15.4.4.21\n// https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Array/reduce\nvar reduceCoercesToObject = false;\nif (Array.prototype.reduce) {\n    reduceCoercesToObject = typeof Array.prototype.reduce.call('es5', function (_, __, ___, list) { return list; }) === 'object';\n}\nif (!Array.prototype.reduce || !reduceCoercesToObject) {\n    Array.prototype.reduce = function reduce(fun /*, initial*/) {\n        var object = toObject(this),\n            self = splitString && _toString.call(this) === \"[object String]\" ?\n                this.split(\"\") :\n                object,\n            length = self.length >>> 0;\n\n        // If no callback function or if callback is not a callable function\n        if (!isFunction(fun)) {\n            throw new TypeError(fun + \" is not a function\");\n        }\n\n        // no value to return if no initial value and an empty array\n        if (!length && arguments.length === 1) {\n            throw new TypeError(\"reduce of empty array with no initial value\");\n        }\n\n        var i = 0;\n        var result;\n        if (arguments.length >= 2) {\n            result = arguments[1];\n        } else {\n            do {\n                if (i in self) {\n                    result = self[i++];\n                    break;\n                }\n\n                // if array contains no values, no initial value to return\n                if (++i >= length) {\n                    throw new TypeError(\"reduce of empty array with no initial value\");\n                }\n            } while (true);\n        }\n\n        for (; i < length; i++) {\n            if (i in self) {\n                result = fun.call(void 0, result, self[i], i, object);\n            }\n        }\n\n        return result;\n    };\n}\n\n// ES5 15.4.4.22\n// http://es5.github.com/#x15.4.4.22\n// https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Array/reduceRight\nvar reduceRightCoercesToObject = false;\nif (Array.prototype.reduceRight) {\n    reduceRightCoercesToObject = typeof Array.prototype.reduceRight.call('es5', function (_, __, ___, list) { return list; }) === 'object';\n}\nif (!Array.prototype.reduceRight || !reduceRightCoercesToObject) {\n    Array.prototype.reduceRight = function reduceRight(fun /*, initial*/) {\n        var object = toObject(this),\n            self = splitString && _toString.call(this) === \"[object String]\" ?\n                this.split(\"\") :\n                object,\n            length = self.length >>> 0;\n\n        // If no callback function or if callback is not a callable function\n        if (!isFunction(fun)) {\n            throw new TypeError(fun + \" is not a function\");\n        }\n\n        // no value to return if no initial value, empty array\n        if (!length && arguments.length === 1) {\n            throw new TypeError(\"reduceRight of empty array with no initial value\");\n        }\n\n        var result, i = length - 1;\n        if (arguments.length >= 2) {\n            result = arguments[1];\n        } else {\n            do {\n                if (i in self) {\n                    result = self[i--];\n                    break;\n                }\n\n                // if array contains no values, no initial value to return\n                if (--i < 0) {\n                    throw new TypeError(\"reduceRight of empty array with no initial value\");\n                }\n            } while (true);\n        }\n\n        if (i < 0) {\n            return result;\n        }\n\n        do {\n            if (i in self) {\n                result = fun.call(void 0, result, self[i], i, object);\n            }\n        } while (i--);\n\n        return result;\n    };\n}\n\n// ES5 15.4.4.14\n// http://es5.github.com/#x15.4.4.14\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/indexOf\nif (!Array.prototype.indexOf || ([0, 1].indexOf(1, 2) !== -1)) {\n    Array.prototype.indexOf = function indexOf(sought /*, fromIndex */ ) {\n        var self = splitString && _toString.call(this) === \"[object String]\" ?\n                this.split(\"\") :\n                toObject(this),\n            length = self.length >>> 0;\n\n        if (!length) {\n            return -1;\n        }\n\n        var i = 0;\n        if (arguments.length > 1) {\n            i = toInteger(arguments[1]);\n        }\n\n        // handle negative indices\n        i = i >= 0 ? i : Math.max(0, length + i);\n        for (; i < length; i++) {\n            if (i in self && self[i] === sought) {\n                return i;\n            }\n        }\n        return -1;\n    };\n}\n\n// ES5 15.4.4.15\n// http://es5.github.com/#x15.4.4.15\n// https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/lastIndexOf\nif (!Array.prototype.lastIndexOf || ([0, 1].lastIndexOf(0, -3) !== -1)) {\n    Array.prototype.lastIndexOf = function lastIndexOf(sought /*, fromIndex */) {\n        var self = splitString && _toString.call(this) === \"[object String]\" ?\n                this.split(\"\") :\n                toObject(this),\n            length = self.length >>> 0;\n\n        if (!length) {\n            return -1;\n        }\n        var i = length - 1;\n        if (arguments.length > 1) {\n            i = Math.min(i, toInteger(arguments[1]));\n        }\n        // handle negative indices\n        i = i >= 0 ? i : length - Math.abs(i);\n        for (; i >= 0; i--) {\n            if (i in self && sought === self[i]) {\n                return i;\n            }\n        }\n        return -1;\n    };\n}\n\n//\n// Object\n// ======\n//\n\n// ES5 15.2.3.14\n// http://es5.github.com/#x15.2.3.14\nvar keysWorksWithArguments = Object.keys && (function () {\n    return Object.keys(arguments).length === 2;\n}(1, 2));\nif (!Object.keys) {\n    // http://whattheheadsaid.com/2010/10/a-safer-object-keys-compatibility-implementation\n    var hasDontEnumBug = !({'toString': null}).propertyIsEnumerable('toString'),\n        hasProtoEnumBug = (function () {}).propertyIsEnumerable('prototype'),\n        dontEnums = [\n            \"toString\",\n            \"toLocaleString\",\n            \"valueOf\",\n            \"hasOwnProperty\",\n            \"isPrototypeOf\",\n            \"propertyIsEnumerable\",\n            \"constructor\"\n        ],\n        dontEnumsLength = dontEnums.length;\n\n    Object.keys = function keys(object) {\n        var isFn = isFunction(object),\n            isArgs = isArguments(object),\n            isObject = object !== null && typeof object === 'object',\n            isString = isObject && _toString.call(object) === '[object String]';\n\n        if (!isObject && !isFn && !isArgs) {\n            throw new TypeError(\"Object.keys called on a non-object\");\n        }\n\n        var theKeys = [];\n        var skipProto = hasProtoEnumBug && isFn;\n        if (isString || isArgs) {\n            for (var i = 0; i < object.length; ++i) {\n                theKeys.push(String(i));\n            }\n        } else {\n            for (var name in object) {\n                if (!(skipProto && name === 'prototype') && owns(object, name)) {\n                    theKeys.push(String(name));\n                }\n            }\n        }\n\n        if (hasDontEnumBug) {\n            var ctor = object.constructor,\n                skipConstructor = ctor && ctor.prototype === object;\n            for (var j = 0; j < dontEnumsLength; j++) {\n                var dontEnum = dontEnums[j];\n                if (!(skipConstructor && dontEnum === 'constructor') && owns(object, dontEnum)) {\n                    theKeys.push(dontEnum);\n                }\n            }\n        }\n        return theKeys;\n    };\n} else if (!keysWorksWithArguments) {\n    // Safari 5.0 bug\n    var originalKeys = Object.keys;\n    Object.keys = function keys(object) {\n        if (isArguments(object)) {\n            return originalKeys(Array.prototype.slice.call(object));\n        } else {\n            return originalKeys(object);\n        }\n    };\n}\n\n//\n// Date\n// ====\n//\n\n// ES5 15.9.5.43\n// http://es5.github.com/#x15.9.5.43\n// This function returns a String value represent the instance in time\n// represented by this Date object. The format of the String is the Date Time\n// string format defined in 15.9.1.15. All fields are present in the String.\n// The time zone is always UTC, denoted by the suffix Z. If the time value of\n// this object is not a finite Number a RangeError exception is thrown.\nvar negativeDate = -62198755200000,\n    negativeYearString = \"-000001\";\nif (\n    !Date.prototype.toISOString ||\n    (new Date(negativeDate).toISOString().indexOf(negativeYearString) === -1)\n) {\n    Date.prototype.toISOString = function toISOString() {\n        var result, length, value, year, month;\n        if (!isFinite(this)) {\n            throw new RangeError(\"Date.prototype.toISOString called on non-finite value.\");\n        }\n\n        year = this.getUTCFullYear();\n\n        month = this.getUTCMonth();\n        // see https://github.com/es-shims/es5-shim/issues/111\n        year += Math.floor(month / 12);\n        month = (month % 12 + 12) % 12;\n\n        // the date time string format is specified in 15.9.1.15.\n        result = [month + 1, this.getUTCDate(), this.getUTCHours(), this.getUTCMinutes(), this.getUTCSeconds()];\n        year = (\n            (year < 0 ? \"-\" : (year > 9999 ? \"+\" : \"\")) +\n            (\"00000\" + Math.abs(year)).slice(0 <= year && year <= 9999 ? -4 : -6)\n        );\n\n        length = result.length;\n        while (length--) {\n            value = result[length];\n            // pad months, days, hours, minutes, and seconds to have two\n            // digits.\n            if (value < 10) {\n                result[length] = \"0\" + value;\n            }\n        }\n        // pad milliseconds to have three digits.\n        return (\n            year + \"-\" + result.slice(0, 2).join(\"-\") +\n            \"T\" + result.slice(2).join(\":\") + \".\" +\n            (\"000\" + this.getUTCMilliseconds()).slice(-3) + \"Z\"\n        );\n    };\n}\n\n\n// ES5 15.9.5.44\n// http://es5.github.com/#x15.9.5.44\n// This function provides a String representation of a Date object for use by\n// JSON.stringify (15.12.3).\nvar dateToJSONIsSupported = false;\ntry {\n    dateToJSONIsSupported = (\n        Date.prototype.toJSON &&\n        new Date(NaN).toJSON() === null &&\n        new Date(negativeDate).toJSON().indexOf(negativeYearString) !== -1 &&\n        Date.prototype.toJSON.call({ // generic\n            toISOString: function () {\n                return true;\n            }\n        })\n    );\n} catch (e) {\n}\nif (!dateToJSONIsSupported) {\n    Date.prototype.toJSON = function toJSON(key) {\n        // When the toJSON method is called with argument key, the following\n        // steps are taken:\n\n        // 1.  Let O be the result of calling ToObject, giving it the this\n        // value as its argument.\n        // 2. Let tv be toPrimitive(O, hint Number).\n        var o = Object(this),\n            tv = toPrimitive(o),\n            toISO;\n        // 3. If tv is a Number and is not finite, return null.\n        if (typeof tv === \"number\" && !isFinite(tv)) {\n            return null;\n        }\n        // 4. Let toISO be the result of calling the [[Get]] internal method of\n        // O with argument \"toISOString\".\n        toISO = o.toISOString;\n        // 5. If IsCallable(toISO) is false, throw a TypeError exception.\n        if (typeof toISO !== \"function\") {\n            throw new TypeError(\"toISOString property is not callable\");\n        }\n        // 6. Return the result of calling the [[Call]] internal method of\n        //  toISO with O as the this value and an empty argument list.\n        return toISO.call(o);\n\n        // NOTE 1 The argument is ignored.\n\n        // NOTE 2 The toJSON function is intentionally generic; it does not\n        // require that its this value be a Date object. Therefore, it can be\n        // transferred to other kinds of objects for use as a method. However,\n        // it does require that any such object have a toISOString method. An\n        // object is free to use the argument key to filter its\n        // stringification.\n    };\n}\n\n// ES5 15.9.4.2\n// http://es5.github.com/#x15.9.4.2\n// based on work shared by Daniel Friesen (dantman)\n// http://gist.github.com/303249\nvar supportsExtendedYears = Date.parse('+033658-09-27T01:46:40.000Z') === 1e15;\nvar acceptsInvalidDates = !isNaN(Date.parse('2012-04-04T24:00:00.500Z')) || !isNaN(Date.parse('2012-11-31T23:59:59.000Z'));\nvar doesNotParseY2KNewYear = isNaN(Date.parse(\"2000-01-01T00:00:00.000Z\"));\nif (!Date.parse || doesNotParseY2KNewYear || acceptsInvalidDates || !supportsExtendedYears) {\n    // XXX global assignment won't work in embeddings that use\n    // an alternate object for the context.\n    Date = (function (NativeDate) {\n\n        // Date.length === 7\n        function Date(Y, M, D, h, m, s, ms) {\n            var length = arguments.length;\n            if (this instanceof NativeDate) {\n                var date = length === 1 && String(Y) === Y ? // isString(Y)\n                    // We explicitly pass it through parse:\n                    new NativeDate(Date.parse(Y)) :\n                    // We have to manually make calls depending on argument\n                    // length here\n                    length >= 7 ? new NativeDate(Y, M, D, h, m, s, ms) :\n                    length >= 6 ? new NativeDate(Y, M, D, h, m, s) :\n                    length >= 5 ? new NativeDate(Y, M, D, h, m) :\n                    length >= 4 ? new NativeDate(Y, M, D, h) :\n                    length >= 3 ? new NativeDate(Y, M, D) :\n                    length >= 2 ? new NativeDate(Y, M) :\n                    length >= 1 ? new NativeDate(Y) :\n                                  new NativeDate();\n                // Prevent mixups with unfixed Date object\n                date.constructor = Date;\n                return date;\n            }\n            return NativeDate.apply(this, arguments);\n        }\n\n        // 15.9.1.15 Date Time String Format.\n        var isoDateExpression = new RegExp(\"^\" +\n            \"(\\\\d{4}|[\\+\\-]\\\\d{6})\" + // four-digit year capture or sign +\n                                      // 6-digit extended year\n            \"(?:-(\\\\d{2})\" + // optional month capture\n            \"(?:-(\\\\d{2})\" + // optional day capture\n            \"(?:\" + // capture hours:minutes:seconds.milliseconds\n                \"T(\\\\d{2})\" + // hours capture\n                \":(\\\\d{2})\" + // minutes capture\n                \"(?:\" + // optional :seconds.milliseconds\n                    \":(\\\\d{2})\" + // seconds capture\n                    \"(?:(\\\\.\\\\d{1,}))?\" + // milliseconds capture\n                \")?\" +\n            \"(\" + // capture UTC offset component\n                \"Z|\" + // UTC capture\n                \"(?:\" + // offset specifier +/-hours:minutes\n                    \"([-+])\" + // sign capture\n                    \"(\\\\d{2})\" + // hours offset capture\n                    \":(\\\\d{2})\" + // minutes offset capture\n                \")\" +\n            \")?)?)?)?\" +\n        \"$\");\n\n        var months = [\n            0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334, 365\n        ];\n\n        function dayFromMonth(year, month) {\n            var t = month > 1 ? 1 : 0;\n            return (\n                months[month] +\n                Math.floor((year - 1969 + t) / 4) -\n                Math.floor((year - 1901 + t) / 100) +\n                Math.floor((year - 1601 + t) / 400) +\n                365 * (year - 1970)\n            );\n        }\n\n        function toUTC(t) {\n            return Number(new NativeDate(1970, 0, 1, 0, 0, 0, t));\n        }\n\n        // Copy any custom methods a 3rd party library may have added\n        for (var key in NativeDate) {\n            Date[key] = NativeDate[key];\n        }\n\n        // Copy \"native\" methods explicitly; they may be non-enumerable\n        Date.now = NativeDate.now;\n        Date.UTC = NativeDate.UTC;\n        Date.prototype = NativeDate.prototype;\n        Date.prototype.constructor = Date;\n\n        // Upgrade Date.parse to handle simplified ISO 8601 strings\n        Date.parse = function parse(string) {\n            var match = isoDateExpression.exec(string);\n            if (match) {\n                // parse months, days, hours, minutes, seconds, and milliseconds\n                // provide default values if necessary\n                // parse the UTC offset component\n                var year = Number(match[1]),\n                    month = Number(match[2] || 1) - 1,\n                    day = Number(match[3] || 1) - 1,\n                    hour = Number(match[4] || 0),\n                    minute = Number(match[5] || 0),\n                    second = Number(match[6] || 0),\n                    millisecond = Math.floor(Number(match[7] || 0) * 1000),\n                    // When time zone is missed, local offset should be used\n                    // (ES 5.1 bug)\n                    // see https://bugs.ecmascript.org/show_bug.cgi?id=112\n                    isLocalTime = Boolean(match[4] && !match[8]),\n                    signOffset = match[9] === \"-\" ? 1 : -1,\n                    hourOffset = Number(match[10] || 0),\n                    minuteOffset = Number(match[11] || 0),\n                    result;\n                if (\n                    hour < (\n                        minute > 0 || second > 0 || millisecond > 0 ?\n                        24 : 25\n                    ) &&\n                    minute < 60 && second < 60 && millisecond < 1000 &&\n                    month > -1 && month < 12 && hourOffset < 24 &&\n                    minuteOffset < 60 && // detect invalid offsets\n                    day > -1 &&\n                    day < (\n                        dayFromMonth(year, month + 1) -\n                        dayFromMonth(year, month)\n                    )\n                ) {\n                    result = (\n                        (dayFromMonth(year, month) + day) * 24 +\n                        hour +\n                        hourOffset * signOffset\n                    ) * 60;\n                    result = (\n                        (result + minute + minuteOffset * signOffset) * 60 +\n                        second\n                    ) * 1000 + millisecond;\n                    if (isLocalTime) {\n                        result = toUTC(result);\n                    }\n                    if (-8.64e15 <= result && result <= 8.64e15) {\n                        return result;\n                    }\n                }\n                return NaN;\n            }\n            return NativeDate.parse.apply(this, arguments);\n        };\n\n        return Date;\n    })(Date);\n}\n\n// ES5 15.9.4.4\n// http://es5.github.com/#x15.9.4.4\nif (!Date.now) {\n    Date.now = function now() {\n        return new Date().getTime();\n    };\n}\n\n\n//\n// Number\n// ======\n//\n\n// ES5.1 15.7.4.5\n// http://es5.github.com/#x15.7.4.5\nif (!Number.prototype.toFixed || (0.00008).toFixed(3) !== '0.000' || (0.9).toFixed(0) === '0' || (1.255).toFixed(2) !== '1.25' || (1000000000000000128).toFixed(0) !== \"1000000000000000128\") {\n    // Hide these variables and functions\n    (function () {\n        var base, size, data, i;\n\n        base = 1e7;\n        size = 6;\n        data = [0, 0, 0, 0, 0, 0];\n\n        function multiply(n, c) {\n            var i = -1;\n            while (++i < size) {\n                c += n * data[i];\n                data[i] = c % base;\n                c = Math.floor(c / base);\n            }\n        }\n\n        function divide(n) {\n            var i = size, c = 0;\n            while (--i >= 0) {\n                c += data[i];\n                data[i] = Math.floor(c / n);\n                c = (c % n) * base;\n            }\n        }\n\n        function numToString() {\n            var i = size;\n            var s = '';\n            while (--i >= 0) {\n                if (s !== '' || i === 0 || data[i] !== 0) {\n                    var t = String(data[i]);\n                    if (s === '') {\n                        s = t;\n                    } else {\n                        s += '0000000'.slice(0, 7 - t.length) + t;\n                    }\n                }\n            }\n            return s;\n        }\n\n        function pow(x, n, acc) {\n            return (n === 0 ? acc : (n % 2 === 1 ? pow(x, n - 1, acc * x) : pow(x * x, n / 2, acc)));\n        }\n\n        function log(x) {\n            var n = 0;\n            while (x >= 4096) {\n                n += 12;\n                x /= 4096;\n            }\n            while (x >= 2) {\n                n += 1;\n                x /= 2;\n            }\n            return n;\n        }\n\n        Number.prototype.toFixed = function toFixed(fractionDigits) {\n            var f, x, s, m, e, z, j, k;\n\n            // Test for NaN and round fractionDigits down\n            f = Number(fractionDigits);\n            f = f !== f ? 0 : Math.floor(f);\n\n            if (f < 0 || f > 20) {\n                throw new RangeError(\"Number.toFixed called with invalid number of decimals\");\n            }\n\n            x = Number(this);\n\n            // Test for NaN\n            if (x !== x) {\n                return \"NaN\";\n            }\n\n            // If it is too big or small, return the string value of the number\n            if (x <= -1e21 || x >= 1e21) {\n                return String(x);\n            }\n\n            s = \"\";\n\n            if (x < 0) {\n                s = \"-\";\n                x = -x;\n            }\n\n            m = \"0\";\n\n            if (x > 1e-21) {\n                // 1e-21 < x < 1e21\n                // -70 < log2(x) < 70\n                e = log(x * pow(2, 69, 1)) - 69;\n                z = (e < 0 ? x * pow(2, -e, 1) : x / pow(2, e, 1));\n                z *= 0x10000000000000; // Math.pow(2, 52);\n                e = 52 - e;\n\n                // -18 < e < 122\n                // x = z / 2 ^ e\n                if (e > 0) {\n                    multiply(0, z);\n                    j = f;\n\n                    while (j >= 7) {\n                        multiply(1e7, 0);\n                        j -= 7;\n                    }\n\n                    multiply(pow(10, j, 1), 0);\n                    j = e - 1;\n\n                    while (j >= 23) {\n                        divide(1 << 23);\n                        j -= 23;\n                    }\n\n                    divide(1 << j);\n                    multiply(1, 1);\n                    divide(2);\n                    m = numToString();\n                } else {\n                    multiply(0, z);\n                    multiply(1 << (-e), 0);\n                    m = numToString() + '0.00000000000000000000'.slice(2, 2 + f);\n                }\n            }\n\n            if (f > 0) {\n                k = m.length;\n\n                if (k <= f) {\n                    m = s + '0.0000000000000000000'.slice(0, f - k + 2) + m;\n                } else {\n                    m = s + m.slice(0, k - f) + '.' + m.slice(k - f);\n                }\n            } else {\n                m = s + m;\n            }\n\n            return m;\n        };\n    }());\n}\n\n\n//\n// String\n// ======\n//\n\n// ES5 15.5.4.14\n// http://es5.github.com/#x15.5.4.14\n\n// [bugfix, IE lt 9, firefox 4, Konqueror, Opera, obscure browsers]\n// Many browsers do not split properly with regular expressions or they\n// do not perform the split correctly under obscure conditions.\n// See http://blog.stevenlevithan.com/archives/cross-browser-split\n// I've tested in many browsers and this seems to cover the deviant ones:\n//    'ab'.split(/(?:ab)*/) should be [\"\", \"\"], not [\"\"]\n//    '.'.split(/(.?)(.?)/) should be [\"\", \".\", \"\", \"\"], not [\"\", \"\"]\n//    'tesst'.split(/(s)*/) should be [\"t\", undefined, \"e\", \"s\", \"t\"], not\n//       [undefined, \"t\", undefined, \"e\", ...]\n//    ''.split(/.?/) should be [], not [\"\"]\n//    '.'.split(/()()/) should be [\".\"], not [\"\", \"\", \".\"]\n\nvar string_split = String.prototype.split;\nif (\n    'ab'.split(/(?:ab)*/).length !== 2 ||\n    '.'.split(/(.?)(.?)/).length !== 4 ||\n    'tesst'.split(/(s)*/)[1] === \"t\" ||\n    'test'.split(/(?:)/, -1).length !== 4 ||\n    ''.split(/.?/).length ||\n    '.'.split(/()()/).length > 1\n) {\n    (function () {\n        var compliantExecNpcg = /()??/.exec(\"\")[1] === void 0; // NPCG: nonparticipating capturing group\n\n        String.prototype.split = function (separator, limit) {\n            var string = this;\n            if (separator === void 0 && limit === 0) {\n                return [];\n            }\n\n            // If `separator` is not a regex, use native split\n            if (_toString.call(separator) !== \"[object RegExp]\") {\n                return string_split.call(this, separator, limit);\n            }\n\n            var output = [],\n                flags = (separator.ignoreCase ? \"i\" : \"\") +\n                        (separator.multiline  ? \"m\" : \"\") +\n                        (separator.extended   ? \"x\" : \"\") + // Proposed for ES6\n                        (separator.sticky     ? \"y\" : \"\"), // Firefox 3+\n                lastLastIndex = 0,\n                // Make `global` and avoid `lastIndex` issues by working with a copy\n                separator2, match, lastIndex, lastLength;\n            separator = new RegExp(separator.source, flags + \"g\");\n            string += \"\"; // Type-convert\n            if (!compliantExecNpcg) {\n                // Doesn't need flags gy, but they don't hurt\n                separator2 = new RegExp(\"^\" + separator.source + \"$(?!\\\\s)\", flags);\n            }\n            /* Values for `limit`, per the spec:\n             * If undefined: 4294967295 // Math.pow(2, 32) - 1\n             * If 0, Infinity, or NaN: 0\n             * If positive number: limit = Math.floor(limit); if (limit > 4294967295) limit -= 4294967296;\n             * If negative number: 4294967296 - Math.floor(Math.abs(limit))\n             * If other: Type-convert, then use the above rules\n             */\n            limit = limit === void 0 ?\n                -1 >>> 0 : // Math.pow(2, 32) - 1\n                ToUint32(limit);\n            while (match = separator.exec(string)) {\n                // `separator.lastIndex` is not reliable cross-browser\n                lastIndex = match.index + match[0].length;\n                if (lastIndex > lastLastIndex) {\n                    output.push(string.slice(lastLastIndex, match.index));\n                    // Fix browsers whose `exec` methods don't consistently return `undefined` for\n                    // nonparticipating capturing groups\n                    if (!compliantExecNpcg && match.length > 1) {\n                        match[0].replace(separator2, function () {\n                            for (var i = 1; i < arguments.length - 2; i++) {\n                                if (arguments[i] === void 0) {\n                                    match[i] = void 0;\n                                }\n                            }\n                        });\n                    }\n                    if (match.length > 1 && match.index < string.length) {\n                        Array.prototype.push.apply(output, match.slice(1));\n                    }\n                    lastLength = match[0].length;\n                    lastLastIndex = lastIndex;\n                    if (output.length >= limit) {\n                        break;\n                    }\n                }\n                if (separator.lastIndex === match.index) {\n                    separator.lastIndex++; // Avoid an infinite loop\n                }\n            }\n            if (lastLastIndex === string.length) {\n                if (lastLength || !separator.test(\"\")) {\n                    output.push(\"\");\n                }\n            } else {\n                output.push(string.slice(lastLastIndex));\n            }\n            return output.length > limit ? output.slice(0, limit) : output;\n        };\n    }());\n\n// [bugfix, chrome]\n// If separator is undefined, then the result array contains just one String,\n// which is the this value (converted to a String). If limit is not undefined,\n// then the output array is truncated so that it contains no more than limit\n// elements.\n// \"0\".split(undefined, 0) -> []\n} else if (\"0\".split(void 0, 0).length) {\n    String.prototype.split = function split(separator, limit) {\n        if (separator === void 0 && limit === 0) { return []; }\n        return string_split.call(this, separator, limit);\n    };\n}\n\nvar str_replace = String.prototype.replace;\nvar replaceReportsGroupsCorrectly = (function () {\n    var groups = [];\n    'x'.replace(/x(.)?/g, function (match, group) {\n        groups.push(group);\n    });\n    return groups.length === 1 && typeof groups[0] === 'undefined';\n}());\n\nif (!replaceReportsGroupsCorrectly) {\n    String.prototype.replace = function replace(searchValue, replaceValue) {\n        var isFn = isFunction(replaceValue);\n        var hasCapturingGroups = isRegex(searchValue) && (/\\)[*?]/).test(searchValue.source);\n        if (!isFn || !hasCapturingGroups) {\n            return str_replace.call(this, searchValue, replaceValue);\n        } else {\n            var wrappedReplaceValue = function (match) {\n                var length = arguments.length;\n                var originalLastIndex = searchValue.lastIndex;\n                searchValue.lastIndex = 0;\n                var args = searchValue.exec(match);\n                searchValue.lastIndex = originalLastIndex;\n                args.push(arguments[length - 2], arguments[length - 1]);\n                return replaceValue.apply(this, args);\n            };\n            return str_replace.call(this, searchValue, wrappedReplaceValue);\n        }\n    };\n}\n\n// ECMA-262, 3rd B.2.3\n// Not an ECMAScript standard, although ECMAScript 3rd Edition has a\n// non-normative section suggesting uniform semantics and it should be\n// normalized across all browsers\n// [bugfix, IE lt 9] IE < 9 substr() with negative value not working in IE\nif (\"\".substr && \"0b\".substr(-1) !== \"b\") {\n    var string_substr = String.prototype.substr;\n    /**\n     *  Get the substring of a string\n     *  @param  {integer}  start   where to start the substring\n     *  @param  {integer}  length  how many characters to return\n     *  @return {string}\n     */\n    String.prototype.substr = function substr(start, length) {\n        return string_substr.call(\n            this,\n            start < 0 ? ((start = this.length + start) < 0 ? 0 : start) : start,\n            length\n        );\n    };\n}\n\n// ES5 15.5.4.20\n// whitespace from: http://es5.github.io/#x15.5.4.20\nvar ws = \"\\x09\\x0A\\x0B\\x0C\\x0D\\x20\\xA0\\u1680\\u180E\\u2000\\u2001\\u2002\\u2003\" +\n    \"\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200A\\u202F\\u205F\\u3000\\u2028\" +\n    \"\\u2029\\uFEFF\";\nvar zeroWidth = '\\u200b';\nif (!String.prototype.trim || ws.trim() || !zeroWidth.trim()) {\n    // http://blog.stevenlevithan.com/archives/faster-trim-javascript\n    // http://perfectionkills.com/whitespace-deviations/\n    ws = \"[\" + ws + \"]\";\n    var trimBeginRegexp = new RegExp(\"^\" + ws + ws + \"*\"),\n        trimEndRegexp = new RegExp(ws + ws + \"*$\");\n    String.prototype.trim = function trim() {\n        if (this === void 0 || this === null) {\n            throw new TypeError(\"can't convert \" + this + \" to object\");\n        }\n        return String(this)\n            .replace(trimBeginRegexp, \"\")\n            .replace(trimEndRegexp, \"\");\n    };\n}\n\n// ES-5 15.1.2.2\nif (parseInt(ws + '08') !== 8 || parseInt(ws + '0x16') !== 22) {\n    parseInt = (function (origParseInt) {\n        var hexRegex = /^0[xX]/;\n        return function parseIntES5(str, radix) {\n            str = String(str).trim();\n            if (!Number(radix)) {\n                radix = hexRegex.test(str) ? 16 : 10;\n            }\n            return origParseInt(str, radix);\n        };\n    }(parseInt));\n}\n\n//\n// Util\n// ======\n//\n\n// ES5 9.4\n// http://es5.github.com/#x9.4\n// http://jsperf.com/to-integer\n\nfunction toInteger(n) {\n    n = +n;\n    if (n !== n) { // isNaN\n        n = 0;\n    } else if (n !== 0 && n !== (1 / 0) && n !== -(1 / 0)) {\n        n = (n > 0 || -1) * Math.floor(Math.abs(n));\n    }\n    return n;\n}\n\nfunction isPrimitive(input) {\n    var type = typeof input;\n    return (\n        input === null ||\n        type === \"undefined\" ||\n        type === \"boolean\" ||\n        type === \"number\" ||\n        type === \"string\"\n    );\n}\n\nfunction toPrimitive(input) {\n    var val, valueOf, toStr;\n    if (isPrimitive(input)) {\n        return input;\n    }\n    valueOf = input.valueOf;\n    if (isFunction(valueOf)) {\n        val = valueOf.call(input);\n        if (isPrimitive(val)) {\n            return val;\n        }\n    }\n    toStr = input.toString;\n    if (isFunction(toStr)) {\n        val = toStr.call(input);\n        if (isPrimitive(val)) {\n            return val;\n        }\n    }\n    throw new TypeError();\n}\n\n// ES5 9.9\n// http://es5.github.com/#x9.9\nvar toObject = function (o) {\n    if (o == null) { // this matches both null and undefined\n        throw new TypeError(\"can't convert \" + o + \" to object\");\n    }\n    return Object(o);\n};\n\nvar ToUint32 = function ToUint32(x) {\n    return x >>> 0;\n};\n\n}));\n","/*!\r\n * jQuery Migrate - v1.2.1 - 2013-05-08\r\n * https://github.com/jquery/jquery-migrate\r\n * Copyright 2005, 2013 jQuery Foundation, Inc. and other contributors; Licensed MIT\r\n */\r\n(function( jQuery, window, undefined ) {\r\n// See http://bugs.jquery.com/ticket/13335\r\n// \"use strict\";\r\n\r\n\r\nvar warnedAbout = {};\r\n\r\n// List of warnings already given; public read only\r\njQuery.migrateWarnings = [];\r\n\r\n// Set to true to prevent console output; migrateWarnings still maintained\r\n// jQuery.migrateMute = false;\r\n\r\n// Show a message on the console so devs know we're active\r\nif ( !jQuery.migrateMute && window.console && window.console.log ) {\r\n\twindow.console.log(\"JQMIGRATE: Logging is active\");\r\n}\r\n\r\n// Set to false to disable traces that appear with warnings\r\nif ( jQuery.migrateTrace === undefined ) {\r\n\tjQuery.migrateTrace = true;\r\n}\r\n\r\n// Forget any warnings we've already given; public\r\njQuery.migrateReset = function() {\r\n\twarnedAbout = {};\r\n\tjQuery.migrateWarnings.length = 0;\r\n};\r\n\r\nfunction migrateWarn( msg) {\r\n\tvar console = window.console;\r\n\tif ( !warnedAbout[ msg ] ) {\r\n\t\twarnedAbout[ msg ] = true;\r\n\t\tjQuery.migrateWarnings.push( msg );\r\n\t\tif ( console && console.warn && !jQuery.migrateMute ) {\r\n\t\t\tconsole.warn( \"JQMIGRATE: \" + msg );\r\n\t\t\tif ( jQuery.migrateTrace && console.trace ) {\r\n\t\t\t\tconsole.trace();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction migrateWarnProp( obj, prop, value, msg ) {\r\n\tif ( Object.defineProperty ) {\r\n\t\t// On ES5 browsers (non-oldIE), warn if the code tries to get prop;\r\n\t\t// allow property to be overwritten in case some other plugin wants it\r\n\t\ttry {\r\n\t\t\tObject.defineProperty( obj, prop, {\r\n\t\t\t\tconfigurable: true,\r\n\t\t\t\tenumerable: true,\r\n\t\t\t\tget: function() {\r\n\t\t\t\t\tmigrateWarn( msg );\r\n\t\t\t\t\treturn value;\r\n\t\t\t\t},\r\n\t\t\t\tset: function( newValue ) {\r\n\t\t\t\t\tmigrateWarn( msg );\r\n\t\t\t\t\tvalue = newValue;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t} catch( err ) {\r\n\t\t\t// IE8 is a dope about Object.defineProperty, can't warn there\r\n\t\t}\r\n\t}\r\n\r\n\t// Non-ES5 (or broken) browser; just set the property\r\n\tjQuery._definePropertyBroken = true;\r\n\tobj[ prop ] = value;\r\n}\r\n\r\nif ( document.compatMode === \"BackCompat\" ) {\r\n\t// jQuery has never supported or tested Quirks Mode\r\n\tmigrateWarn( \"jQuery is not compatible with Quirks Mode\" );\r\n}\r\n\r\n\r\nvar attrFn = jQuery( \"<input/>\", { size: 1 } ).attr(\"size\") && jQuery.attrFn,\r\n\toldAttr = jQuery.attr,\r\n\tvalueAttrGet = jQuery.attrHooks.value && jQuery.attrHooks.value.get ||\r\n\t\tfunction() { return null; },\r\n\tvalueAttrSet = jQuery.attrHooks.value && jQuery.attrHooks.value.set ||\r\n\t\tfunction() { return undefined; },\r\n\trnoType = /^(?:input|button)$/i,\r\n\trnoAttrNodeType = /^[238]$/,\r\n\trboolean = /^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,\r\n\truseDefault = /^(?:checked|selected)$/i;\r\n\r\n// jQuery.attrFn\r\nmigrateWarnProp( jQuery, \"attrFn\", attrFn || {}, \"jQuery.attrFn is deprecated\" );\r\n\r\njQuery.attr = function( elem, name, value, pass ) {\r\n\tvar lowerName = name.toLowerCase(),\r\n\t\tnType = elem && elem.nodeType;\r\n\r\n\tif ( pass ) {\r\n\t\t// Since pass is used internally, we only warn for new jQuery\r\n\t\t// versions where there isn't a pass arg in the formal params\r\n\t\tif ( oldAttr.length < 4 ) {\r\n\t\t\tmigrateWarn(\"jQuery.fn.attr( props, pass ) is deprecated\");\r\n\t\t}\r\n\t\tif ( elem && !rnoAttrNodeType.test( nType ) &&\r\n\t\t\t(attrFn ? name in attrFn : jQuery.isFunction(jQuery.fn[name])) ) {\r\n\t\t\treturn jQuery( elem )[ name ]( value );\r\n\t\t}\r\n\t}\r\n\r\n\t// Warn if user tries to set `type`, since it breaks on IE 6/7/8; by checking\r\n\t// for disconnected elements we don't warn on $( \"<button>\", { type: \"button\" } ).\r\n\tif ( name === \"type\" && value !== undefined && rnoType.test( elem.nodeName ) && elem.parentNode ) {\r\n\t\tmigrateWarn(\"Can't change the 'type' of an input or button in IE 6/7/8\");\r\n\t}\r\n\r\n\t// Restore boolHook for boolean property/attribute synchronization\r\n\tif ( !jQuery.attrHooks[ lowerName ] && rboolean.test( lowerName ) ) {\r\n\t\tjQuery.attrHooks[ lowerName ] = {\r\n\t\t\tget: function( elem, name ) {\r\n\t\t\t\t// Align boolean attributes with corresponding properties\r\n\t\t\t\t// Fall back to attribute presence where some booleans are not supported\r\n\t\t\t\tvar attrNode,\r\n\t\t\t\t\tproperty = jQuery.prop( elem, name );\r\n\t\t\t\treturn property === true || typeof property !== \"boolean\" &&\r\n\t\t\t\t\t( attrNode = elem.getAttributeNode(name) ) && attrNode.nodeValue !== false ?\r\n\r\n\t\t\t\t\tname.toLowerCase() :\r\n\t\t\t\t\tundefined;\r\n\t\t\t},\r\n\t\t\tset: function( elem, value, name ) {\r\n\t\t\t\tvar propName;\r\n\t\t\t\tif ( value === false ) {\r\n\t\t\t\t\t// Remove boolean attributes when set to false\r\n\t\t\t\t\tjQuery.removeAttr( elem, name );\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// value is true since we know at this point it's type boolean and not false\r\n\t\t\t\t\t// Set boolean attributes to the same name and set the DOM property\r\n\t\t\t\t\tpropName = jQuery.propFix[ name ] || name;\r\n\t\t\t\t\tif ( propName in elem ) {\r\n\t\t\t\t\t\t// Only set the IDL specifically if it already exists on the element\r\n\t\t\t\t\t\telem[ propName ] = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\telem.setAttribute( name, name.toLowerCase() );\r\n\t\t\t\t}\r\n\t\t\t\treturn name;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Warn only for attributes that can remain distinct from their properties post-1.9\r\n\t\tif ( ruseDefault.test( lowerName ) ) {\r\n\t\t\tmigrateWarn( \"jQuery.fn.attr('\" + lowerName + \"') may use property instead of attribute\" );\r\n\t\t}\r\n\t}\r\n\r\n\treturn oldAttr.call( jQuery, elem, name, value );\r\n};\r\n\r\n// attrHooks: value\r\njQuery.attrHooks.value = {\r\n\tget: function( elem, name ) {\r\n\t\tvar nodeName = ( elem.nodeName || \"\" ).toLowerCase();\r\n\t\tif ( nodeName === \"button\" ) {\r\n\t\t\treturn valueAttrGet.apply( this, arguments );\r\n\t\t}\r\n\t\tif ( nodeName !== \"input\" && nodeName !== \"option\" ) {\r\n\t\t\tmigrateWarn(\"jQuery.fn.attr('value') no longer gets properties\");\r\n\t\t}\r\n\t\treturn name in elem ?\r\n\t\t\telem.value :\r\n\t\t\tnull;\r\n\t},\r\n\tset: function( elem, value ) {\r\n\t\tvar nodeName = ( elem.nodeName || \"\" ).toLowerCase();\r\n\t\tif ( nodeName === \"button\" ) {\r\n\t\t\treturn valueAttrSet.apply( this, arguments );\r\n\t\t}\r\n\t\tif ( nodeName !== \"input\" && nodeName !== \"option\" ) {\r\n\t\t\tmigrateWarn(\"jQuery.fn.attr('value', val) no longer sets properties\");\r\n\t\t}\r\n\t\t// Does not return so that setAttribute is also used\r\n\t\telem.value = value;\r\n\t}\r\n};\r\n\r\n\r\nvar matched, browser,\r\n\toldInit = jQuery.fn.init,\r\n\toldParseJSON = jQuery.parseJSON,\r\n\t// Note: XSS check is done below after string is trimmed\r\n\trquickExpr = /^([^<]*)(<[\\w\\W]+>)([^>]*)$/;\r\n\r\n// $(html) \"looks like html\" rule change\r\njQuery.fn.init = function( selector, context, rootjQuery ) {\r\n\tvar match;\r\n\r\n\tif ( selector && typeof selector === \"string\" && !jQuery.isPlainObject( context ) &&\r\n\t\t\t(match = rquickExpr.exec( jQuery.trim( selector ) )) && match[ 0 ] ) {\r\n\t\t// This is an HTML string according to the \"old\" rules; is it still?\r\n\t\tif ( selector.charAt( 0 ) !== \"<\" ) {\r\n\t\t\tmigrateWarn(\"$(html) HTML strings must start with '<' character\");\r\n\t\t}\r\n\t\tif ( match[ 3 ] ) {\r\n\t\t\tmigrateWarn(\"$(html) HTML text after last tag is ignored\");\r\n\t\t}\r\n\t\t// Consistently reject any HTML-like string starting with a hash (#9521)\r\n\t\t// Note that this may break jQuery 1.6.x code that otherwise would work.\r\n\t\tif ( match[ 0 ].charAt( 0 ) === \"#\" ) {\r\n\t\t\tmigrateWarn(\"HTML string cannot start with a '#' character\");\r\n\t\t\tjQuery.error(\"JQMIGRATE: Invalid selector string (XSS)\");\r\n\t\t}\r\n\t\t// Now process using loose rules; let pre-1.8 play too\r\n\t\tif ( context && context.context ) {\r\n\t\t\t// jQuery object as context; parseHTML expects a DOM object\r\n\t\t\tcontext = context.context;\r\n\t\t}\r\n\t\tif ( jQuery.parseHTML ) {\r\n\t\t\treturn oldInit.call( this, jQuery.parseHTML( match[ 2 ], context, true ),\r\n\t\t\t\t\tcontext, rootjQuery );\r\n\t\t}\r\n\t}\r\n\treturn oldInit.apply( this, arguments );\r\n};\r\njQuery.fn.init.prototype = jQuery.fn;\r\n\r\n// Let $.parseJSON(falsy_value) return null\r\njQuery.parseJSON = function( json ) {\r\n\tif ( !json && json !== null ) {\r\n\t\tmigrateWarn(\"jQuery.parseJSON requires a valid JSON string\");\r\n\t\treturn null;\r\n\t}\r\n\treturn oldParseJSON.apply( this, arguments );\r\n};\r\n\r\njQuery.uaMatch = function( ua ) {\r\n\tua = ua.toLowerCase();\r\n\r\n\tvar match = /(chrome)[ \\/]([\\w.]+)/.exec( ua ) ||\r\n\t\t/(webkit)[ \\/]([\\w.]+)/.exec( ua ) ||\r\n\t\t/(opera)(?:.*version|)[ \\/]([\\w.]+)/.exec( ua ) ||\r\n\t\t/(msie) ([\\w.]+)/.exec( ua ) ||\r\n\t\tua.indexOf(\"compatible\") < 0 && /(mozilla)(?:.*? rv:([\\w.]+)|)/.exec( ua ) ||\r\n\t\t[];\r\n\r\n\treturn {\r\n\t\tbrowser: match[ 1 ] || \"\",\r\n\t\tversion: match[ 2 ] || \"0\"\r\n\t};\r\n};\r\n\r\n// Don't clobber any existing jQuery.browser in case it's different\r\nif ( !jQuery.browser ) {\r\n\tmatched = jQuery.uaMatch( navigator.userAgent );\r\n\tbrowser = {};\r\n\r\n\tif ( matched.browser ) {\r\n\t\tbrowser[ matched.browser ] = true;\r\n\t\tbrowser.version = matched.version;\r\n\t}\r\n\r\n\t// Chrome is Webkit, but Webkit is also Safari.\r\n\tif ( browser.chrome ) {\r\n\t\tbrowser.webkit = true;\r\n\t} else if ( browser.webkit ) {\r\n\t\tbrowser.safari = true;\r\n\t}\r\n\r\n\tjQuery.browser = browser;\r\n}\r\n\r\n// Warn if the code tries to get jQuery.browser\r\nmigrateWarnProp( jQuery, \"browser\", jQuery.browser, \"jQuery.browser is deprecated\" );\r\n\r\njQuery.sub = function() {\r\n\tfunction jQuerySub( selector, context ) {\r\n\t\treturn new jQuerySub.fn.init( selector, context );\r\n\t}\r\n\tjQuery.extend( true, jQuerySub, this );\r\n\tjQuerySub.superclass = this;\r\n\tjQuerySub.fn = jQuerySub.prototype = this();\r\n\tjQuerySub.fn.constructor = jQuerySub;\r\n\tjQuerySub.sub = this.sub;\r\n\tjQuerySub.fn.init = function init( selector, context ) {\r\n\t\tif ( context && context instanceof jQuery && !(context instanceof jQuerySub) ) {\r\n\t\t\tcontext = jQuerySub( context );\r\n\t\t}\r\n\r\n\t\treturn jQuery.fn.init.call( this, selector, context, rootjQuerySub );\r\n\t};\r\n\tjQuerySub.fn.init.prototype = jQuerySub.fn;\r\n\tvar rootjQuerySub = jQuerySub(document);\r\n\tmigrateWarn( \"jQuery.sub() is deprecated\" );\r\n\treturn jQuerySub;\r\n};\r\n\r\n\r\n// Ensure that $.ajax gets the new parseJSON defined in core.js\r\njQuery.ajaxSetup({\r\n\tconverters: {\r\n\t\t\"text json\": jQuery.parseJSON\r\n\t}\r\n});\r\n\r\n\r\nvar oldFnData = jQuery.fn.data;\r\n\r\njQuery.fn.data = function( name ) {\r\n\tvar ret, evt,\r\n\t\telem = this[0];\r\n\r\n\t// Handles 1.7 which has this behavior and 1.8 which doesn't\r\n\tif ( elem && name === \"events\" && arguments.length === 1 ) {\r\n\t\tret = jQuery.data( elem, name );\r\n\t\tevt = jQuery._data( elem, name );\r\n\t\tif ( ( ret === undefined || ret === evt ) && evt !== undefined ) {\r\n\t\t\tmigrateWarn(\"Use of jQuery.fn.data('events') is deprecated\");\r\n\t\t\treturn evt;\r\n\t\t}\r\n\t}\r\n\treturn oldFnData.apply( this, arguments );\r\n};\r\n\r\n\r\nvar rscriptType = /\\/(java|ecma)script/i,\r\n\toldSelf = jQuery.fn.andSelf || jQuery.fn.addBack;\r\n\r\njQuery.fn.andSelf = function() {\r\n\tmigrateWarn(\"jQuery.fn.andSelf() replaced by jQuery.fn.addBack()\");\r\n\treturn oldSelf.apply( this, arguments );\r\n};\r\n\r\n// Since jQuery.clean is used internally on older versions, we only shim if it's missing\r\nif ( !jQuery.clean ) {\r\n\tjQuery.clean = function( elems, context, fragment, scripts ) {\r\n\t\t// Set context per 1.8 logic\r\n\t\tcontext = context || document;\r\n\t\tcontext = !context.nodeType && context[0] || context;\r\n\t\tcontext = context.ownerDocument || context;\r\n\r\n\t\tmigrateWarn(\"jQuery.clean() is deprecated\");\r\n\r\n\t\tvar i, elem, handleScript, jsTags,\r\n\t\t\tret = [];\r\n\r\n\t\tjQuery.merge( ret, jQuery.buildFragment( elems, context ).childNodes );\r\n\r\n\t\t// Complex logic lifted directly from jQuery 1.8\r\n\t\tif ( fragment ) {\r\n\t\t\t// Special handling of each script element\r\n\t\t\thandleScript = function( elem ) {\r\n\t\t\t\t// Check if we consider it executable\r\n\t\t\t\tif ( !elem.type || rscriptType.test( elem.type ) ) {\r\n\t\t\t\t\t// Detach the script and store it in the scripts array (if provided) or the fragment\r\n\t\t\t\t\t// Return truthy to indicate that it has been handled\r\n\t\t\t\t\treturn scripts ?\r\n\t\t\t\t\t\tscripts.push( elem.parentNode ? elem.parentNode.removeChild( elem ) : elem ) :\r\n\t\t\t\t\t\tfragment.appendChild( elem );\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t\tfor ( i = 0; (elem = ret[i]) != null; i++ ) {\r\n\t\t\t\t// Check if we're done after handling an executable script\r\n\t\t\t\tif ( !( jQuery.nodeName( elem, \"script\" ) && handleScript( elem ) ) ) {\r\n\t\t\t\t\t// Append to fragment and handle embedded scripts\r\n\t\t\t\t\tfragment.appendChild( elem );\r\n\t\t\t\t\tif ( typeof elem.getElementsByTagName !== \"undefined\" ) {\r\n\t\t\t\t\t\t// handleScript alters the DOM, so use jQuery.merge to ensure snapshot iteration\r\n\t\t\t\t\t\tjsTags = jQuery.grep( jQuery.merge( [], elem.getElementsByTagName(\"script\") ), handleScript );\r\n\r\n\t\t\t\t\t\t// Splice the scripts into ret after their former ancestor and advance our index beyond them\r\n\t\t\t\t\t\tret.splice.apply( ret, [i + 1, 0].concat( jsTags ) );\r\n\t\t\t\t\t\ti += jsTags.length;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn ret;\r\n\t};\r\n}\r\n\r\nvar eventAdd = jQuery.event.add,\r\n\teventRemove = jQuery.event.remove,\r\n\teventTrigger = jQuery.event.trigger,\r\n\toldToggle = jQuery.fn.toggle,\r\n\toldLive = jQuery.fn.live,\r\n\toldDie = jQuery.fn.die,\r\n\tajaxEvents = \"ajaxStart|ajaxStop|ajaxSend|ajaxComplete|ajaxError|ajaxSuccess\",\r\n\trajaxEvent = new RegExp( \"\\\\b(?:\" + ajaxEvents + \")\\\\b\" ),\r\n\trhoverHack = /(?:^|\\s)hover(\\.\\S+|)\\b/,\r\n\thoverHack = function( events ) {\r\n\t\tif ( typeof( events ) !== \"string\" || jQuery.event.special.hover ) {\r\n\t\t\treturn events;\r\n\t\t}\r\n\t\tif ( rhoverHack.test( events ) ) {\r\n\t\t\tmigrateWarn(\"'hover' pseudo-event is deprecated, use 'mouseenter mouseleave'\");\r\n\t\t}\r\n\t\treturn events && events.replace( rhoverHack, \"mouseenter$1 mouseleave$1\" );\r\n\t};\r\n\r\n// Event props removed in 1.9, put them back if needed; no practical way to warn them\r\nif ( jQuery.event.props && jQuery.event.props[ 0 ] !== \"attrChange\" ) {\r\n\tjQuery.event.props.unshift( \"attrChange\", \"attrName\", \"relatedNode\", \"srcElement\" );\r\n}\r\n\r\n// Undocumented jQuery.event.handle was \"deprecated\" in jQuery 1.7\r\nif ( jQuery.event.dispatch ) {\r\n\tmigrateWarnProp( jQuery.event, \"handle\", jQuery.event.dispatch, \"jQuery.event.handle is undocumented and deprecated\" );\r\n}\r\n\r\n// Support for 'hover' pseudo-event and ajax event warnings\r\njQuery.event.add = function( elem, types, handler, data, selector ){\r\n\tif ( elem !== document && rajaxEvent.test( types ) ) {\r\n\t\tmigrateWarn( \"AJAX events should be attached to document: \" + types );\r\n\t}\r\n\teventAdd.call( this, elem, hoverHack( types || \"\" ), handler, data, selector );\r\n};\r\njQuery.event.remove = function( elem, types, handler, selector, mappedTypes ){\r\n\teventRemove.call( this, elem, hoverHack( types ) || \"\", handler, selector, mappedTypes );\r\n};\r\n\r\njQuery.fn.error = function() {\r\n\tvar args = Array.prototype.slice.call( arguments, 0);\r\n\tmigrateWarn(\"jQuery.fn.error() is deprecated\");\r\n\targs.splice( 0, 0, \"error\" );\r\n\tif ( arguments.length ) {\r\n\t\treturn this.bind.apply( this, args );\r\n\t}\r\n\t// error event should not bubble to window, although it does pre-1.7\r\n\tthis.triggerHandler.apply( this, args );\r\n\treturn this;\r\n};\r\n\r\njQuery.fn.toggle = function( fn, fn2 ) {\r\n\r\n\t// Don't mess with animation or css toggles\r\n\tif ( !jQuery.isFunction( fn ) || !jQuery.isFunction( fn2 ) ) {\r\n\t\treturn oldToggle.apply( this, arguments );\r\n\t}\r\n\tmigrateWarn(\"jQuery.fn.toggle(handler, handler...) is deprecated\");\r\n\r\n\t// Save reference to arguments for access in closure\r\n\tvar args = arguments,\r\n\t\tguid = fn.guid || jQuery.guid++,\r\n\t\ti = 0,\r\n\t\ttoggler = function( event ) {\r\n\t\t\t// Figure out which function to execute\r\n\t\t\tvar lastToggle = ( jQuery._data( this, \"lastToggle\" + fn.guid ) || 0 ) % i;\r\n\t\t\tjQuery._data( this, \"lastToggle\" + fn.guid, lastToggle + 1 );\r\n\r\n\t\t\t// Make sure that clicks stop\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\t// and execute the function\r\n\t\t\treturn args[ lastToggle ].apply( this, arguments ) || false;\r\n\t\t};\r\n\r\n\t// link all the functions, so any of them can unbind this click handler\r\n\ttoggler.guid = guid;\r\n\twhile ( i < args.length ) {\r\n\t\targs[ i++ ].guid = guid;\r\n\t}\r\n\r\n\treturn this.click( toggler );\r\n};\r\n\r\njQuery.fn.live = function( types, data, fn ) {\r\n\tmigrateWarn(\"jQuery.fn.live() is deprecated\");\r\n\tif ( oldLive ) {\r\n\t\treturn oldLive.apply( this, arguments );\r\n\t}\r\n\tjQuery( this.context ).on( types, this.selector, data, fn );\r\n\treturn this;\r\n};\r\n\r\njQuery.fn.die = function( types, fn ) {\r\n\tmigrateWarn(\"jQuery.fn.die() is deprecated\");\r\n\tif ( oldDie ) {\r\n\t\treturn oldDie.apply( this, arguments );\r\n\t}\r\n\tjQuery( this.context ).off( types, this.selector || \"**\", fn );\r\n\treturn this;\r\n};\r\n\r\n// Turn global events into document-triggered events\r\njQuery.event.trigger = function( event, data, elem, onlyHandlers  ){\r\n\tif ( !elem && !rajaxEvent.test( event ) ) {\r\n\t\tmigrateWarn( \"Global events are undocumented and deprecated\" );\r\n\t}\r\n\treturn eventTrigger.call( this,  event, data, elem || document, onlyHandlers  );\r\n};\r\njQuery.each( ajaxEvents.split(\"|\"),\r\n\tfunction( _, name ) {\r\n\t\tjQuery.event.special[ name ] = {\r\n\t\t\tsetup: function() {\r\n\t\t\t\tvar elem = this;\r\n\r\n\t\t\t\t// The document needs no shimming; must be !== for oldIE\r\n\t\t\t\tif ( elem !== document ) {\r\n\t\t\t\t\tjQuery.event.add( document, name + \".\" + jQuery.guid, function() {\r\n\t\t\t\t\t\tjQuery.event.trigger( name, null, elem, true );\r\n\t\t\t\t\t});\r\n\t\t\t\t\tjQuery._data( this, name, jQuery.guid++ );\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t},\r\n\t\t\tteardown: function() {\r\n\t\t\t\tif ( this !== document ) {\r\n\t\t\t\t\tjQuery.event.remove( document, name + \".\" + jQuery._data( this, name ) );\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n);\r\n\r\n\r\n})( jQuery, window );\r\n","/*global define:true, require:true*/ // require.js\n/*jslint indent:2*/\n/*jslint browser:true nomen:true*/\n\n(function (window) {\n  'use strict';\n\n  var BMP = window.BMP,\n    URL = {},\n    generateUUID,\n    blobs = {}; // in-memory storage\n\n  /**\n   * @param {Blob} blob object to store.\n   * @param {Object} [options] optional parameters with 'autoRevoke' attribute.\n   * @returns {String} Blob URI.\n   */\n  URL.createObjectURL = function (blob, options) {\n    var key = generateUUID(),\n      autoRevoke = !!(options && options.autoRevoke) || false;\n\n    blobs[key] = blob;\n    // TODO: handle autoRevoke when specification is finalised\n    return 'blob:' + key;\n  };\n\n  URL.revokeObjectURL = function (uri) {\n    var key = uri.replace('blob:', '');\n    delete blobs[key];\n  };\n\n  /**\n   * non-W3C standard, but used for our implementation\n   */\n  URL.retrieveObject = function (uri) {\n    var key = uri.replace('blob:', '');\n    return blobs[key];\n  };\n\n  /**\n   * non-W3C standard, but used for our implementation\n   */\n  URL.revokeAllObjectURLs = function () {\n    blobs = {};\n  };\n\n  generateUUID = function () {\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {\n      /*jslint bitwise:true*/\n      var r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8);\n      /*jslint bitwise:false*/\n      return v.toString(16);\n    });\n  };\n\n  window.BMP = window.BMP || {};\n  window.BMP.URL = URL;\n}(this));\n\n(function (window) {\n  'use strict';\n  var BMP,\n    MIME;\n\n  window.BMP = window.BMP || {};\n  BMP = window.BMP;\n\n  BMP.MIME = BMP.MIME || {};\n  MIME = BMP.MIME;\n\n  /**\n   * @const\n   */\n  MIME.TEXT_TYPES = [\n    'application/javascript',\n    'application/json',\n    'application/x-javascript'\n  ];\n\n  /**\n   * @param {String} type e.g. 'image/jpeg'\n   * @returns {Boolean}\n   */\n  MIME.isText = function (type) {\n    // TODO: strip type parameters (semi-colon and onwards) ??\n    if (type.indexOf('text/') === 0) {\n      return true;\n    }\n    if (MIME.TEXT_TYPES.indexOf(type) !== -1) {\n      return true;\n    }\n    return false;\n  };\n\n}(this));\n\n/*jslint indent:2*/\n/*jslint browser:true*/\n/*jslint nomen:true, plusplus:true*/\n\n(function (window) {\n  'use strict';\n  var b, isConstructableBlob = true,\n    Blob,\n    NestedBlob,\n    convertArrayBufferToBase64,\n    convertStringToArrayBuffer,\n    MIME = window.BMP.MIME;\n\n  try {\n    b = new window.Blob();\n    b = null;\n  } catch (err) {\n    isConstructableBlob = false;\n  }\n\n  // http://stackoverflow.com/questions/9267899\n  convertArrayBufferToBase64 = function (buffer) {\n    var binary = '',\n      bytes = new window.Uint8Array(buffer),\n      len = bytes.byteLength,\n      i;\n\n    for (i = 0; i < len; i++) {\n      binary += String.fromCharCode(bytes[i]);\n    }\n    return window.btoa(binary);\n  };\n\n  /**\n   * @constructor\n   * @param {Array} [data] contains 1 {String}\n   * @param {Object} [options] properties Object with \"type\" attribute\n   */\n  Blob = function (data, options) {\n    var datum;\n\n    if (data && !Array.isArray(data)) {\n      throw new Error('first argument should be an Array');\n    }\n\n    options = options || {};\n\n    this.size = 0;\n    this.type = '';\n    this.base64 = '';\n    this.text = '';\n\n    if (typeof options === 'object') {\n      this.type = options.type || this.type;\n    }\n\n    if (data && data.length) {\n      datum = data[0];\n      if (typeof datum === 'string') {\n        if (datum.indexOf('data:') === 0 && this.type === 'text/plain') {\n          this.size += datum.length;\n          this.text += datum;\n        } else {\n          this.size += datum.length;\n          this.base64 += datum;\n        }\n      }\n    }\n\n    return this;\n  };\n\n  /**\n   * cross-browser constructor for Blob\n   * @param {Array} data Array of {ArrayBuffer|ArrayBufferView|Blob|String}.\n   * @param {Object} [options] optional Object with \"type\" attribute\n   */\n  Blob.createNative = function (data, options) {\n    var builder;\n    options = options || {};\n    if (isConstructableBlob) {\n      return new window.Blob(data, options);\n    }\n    if (window.BlobBuilder) {\n      builder = new window.BlobBuilder();\n      builder.append(data);\n      return builder.getBlob(options);\n    }\n    return new Blob(data, options);\n  };\n\n  /**\n   * @param {String} url\n   * @param {Function} onSuccess function({BMP.Blob} blob)\n   * @param {Function} onError function({Error} error)\n   */\n  Blob.fromBlobURL = function (url, onSuccess, onError) {\n    var xhr,\n      blob;\n\n    onSuccess = onSuccess || function () {};\n    onError = onError || function () {};\n\n    if (!window.URL || !window.URL.createObjectURL) {\n      this.fromNativeBlob(window.BMP.URL.retrieveObject(url), function (blob) {\n        onSuccess(blob);\n      }, function (err) {\n        onError(err);\n      });\n\n    } else { // native URL.createObjectURL, therefore use XMLHTTPRequest\n      Blob.nativelyFromBlobURL(url, onSuccess, onError);\n    }\n  };\n\n  /**\n   * @param {Blob} blob\n   * @param {Function} onSuccess function({BMP.Blob} blob)\n   * @param {Function} onError function({Error} error)\n   */\n  Blob.fromNativeBlob = function (blob, onSuccess, onError) {\n    var fr = new window.FileReader();\n\n    onSuccess = onSuccess || function () {};\n    onError = onError || function () {};\n\n    fr.onload = function (event) {\n      var result;\n      fr.onload = null;\n      try {\n        result = event.target.result;\n        blob = Blob.fromDataURI(event.target.result);\n        if (!blob) {\n          throw new Error('Blob.fromNativeBlob: fromDataURI gave no blob');\n        }\n      } catch (err) {\n        onError(err);\n        return;\n      }\n      onSuccess(blob);\n    };\n    fr.onerror = function (event) {\n      fr.onerror = null;\n      onError(event.target.error);\n    };\n    try {\n      fr.readAsDataURL(blob);\n    } catch (err) {\n      fr.onload = null;\n      fr.onerror = null;\n      onError(err);\n    }\n  };\n\n  /**\n   * @param {String} dataURI\n   * @returns {BMP.Blob} not native Blob!\n   */\n  Blob.fromDataURI = function (dataURI) {\n    var parts,\n      type,\n      encoding,\n      data,\n      blob = new Blob();\n\n    parts = dataURI.split(','); // 0 => header, 1 => data\n    data = parts[1];\n    parts = parts[0].split(':'); // 0 => 'data', 1 => type;encoding\n    parts = parts[1].split(';'); // 0 => type, 1 => encoding\n    type = parts[0];\n    encoding = parts[1];\n\n    if (encoding === 'base64') {\n      blob.base64 = data;\n    } else {\n      blob.text = data;\n    }\n    blob.type = type;\n    blob.size = data.length;\n\n    try {\n      blob = Blob.fromDataURI(window.atob(blob.base64));\n      blob.makeNested();\n    } catch (err) {\n      // do nothing, let original blob be returned\n    }\n\n    return blob;\n  };\n\n  /**\n   * @param {String} url\n   * @param {Function} onSuccess function({BMP.Blob} blob)\n   * @param {Function} onError function({Error} error)\n   */\n  Blob.nativelyFromBlobURL = function (url, onSuccess, onError) {\n    var xhr,\n      blob;\n\n    onSuccess = onSuccess || function () {};\n    onError = onError || function () {};\n\n    xhr = new window.XMLHttpRequest();\n    xhr.onreadystatechange = function () {\n      var mime,\n        base64,\n        serializer;\n\n      if (this.readyState === window.XMLHttpRequest.DONE) {\n        this.onreadystatechange = null;\n        mime = this.getResponseHeader('Content-Type');\n        if (this.status === 200) {\n          if (this.responseType === 'arraybuffer') {\n            base64 = convertArrayBufferToBase64(this.response);\n            blob = new Blob([base64], { type: mime });\n\n          } else if (this.responseType === 'blob') {\n            Blob.fromNativeBlob(this.response, function (blob) {\n              onSuccess(blob);\n            }, function (err) {\n              onError(err);\n            });\n\n          } else if (this.responseType === 'document') {\n            serializer = new window.XMLSerializer();\n            base64 = window.btoa(serializer.serializeToString(this.response));\n            blob = new Blob([base64], { type: mime });\n\n          } else if (this.responseType === 'json') {\n            base64 = window.btoa(JSON.stringify(this.response));\n            blob = new Blob([base64], { type: mime });\n\n          } else { // this.responseType === 'text'\n            blob = new Blob([this.response], { type: mime });\n          }\n          if (blob) {\n            onSuccess(blob);\n          } else {\n            onError(new Error('error retrieving target Blob via Blob URL'));\n          }\n\n        } else { // status === 500\n          onError(new Error(this.url + ' -> ' + this.status));\n        }\n      }\n    };\n    xhr.open('GET', url);\n    xhr.send();\n  };\n\n  /**\n   * @param {BMP.Blob} blob\n   */\n  Blob.isNested = function () {\n\n  };\n\n  /**\n   * @returns {Blob} a Base64-encoded BMP.Blob within a Blob\n   */\n  Blob.prototype.makeNested = function () {\n    var dataURI = 'data:';\n    dataURI += this.type;\n    dataURI += ';base64,';\n    dataURI += this.base64;\n    this.type = 'text/plain';\n    this.text = dataURI;\n    this.base64 = null;\n  };\n\n  Blob.prototype.undoNested = function () {\n    var blob = Blob.fromDataURI(this.text);\n    this.type = blob.type;\n    this.base64 = blob.base64;\n    this.text = null;\n  };\n\n  Blob.prototype.toNative = function () {\n    return window.BMP.Blob.createNative([window.atob(this.base64)], {\n      type: this.type\n    });\n  };\n\n  window.BMP = window.BMP || {};\n  window.BMP.Blob = Blob;\n  window.BMP.NestedBlob = NestedBlob;\n}(this));\n","/*global DOMParser, ActiveXObject*/ // Web Platform and Internet Explorer APIs\n\n/* new tests for Modernizr */\n(function(window) {\n  'use strict';\n  var Modernizr = window.Modernizr,\n      document = window.document,\n      $ = window.jQuery,\n      // vars for additional canvas tests\n      image,\n      canvas,\n      ctx;\n\n  if (!Modernizr) {\n    window.warn('Blink Modernizr tests need Modernizr to be included first.');\n    return;\n  }\n\n  // https://github.com/Modernizr/Modernizr/blob/master/feature-detects/file-api.js\n  Modernizr.addTest('filereader', function() {\n    return !!(window.File && window.FileList && window.FileReader);\n  });\n\n  Modernizr.addTest('positionfixed', function() {\n    var test = document.createElement('div'),\n        fake = false,\n        root = document.body || (function() {\n          fake = true;\n          return document.documentElement.appendChild(document.createElement('body'));\n        }()),\n        oldCssText = root.style.cssText,\n        ret, offset;\n\n    root.style.cssText = 'height: 3000px; margin: 0; padding; 0;';\n    test.style.cssText = 'position: fixed; top: 100px';\n    root.appendChild(test);\n    window.scrollTo(0, 500);\n    offset = $(test).offset();\n    ret = offset.top === 600; // 100 + 500\n    if (!ret && typeof test.getBoundingClientRect !== 'undefined') {\n      ret = test.getBoundingClientRect().top === 100;\n    }\n    root.removeChild(test);\n    root.style.cssText = oldCssText;\n    window.scrollTo(0, 1);\n    if (fake) {\n      document.documentElement.removeChild(root);\n    }\n    return ret;\n  });\n\n  Modernizr.addTest('xpath', function () {\n    // http://developer.samsung.com/forum/board/thread/view.do?boardName=General&messageId=253999\n    var tmp, xml, result;\n    if (!window.XPathResult || !window.DOMParser) {\n      return false; // constructors for Firefox, Safari and Chrome not found\n    }\n    try {\n      tmp = new DOMParser();\n      xml = tmp.parseFromString('<book><page /></book>', 'text/xml');\n    } catch (ignore) {}\n    if (!xml || !xml.documentElement || xml.getElementsByTagName('parsererror').length) {\n      return false; // XML didn't parse correctly\n    }\n    if (!xml.evaluate) {\n      return false; // no support for `evaluate` method\n    }\n    try {\n      result = xml.evaluate('/book', xml, null, 9, null);\n      return !!(result && result.singleNodeValue);\n    } catch (ignore) {}\n    return false;\n  });\n\n  Modernizr.addTest('documentfragment', function() {\n    var outerFragment,\n    innerFragment,\n    p;\n\n    try {\n      p = document.createElement('p');\n\n      outerFragment = document.createDocumentFragment();\n      innerFragment = document.createDocumentFragment();\n\n      innerFragment.appendChild(p);\n      outerFragment.appendChild(innerFragment);\n\n      // intermediate fragments are supposed to be destroyed\n      if (p.parentNode !== outerFragment) {\n        return false;\n      }\n      if (innerFragment.parentNode === outerFragment) {\n        return false;\n      }\n\n      return true;\n\n    } catch (error) {\n      return false;\n    }\n\n  });\n\n  /**\n   * Check to see if input[type=file] even works on this browser.\n   */\n  Modernizr.inputtypes.file = (function() {\n    var userAgent = navigator.userAgent,\n    isAndroid = userAgent.indexOf('Android') !== -1,\n    isEclair = isAndroid && /Android 2\\.(0|1)/.test(userAgent),\n    dummy;\n    // check for Android <= 2.1 and report false\n    if (isAndroid) {\n      if (userAgent.indexOf('Android 1.') !== -1 || isEclair) {\n        return false;\n      }\n    }\n    dummy = document.createElement('input');\n    dummy.setAttribute('type', 'file');\n    return dummy.disabled === false;\n  }());\n\n  /**\n   * Check to see if non-Integer values are valid in input[type=number].\n   * They should be, but some WebKits disagree.\n   */\n  Modernizr.inputtypes.number = (function() {\n    var $number,\n        test;\n    if (!Modernizr.inputtypes.number) {\n      return false;\n    }\n    $number = $('<input type=\"number\" />');\n    $number.val(1.5);\n    test = $number[0].checkValidity();\n    $number.remove();\n    return test;\n  }());\n\n// https://github.com/Modernizr/Modernizr/blob/master/feature-detects/canvas-todataurl-type.js\n  if (Modernizr.canvas) {\n    image = new Image(),\n    canvas = document.createElement('canvas'),\n    ctx = canvas.getContext('2d');\n    image.onload = function() {\n      ctx.drawImage(image, 0, 0);\n      Modernizr.addTest('canvastodataurlpng', function() {\n        return canvas.toDataURL('image/png').indexOf('data:image/png') === 0;\n      });\n      Modernizr.addTest('canvastodataurljpeg', function() {\n        return canvas.toDataURL('image/jpeg').indexOf('data:image/jpeg') === 0;\n      });\n      Modernizr.addTest('canvastodataurlwebp', function() {\n        return canvas.toDataURL('image/webp').indexOf('data:image/webp') === 0;\n      });\n    };\n    image.src = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACklEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg==';\n  }\n\n}(this));\n\n\n","/* basic collection of utility functions not expected to undergo rapid\n * development requires jQuery\n * if Modernizr is being used, please include this after Modernizr\n */\n\n/*jslint browser:true, indent:2, nomen:true, plusplus:true, todo:true*/\n/*global error, warn*/\n\n(function (window) {\n  'use strict';\n  var $ = window.jQuery,\n    Math = window.Math;\n  /* END: var */\n\n  // detect BlinkGap / PhoneGap / Callback\n  window.isBlinkGapDevice = function () {\n    return window.PhoneGap && $.type(window.device) === 'object' &&\n      window.device instanceof window.Device;\n  };\n\n  window.computeTimeout = function (messageLength) {\n\n    var lowestTransferRateConst = 1000 / (4800 / 8);\n    // maxTransactionTimeout = 180 * 1000;\n    return Math.floor((messageLength * lowestTransferRateConst) + 15000);\n  };\n\n}(this));\n\n/* logging functions\n * initialises log(), error(), warn(), info() in the global context\n */\n(function (window) {\n  'use strict';\n  var $ = window.jQuery,\n    $document = $(window.document),\n    early = { // catch messages from before we are ready\n      history: []\n    },\n    console,\n    fns = ['log', 'error', 'warn', 'info'],\n    /**\n * re-route messages now that we are ready\n */\n    initialise = function () {\n      $document.off('ready deviceready', initialise);\n      setTimeout(function () { // force thread-switch for PhoneGap\n        console = window.console || window.debug || { log: $.noop };\n        /*jslint unparam:true*/\n        $.each(fns, function (index, fn) {\n          var type = $.type(console[fn]);\n          if (type === 'function') {\n            window[fn] = function () {\n              console[fn].apply(console, arguments);\n            };\n          } else if (type === 'object') {\n            window[fn] = function (message) {\n              console[fn](message);\n            };\n          } else if (fn !== 'log') {\n            window[fn] = window.log;\n          } else {\n            window[fn] = $.noop;\n          }\n        });\n        /*jslint unparam:false*/\n        // playback early messages\n        /*jslint unparam:true*/\n        $.each(early.history, function (index, message) {\n          var fn = window[message.fn],\n            type = $.type(fn);\n\n          if (type === 'function') {\n            fn.apply(console, message.args);\n          } else if (type === 'object') {\n            fn(message.args[0]);\n          }\n        });\n        /*jslint unparam:false*/\n        // discard unused objects\n        delete early.history;\n        /*jslint unparam:true*/\n        $.each(fns, function (index, fn) {\n          delete early[fn];\n        });\n        /*jslint unparam:false*/\n      }, 0);\n    },\n    waitForBlinkGap = function () {\n      if (window.PhoneGap && window.PhoneGap.available) {\n        if (early.history) {\n          initialise();\n        }\n      } else {\n        setTimeout(waitForBlinkGap, 197);\n      }\n    };\n\n  // setup routing for early messages\n  console = early;\n  /*jslint unparam:true*/\n  $.each(fns, function (index, fn) {\n    early[fn] = function () {\n      early.history.push({ 'fn': fn, 'args': $.makeArray(arguments) });\n    };\n    window[fn] = console[fn];\n  });\n  /*jslint unparam:false*/\n\n  // wait until we are ready to start real routing\n  if (window.isBlinkGap) {\n    waitForBlinkGap();\n  } else {\n    $document.on('ready', initialise);\n  }\n}(this));\n\n//* convenient additions to the String prototype*/\n(function (window) {\n  'use strict';\n  var String = window.String;\n  String.prototype.hasEntities = function () {\n    var string = this;\n    if (string.indexOf('&') === -1) {\n      return false;\n    }\n  // TODO: use RegExp to properly detect HTML Entities\n  };\n  String.prototype.repeat = function (occurrences) {\n    var string = '',\n      o;\n    for (o = 0; o < occurrences; o++) {\n      string += this;\n    }\n    return string;\n  };\n}(this));\n\n/* minor improvements to Math */\n(function (window) {\n  'use strict';\n  var Math = window.Math,\n    oldRound = Math.round;\n  /* END: var */\n\n  /* duck-punching Math.round() so it accepts a 2nd parameter */\n  Math.round = function (value, decimals) {\n    var order;\n    if (!decimals || decimals === 0) {\n      return oldRound(value);\n    }\n    order = Math.pow(10, decimals);\n    if (typeof decimals === 'number' && decimals > 0) {\n      value = Math.round(value * order) / order;\n    }\n    return value;\n  };\n\n  /*\n  * Math.uuid.js, minimalistic uuid generator. Original script from Robert\n  * Kieffer, http://www.broofa.com Dual licensed under the MIT and GPL licenses.\n  * example: >>> Math.uuid(); // returns RFC4122, version 4 ID\n  * \"92329D39-6F5C-4520-ABFC-AAB64544E172\"\n  */\n  /*jslint bitwise: true*/\n  if (typeof Math.uuid !== 'function') {\n    Math.uuid = function () {\n      var chars = Math.uuid.CHARS,\n        uuid = [],\n        r,\n        i = 36;\n\n      // rfc4122 requires these characters\n      uuid[8] = uuid[13] = uuid[18] = uuid[23] = '-';\n      uuid[14] = '4';\n\n      // Fill in random data. At i==19 set the high bits of clock sequence as\n      // per rfc4122, sec. 4.1.5\n      while (i--) {\n        if (!uuid[i]) {\n          r = Math.random() * 16 | 0;\n          uuid[i] = chars[(i === 19) ? (r & 0x3) | 0x8 : r];\n        }\n      }\n      return uuid.join('');\n    };\n    Math.uuid.CHARS = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A',\n      'B', 'C', 'D', 'E', 'F'];\n  }\n  /*jslint bitwise: false*/\n}(this));\n\n/* minor improvements to jQuery */\n(function (window) {\n  'use strict';\n  var $ = window.jQuery,\n    _oldAttr = $.fn.attr,\n    _show = $.fn.show;\n  /* END: var */\n\n  /**\n   * checks to see if an Object has the listed Properties\n   * didn't feel comfortable exposing this to the world\n   * really handy for duck-typing (does it quack like a duck?)\n   * @param {Object} object object to check.\n   * @param {Object|Array} props array of properties, or map of property->type.\n   * @return {Boolean} all properties present?\n   */\n  function hasProperties(object, props) {\n    var result = true;\n    if (!object || $.type(object) !== 'object') {\n      return false;\n    }\n    if ($.type(props) === 'array') {\n      /*jslint unparam:true*/\n      $.each(props, function (index, name) {\n        if (object[name] === undefined) {\n          result = false;\n          return false; // break loop now\n        }\n        return true; // continue testing\n      });\n      /*jslint unparam:false*/\n      return result;\n    }\n    if ($.type(props) === 'object') {\n      $.each(props, function (name, value) {\n        if ($.type(object[name]) !== value) {\n          result = false;\n          return false; // break loop now\n        }\n        return true; // continue testing\n      });\n      return result;\n    }\n    return false;\n  }\n\n  /**\n   * @param {Object} Does $.type(object) === 'object'?\n   */\n  $.isObject = function (variable) {\n    return $.type(variable) === 'object';\n  };\n\n  /**\n   * @return {Boolean} Is object a jQuery Deferred Promise (read-only)?\n   */\n  $.isPromise = function (object) {\n    var type = 'function',\n      props = {\n        always: type,\n        done: type,\n        fail: type,\n        pipe: type,\n        progress: type,\n        promise: type,\n        state: type,\n        then: type\n      };\n    return hasProperties(object, props);\n  };\n\n  /**\n   * @return {Boolean} Is object a jQuery Deferred Object (read-write)?\n   */\n  $.isDeferred = function (object) {\n    var type = 'function',\n      props = {\n        notify: type,\n        notifyWith: type,\n        reject: type,\n        rejectWith: type,\n        resolve: type,\n        resolveWith: type\n      };\n    if ($.isPromise(object)) {\n      return hasProperties(object, props);\n    }\n    return false;\n  };\n\n  // duck-punching to make attr() return a map\n  $.fn.attr = function () {\n    var attributes, map;\n    if (this[0] && arguments.length === 0) {\n      map = {};\n      attributes = this[0].attributes;\n      /*jslint unparam:true*/\n      $.each(attributes, function (index, attribute) {\n        var name = attribute.name || attribute.nodeName,\n          value = attribute.value || attribute.nodeValue;\n        /* END: var */\n        if (name) {\n          map[name.toLowerCase()] = value;\n        }\n      });\n      /*jslint unparam:false*/\n      return map;\n    }\n    return _oldAttr.apply(this, arguments);\n  };\n\n  // TODO: remove this backwards-compatibility later\n  $.fn.show = function () {\n    this.removeAttr('hidden');\n    this.removeClass('hidden');\n    return _show.apply(this, arguments);\n  };\n\n  $.fn.isHidden = function () {\n    if (this.prop('hidden') || this.hasClass('hidden')) {\n      return true;\n    }\n    return this[0] && this[0].style && this[0].style.display === 'none';\n  };\n\n  // return just the element's HTML tag (no attributes or innerHTML)\n  $.fn.tag = function () {\n    var tag;\n    if (this.length > 0) {\n      tag = this[0].nodeName || this[0].tagName || '';\n      return tag.toLowerCase();\n    }\n    return '';\n  };\n\n  // return a simple HTML tag string not containing the innerHTML\n  $.fn.tagHTML = function () {\n    var $this = $(this),\n      html;\n    if (this[0]) {\n      html = '<' + $this.tag();\n      $.each($this.attr(), function (key, value) {\n        html += ' ' + key + '=\"' + value + '\"';\n      });\n      html += ' />';\n      return html;\n    }\n  };\n\n  /* function to allow passing an array to jQuery.when() */\n  $.whenArray = function (array) {\n    return $.when.apply($, array);\n  };\n  /* automatically wrap Deferred.resolve in a setTimeout\n   * @param {jQueryDeferred} deferred\n   */\n  $.resolveTimeout = function () {\n    var args = $.makeArray(arguments),\n      deferred = args.shift();\n    setTimeout(function () {\n      deferred.resolve.apply(deferred, args);\n    }, 0);\n    return this;\n  };\n\n  /*\n   * @param {String} string (X)HTML or text to append to the selected element\n   * @param {Number} attempts number of times to try\n   * @param {String} [needle] resulting HTML must include this for success\n   * @param {Number} [lastIndex] only used internally\n   * @returns {jQueryPromise}\n   */\n  /*jslint regexp: true*/\n  $.fn.appendWithCheck = function (string, attempts, needle, lastIndex) {\n    var $element = $(this),\n      deferred = new $.Deferred(),\n      MyAnswers = window.MyAnswers;\n    /* END: var */\n    if ($.type(needle) !== 'string') {\n      needle = string.match(/>([^<>\\0\\n\\f\\r\\t\\v]+)</);\n      if (!needle) {\n        needle = string.match(/(\\w+)/);\n      }\n      needle = $.type(needle) === 'array' ? needle[0] : string;\n    }\n    if ($.type(lastIndex) !== 'number') {\n      MyAnswers.dispatch.add(function () {\n        lastIndex = $element.html().lastIndexOf(needle);\n      });\n    }\n    MyAnswers.dispatch.add(function () {\n      $element.append(string);\n    });\n    MyAnswers.dispatch.add(function () {\n      var html = $element.html();\n      if ($.type(html) !== 'string' || !html ||\n          html.lastIndexOf(needle) > lastIndex) {\n        deferred.resolve();\n      } else if (attempts > 0) {\n        $.when($element.appendWithCheck(string, --attempts, needle, lastIndex))\n          .fail(deferred.reject)\n          .then(deferred.resolve);\n      } else {\n        deferred.reject();\n      }\n    });\n    return deferred.promise();\n  };\n  /*jslint regexp: false*/\n\n  $.fn.childrenAsProperties = function () {\n    var properties = {};\n    /*jslint unparam:true*/\n    $(this).children().each(function (index, element) {\n      var $element = $(element),\n        name = $element.tag(),\n        value = $element.text();\n      if (name.length > 0 && value.length > 0) {\n        properties[name] = value;\n      }\n    });\n    /*jslint unparam:false*/\n    return properties;\n  };\n\n  // from http://api.jquery.com/jQuery.getScript/\n  $.getCachedScript = function (url, options) {\n    options = $.extend(options || {}, {\n      dataType: \"script\",\n      cache: true,\n      url: url\n    });\n    return $.ajax(options);\n  };\n  /*jslint nomen: false*/\n}(this));\n\n(function (window) {\n  'use strict';\n  var $ = window.jQuery,\n    _Blink = window._Blink,\n    _SERVER = window._SERVER,\n    defaults = {\n      'PREFIX_GZ': '/_c_/',\n      'SUFFIX_GZ': '',\n      'PREFIX': '/_c_/',\n      'SUFFIX': ''\n    },\n    /** @const */\n    GZ_TYPES = ['css', 'js'],\n    /**\n     * JavaScript mirror of our PHP class: \\Blink\\CDN\\PlatformCDN\n     * @class\n     * @param {String} [encoding] Provide the HTTP_ACCEPT_ENCODING Header.\n     */\n    PlatformCDN = function (encoding) {\n      var cfg, isAppCache, isSecure;\n\n      isAppCache = window.applicationCache && window.applicationCache.status !== 0;\n      isSecure = window.location && window.location.protocol === 'https:';\n\n      cfg = _Blink && _Blink.cfg && _Blink.cfg.CDN_PLATFORM;\n      cfg = $.isObject(cfg) ? cfg : {};\n      cfg = $.extend({}, defaults, cfg);\n      encoding = encoding || (_SERVER && _SERVER.HTTP_ACCEPT_ENCODING);\n      encoding = typeof encoding === 'string' ? encoding : '';\n      if (encoding.indexOf('gzip') === -1) {\n        cfg.PREFIX_GZ = cfg.PREFIX;\n        cfg.SUFFIX_GZ = cfg.SUFFIX;\n      }\n      if (isAppCache && isSecure) {\n        cfg.PREFIX = '/_c_/';\n        cfg.SUFFIX = '';\n        cfg.PREFIX_GZ = cfg.PREFIX;\n        cfg.SUFFIX_GZ = cfg.SUFFIX;\n      }\n\n      /**\n       * add necessary protocol, domain and suffix to a given path\n       * @param  {String} path Provide the path to desired resource.\n       * @return {String} The completed URL.\n       */\n      this.getURL = function (path) {\n        var extension;\n        if (!path || typeof path !== 'string') {\n          return '';\n        }\n        path = $.trim(path);\n        path = path.replace(/^\\/*/, '');\n        extension = path.match(/\\.?(\\w+)$/);\n        extension = $.type(extension) === 'array' ? extension[1] : '';\n        if (!extension || $.inArray(extension, GZ_TYPES) === -1) {\n          return cfg.PREFIX + path + cfg.SUFFIX;\n        }\n        return cfg.PREFIX_GZ + path + cfg.SUFFIX_GZ;\n      };\n      return this;\n    };\n\n  _Blink.AnswerSpaceCDN = function (cdn) {\n    var cfg, basename, answerSpaceDefaults, getCDN;\n    answerSpaceDefaults = {\n      \"ROOT\": 'images/'\n    };\n    cfg = _Blink && _Blink.cfg && _Blink.cfg.CDN_USER;\n    cfg = $.isObject(cfg) ? cfg : {};\n    cfg = $.extend({}, answerSpaceDefaults, cfg);\n    cfg.cdnLocation = cdn;\n    basename = function (path, suffix) {\n      var b, ln;\n      /*jslint regexp:true*/ // this isn't being used for secure purposes\n      b = path.replace(/^.*[\\/\\\\]/g, '');\n      /*jslint regexp:false*/\n      if (suffix === undefined) {\n        suffix = \"\";\n      }\n      ln = b.length - suffix.length;\n      if (b.substr(ln) === suffix) {\n        b = b.substr(0, ln);\n      }\n      return b;\n    };\n    getCDN = function () {\n      var parts;\n      parts = cfg.cdnLocation.split(\":\");\n\n      return parts[1];\n    };\n    /**\n     * add necessary protocol, domain and suffix to a given path\n     * @param  {String} path Provide the path to desired resource.\n     * @return {String} The completed URL.\n     */\n    this.getURL = function (path) {\n      if (!path || typeof path !== 'string') {\n        return '';\n      }\n      path = $.trim(path);\n      path = path.replace(/^\\/*/, '');\n      if (basename(path) === path) {\n        path = cfg.ROOT + getCDN() + \"/\" + path;\n      }\n      return path;\n    };\n    return this;\n  };\n\n  /**\n   * use a hidden <iframe> to load a page,\n   * deleting the iframe when the page's <body> gains the \"s-ready\" class\n   * @param {String} src URL for the HTML content to be loaded.\n   */\n  _Blink.preloadPage = function (src) {\n    var $iframe = $('<iframe></iframe>'),\n      checkCountdown = 30,\n      iframeWindow,\n      onReadyFn = function () {\n        $iframe.remove();\n      },\n      testReadyFn = function () {\n        checkCountdown--;\n        if ($(iframeWindow.document.body).hasClass('s-ready')) {\n          onReadyFn();\n        } else if (checkCountdown < 0) {\n          warn('preloadPage(): timed out waiting for \"s-ready\"');\n          onReadyFn();\n        } else {\n          setTimeout(testReadyFn, 2000);\n        }\n      };\n\n    $iframe.attr({\n      height: 10,\n      width: 10,\n      'src': src\n    });\n    $iframe.css({\n      position: 'absolute',\n      top: '-50px',\n      left: '-50px'\n    });\n    $('body').append($iframe);\n    iframeWindow = $iframe[0].contentWindow;\n    if ($.isWindow(iframeWindow) && iframeWindow.document) {\n      if ($(iframeWindow.document.body).hasClass('s-ready')) {\n        onReadyFn();\n      } else {\n        setTimeout(testReadyFn, 2000);\n      }\n    } else {\n      warn('preloadPage(): unable to find Window or Document in <iframe>');\n    }\n  };\n\n  /**\n   * Convert a DOM HTML or XML Node into an XML String.\n   * @param {Node} node XML or HTML Node to convert.\n   * @return {String} XML String.\n   */\n  _Blink.stringifyDOM = function (node) {\n    var xmlSerializer;\n    if (node.xml) {\n      return node.xml;\n    }\n    if (window.XMLSerializer) {\n      xmlSerializer = new window.XMLSerializer();\n      return xmlSerializer.serializeToString(node);\n    }\n    return null;\n  };\n\n  /**\n   * @param {String} char Single character to be tested.\n   */\n  _Blink.hasFontFor = function (char) {\n    var me = _Blink.hasFontFor,\n      result,\n      $body,\n      $target,\n      $test;\n    try {\n      if (!me.results) {\n        me.results = {};\n      }\n      if (typeof me.results[char] === 'boolean') {\n        result = me.results[char];\n      } else {\n        $body = $(window.document.body);\n        $target = $('<span>' + char + '</span>');\n        $test = $('<span>&#xFFFD;</span>');\n        $target.add($test).appendTo($body);\n        result = $target.innerWidth() !== $test.innerWidth();\n        me.results[char] = result;\n        $target.add($test).remove();\n      }\n    } catch (err) {\n      error(err);\n      result = false;\n    }\n    return result;\n  };\n\n  // export singleton to global namespace\n  window._Blink.cdnp = new PlatformCDN();\n\n}(this));\n\n","/* \n * basic class for queuing execution\n * requires utilities.js\n */\n\n/*jslint white:true*/\n\n(function(window) {\n\t'use strict';\n\tvar $ = window.jQuery,\n\tBlinkDispatch = function(interval) {\n\t\tvar timeout = null,\n\t\tself = this; // to facilitate self-references\n\t\t/* END: var */\n\t\tthis.queue = [];\n\t\tthis.interval = interval || 0;\n\t\tthis.isPaused = false;\n\t\t\n\t\t/**\n\t\t * check to see if we have items in the queue, and process the first one\n\t\t */\n\t\tfunction processQueue() {\n\t\t\tif (self.isPaused || timeout !== null || self.queue.length === 0) {return;}\n\t\t\tvar item = self.queue.shift(),\n\t\t\tresult;\n\t\t\t/* END: var */\n\t\t\tif (typeof item === 'function') {\n\t\t\t\tresult = item();\n\t\t\t}\n\t\t\t// check to see if we have queued a jQuery Deferred Promise\n\t\t\tif (typeof $ === 'function' && $() instanceof $\n\t\t\t\t\t&& result && typeof result === 'object'\n\t\t\t\t\t&& result.promise && typeof result.promise === 'function') {\n\t\t\t\ttimeout = 0; // placeholder value\n\t\t\t\t$.when(result)\n\t\t\t\t.always(function() {\n\t\t\t\t\ttimeout = setTimeout(function() {\n\t\t\t\t\t\ttimeout = null;\n\t\t\t\t\t\tprocessQueue();\n\t\t\t\t\t}, self.interval);\n\t\t\t\t});\n\t\t\t} else { // not a Promise\n\t\t\t\ttimeout = setTimeout(function() {\n\t\t\t\t\ttimeout = null;\n\t\t\t\t\tprocessQueue();\n\t\t\t\t}, self.interval);\n\t\t\t}\n\t\t}\n\t\t/**\n\t\t * public function to trigger processing of the queue\n\t\t */\n\t\tthis.poke = function() {\n\t\t\tprocessQueue();\n\t\t}\n\t\tthis.pause = function() {\n\t\t\tclearTimeout(timeout);\n\t\t\ttimeout = null;\n\t\t\tthis.isPaused = true;\n\t\t};\n\t\tthis.resume = function() {\n\t\t\tthis.isPaused = false;\n\t\t\tprocessQueue();\n\t\t};\n\t\treturn this;\n\t};\n\t/* END: var */\n\tBlinkDispatch.prototype.add = function(item) {\n\t\tthis.queue.push(item);\n\t\tthis.poke();\n\t};\n\t\n\twindow.BlinkDispatch = BlinkDispatch;\n}(this));\n","// UMD pattern from https://github.com/umdjs/umd/blob/master/amdWebGlobal.js\n\n/*global define:true*/\n\n(function (root, factory) {\n  'use strict';\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define(['jquery'], function ($) {\n      // Also create a global in case some scripts\n      // that are loaded still are looking for\n      // a global even when an AMD loader is in use.\n      root.BMP = factory(root, $);\n      return (root.BMP);\n    });\n  } else {\n    // Browser globals\n    root.BMP = factory(root, root.$);\n  }\n}(this, function (global, $) {\n  'use strict';\n\n  var BMP,\n      $doc = $(global.document),\n      $body = $(global.document.body),\n      nav = global.navigator || {},\n      $dialog,\n      putDialog,\n      showDialog = {},\n      hasCordova,\n      hasjQueryUI,\n      hasjQueryMobile,\n      bindQueue;\n\n  BMP = global.BMP = global.BMP || {};\n\n  if (!$ || !$.fn || typeof $.fn.jquery !== 'string') {\n    // can't find valid jQuery, bailing out early\n    return;\n  }\n\n  putDialog = function() {\n    var $div = $('<div id=\"bmp-dialog-async\"></div>');\n    $div.hide();\n    $body.append($div);\n    return $div;\n  };\n\n  showDialog.jQueryUI = function(message, options) {\n    $dialog = $body.find('#bmp-dialog-async');\n    if (!$dialog.length) {\n      $dialog = putDialog();\n    }\n    $dialog.empty();\n    if ($dialog.hasClass('ui-dialog-content')) {\n      $dialog.dialog('destroy');\n    }\n    $dialog.append('<p>' + message + '</p>');\n    options.modal = true;\n    options.closeOnEscape = true;\n    $dialog.dialog(options);\n  };\n\n  hasjQueryUI = function() {\n    return $.fn.dialog;\n  };\n\n  hasjQueryMobile = function() {\n    return $.mobile && $.fn.dialog;\n  };\n\n  /**\n   * https://developer.mozilla.org/en-US/docs/DOM/window.alert\n   * @param {String} message content to be displayed.\n   * @param {Object} [options] { title: \"...\", ok: \"...\" }\n   * @return {Promise} resolved when dismissed by user.\n   */\n  BMP.alertNoQueue = function(message, options) {\n    var dfrd = new $.Deferred(),\n        n10n = nav.notification || {},\n        alert = n10n.alert,\n        dismissedFn;\n\n    options = options || {};\n    options.ok = 'OK';\n\n    dismissedFn = function() {\n      dfrd.resolve();\n    };\n\n    if ($.type(alert) === 'function') {\n      // do cordova thing here\n      options.title = 'Alert';\n      alert(message, dismissedFn, options.title, options.ok);\n\n    /*\n    } else if (hasjQueryMobile()) {\n      // TODO: do jQueryMobile thing here\n      */\n\n    } else if (hasjQueryUI()) {\n      // do jQueryUI thing here\n      options.title = 'Alert';\n      options.buttons = {};\n      options.buttons[options.ok] = function() {\n        $(this).dialog('close');\n      };\n      options.close = dismissedFn;\n\n      showDialog.jQueryUI(message, options);\n\n    } else {\n      // last resort, use browser global :(\n      message = (options.title ? options.title + ' | ' : '') + message;\n      global.alert(message);\n      dfrd.resolve();\n    }\n    return dfrd.promise();\n  };\n\n  /**\n   * https://developer.mozilla.org/en-US/docs/DOM/window.confirm\n   * @param {String} message content to be displayed.\n   * @param {Object} [options] { title: \"...\", ok: \"...\", cancel: \"...\" }\n   * @return {Promise} resolved when dismissed by user, passed Boolean result.\n   */\n  BMP.confirmNoQueue = function(message, options) {\n    var dfrd = new $.Deferred(),\n        n10n = nav.notification || {},\n        alert = n10n.alert;\n\n    options = options || {};\n    options.ok = options.ok || 'OK';\n    options.cancel = options.cancel || 'Cancel';\n\n    if ($.type(alert) === 'function') {\n      // do cordova thing here\n      options.title = options.title || 'Confirm';\n      alert(message, function(result) {\n        if (result === 1) {\n          // OK button pressed\n          dfrd.resolve(true);\n        } else {\n          // Cancel button or dialog dismissed\n          dfrd.resolve(false);\n        }\n      }, options.title, options.ok + ',' + options.cancel);\n\n      /*\n       } else if (hasjQueryMobile()) {\n       // TODO: do jQueryMobile thing here\n       */\n\n    } else if (hasjQueryUI()) {\n      // do jQueryUI thing here\n      options.title = options.title || 'Confirm';\n      options.buttons = {};\n      options.buttons[options.cancel] = function() {\n        $(this).dialog('close');\n      };\n      options.buttons[options.ok] = function() {\n        dfrd.resolve(true);\n        $(this).dialog('close');\n      };\n      options.close = function() {\n        if (!dfrd.isRejected() || !dfrd.isResolved()) {\n          dfrd.resolve(false);\n        }\n      };\n\n      showDialog.jQueryUI(message, options);\n\n    } else {\n      // last resort, use browser global :(\n      message = (options.title ? options.title + ' | ' : '') + message;\n      dfrd.resolve(global.confirm(message));\n    }\n    return dfrd.promise();\n  };\n\n  /**\n   * https://developer.mozilla.org/en-US/docs/DOM/window.prompt\n   * @param {String} message content to be displayed.\n   * @param {String} [value] optional default value to be displayed.\n   * @param {Object} [options] { title: \"...\", ok: \"...\", cancel: \"...\" }\n   * @return {Promise} resolved when dismissed by user, passed input String.\n   */\n  BMP.promptNoQueue = function(message, value, options) {\n    var dfrd = new $.Deferred();\n\n    if (typeof value !== 'string') {\n      options = value;\n      value = '';\n    }\n\n    options = options || {};\n    options.ok = options.ok || 'OK';\n    options.cancel = options.cancel || 'Cancel';\n\n    // as of Cordova 2.5, there is no native functionality for this\n\n      /*\n       if (hasjQueryMobile()) {\n       // TODO: do jQueryMobile thing here\n\n    } else*/ if (hasjQueryUI()) {\n      // do jQueryUI thing here\n      message += '</p><p><input type=\"text\" value=\"' + value + '\" />';\n      options.title = options.title || 'Prompt';\n      options.buttons = {};\n      options.buttons[options.cancel] = function() {\n        $(this).dialog('close');\n      };\n      options.buttons[options.ok] = function() {\n        var $this = $(this);\n        dfrd.resolve($this.find('input').val());\n        $this.dialog('close');\n      };\n      options.close = function() {\n        if (!dfrd.isRejected() || !dfrd.isResolved()) {\n          dfrd.resolve(null);\n        }\n      };\n\n      showDialog.jQueryUI(message, options);\n\n    } else {\n      // last resort, use browser global :(\n      message = (options.title ? options.title + ' | ' : '') + message;\n      dfrd.resolve(global.prompt(message));\n    }\n    return dfrd.promise();\n  };\n\n  // put alert|confirm|prompt in a queue to prevent lost messages / promises\n\n  /**\n   * @param {Object} context the context to use during execution.\n   * @param {Function|String} method either the name or the method itself.\n   * @param {String} queue the name of the queue to use.\n   * @return {Function} a method that returns Promises and queues itself.\n   */\n  bindQueue = function(context, method, queue) {\n    if (typeof method === 'string') {\n      method = context[method];\n    }\n\n    return function() {\n      var args = $.makeArray(arguments),\n          dfrd = new $.Deferred();\n\n      $doc.queue(queue, function(next) {\n        var result,\n            array = $._data($doc[0], queue + 'queue');\n\n        array.unshift('inprogress');\n        result = method.apply(context, args);\n        result.then(function() {\n          dfrd.resolve.apply(dfrd, $.makeArray(arguments));\n          array.shift(); // clear 'inprogress'\n          next();\n        }, function() {\n          dfrd.reject.apply(dfrd, $.makeArray(arguments));\n          array.shift(); // clear 'inprogress'\n          next();\n        });\n        return result;\n      });\n\n      if ($doc.queue(queue).length && $doc.queue(queue)[0] !== 'inprogress') {\n        $doc.dequeue(queue);\n      }\n\n      return dfrd.promise();\n    };\n  };\n\n  BMP.alert = bindQueue(this, BMP.alertNoQueue, 'bmp-alerts');\n  BMP.confirm = bindQueue(this, BMP.confirmNoQueue, 'bmp-alerts');\n  BMP.prompt = bindQueue(this, BMP.promptNoQueue, 'bmp-alerts');\n\n  return BMP;\n}));","// UMD pattern from https://github.com/umdjs/umd/blob/master/amdWebGlobal.js\n\n/*global define:true*/\n/*jslint nomen:true*/ // for Underscore.JS\n\n(function(root, factory) {\n  'use strict';\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define(['../../../../.'], function(_) {\n      // Also create a global in case some scripts\n      // that are loaded still are looking for\n      // a global even when an AMD loader is in use.\n      root.BMP = factory(root, _);\n      return (root.BMP);\n    });\n  } else {\n    // Browser globals\n    root.BMP = factory(root, root._);\n  }\n}(this, function(global, _) {\n  'use strict';\n\n  var BMP,\n      BIC,\n      Config;\n\n  BMP = global.BMP = global.BMP || {};\n  BIC = BMP.BIC = BMP.BIC || {};\n\n  /**\n   * convenience prototype to collect configuration-specific functionality\n   * @constructor\n   * @param {Object} cfg plain object { setting: 'value', ... }.\n   */\n  Config = function(cfg) {\n    this.cfg = cfg;\n  };\n\n  /**\n   * @return {Object} plain object usable as Cordova CameraOptions.\n   */\n  Config.prototype.toCameraOptions = function() {\n    var options = {},\n        cameraOpts;\n\n    if (_.isNumber(this.cfg.imageCaptureQuality)) {\n      options.quality = this.cfg.imageCaptureQuality;\n    }\n    if (_.isNumber(this.cfg.imageCaptureScale)) {\n      options.imageScale = this.cfg.imageCaptureScale;\n    }\n    if (_.isString(this.cfg.cameraOptions)) {\n      try {\n        cameraOpts = JSON.parse(this.cfg.cameraOptions);\n        if (!_.isObject(cameraOpts) || _.isArray(cameraOpts)) {\n          cameraOpts = {};\n        }\n      } finally {\n        cameraOpts = cameraOpts || {};\n      }\n      _.extend(options, cameraOpts);\n    }\n    return options;\n  };\n\n  BIC.Config = Config;\n  return BMP;\n}));\n","/*\r\n * custom library to abstract access to available local storage mechanisms\r\n * requires: jQuery 1.5+, utilities.js (optional)\r\n *\r\n * valid storage types are: localstorage, sessionstorage, websqldatabase, indexeddb\r\n *\r\n * This has been designed with seemless operation of asynchronous storage methods,\r\n * via the jQuery Deferred Promises mechanism in jQuery 1.5.\r\n *\r\n * The SQL-specific terms \"database\" and \"table\" have been replaced with\r\n * the more neutral \"partition\" and \"section\", respectively.\r\n */\r\n\r\n/*jslint plusplus:true, white:true*/\r\n\r\n(function (window) {\r\n    'use strict';\r\n    var available,\r\n        $ = window.jQuery,\r\n        alert = window.alert,\r\n    // for websqldatabase\r\n        estimatedSizeMbs,\r\n        estimatedSize,\r\n        webSqlDbs = {}, // store open handles to databases (websqldatabase)\r\n        errorHandler,\r\n        openSection,\r\n        openWebSQL,\r\n    // logging functions\r\n        logger = {},\r\n        log, error, warn, info,\r\n        /**\r\n         * @inner\r\n         * @construct\r\n         */\r\n            BlinkStorage = function (type, partition, section) {\r\n            var self = this,\r\n                readyDeferred = new $.Deferred(),\r\n                sql, // for webslqdatabase and blinkgapsql\r\n                db,// for websqldatabase, localstorage or sessionstorage\r\n                memory; // for memory\r\n            if (typeof partition !== 'string' || partition.length < 1) {\r\n                partition = 'default';\r\n            }\r\n            if (typeof section !== 'string' || section.length < 1) {\r\n                section = 'main';\r\n            }\r\n\r\n            if (typeof type !== 'string') {\r\n                type = available[0];\r\n            } else if (type === 'sessionstorage' && $.inArray('sessionstorage', available) === -1) {\r\n                type = 'memory';\r\n            } else if ($.inArray(type, available) === -1) {\r\n                type = available[0];\r\n            }\r\n\r\n            self.type = type;\r\n            self.partition = partition;\r\n            self.section = section;\r\n\r\n            readyDeferred.done(function () {\r\n                log('BlinkStorage(): ' + type + ' -> ' + partition + ' : ' + section + ' ready');\r\n            });\r\n            self.ready = function () {\r\n                return readyDeferred.promise();\r\n            };\r\n\r\n            if (type === 'localstorage' || type === 'sessionstorage') {\r\n\r\n                db = (type === 'localstorage') ? window.localStorage : window.sessionStorage;\r\n\r\n                self.get = function (key) {\r\n                    var dfrd = new $.Deferred();\r\n                    dfrd.resolve(db.getItem(partition + ':' + section + ':' + key));\r\n                    // dfrd.reject(); not sure if this is needed\r\n                    return dfrd.promise();\r\n                };\r\n\r\n                self.set = function (key, value) {\r\n                    var dfrd = new $.Deferred();\r\n                    db.setItem(partition + ':' + section + ':' + key, value);\r\n                    dfrd.resolve();\r\n                    return dfrd.promise();\r\n                };\r\n\r\n                self.remove = function (key) {\r\n                    var dfrd = new $.Deferred();\r\n                    db.removeItem(partition + ':' + section + ':' + key);\r\n                    dfrd.resolve();\r\n                    return dfrd.promise();\r\n                };\r\n\r\n                self.keys = function () {\r\n                    var dfrd = new $.Deferred(),\r\n                        found = [],\r\n                        length = db.length,\r\n                        index, parts,\r\n                        current,\r\n                        prefix = partition + ':' + section + ':';\r\n                    /* END: var */\r\n                    for (index = 0; index < length; index++) {\r\n                        current = db.key(index);\r\n                        if (current.indexOf(prefix) === 0) {\r\n                            found.push(current.replace(prefix, ''));\r\n                        }\r\n                    }\r\n                    dfrd.resolve(found);\r\n                    return dfrd.promise();\r\n                };\r\n\r\n                self.count = function () {\r\n                    var dfrd = new $.Deferred();\r\n                    $.when(self.keys()).done(function (keys) {\r\n                        dfrd.resolve(keys.length);\r\n                    });\r\n                    return dfrd.promise();\r\n                };\r\n\r\n                readyDeferred.resolve();\r\n\r\n            } else if (type === 'websqldatabase') {\r\n                //set the estimated size - use 5mb if we are using the old plugin, 100mb if we are on the new blinkgap and not much at all if we are not\r\n                if (window.device) {\r\n                  //we are on device\r\n                  if (window.sqlitePlugin) {\r\n                    //new version\r\n                    estimatedSizeMbs = 100\r\n                  } else {\r\n                    //old version\r\n                    estimatedSizeMbs = 5\r\n                  }\r\n                } else {\r\n                  estimatedSizeMbs = 0.75\r\n                }\r\n                estimatedSize = estimatedSizeMbs * 1024 * 1024;\r\n                /* @inner */\r\n                errorHandler = function (arg1, arg2) {\r\n                    var sqlError = arg2 && arg1.executeSql ? arg2 : arg1;\r\n                    error('BlinkStorage error1: ' + sqlError.code + ' ' + sqlError.message);\r\n                    if (sqlError.code === 3 || sqlError.code === 4 || sqlError.code === 7) {\r\n                        alert('storage-error: ' + sqlError.code + '\\n' + sqlError.message);\r\n                    }\r\n                    return false;\r\n                };\r\n                /* @inner */\r\n                openSection = function (db, readyDeferred) {\r\n\r\n                    db.transaction(function (tx) {\r\n                        tx.executeSql(\r\n                            'CREATE TABLE IF NOT EXISTS `' + section + '` (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)',\r\n                            [],\r\n                          $.noop,\r\n                          errorHandler\r\n                        );\r\n                    }, function (err) {\r\n                        //transaction error\r\n                        readyDeferred.reject();\r\n                        errorHandler();\r\n                    }, function () {\r\n                        //transaction success\r\n                        readyDeferred.resolve();\r\n                    });\r\n                };\r\n\r\n                /* @inner */\r\n                openWebSQL = function (partition, readyDeferred, onSuccess) {\r\n                    try {\r\n                        //db = window.openDatabase(partition, '1.0', partition, estimatedSize);\r\n                      if (window.sqlitePlugin) {\r\n                        log(\"sqliteplugin found. opening database.\");\r\n                        db = window.sqlitePlugin.openDatabase(partition, \"1.0\", partition, estimatedSize, function () {\r\n                          log(\"opendb success callback\");\r\n                        }, function () {\r\n                          log(\"failed to open \" + partition);\r\n                          readyDeferred.reject();\r\n                          throw 'BlinkStorage: sqliteplugin unable to open database';\r\n                        });\r\n                      } else {\r\n                         db = window.openDatabase(partition, \"1.0\", partition, estimatedSize);\r\n                      }\r\n                      //assign our references to DB and the nulls\r\n                      if (db && (db.readTransaction || db.transaction)) {\r\n                        webSqlDbs[partition] = db;\r\n                        db.readTransaction = db.readTransaction || db.transaction;\r\n                        onSuccess(db, readyDeferred);\r\n                      } else {\r\n                        throw \"neither sqliteplugin nor window.openDatabase worked. failing.\"\r\n                      }\r\n                    } catch (error) {\r\n                        readyDeferred.reject();\r\n                        throw 'BlinkStorage: ' + error;\r\n                    }\r\n                };\r\n\r\n                // cache SQL so each string only occupies memory once per DB\r\n                sql = {\r\n                    get: 'SELECT v FROM `' + section + '` WHERE k = ?',\r\n                    set: 'INSERT OR REPLACE INTO `' + section + '` (k, v) VALUES (?, ?)',\r\n                    remove: 'DELETE FROM `' + section + '` WHERE k = ?',\r\n                    keys: 'SELECT k FROM `' + section + '`',\r\n                    count: 'SELECT count(k) AS `count` FROM ' + section\r\n                };\r\n\r\n                if (webSqlDbs[partition]) {\r\n                    db = webSqlDbs[partition];\r\n                    openSection(db, readyDeferred);\r\n                } else {\r\n                    openWebSQL(partition, readyDeferred, openSection);\r\n                }\r\n\r\n                self.get = function (key) {\r\n                    var dfrd = new $.Deferred();\r\n                    db.readTransaction(function (tx) {\r\n                        tx.executeSql(sql.get, [key],\r\n                            function (tx, result) { // SQL success handler\r\n                                if (result.rows.length === 1) {\r\n                                    dfrd.resolve(result.rows.item(0).v);\r\n                                } else {\r\n                                    dfrd.resolve(null);\r\n                                    if (result.rows.length > 1) {\r\n                                        error('BlinkStorage: SELECT returned multiple rows');\r\n                                    }\r\n                                }\r\n                            },\r\n                            errorHandler // SQL error handler\r\n                        );\r\n                    }, errorHandler, $.noop); // transaction handlers\r\n                    return dfrd.promise();\r\n                };\r\n\r\n                self.set = function (key, value, attempts) {\r\n                    var deferred = new $.Deferred(),\r\n                        dfrdSQL = new $.Deferred(),\r\n                        retryFn = function () {\r\n                            setTimeout(function () { // retry after 2 seconds\r\n                                $.when(self.set(key, value, attempts))\r\n                                    .fail(deferred.reject)\r\n                                    .then(deferred.resolve);\r\n                            }, 2 * 1000);\r\n                        };\r\n                    /* END: var */\r\n                    attempts = typeof attempts !== 'number' ? 2 : attempts;\r\n                    if (attempts-- <= 0) {\r\n                        deferred.reject();\r\n                        return deferred.promise();\r\n                    }\r\n                    // perform transaction\r\n                    setTimeout(function () {\r\n                        db.transaction(function (tx) {\r\n                                // execute INSERT OR REPLACE statement\r\n                                tx.executeSql(sql.set, [key, value],\r\n                                    function (tx, result) { // SQL success handler\r\n                                        if (result.rowsAffected !== 1) {\r\n                                            error('BlinkStorage: INSERT did not affect 1 row');\r\n                                            retryFn();\r\n                                        } else {\r\n                                            dfrdSQL.resolve();\r\n                                        }\r\n                                    },\r\n                                    function (tx, sqlError) { // SQL error handler\r\n                                        errorHandler(sqlError);\r\n                                        retryFn();\r\n                                    }\r\n                                );\r\n                            },\r\n                            function (tx, sqlError) { // transaction error handler\r\n                                errorHandler(tx, sqlError);\r\n                                retryFn();\r\n                            },\r\n                            function () { // transaction success handler\r\n                                if (dfrdSQL.state() === 'pending') {\r\n                                    // if TX finishes before SQL then we have a problem\r\n                                    retryFn();\r\n                                } else {\r\n                                    deferred.resolve();\r\n                                }\r\n                            });\r\n                    }, 0);\r\n                    return deferred.promise();\r\n                };\r\n\r\n                self.remove = function (key) {\r\n                    var dfrd = new $.Deferred();\r\n                    db.transaction(function (tx) {\r\n                        tx.executeSql(sql.remove, [key], function (tx, result) {\r\n                            dfrd.resolve();\r\n                        });\r\n                    }, errorHandler, $.noop);\r\n                    return dfrd.promise();\r\n                };\r\n\r\n                self.keys = function () {\r\n                    var dfrd = new $.Deferred();\r\n                    db.readTransaction(function (tx) {\r\n                        tx.executeSql(sql.keys, [], function (tx, result) {\r\n                            var index, row,\r\n                                length = result.rows.length,\r\n                                found = [];\r\n                            for (index = 0; index < length; index++) {\r\n                                row = result.rows.item(index);\r\n                                found.push(row.k);\r\n                            }\r\n                            dfrd.resolve(found);\r\n                        });\r\n                    }, errorHandler, $.noop);\r\n                    return dfrd.promise();\r\n                };\r\n\r\n                self.count = function () {\r\n                    var dfrd = new $.Deferred();\r\n                    db.readTransaction(function (tx) {\r\n                        tx.executeSql(sql.count, [], function (tx, result) {\r\n                                var count = result.rows.item(0).count;\r\n                                if ($.isNumeric(count)) {\r\n                                    dfrd.resolve(parseInt(count, 10));\r\n                                } else {\r\n                                    error('BlinkStorage: SELECT count(k) non-numeric');\r\n                                    dfrd.reject();\r\n                                }\r\n                            }\r\n                        );\r\n                    }, errorHandler, $.noop);\r\n                    return dfrd.promise();\r\n                };\r\n\r\n            } else if (type === 'memory') {\r\n\r\n                memory = {};\r\n\r\n                self.get = function (key) {\r\n                    var dfrd = new $.Deferred();\r\n                    dfrd.resolve(memory[partition + ':' + section + ':' + key]);\r\n                    // dfrd.reject(); not sure if this is needed\r\n                    return dfrd.promise();\r\n                };\r\n\r\n                self.set = function (key, value) {\r\n                    var dfrd = new $.Deferred();\r\n                    memory[partition + ':' + section + ':' + key] = value;\r\n                    dfrd.resolve();\r\n                    return dfrd.promise();\r\n                };\r\n\r\n                self.remove = function (key) {\r\n                    var dfrd = new $.Deferred();\r\n                    delete memory[partition + ':' + section + ':' + key];\r\n                    dfrd.resolve();\r\n                    return dfrd.promise();\r\n                };\r\n\r\n                self.keys = function () {\r\n                    var dfrd = new $.Deferred(),\r\n                        found = [],\r\n                        prefix = partition + ':' + section + ':',\r\n                        key;\r\n                    /* END: var */\r\n                    for (key in memory) {\r\n                        if (memory.hasOwnProperty(key)) {\r\n                            if (key.indexOf(prefix) === 0) {\r\n                                found.push(key.replace(prefix, ''));\r\n                            }\r\n                        }\r\n                    }\r\n                    dfrd.resolve(found);\r\n                    return dfrd.promise();\r\n                };\r\n\r\n                self.count = function () {\r\n                    var dfrd = new $.Deferred();\r\n                    $.when(self.keys()).done(function (keys) {\r\n                        dfrd.resolve(keys.length);\r\n                    });\r\n                    return dfrd.promise();\r\n                };\r\n\r\n                readyDeferred.resolve();\r\n            }\r\n            return this;\r\n        };\r\n    /* END: var */\r\n\r\n    if (!$) {\r\n        alert('error: BlinkStorage.JS requires jQuery to be loaded first');\r\n        return;\r\n    }\r\n\r\n    // setup loggers\r\n    $.each(['log', 'error', 'warn', 'info'], function (index, fn) {\r\n        logger[fn] = function () {\r\n            if (window[fn]) {\r\n                window[fn].apply(window, arguments);\r\n            }\r\n        };\r\n    });\r\n    log = logger.log;\r\n    error = logger.error;\r\n    warn = logger.warn;\r\n    info = logger.info;\r\n\r\n    BlinkStorage.prototype.removeKeysRegExp = function (regexp) {\r\n        var store = this,\r\n            deferred = new $.Deferred(function (dfrd) {\r\n                $.when(store.keys()).done(function (keys) {\r\n                    var k, kLength = keys.length,\r\n                        removeDefers = [];\r\n                    for (k = 0; k < kLength; k++) {\r\n                        if (keys[k].search(regexp) !== -1) {\r\n                            removeDefers.push(store.remove(keys[k]));\r\n                        }\r\n                    }\r\n                    $.when(removeDefers).done(dfrd.resolve());\r\n                });\r\n            });\r\n        return deferred.promise();\r\n    };\r\n\r\n    // perform engine detection\r\n    BlinkStorage.prototype.available = [];\r\n    available = BlinkStorage.prototype.available;\r\n    // TODO: add detection for indexedDB\r\n    if (typeof window.openDatabase !== 'undefined') {\r\n        available.push('websqldatabase');\r\n    }\r\n    if (typeof window.localStorage !== 'undefined') {\r\n        available.push('localstorage');\r\n    }\r\n    if (typeof window.sessionStorage !== 'undefined') {\r\n        available.push('sessionstorage');\r\n    }\r\n    available.push('memory');\r\n    if (typeof window.log === 'function') {\r\n        info('BlinkStorage(): available=[' + available.join(',') + ']');\r\n    }\r\n\r\n    window.BlinkStorage = BlinkStorage;\r\n}(this));\r\n","/*\n    json2.js\n    2012-10-08\n\n    Public Domain.\n\n    NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n\n    See http://www.JSON.org/js.html\n\n\n    This code should be minified before deployment.\n    See http://javascript.crockford.com/jsmin.html\n\n    USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\n    NOT CONTROL.\n\n\n    This file creates a global JSON object containing two methods: stringify\n    and parse.\n\n        JSON.stringify(value, replacer, space)\n            value       any JavaScript value, usually an object or array.\n\n            replacer    an optional parameter that determines how object\n                        values are stringified for objects. It can be a\n                        function or an array of strings.\n\n            space       an optional parameter that specifies the indentation\n                        of nested structures. If it is omitted, the text will\n                        be packed without extra whitespace. If it is a number,\n                        it will specify the number of spaces to indent at each\n                        level. If it is a string (such as '\\t' or '&nbsp;'),\n                        it contains the characters used to indent at each level.\n\n            This method produces a JSON text from a JavaScript value.\n\n            When an object value is found, if the object contains a toJSON\n            method, its toJSON method will be called and the result will be\n            stringified. A toJSON method does not serialize: it returns the\n            value represented by the name/value pair that should be serialized,\n            or undefined if nothing should be serialized. The toJSON method\n            will be passed the key associated with the value, and this will be\n            bound to the value\n\n            For example, this would serialize Dates as ISO strings.\n\n                Date.prototype.toJSON = function (key) {\n                    function f(n) {\n                        // Format integers to have at least two digits.\n                        return n < 10 ? '0' + n : n;\n                    }\n\n                    return this.getUTCFullYear()   + '-' +\n                         f(this.getUTCMonth() + 1) + '-' +\n                         f(this.getUTCDate())      + 'T' +\n                         f(this.getUTCHours())     + ':' +\n                         f(this.getUTCMinutes())   + ':' +\n                         f(this.getUTCSeconds())   + 'Z';\n                };\n\n            You can provide an optional replacer method. It will be passed the\n            key and value of each member, with this bound to the containing\n            object. The value that is returned from your method will be\n            serialized. If your method returns undefined, then the member will\n            be excluded from the serialization.\n\n            If the replacer parameter is an array of strings, then it will be\n            used to select the members to be serialized. It filters the results\n            such that only members with keys listed in the replacer array are\n            stringified.\n\n            Values that do not have JSON representations, such as undefined or\n            functions, will not be serialized. Such values in objects will be\n            dropped; in arrays they will be replaced with null. You can use\n            a replacer function to replace those with JSON values.\n            JSON.stringify(undefined) returns undefined.\n\n            The optional space parameter produces a stringification of the\n            value that is filled with line breaks and indentation to make it\n            easier to read.\n\n            If the space parameter is a non-empty string, then that string will\n            be used for indentation. If the space parameter is a number, then\n            the indentation will be that many spaces.\n\n            Example:\n\n            text = JSON.stringify(['e', {pluribus: 'unum'}]);\n            // text is '[\"e\",{\"pluribus\":\"unum\"}]'\n\n\n            text = JSON.stringify(['e', {pluribus: 'unum'}], null, '\\t');\n            // text is '[\\n\\t\"e\",\\n\\t{\\n\\t\\t\"pluribus\": \"unum\"\\n\\t}\\n]'\n\n            text = JSON.stringify([new Date()], function (key, value) {\n                return this[key] instanceof Date ?\n                    'Date(' + this[key] + ')' : value;\n            });\n            // text is '[\"Date(---current time---)\"]'\n\n\n        JSON.parse(text, reviver)\n            This method parses a JSON text to produce an object or array.\n            It can throw a SyntaxError exception.\n\n            The optional reviver parameter is a function that can filter and\n            transform the results. It receives each of the keys and values,\n            and its return value is used instead of the original value.\n            If it returns what it received, then the structure is not modified.\n            If it returns undefined then the member is deleted.\n\n            Example:\n\n            // Parse the text. Values that look like ISO date strings will\n            // be converted to Date objects.\n\n            myData = JSON.parse(text, function (key, value) {\n                var a;\n                if (typeof value === 'string') {\n                    a =\n/^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2}(?:\\.\\d*)?)Z$/.exec(value);\n                    if (a) {\n                        return new Date(Date.UTC(+a[1], +a[2] - 1, +a[3], +a[4],\n                            +a[5], +a[6]));\n                    }\n                }\n                return value;\n            });\n\n            myData = JSON.parse('[\"Date(09/09/2001)\"]', function (key, value) {\n                var d;\n                if (typeof value === 'string' &&\n                        value.slice(0, 5) === 'Date(' &&\n                        value.slice(-1) === ')') {\n                    d = new Date(value.slice(5, -1));\n                    if (d) {\n                        return d;\n                    }\n                }\n                return value;\n            });\n\n\n    This is a reference implementation. You are free to copy, modify, or\n    redistribute.\n*/\n\n/*jslint evil: true, regexp: true */\n\n/*members \"\", \"\\b\", \"\\t\", \"\\n\", \"\\f\", \"\\r\", \"\\\"\", JSON, \"\\\\\", apply,\n    call, charCodeAt, getUTCDate, getUTCFullYear, getUTCHours,\n    getUTCMinutes, getUTCMonth, getUTCSeconds, hasOwnProperty, join,\n    lastIndex, length, parse, prototype, push, replace, slice, stringify,\n    test, toJSON, toString, valueOf\n*/\n\n\n// Create a JSON object only if one does not already exist. We create the\n// methods in a closure to avoid creating global variables.\n\nif (typeof JSON !== 'object') {\n    JSON = {};\n}\n\n(function () {\n    'use strict';\n\n    function f(n) {\n        // Format integers to have at least two digits.\n        return n < 10 ? '0' + n : n;\n    }\n\n    if (typeof Date.prototype.toJSON !== 'function') {\n\n        Date.prototype.toJSON = function (key) {\n\n            return isFinite(this.valueOf())\n                ? this.getUTCFullYear()     + '-' +\n                    f(this.getUTCMonth() + 1) + '-' +\n                    f(this.getUTCDate())      + 'T' +\n                    f(this.getUTCHours())     + ':' +\n                    f(this.getUTCMinutes())   + ':' +\n                    f(this.getUTCSeconds())   + 'Z'\n                : null;\n        };\n\n        String.prototype.toJSON      =\n            Number.prototype.toJSON  =\n            Boolean.prototype.toJSON = function (key) {\n                return this.valueOf();\n            };\n    }\n\n    var cx = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n        escapable = /[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n        gap,\n        indent,\n        meta = {    // table of character substitutions\n            '\\b': '\\\\b',\n            '\\t': '\\\\t',\n            '\\n': '\\\\n',\n            '\\f': '\\\\f',\n            '\\r': '\\\\r',\n            '\"' : '\\\\\"',\n            '\\\\': '\\\\\\\\'\n        },\n        rep;\n\n\n    function quote(string) {\n\n// If the string contains no control characters, no quote characters, and no\n// backslash characters, then we can safely slap some quotes around it.\n// Otherwise we must also replace the offending characters with safe escape\n// sequences.\n\n        escapable.lastIndex = 0;\n        return escapable.test(string) ? '\"' + string.replace(escapable, function (a) {\n            var c = meta[a];\n            return typeof c === 'string'\n                ? c\n                : '\\\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n        }) + '\"' : '\"' + string + '\"';\n    }\n\n\n    function str(key, holder) {\n\n// Produce a string from holder[key].\n\n        var i,          // The loop counter.\n            k,          // The member key.\n            v,          // The member value.\n            length,\n            mind = gap,\n            partial,\n            value = holder[key];\n\n// If the value has a toJSON method, call it to obtain a replacement value.\n\n        if (value && typeof value === 'object' &&\n                typeof value.toJSON === 'function') {\n            value = value.toJSON(key);\n        }\n\n// If we were called with a replacer function, then call the replacer to\n// obtain a replacement value.\n\n        if (typeof rep === 'function') {\n            value = rep.call(holder, key, value);\n        }\n\n// What happens next depends on the value's type.\n\n        switch (typeof value) {\n        case 'string':\n            return quote(value);\n\n        case 'number':\n\n// JSON numbers must be finite. Encode non-finite numbers as null.\n\n            return isFinite(value) ? String(value) : 'null';\n\n        case 'boolean':\n        case 'null':\n\n// If the value is a boolean or null, convert it to a string. Note:\n// typeof null does not produce 'null'. The case is included here in\n// the remote chance that this gets fixed someday.\n\n            return String(value);\n\n// If the type is 'object', we might be dealing with an object or an array or\n// null.\n\n        case 'object':\n\n// Due to a specification blunder in ECMAScript, typeof null is 'object',\n// so watch out for that case.\n\n            if (!value) {\n                return 'null';\n            }\n\n// Make an array to hold the partial results of stringifying this object value.\n\n            gap += indent;\n            partial = [];\n\n// Is the value an array?\n\n            if (Object.prototype.toString.apply(value) === '[object Array]') {\n\n// The value is an array. Stringify every element. Use null as a placeholder\n// for non-JSON values.\n\n                length = value.length;\n                for (i = 0; i < length; i += 1) {\n                    partial[i] = str(i, value) || 'null';\n                }\n\n// Join all of the elements together, separated with commas, and wrap them in\n// brackets.\n\n                v = partial.length === 0\n                    ? '[]'\n                    : gap\n                    ? '[\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + ']'\n                    : '[' + partial.join(',') + ']';\n                gap = mind;\n                return v;\n            }\n\n// If the replacer is an array, use it to select the members to be stringified.\n\n            if (rep && typeof rep === 'object') {\n                length = rep.length;\n                for (i = 0; i < length; i += 1) {\n                    if (typeof rep[i] === 'string') {\n                        k = rep[i];\n                        v = str(k, value);\n                        if (v) {\n                            partial.push(quote(k) + (gap ? ': ' : ':') + v);\n                        }\n                    }\n                }\n            } else {\n\n// Otherwise, iterate through all of the keys in the object.\n\n                for (k in value) {\n                    if (Object.prototype.hasOwnProperty.call(value, k)) {\n                        v = str(k, value);\n                        if (v) {\n                            partial.push(quote(k) + (gap ? ': ' : ':') + v);\n                        }\n                    }\n                }\n            }\n\n// Join all of the member texts together, separated with commas,\n// and wrap them in braces.\n\n            v = partial.length === 0\n                ? '{}'\n                : gap\n                ? '{\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + '}'\n                : '{' + partial.join(',') + '}';\n            gap = mind;\n            return v;\n        }\n    }\n\n// If the JSON object does not yet have a stringify method, give it one.\n\n    if (typeof JSON.stringify !== 'function') {\n        JSON.stringify = function (value, replacer, space) {\n\n// The stringify method takes a value and an optional replacer, and an optional\n// space parameter, and returns a JSON text. The replacer can be a function\n// that can replace values, or an array of strings that will select the keys.\n// A default replacer method can be provided. Use of the space parameter can\n// produce text that is more easily readable.\n\n            var i;\n            gap = '';\n            indent = '';\n\n// If the space parameter is a number, make an indent string containing that\n// many spaces.\n\n            if (typeof space === 'number') {\n                for (i = 0; i < space; i += 1) {\n                    indent += ' ';\n                }\n\n// If the space parameter is a string, it will be used as the indent string.\n\n            } else if (typeof space === 'string') {\n                indent = space;\n            }\n\n// If there is a replacer, it must be a function or an array.\n// Otherwise, throw an error.\n\n            rep = replacer;\n            if (replacer && typeof replacer !== 'function' &&\n                    (typeof replacer !== 'object' ||\n                    typeof replacer.length !== 'number')) {\n                throw new Error('JSON.stringify');\n            }\n\n// Make a fake root object containing our value under the key of ''.\n// Return the result of stringifying the value.\n\n            return str('', {'': value});\n        };\n    }\n\n\n// If the JSON object does not yet have a parse method, give it one.\n\n    if (typeof JSON.parse !== 'function') {\n        JSON.parse = function (text, reviver) {\n\n// The parse method takes a text and an optional reviver function, and returns\n// a JavaScript value if the text is a valid JSON text.\n\n            var j;\n\n            function walk(holder, key) {\n\n// The walk method is used to recursively walk the resulting structure so\n// that modifications can be made.\n\n                var k, v, value = holder[key];\n                if (value && typeof value === 'object') {\n                    for (k in value) {\n                        if (Object.prototype.hasOwnProperty.call(value, k)) {\n                            v = walk(value, k);\n                            if (v !== undefined) {\n                                value[k] = v;\n                            } else {\n                                delete value[k];\n                            }\n                        }\n                    }\n                }\n                return reviver.call(holder, key, value);\n            }\n\n\n// Parsing happens in four stages. In the first stage, we replace certain\n// Unicode characters with escape sequences. JavaScript handles many characters\n// incorrectly, either silently deleting them, or treating them as line endings.\n\n            text = String(text);\n            cx.lastIndex = 0;\n            if (cx.test(text)) {\n                text = text.replace(cx, function (a) {\n                    return '\\\\u' +\n                        ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n                });\n            }\n\n// In the second stage, we run the text against regular expressions that look\n// for non-JSON patterns. We are especially concerned with '()' and 'new'\n// because they can cause invocation, and '=' because it can cause mutation.\n// But just to be safe, we want to reject all unexpected forms.\n\n// We split the second stage into 4 regexp operations in order to work around\n// crippling inefficiencies in IE's and Safari's regexp engines. First we\n// replace the JSON backslash pairs with '@' (a non-JSON character). Second, we\n// replace all simple value tokens with ']' characters. Third, we delete all\n// open brackets that follow a colon or comma or that begin the text. Finally,\n// we look to see that the remaining characters are only whitespace or ']' or\n// ',' or ':' or '{' or '}'. If that is so, then the text is safe for eval.\n\n            if (/^[\\],:{}\\s]*$/\n                    .test(text.replace(/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@')\n                        .replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']')\n                        .replace(/(?:^|:|,)(?:\\s*\\[)+/g, ''))) {\n\n// In the third stage we use the eval function to compile the text into a\n// JavaScript structure. The '{' operator is subject to a syntactic ambiguity\n// in JavaScript: it can begin a block or an object literal. We wrap the text\n// in parens to eliminate the ambiguity.\n\n                j = eval('(' + text + ')');\n\n// In the optional fourth stage, we recursively walk the new structure, passing\n// each name/value pair to a reviver function for possible transformation.\n\n                return typeof reviver === 'function'\n                    ? walk({'': j}, '')\n                    : j;\n            }\n\n// If the text is not JSON parseable, then a SyntaxError is thrown.\n\n            throw new SyntaxError('JSON.parse');\n        };\n    }\n}());/**\n * History.js jQuery Adapter\n * @author Benjamin Arthur Lupton <contact@balupton.com>\n * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>\n * @license New BSD License <http://creativecommons.org/licenses/BSD/>\n */\n\n// Closure\n(function(window,undefined){\n\t\"use strict\";\n\n\t// Localise Globals\n\tvar\n\t\tHistory = window.History = window.History||{},\n\t\tjQuery = window.jQuery;\n\n\t// Check Existence\n\tif ( typeof History.Adapter !== 'undefined' ) {\n\t\tthrow new Error('History.js Adapter has already been loaded...');\n\t}\n\n\t// Add the Adapter\n\tHistory.Adapter = {\n\t\t/**\n\t\t * History.Adapter.bind(el,event,callback)\n\t\t * @param {Element|string} el\n\t\t * @param {string} event - custom and standard events\n\t\t * @param {function} callback\n\t\t * @return {void}\n\t\t */\n\t\tbind: function(el,event,callback){\n\t\t\tjQuery(el).bind(event,callback);\n\t\t},\n\n\t\t/**\n\t\t * History.Adapter.trigger(el,event)\n\t\t * @param {Element|string} el\n\t\t * @param {string} event - custom and standard events\n\t\t * @param {Object=} extra - a object of extra event data (optional)\n\t\t * @return {void}\n\t\t */\n\t\ttrigger: function(el,event,extra){\n\t\t\tjQuery(el).trigger(event,extra);\n\t\t},\n\n\t\t/**\n\t\t * History.Adapter.extractEventData(key,event,extra)\n\t\t * @param {string} key - key for the event data to extract\n\t\t * @param {string} event - custom and standard events\n\t\t * @param {Object=} extra - a object of extra event data (optional)\n\t\t * @return {mixed}\n\t\t */\n\t\textractEventData: function(key,event,extra){\n\t\t\t// jQuery Native then jQuery Custom\n\t\t\tvar result = (event && event.originalEvent && event.originalEvent[key]) || (extra && extra[key]) || undefined;\n\n\t\t\t// Return\n\t\t\treturn result;\n\t\t},\n\n\t\t/**\n\t\t * History.Adapter.onDomLoad(callback)\n\t\t * @param {function} callback\n\t\t * @return {void}\n\t\t */\n\t\tonDomLoad: function(callback) {\n\t\t\tjQuery(callback);\n\t\t}\n\t};\n\n\t// Try and Initialise History\n\tif ( typeof History.init !== 'undefined' ) {\n\t\tHistory.init();\n\t}\n\n})(window);\n\n/**\n * History.js HTML4 Support\n * Depends on the HTML5 Support\n * @author Benjamin Arthur Lupton <contact@balupton.com>\n * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>\n * @license New BSD License <http://creativecommons.org/licenses/BSD/>\n */\n\n(function(window,undefined){\n\t\"use strict\";\n\n\t// ========================================================================\n\t// Initialise\n\n\t// Localise Globals\n\tvar\n\t\tdocument = window.document, // Make sure we are using the correct document\n\t\tsetTimeout = window.setTimeout||setTimeout,\n\t\tclearTimeout = window.clearTimeout||clearTimeout,\n\t\tsetInterval = window.setInterval||setInterval,\n\t\tHistory = window.History = window.History||{}; // Public History Object\n\n\t// Check Existence\n\tif ( typeof History.initHtml4 !== 'undefined' ) {\n\t\tthrow new Error('History.js HTML4 Support has already been loaded...');\n\t}\n\n\n\t// ========================================================================\n\t// Initialise HTML4 Support\n\n\t// Initialise HTML4 Support\n\tHistory.initHtml4 = function(){\n\t\t// Initialise\n\t\tif ( typeof History.initHtml4.initialized !== 'undefined' ) {\n\t\t\t// Already Loaded\n\t\t\treturn false;\n\t\t}\n\t\telse {\n\t\t\tHistory.initHtml4.initialized = true;\n\t\t}\n\n\n\t\t// ====================================================================\n\t\t// Properties\n\n\t\t/**\n\t\t * History.enabled\n\t\t * Is History enabled?\n\t\t */\n\t\tHistory.enabled = true;\n\n\n\t\t// ====================================================================\n\t\t// Hash Storage\n\n\t\t/**\n\t\t * History.savedHashes\n\t\t * Store the hashes in an array\n\t\t */\n\t\tHistory.savedHashes = [];\n\n\t\t/**\n\t\t * History.isLastHash(newHash)\n\t\t * Checks if the hash is the last hash\n\t\t * @param {string} newHash\n\t\t * @return {boolean} true\n\t\t */\n\t\tHistory.isLastHash = function(newHash){\n\t\t\t// Prepare\n\t\t\tvar oldHash = History.getHashByIndex(),\n\t\t\t\tisLast;\n\n\t\t\t// Check\n\t\t\tisLast = newHash === oldHash;\n\n\t\t\t// Return isLast\n\t\t\treturn isLast;\n\t\t};\n\n\t\t/**\n\t\t * History.isHashEqual(newHash, oldHash)\n\t\t * Checks to see if two hashes are functionally equal\n\t\t * @param {string} newHash\n\t\t * @param {string} oldHash\n\t\t * @return {boolean} true\n\t\t */\n\t\tHistory.isHashEqual = function(newHash, oldHash){\n\t\t\tnewHash = encodeURIComponent(newHash).replace(/%25/g, \"%\");\n\t\t\toldHash = encodeURIComponent(oldHash).replace(/%25/g, \"%\");\n\t\t\treturn newHash === oldHash;\n\t\t};\n\n\t\t/**\n\t\t * History.saveHash(newHash)\n\t\t * Push a Hash\n\t\t * @param {string} newHash\n\t\t * @return {boolean} true\n\t\t */\n\t\tHistory.saveHash = function(newHash){\n\t\t\t// Check Hash\n\t\t\tif ( History.isLastHash(newHash) ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Push the Hash\n\t\t\tHistory.savedHashes.push(newHash);\n\n\t\t\t// Return true\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * History.getHashByIndex()\n\t\t * Gets a hash by the index\n\t\t * @param {integer} index\n\t\t * @return {string}\n\t\t */\n\t\tHistory.getHashByIndex = function(index){\n\t\t\t// Prepare\n\t\t\tvar hash = null;\n\n\t\t\t// Handle\n\t\t\tif ( typeof index === 'undefined' ) {\n\t\t\t\t// Get the last inserted\n\t\t\t\thash = History.savedHashes[History.savedHashes.length-1];\n\t\t\t}\n\t\t\telse if ( index < 0 ) {\n\t\t\t\t// Get from the end\n\t\t\t\thash = History.savedHashes[History.savedHashes.length+index];\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Get from the beginning\n\t\t\t\thash = History.savedHashes[index];\n\t\t\t}\n\n\t\t\t// Return hash\n\t\t\treturn hash;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// Discarded States\n\n\t\t/**\n\t\t * History.discardedHashes\n\t\t * A hashed array of discarded hashes\n\t\t */\n\t\tHistory.discardedHashes = {};\n\n\t\t/**\n\t\t * History.discardedStates\n\t\t * A hashed array of discarded states\n\t\t */\n\t\tHistory.discardedStates = {};\n\n\t\t/**\n\t\t * History.discardState(State)\n\t\t * Discards the state by ignoring it through History\n\t\t * @param {object} State\n\t\t * @return {true}\n\t\t */\n\t\tHistory.discardState = function(discardedState,forwardState,backState){\n\t\t\t//History.debug('History.discardState', arguments);\n\t\t\t// Prepare\n\t\t\tvar discardedStateHash = History.getHashByState(discardedState),\n\t\t\t\tdiscardObject;\n\n\t\t\t// Create Discard Object\n\t\t\tdiscardObject = {\n\t\t\t\t'discardedState': discardedState,\n\t\t\t\t'backState': backState,\n\t\t\t\t'forwardState': forwardState\n\t\t\t};\n\n\t\t\t// Add to DiscardedStates\n\t\t\tHistory.discardedStates[discardedStateHash] = discardObject;\n\n\t\t\t// Return true\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * History.discardHash(hash)\n\t\t * Discards the hash by ignoring it through History\n\t\t * @param {string} hash\n\t\t * @return {true}\n\t\t */\n\t\tHistory.discardHash = function(discardedHash,forwardState,backState){\n\t\t\t//History.debug('History.discardState', arguments);\n\t\t\t// Create Discard Object\n\t\t\tvar discardObject = {\n\t\t\t\t'discardedHash': discardedHash,\n\t\t\t\t'backState': backState,\n\t\t\t\t'forwardState': forwardState\n\t\t\t};\n\n\t\t\t// Add to discardedHash\n\t\t\tHistory.discardedHashes[discardedHash] = discardObject;\n\n\t\t\t// Return true\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * History.discardedState(State)\n\t\t * Checks to see if the state is discarded\n\t\t * @param {object} State\n\t\t * @return {bool}\n\t\t */\n\t\tHistory.discardedState = function(State){\n\t\t\t// Prepare\n\t\t\tvar StateHash = History.getHashByState(State),\n\t\t\t\tdiscarded;\n\n\t\t\t// Check\n\t\t\tdiscarded = History.discardedStates[StateHash]||false;\n\n\t\t\t// Return true\n\t\t\treturn discarded;\n\t\t};\n\n\t\t/**\n\t\t * History.discardedHash(hash)\n\t\t * Checks to see if the state is discarded\n\t\t * @param {string} State\n\t\t * @return {bool}\n\t\t */\n\t\tHistory.discardedHash = function(hash){\n\t\t\t// Check\n\t\t\tvar discarded = History.discardedHashes[hash]||false;\n\n\t\t\t// Return true\n\t\t\treturn discarded;\n\t\t};\n\n\t\t/**\n\t\t * History.recycleState(State)\n\t\t * Allows a discarded state to be used again\n\t\t * @param {object} data\n\t\t * @param {string} title\n\t\t * @param {string} url\n\t\t * @return {true}\n\t\t */\n\t\tHistory.recycleState = function(State){\n\t\t\t//History.debug('History.recycleState', arguments);\n\t\t\t// Prepare\n\t\t\tvar StateHash = History.getHashByState(State);\n\n\t\t\t// Remove from DiscardedStates\n\t\t\tif ( History.discardedState(State) ) {\n\t\t\t\tdelete History.discardedStates[StateHash];\n\t\t\t}\n\n\t\t\t// Return true\n\t\t\treturn true;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// HTML4 HashChange Support\n\n\t\tif ( History.emulated.hashChange ) {\n\t\t\t/*\n\t\t\t * We must emulate the HTML4 HashChange Support by manually checking for hash changes\n\t\t\t */\n\n\t\t\t/**\n\t\t\t * History.hashChangeInit()\n\t\t\t * Init the HashChange Emulation\n\t\t\t */\n\t\t\tHistory.hashChangeInit = function(){\n\t\t\t\t// Define our Checker Function\n\t\t\t\tHistory.checkerFunction = null;\n\n\t\t\t\t// Define some variables that will help in our checker function\n\t\t\t\tvar lastDocumentHash = '',\n\t\t\t\t\tiframeId, iframe,\n\t\t\t\t\tlastIframeHash, checkerRunning,\n\t\t\t\t\tstartedWithHash = Boolean(History.getHash());\n\n\t\t\t\t// Handle depending on the browser\n\t\t\t\tif ( History.isInternetExplorer() ) {\n\t\t\t\t\t// IE6 and IE7\n\t\t\t\t\t// We need to use an iframe to emulate the back and forward buttons\n\n\t\t\t\t\t// Create iFrame\n\t\t\t\t\tiframeId = 'historyjs-iframe';\n\t\t\t\t\tiframe = document.createElement('iframe');\n\n\t\t\t\t\t// Adjust iFarme\n\t\t\t\t\t// IE 6 requires iframe to have a src on HTTPS pages, otherwise it will throw a\n\t\t\t\t\t// \"This page contains both secure and nonsecure items\" warning.\n\t\t\t\t\tiframe.setAttribute('id', iframeId);\n\t\t\t\t\tiframe.setAttribute('src', '#');\n\t\t\t\t\tiframe.style.display = 'none';\n\n\t\t\t\t\t// Append iFrame\n\t\t\t\t\tdocument.body.appendChild(iframe);\n\n\t\t\t\t\t// Create initial history entry\n\t\t\t\t\tiframe.contentWindow.document.open();\n\t\t\t\t\tiframe.contentWindow.document.close();\n\n\t\t\t\t\t// Define some variables that will help in our checker function\n\t\t\t\t\tlastIframeHash = '';\n\t\t\t\t\tcheckerRunning = false;\n\n\t\t\t\t\t// Define the checker function\n\t\t\t\t\tHistory.checkerFunction = function(){\n\t\t\t\t\t\t// Check Running\n\t\t\t\t\t\tif ( checkerRunning ) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Update Running\n\t\t\t\t\t\tcheckerRunning = true;\n\n\t\t\t\t\t\t// Fetch\n\t\t\t\t\t\tvar\n\t\t\t\t\t\t\tdocumentHash = History.getHash(),\n\t\t\t\t\t\t\tiframeHash = History.getHash(iframe.contentWindow.document);\n\n\t\t\t\t\t\t// The Document Hash has changed (application caused)\n\t\t\t\t\t\tif ( documentHash !== lastDocumentHash ) {\n\t\t\t\t\t\t\t// Equalise\n\t\t\t\t\t\t\tlastDocumentHash = documentHash;\n\n\t\t\t\t\t\t\t// Create a history entry in the iframe\n\t\t\t\t\t\t\tif ( iframeHash !== documentHash ) {\n\t\t\t\t\t\t\t\t//History.debug('hashchange.checker: iframe hash change', 'documentHash (new):', documentHash, 'iframeHash (old):', iframeHash);\n\n\t\t\t\t\t\t\t\t// Equalise\n\t\t\t\t\t\t\t\tlastIframeHash = iframeHash = documentHash;\n\n\t\t\t\t\t\t\t\t// Create History Entry\n\t\t\t\t\t\t\t\tiframe.contentWindow.document.open();\n\t\t\t\t\t\t\t\tiframe.contentWindow.document.close();\n\n\t\t\t\t\t\t\t\t// Update the iframe's hash\n\t\t\t\t\t\t\t\tiframe.contentWindow.document.location.hash = History.escapeHash(documentHash);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Trigger Hashchange Event\n\t\t\t\t\t\t\tHistory.Adapter.trigger(window,'hashchange');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// The iFrame Hash has changed (back button caused)\n\t\t\t\t\t\telse if ( iframeHash !== lastIframeHash ) {\n\t\t\t\t\t\t\t//History.debug('hashchange.checker: iframe hash out of sync', 'iframeHash (new):', iframeHash, 'documentHash (old):', documentHash);\n\n\t\t\t\t\t\t\t// Equalise\n\t\t\t\t\t\t\tlastIframeHash = iframeHash;\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t// If there is no iframe hash that means we're at the original\n\t\t\t\t\t\t\t// iframe state.\n\t\t\t\t\t\t\t// And if there was a hash on the original request, the original\n\t\t\t\t\t\t\t// iframe state was replaced instantly, so skip this state and take\n\t\t\t\t\t\t\t// the user back to where they came from.\n\t\t\t\t\t\t\tif (startedWithHash && iframeHash === '') {\n\t\t\t\t\t\t\t\tHistory.back();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t// Update the Hash\n\t\t\t\t\t\t\t\tHistory.setHash(iframeHash,false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Reset Running\n\t\t\t\t\t\tcheckerRunning = false;\n\n\t\t\t\t\t\t// Return true\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// We are not IE\n\t\t\t\t\t// Firefox 1 or 2, Opera\n\n\t\t\t\t\t// Define the checker function\n\t\t\t\t\tHistory.checkerFunction = function(){\n\t\t\t\t\t\t// Prepare\n\t\t\t\t\t\tvar documentHash = History.getHash()||'';\n\n\t\t\t\t\t\t// The Document Hash has changed (application caused)\n\t\t\t\t\t\tif ( documentHash !== lastDocumentHash ) {\n\t\t\t\t\t\t\t// Equalise\n\t\t\t\t\t\t\tlastDocumentHash = documentHash;\n\n\t\t\t\t\t\t\t// Trigger Hashchange Event\n\t\t\t\t\t\t\tHistory.Adapter.trigger(window,'hashchange');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Return true\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\t// Apply the checker function\n\t\t\t\tHistory.intervalList.push(setInterval(History.checkerFunction, History.options.hashChangeInterval));\n\n\t\t\t\t// Done\n\t\t\t\treturn true;\n\t\t\t}; // History.hashChangeInit\n\n\t\t\t// Bind hashChangeInit\n\t\t\tHistory.Adapter.onDomLoad(History.hashChangeInit);\n\n\t\t} // History.emulated.hashChange\n\n\n\t\t// ====================================================================\n\t\t// HTML5 State Support\n\n\t\t// Non-Native pushState Implementation\n\t\tif ( History.emulated.pushState ) {\n\t\t\t/*\n\t\t\t * We must emulate the HTML5 State Management by using HTML4 HashChange\n\t\t\t */\n\n\t\t\t/**\n\t\t\t * History.onHashChange(event)\n\t\t\t * Trigger HTML5's window.onpopstate via HTML4 HashChange Support\n\t\t\t */\n\t\t\tHistory.onHashChange = function(event){\n\t\t\t\t//History.debug('History.onHashChange', arguments);\n\n\t\t\t\t// Prepare\n\t\t\t\tvar currentUrl = ((event && event.newURL) || History.getLocationHref()),\n\t\t\t\t\tcurrentHash = History.getHashByUrl(currentUrl),\n\t\t\t\t\tcurrentState = null,\n\t\t\t\t\tcurrentStateHash = null,\n\t\t\t\t\tcurrentStateHashExits = null,\n\t\t\t\t\tdiscardObject;\n\n\t\t\t\t// Check if we are the same state\n\t\t\t\tif ( History.isLastHash(currentHash) ) {\n\t\t\t\t\t// There has been no change (just the page's hash has finally propagated)\n\t\t\t\t\t//History.debug('History.onHashChange: no change');\n\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Reset the double check\n\t\t\t\tHistory.doubleCheckComplete();\n\n\t\t\t\t// Store our location for use in detecting back/forward direction\n\t\t\t\tHistory.saveHash(currentHash);\n\n\t\t\t\t// Expand Hash\n\t\t\t\tif ( currentHash && History.isTraditionalAnchor(currentHash) ) {\n\t\t\t\t\t//History.debug('History.onHashChange: traditional anchor', currentHash);\n\t\t\t\t\t// Traditional Anchor Hash\n\t\t\t\t\tHistory.Adapter.trigger(window,'anchorchange');\n\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Create State\n\t\t\t\tcurrentState = History.extractState(History.getFullUrl(currentHash||History.getLocationHref()),true);\n\n\t\t\t\t// Check if we are the same state\n\t\t\t\tif ( History.isLastSavedState(currentState) ) {\n\t\t\t\t\t//History.debug('History.onHashChange: no change');\n\t\t\t\t\t// There has been no change (just the page's hash has finally propagated)\n\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Create the state Hash\n\t\t\t\tcurrentStateHash = History.getHashByState(currentState);\n\n\t\t\t\t// Check if we are DiscardedState\n\t\t\t\tdiscardObject = History.discardedState(currentState);\n\t\t\t\tif ( discardObject ) {\n\t\t\t\t\t// Ignore this state as it has been discarded and go back to the state before it\n\t\t\t\t\tif ( History.getHashByIndex(-2) === History.getHashByState(discardObject.forwardState) ) {\n\t\t\t\t\t\t// We are going backwards\n\t\t\t\t\t\t//History.debug('History.onHashChange: go backwards');\n\t\t\t\t\t\tHistory.back(false);\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// We are going forwards\n\t\t\t\t\t\t//History.debug('History.onHashChange: go forwards');\n\t\t\t\t\t\tHistory.forward(false);\n\t\t\t\t\t}\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Push the new HTML5 State\n\t\t\t\t//History.debug('History.onHashChange: success hashchange');\n\t\t\t\tHistory.pushState(currentState.data,currentState.title,encodeURI(currentState.url),false);\n\n\t\t\t\t// End onHashChange closure\n\t\t\t\treturn true;\n\t\t\t};\n\t\t\tHistory.Adapter.bind(window,'hashchange',History.onHashChange);\n\n\t\t\t/**\n\t\t\t * History.pushState(data,title,url)\n\t\t\t * Add a new State to the history object, become it, and trigger onpopstate\n\t\t\t * We have to trigger for HTML4 compatibility\n\t\t\t * @param {object} data\n\t\t\t * @param {string} title\n\t\t\t * @param {string} url\n\t\t\t * @return {true}\n\t\t\t */\n\t\t\tHistory.pushState = function(data,title,url,queue){\n\t\t\t\t//History.debug('History.pushState: called', arguments);\n\n\t\t\t\t// We assume that the URL passed in is URI-encoded, but this makes\n\t\t\t\t// sure that it's fully URI encoded; any '%'s that are encoded are\n\t\t\t\t// converted back into '%'s\n\t\t\t\turl = encodeURI(url).replace(/%25/g, \"%\");\n\n\t\t\t\t// Check the State\n\t\t\t\tif ( History.getHashByUrl(url) ) {\n\t\t\t\t\tthrow new Error('History.js does not support states with fragment-identifiers (hashes/anchors).');\n\t\t\t\t}\n\n\t\t\t\t// Handle Queueing\n\t\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t\t// Wait + Push to Queue\n\t\t\t\t\t//History.debug('History.pushState: we must wait', arguments);\n\t\t\t\t\tHistory.pushQueue({\n\t\t\t\t\t\tscope: History,\n\t\t\t\t\t\tcallback: History.pushState,\n\t\t\t\t\t\targs: arguments,\n\t\t\t\t\t\tqueue: queue\n\t\t\t\t\t});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Make Busy\n\t\t\t\tHistory.busy(true);\n\n\t\t\t\t// Fetch the State Object\n\t\t\t\tvar newState = History.createStateObject(data,title,url),\n\t\t\t\t\tnewStateHash = History.getHashByState(newState),\n\t\t\t\t\toldState = History.getState(false),\n\t\t\t\t\toldStateHash = History.getHashByState(oldState),\n\t\t\t\t\thtml4Hash = History.getHash(),\n\t\t\t\t\twasExpected = History.expectedStateId == newState.id;\n\n\t\t\t\t// Store the newState\n\t\t\t\tHistory.storeState(newState);\n\t\t\t\tHistory.expectedStateId = newState.id;\n\n\t\t\t\t// Recycle the State\n\t\t\t\tHistory.recycleState(newState);\n\n\t\t\t\t// Force update of the title\n\t\t\t\tHistory.setTitle(newState);\n\n\t\t\t\t// Check if we are the same State\n\t\t\t\tif ( newStateHash === oldStateHash ) {\n\t\t\t\t\t//History.debug('History.pushState: no change', newStateHash);\n\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Update HTML5 State\n\t\t\t\tHistory.saveState(newState);\n\n\t\t\t\t// Fire HTML5 Event\n\t\t\t\tif(!wasExpected)\n\t\t\t\t\tHistory.Adapter.trigger(window,'statechange');\n\n\t\t\t\t// Update HTML4 Hash\n\t\t\t\tif ( !History.isHashEqual(newStateHash, html4Hash) && !History.isHashEqual(newStateHash, History.getShortUrl(History.getLocationHref())) ) {\n\t\t\t\t\tHistory.setHash(newStateHash,false);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tHistory.busy(false);\n\n\t\t\t\t// End pushState closure\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.replaceState(data,title,url)\n\t\t\t * Replace the State and trigger onpopstate\n\t\t\t * We have to trigger for HTML4 compatibility\n\t\t\t * @param {object} data\n\t\t\t * @param {string} title\n\t\t\t * @param {string} url\n\t\t\t * @return {true}\n\t\t\t */\n\t\t\tHistory.replaceState = function(data,title,url,queue){\n\t\t\t\t//History.debug('History.replaceState: called', arguments);\n\n\t\t\t\t// We assume that the URL passed in is URI-encoded, but this makes\n\t\t\t\t// sure that it's fully URI encoded; any '%'s that are encoded are\n\t\t\t\t// converted back into '%'s\n\t\t\t\turl = encodeURI(url).replace(/%25/g, \"%\");\n\n\t\t\t\t// Check the State\n\t\t\t\tif ( History.getHashByUrl(url) ) {\n\t\t\t\t\tthrow new Error('History.js does not support states with fragment-identifiers (hashes/anchors).');\n\t\t\t\t}\n\n\t\t\t\t// Handle Queueing\n\t\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t\t// Wait + Push to Queue\n\t\t\t\t\t//History.debug('History.replaceState: we must wait', arguments);\n\t\t\t\t\tHistory.pushQueue({\n\t\t\t\t\t\tscope: History,\n\t\t\t\t\t\tcallback: History.replaceState,\n\t\t\t\t\t\targs: arguments,\n\t\t\t\t\t\tqueue: queue\n\t\t\t\t\t});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Make Busy\n\t\t\t\tHistory.busy(true);\n\n\t\t\t\t// Fetch the State Objects\n\t\t\t\tvar newState        = History.createStateObject(data,title,url),\n\t\t\t\t\tnewStateHash = History.getHashByState(newState),\n\t\t\t\t\toldState        = History.getState(false),\n\t\t\t\t\toldStateHash = History.getHashByState(oldState),\n\t\t\t\t\tpreviousState   = History.getStateByIndex(-2);\n\n\t\t\t\t// Discard Old State\n\t\t\t\tHistory.discardState(oldState,newState,previousState);\n\n\t\t\t\t// If the url hasn't changed, just store and save the state\n\t\t\t\t// and fire a statechange event to be consistent with the\n\t\t\t\t// html 5 api\n\t\t\t\tif ( newStateHash === oldStateHash ) {\n\t\t\t\t\t// Store the newState\n\t\t\t\t\tHistory.storeState(newState);\n\t\t\t\t\tHistory.expectedStateId = newState.id;\n\t\n\t\t\t\t\t// Recycle the State\n\t\t\t\t\tHistory.recycleState(newState);\n\t\n\t\t\t\t\t// Force update of the title\n\t\t\t\t\tHistory.setTitle(newState);\n\t\t\t\t\t\n\t\t\t\t\t// Update HTML5 State\n\t\t\t\t\tHistory.saveState(newState);\n\n\t\t\t\t\t// Fire HTML5 Event\n\t\t\t\t\t//History.debug('History.pushState: trigger popstate');\n\t\t\t\t\tHistory.Adapter.trigger(window,'statechange');\n\t\t\t\t\tHistory.busy(false);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Alias to PushState\n\t\t\t\t\tHistory.pushState(newState.data,newState.title,newState.url,false);\n\t\t\t\t}\n\n\t\t\t\t// End replaceState closure\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t} // History.emulated.pushState\n\n\n\n\t\t// ====================================================================\n\t\t// Initialise\n\n\t\t// Non-Native pushState Implementation\n\t\tif ( History.emulated.pushState ) {\n\t\t\t/**\n\t\t\t * Ensure initial state is handled correctly\n\t\t\t */\n\t\t\tif ( History.getHash() && !History.emulated.hashChange ) {\n\t\t\t\tHistory.Adapter.onDomLoad(function(){\n\t\t\t\t\tHistory.Adapter.trigger(window,'hashchange');\n\t\t\t\t});\n\t\t\t}\n\n\t\t} // History.emulated.pushState\n\n\t}; // History.initHtml4\n\n\t// Try to Initialise History\n\tif ( typeof History.init !== 'undefined' ) {\n\t\tHistory.init();\n\t}\n\n})(window);\n/**\n * History.js Core\n * @author Benjamin Arthur Lupton <contact@balupton.com>\n * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>\n * @license New BSD License <http://creativecommons.org/licenses/BSD/>\n */\n\n(function(window,undefined){\n\t\"use strict\";\n\n\t// ========================================================================\n\t// Initialise\n\n\t// Localise Globals\n\tvar\n\t\tconsole = window.console||undefined, // Prevent a JSLint complain\n\t\tdocument = window.document, // Make sure we are using the correct document\n\t\tnavigator = window.navigator, // Make sure we are using the correct navigator\n\t\tsessionStorage = window.sessionStorage||false, // sessionStorage\n\t\tsetTimeout = window.setTimeout,\n\t\tclearTimeout = window.clearTimeout,\n\t\tsetInterval = window.setInterval,\n\t\tclearInterval = window.clearInterval,\n\t\tJSON = window.JSON,\n\t\talert = window.alert,\n\t\tHistory = window.History = window.History||{}, // Public History Object\n\t\thistory = window.history; // Old History Object\n\n\ttry {\n\t\tsessionStorage.setItem('TEST', '1');\n\t\tsessionStorage.removeItem('TEST');\n\t} catch(e) {\n\t\tsessionStorage = false;\n\t}\n\n\t// MooTools Compatibility\n\tJSON.stringify = JSON.stringify||JSON.encode;\n\tJSON.parse = JSON.parse||JSON.decode;\n\n\t// Check Existence\n\tif ( typeof History.init !== 'undefined' ) {\n\t\tthrow new Error('History.js Core has already been loaded...');\n\t}\n\n\t// Initialise History\n\tHistory.init = function(options){\n\t\t// Check Load Status of Adapter\n\t\tif ( typeof History.Adapter === 'undefined' ) {\n\t\t\treturn false;\n\t\t}\n\n\t\t// Check Load Status of Core\n\t\tif ( typeof History.initCore !== 'undefined' ) {\n\t\t\tHistory.initCore();\n\t\t}\n\n\t\t// Check Load Status of HTML4 Support\n\t\tif ( typeof History.initHtml4 !== 'undefined' ) {\n\t\t\tHistory.initHtml4();\n\t\t}\n\n\t\t// Return true\n\t\treturn true;\n\t};\n\n\n\t// ========================================================================\n\t// Initialise Core\n\n\t// Initialise Core\n\tHistory.initCore = function(options){\n\t\t// Initialise\n\t\tif ( typeof History.initCore.initialized !== 'undefined' ) {\n\t\t\t// Already Loaded\n\t\t\treturn false;\n\t\t}\n\t\telse {\n\t\t\tHistory.initCore.initialized = true;\n\t\t}\n\n\n\t\t// ====================================================================\n\t\t// Options\n\n\t\t/**\n\t\t * History.options\n\t\t * Configurable options\n\t\t */\n\t\tHistory.options = History.options||{};\n\n\t\t/**\n\t\t * History.options.hashChangeInterval\n\t\t * How long should the interval be before hashchange checks\n\t\t */\n\t\tHistory.options.hashChangeInterval = History.options.hashChangeInterval || 100;\n\n\t\t/**\n\t\t * History.options.safariPollInterval\n\t\t * How long should the interval be before safari poll checks\n\t\t */\n\t\tHistory.options.safariPollInterval = History.options.safariPollInterval || 500;\n\n\t\t/**\n\t\t * History.options.doubleCheckInterval\n\t\t * How long should the interval be before we perform a double check\n\t\t */\n\t\tHistory.options.doubleCheckInterval = History.options.doubleCheckInterval || 500;\n\n\t\t/**\n\t\t * History.options.disableSuid\n\t\t * Force History not to append suid\n\t\t */\n\t\tHistory.options.disableSuid = History.options.disableSuid || false;\n\n\t\t/**\n\t\t * History.options.storeInterval\n\t\t * How long should we wait between store calls\n\t\t */\n\t\tHistory.options.storeInterval = History.options.storeInterval || 1000;\n\n\t\t/**\n\t\t * History.options.busyDelay\n\t\t * How long should we wait between busy events\n\t\t */\n\t\tHistory.options.busyDelay = History.options.busyDelay || 250;\n\n\t\t/**\n\t\t * History.options.debug\n\t\t * If true will enable debug messages to be logged\n\t\t */\n\t\tHistory.options.debug = History.options.debug || false;\n\n\t\t/**\n\t\t * History.options.initialTitle\n\t\t * What is the title of the initial state\n\t\t */\n\t\tHistory.options.initialTitle = History.options.initialTitle || document.title;\n\n\t\t/**\n\t\t * History.options.html4Mode\n\t\t * If true, will force HTMl4 mode (hashtags)\n\t\t */\n\t\tHistory.options.html4Mode = History.options.html4Mode || false;\n\n\t\t/**\n\t\t * History.options.delayInit\n\t\t * Want to override default options and call init manually.\n\t\t */\n\t\tHistory.options.delayInit = History.options.delayInit || false;\n\n\n\t\t// ====================================================================\n\t\t// Interval record\n\n\t\t/**\n\t\t * History.intervalList\n\t\t * List of intervals set, to be cleared when document is unloaded.\n\t\t */\n\t\tHistory.intervalList = [];\n\n\t\t/**\n\t\t * History.clearAllIntervals\n\t\t * Clears all setInterval instances.\n\t\t */\n\t\tHistory.clearAllIntervals = function(){\n\t\t\tvar i, il = History.intervalList;\n\t\t\tif (typeof il !== \"undefined\" && il !== null) {\n\t\t\t\tfor (i = 0; i < il.length; i++) {\n\t\t\t\t\tclearInterval(il[i]);\n\t\t\t\t}\n\t\t\t\tHistory.intervalList = null;\n\t\t\t}\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// Debug\n\n\t\t/**\n\t\t * History.debug(message,...)\n\t\t * Logs the passed arguments if debug enabled\n\t\t */\n\t\tHistory.debug = function(){\n\t\t\tif ( (History.options.debug||false) ) {\n\t\t\t\tHistory.log.apply(History,arguments);\n\t\t\t}\n\t\t};\n\n\t\t/**\n\t\t * History.log(message,...)\n\t\t * Logs the passed arguments\n\t\t */\n\t\tHistory.log = function(){\n\t\t\t// Prepare\n\t\t\tvar\n\t\t\t\tconsoleExists = !(typeof console === 'undefined' || typeof console.log === 'undefined' || typeof console.log.apply === 'undefined'),\n\t\t\t\ttextarea = document.getElementById('log'),\n\t\t\t\tmessage,\n\t\t\t\ti,n,\n\t\t\t\targs,arg\n\t\t\t\t;\n\n\t\t\t// Write to Console\n\t\t\tif ( consoleExists ) {\n\t\t\t\targs = Array.prototype.slice.call(arguments);\n\t\t\t\tmessage = args.shift();\n\t\t\t\tif ( typeof console.debug !== 'undefined' ) {\n\t\t\t\t\tconsole.debug.apply(console,[message,args]);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconsole.log.apply(console,[message,args]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tmessage = (\"\\n\"+arguments[0]+\"\\n\");\n\t\t\t}\n\n\t\t\t// Write to log\n\t\t\tfor ( i=1,n=arguments.length; i<n; ++i ) {\n\t\t\t\targ = arguments[i];\n\t\t\t\tif ( typeof arg === 'object' && typeof JSON !== 'undefined' ) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\targ = JSON.stringify(arg);\n\t\t\t\t\t}\n\t\t\t\t\tcatch ( Exception ) {\n\t\t\t\t\t\t// Recursive Object\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tmessage += \"\\n\"+arg+\"\\n\";\n\t\t\t}\n\n\t\t\t// Textarea\n\t\t\tif ( textarea ) {\n\t\t\t\ttextarea.value += message+\"\\n-----\\n\";\n\t\t\t\ttextarea.scrollTop = textarea.scrollHeight - textarea.clientHeight;\n\t\t\t}\n\t\t\t// No Textarea, No Console\n\t\t\telse if ( !consoleExists ) {\n\t\t\t\talert(message);\n\t\t\t}\n\n\t\t\t// Return true\n\t\t\treturn true;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// Emulated Status\n\n\t\t/**\n\t\t * History.getInternetExplorerMajorVersion()\n\t\t * Get's the major version of Internet Explorer\n\t\t * @return {integer}\n\t\t * @license Public Domain\n\t\t * @author Benjamin Arthur Lupton <contact@balupton.com>\n\t\t * @author James Padolsey <https://gist.github.com/527683>\n\t\t */\n\t\tHistory.getInternetExplorerMajorVersion = function(){\n\t\t\tvar result = History.getInternetExplorerMajorVersion.cached =\n\t\t\t\t\t(typeof History.getInternetExplorerMajorVersion.cached !== 'undefined')\n\t\t\t\t?\tHistory.getInternetExplorerMajorVersion.cached\n\t\t\t\t:\t(function(){\n\t\t\t\t\t\tvar v = 3,\n\t\t\t\t\t\t\t\tdiv = document.createElement('div'),\n\t\t\t\t\t\t\t\tall = div.getElementsByTagName('i');\n\t\t\t\t\t\twhile ( (div.innerHTML = '<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->') && all[0] ) {}\n\t\t\t\t\t\treturn (v > 4) ? v : false;\n\t\t\t\t\t})()\n\t\t\t\t;\n\t\t\treturn result;\n\t\t};\n\n\t\t/**\n\t\t * History.isInternetExplorer()\n\t\t * Are we using Internet Explorer?\n\t\t * @return {boolean}\n\t\t * @license Public Domain\n\t\t * @author Benjamin Arthur Lupton <contact@balupton.com>\n\t\t */\n\t\tHistory.isInternetExplorer = function(){\n\t\t\tvar result =\n\t\t\t\tHistory.isInternetExplorer.cached =\n\t\t\t\t(typeof History.isInternetExplorer.cached !== 'undefined')\n\t\t\t\t\t?\tHistory.isInternetExplorer.cached\n\t\t\t\t\t:\tBoolean(History.getInternetExplorerMajorVersion())\n\t\t\t\t;\n\t\t\treturn result;\n\t\t};\n\n\t\t/**\n\t\t * History.emulated\n\t\t * Which features require emulating?\n\t\t */\n\n\t\tif (History.options.html4Mode) {\n\t\t\tHistory.emulated = {\n\t\t\t\tpushState : true,\n\t\t\t\thashChange: true\n\t\t\t};\n\t\t}\n\n\t\telse {\n\n\t\t\tHistory.emulated = {\n\t\t\t\tpushState: !Boolean(\n\t\t\t\t\twindow.history && window.history.pushState && window.history.replaceState\n\t\t\t\t\t&& !(\n\t\t\t\t\t\t(/ Mobile\\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i).test(navigator.userAgent) /* disable for versions of iOS before version 4.3 (8F190) */\n\t\t\t\t\t\t|| (/AppleWebKit\\/5([0-2]|3[0-2])/i).test(navigator.userAgent) /* disable for the mercury iOS browser, or at least older versions of the webkit engine */\n\t\t\t\t\t)\n\t\t\t\t),\n\t\t\t\thashChange: Boolean(\n\t\t\t\t\t!(('onhashchange' in window) || ('onhashchange' in document))\n\t\t\t\t\t||\n\t\t\t\t\t(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 8)\n\t\t\t\t)\n\t\t\t};\n\t\t}\n\n\t\t/**\n\t\t * History.enabled\n\t\t * Is History enabled?\n\t\t */\n\t\tHistory.enabled = !History.emulated.pushState;\n\n\t\t/**\n\t\t * History.bugs\n\t\t * Which bugs are present\n\t\t */\n\t\tHistory.bugs = {\n\t\t\t/**\n\t\t\t * Safari 5 and Safari iOS 4 fail to return to the correct state once a hash is replaced by a `replaceState` call\n\t\t\t * https://bugs.webkit.org/show_bug.cgi?id=56249\n\t\t\t */\n\t\t\tsetHash: Boolean(!History.emulated.pushState && navigator.vendor === 'Apple Computer, Inc.' && /AppleWebKit\\/5([0-2]|3[0-3])/.test(navigator.userAgent)),\n\n\t\t\t/**\n\t\t\t * Safari 5 and Safari iOS 4 sometimes fail to apply the state change under busy conditions\n\t\t\t * https://bugs.webkit.org/show_bug.cgi?id=42940\n\t\t\t */\n\t\t\tsafariPoll: Boolean(!History.emulated.pushState && navigator.vendor === 'Apple Computer, Inc.' && /AppleWebKit\\/5([0-2]|3[0-3])/.test(navigator.userAgent)),\n\n\t\t\t/**\n\t\t\t * MSIE 6 and 7 sometimes do not apply a hash even it was told to (requiring a second call to the apply function)\n\t\t\t */\n\t\t\tieDoubleCheck: Boolean(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 8),\n\n\t\t\t/**\n\t\t\t * MSIE 6 requires the entire hash to be encoded for the hashes to trigger the onHashChange event\n\t\t\t */\n\t\t\thashEscape: Boolean(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 7)\n\t\t};\n\n\t\t/**\n\t\t * History.isEmptyObject(obj)\n\t\t * Checks to see if the Object is Empty\n\t\t * @param {Object} obj\n\t\t * @return {boolean}\n\t\t */\n\t\tHistory.isEmptyObject = function(obj) {\n\t\t\tfor ( var name in obj ) {\n\t\t\t\tif ( obj.hasOwnProperty(name) ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * History.cloneObject(obj)\n\t\t * Clones a object and eliminate all references to the original contexts\n\t\t * @param {Object} obj\n\t\t * @return {Object}\n\t\t */\n\t\tHistory.cloneObject = function(obj) {\n\t\t\tvar hash,newObj;\n\t\t\tif ( obj ) {\n\t\t\t\thash = JSON.stringify(obj);\n\t\t\t\tnewObj = JSON.parse(hash);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tnewObj = {};\n\t\t\t}\n\t\t\treturn newObj;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// URL Helpers\n\n\t\t/**\n\t\t * History.getRootUrl()\n\t\t * Turns \"http://mysite.com/dir/page.html?asd\" into \"http://mysite.com\"\n\t\t * @return {String} rootUrl\n\t\t */\n\t\tHistory.getRootUrl = function(){\n\t\t\t// Create\n\t\t\tvar rootUrl = document.location.protocol+'//'+(document.location.hostname||document.location.host);\n\t\t\tif ( document.location.port||false ) {\n\t\t\t\trootUrl += ':'+document.location.port;\n\t\t\t}\n\t\t\trootUrl += '/';\n\n\t\t\t// Return\n\t\t\treturn rootUrl;\n\t\t};\n\n\t\t/**\n\t\t * History.getBaseHref()\n\t\t * Fetches the `href` attribute of the `<base href=\"...\">` element if it exists\n\t\t * @return {String} baseHref\n\t\t */\n\t\tHistory.getBaseHref = function(){\n\t\t\t// Create\n\t\t\tvar\n\t\t\t\tbaseElements = document.getElementsByTagName('base'),\n\t\t\t\tbaseElement = null,\n\t\t\t\tbaseHref = '';\n\n\t\t\t// Test for Base Element\n\t\t\tif ( baseElements.length === 1 ) {\n\t\t\t\t// Prepare for Base Element\n\t\t\t\tbaseElement = baseElements[0];\n\t\t\t\tbaseHref = baseElement.href.replace(/[^\\/]+$/,'');\n\t\t\t}\n\n\t\t\t// Adjust trailing slash\n\t\t\tbaseHref = baseHref.replace(/\\/+$/,'');\n\t\t\tif ( baseHref ) baseHref += '/';\n\n\t\t\t// Return\n\t\t\treturn baseHref;\n\t\t};\n\n\t\t/**\n\t\t * History.getBaseUrl()\n\t\t * Fetches the baseHref or basePageUrl or rootUrl (whichever one exists first)\n\t\t * @return {String} baseUrl\n\t\t */\n\t\tHistory.getBaseUrl = function(){\n\t\t\t// Create\n\t\t\tvar baseUrl = History.getBaseHref()||History.getBasePageUrl()||History.getRootUrl();\n\n\t\t\t// Return\n\t\t\treturn baseUrl;\n\t\t};\n\n\t\t/**\n\t\t * History.getPageUrl()\n\t\t * Fetches the URL of the current page\n\t\t * @return {String} pageUrl\n\t\t */\n\t\tHistory.getPageUrl = function(){\n\t\t\t// Fetch\n\t\t\tvar\n\t\t\t\tState = History.getState(false,false),\n\t\t\t\tstateUrl = (State||{}).url||History.getLocationHref(),\n\t\t\t\tpageUrl;\n\n\t\t\t// Create\n\t\t\tpageUrl = stateUrl.replace(/\\/+$/,'').replace(/[^\\/]+$/,function(part,index,string){\n\t\t\t\treturn (/\\./).test(part) ? part : part+'/';\n\t\t\t});\n\n\t\t\t// Return\n\t\t\treturn pageUrl;\n\t\t};\n\n\t\t/**\n\t\t * History.getBasePageUrl()\n\t\t * Fetches the Url of the directory of the current page\n\t\t * @return {String} basePageUrl\n\t\t */\n\t\tHistory.getBasePageUrl = function(){\n\t\t\t// Create\n\t\t\tvar basePageUrl = (History.getLocationHref()).replace(/[#\\?].*/,'').replace(/[^\\/]+$/,function(part,index,string){\n\t\t\t\treturn (/[^\\/]$/).test(part) ? '' : part;\n\t\t\t}).replace(/\\/+$/,'')+'/';\n\n\t\t\t// Return\n\t\t\treturn basePageUrl;\n\t\t};\n\n\t\t/**\n\t\t * History.getFullUrl(url)\n\t\t * Ensures that we have an absolute URL and not a relative URL\n\t\t * @param {string} url\n\t\t * @param {Boolean} allowBaseHref\n\t\t * @return {string} fullUrl\n\t\t */\n\t\tHistory.getFullUrl = function(url,allowBaseHref){\n\t\t\t// Prepare\n\t\t\tvar fullUrl = url, firstChar = url.substring(0,1);\n\t\t\tallowBaseHref = (typeof allowBaseHref === 'undefined') ? true : allowBaseHref;\n\n\t\t\t// Check\n\t\t\tif ( /[a-z]+\\:\\/\\//.test(url) ) {\n\t\t\t\t// Full URL\n\t\t\t}\n\t\t\telse if ( firstChar === '/' ) {\n\t\t\t\t// Root URL\n\t\t\t\tfullUrl = History.getRootUrl()+url.replace(/^\\/+/,'');\n\t\t\t}\n\t\t\telse if ( firstChar === '#' ) {\n\t\t\t\t// Anchor URL\n\t\t\t\tfullUrl = History.getPageUrl().replace(/#.*/,'')+url;\n\t\t\t}\n\t\t\telse if ( firstChar === '?' ) {\n\t\t\t\t// Query URL\n\t\t\t\tfullUrl = History.getPageUrl().replace(/[\\?#].*/,'')+url;\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Relative URL\n\t\t\t\tif ( allowBaseHref ) {\n\t\t\t\t\tfullUrl = History.getBaseUrl()+url.replace(/^(\\.\\/)+/,'');\n\t\t\t\t} else {\n\t\t\t\t\tfullUrl = History.getBasePageUrl()+url.replace(/^(\\.\\/)+/,'');\n\t\t\t\t}\n\t\t\t\t// We have an if condition above as we do not want hashes\n\t\t\t\t// which are relative to the baseHref in our URLs\n\t\t\t\t// as if the baseHref changes, then all our bookmarks\n\t\t\t\t// would now point to different locations\n\t\t\t\t// whereas the basePageUrl will always stay the same\n\t\t\t}\n\n\t\t\t// Return\n\t\t\treturn fullUrl.replace(/\\#$/,'');\n\t\t};\n\n\t\t/**\n\t\t * History.getShortUrl(url)\n\t\t * Ensures that we have a relative URL and not a absolute URL\n\t\t * @param {string} url\n\t\t * @return {string} url\n\t\t */\n\t\tHistory.getShortUrl = function(url){\n\t\t\t// Prepare\n\t\t\tvar shortUrl = url, baseUrl = History.getBaseUrl(), rootUrl = History.getRootUrl();\n\n\t\t\t// Trim baseUrl\n\t\t\tif ( History.emulated.pushState ) {\n\t\t\t\t// We are in a if statement as when pushState is not emulated\n\t\t\t\t// The actual url these short urls are relative to can change\n\t\t\t\t// So within the same session, we the url may end up somewhere different\n\t\t\t\tshortUrl = shortUrl.replace(baseUrl,'');\n\t\t\t}\n\n\t\t\t// Trim rootUrl\n\t\t\tshortUrl = shortUrl.replace(rootUrl,'/');\n\n\t\t\t// Ensure we can still detect it as a state\n\t\t\tif ( History.isTraditionalAnchor(shortUrl) ) {\n\t\t\t\tshortUrl = './'+shortUrl;\n\t\t\t}\n\n\t\t\t// Clean It\n\t\t\tshortUrl = shortUrl.replace(/^(\\.\\/)+/g,'./').replace(/\\#$/,'');\n\n\t\t\t// Return\n\t\t\treturn shortUrl;\n\t\t};\n\n\t\t/**\n\t\t * History.getLocationHref(document)\n\t\t * Returns a normalized version of document.location.href\n\t\t * accounting for browser inconsistencies, etc.\n\t\t *\n\t\t * This URL will be URI-encoded and will include the hash\n\t\t *\n\t\t * @param {object} document\n\t\t * @return {string} url\n\t\t */\n\t\tHistory.getLocationHref = function(doc) {\n\t\t\tdoc = doc || document;\n\n\t\t\t// most of the time, this will be true\n\t\t\tif (doc.URL === doc.location.href)\n\t\t\t\treturn doc.location.href;\n\n\t\t\t// some versions of webkit URI-decode document.location.href\n\t\t\t// but they leave document.URL in an encoded state\n\t\t\tif (doc.location.href === decodeURIComponent(doc.URL))\n\t\t\t\treturn doc.URL;\n\n\t\t\t// FF 3.6 only updates document.URL when a page is reloaded\n\t\t\t// document.location.href is updated correctly\n\t\t\tif (doc.location.hash && decodeURIComponent(doc.location.href.replace(/^[^#]+/, \"\")) === doc.location.hash)\n\t\t\t\treturn doc.location.href;\n\n\t\t\tif (doc.URL.indexOf('#') == -1 && doc.location.href.indexOf('#') != -1)\n\t\t\t\treturn doc.location.href;\n\t\t\t\n\t\t\treturn doc.URL || doc.location.href;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// State Storage\n\n\t\t/**\n\t\t * History.store\n\t\t * The store for all session specific data\n\t\t */\n\t\tHistory.store = {};\n\n\t\t/**\n\t\t * History.idToState\n\t\t * 1-1: State ID to State Object\n\t\t */\n\t\tHistory.idToState = History.idToState||{};\n\n\t\t/**\n\t\t * History.stateToId\n\t\t * 1-1: State String to State ID\n\t\t */\n\t\tHistory.stateToId = History.stateToId||{};\n\n\t\t/**\n\t\t * History.urlToId\n\t\t * 1-1: State URL to State ID\n\t\t */\n\t\tHistory.urlToId = History.urlToId||{};\n\n\t\t/**\n\t\t * History.storedStates\n\t\t * Store the states in an array\n\t\t */\n\t\tHistory.storedStates = History.storedStates||[];\n\n\t\t/**\n\t\t * History.savedStates\n\t\t * Saved the states in an array\n\t\t */\n\t\tHistory.savedStates = History.savedStates||[];\n\n\t\t/**\n\t\t * History.noramlizeStore()\n\t\t * Noramlize the store by adding necessary values\n\t\t */\n\t\tHistory.normalizeStore = function(){\n\t\t\tHistory.store.idToState = History.store.idToState||{};\n\t\t\tHistory.store.urlToId = History.store.urlToId||{};\n\t\t\tHistory.store.stateToId = History.store.stateToId||{};\n\t\t};\n\n\t\t/**\n\t\t * History.getState()\n\t\t * Get an object containing the data, title and url of the current state\n\t\t * @param {Boolean} friendly\n\t\t * @param {Boolean} create\n\t\t * @return {Object} State\n\t\t */\n\t\tHistory.getState = function(friendly,create){\n\t\t\t// Prepare\n\t\t\tif ( typeof friendly === 'undefined' ) { friendly = true; }\n\t\t\tif ( typeof create === 'undefined' ) { create = true; }\n\n\t\t\t// Fetch\n\t\t\tvar State = History.getLastSavedState();\n\n\t\t\t// Create\n\t\t\tif ( !State && create ) {\n\t\t\t\tState = History.createStateObject();\n\t\t\t}\n\n\t\t\t// Adjust\n\t\t\tif ( friendly ) {\n\t\t\t\tState = History.cloneObject(State);\n\t\t\t\tState.url = State.cleanUrl||State.url;\n\t\t\t}\n\n\t\t\t// Return\n\t\t\treturn State;\n\t\t};\n\n\t\t/**\n\t\t * History.getIdByState(State)\n\t\t * Gets a ID for a State\n\t\t * @param {State} newState\n\t\t * @return {String} id\n\t\t */\n\t\tHistory.getIdByState = function(newState){\n\n\t\t\t// Fetch ID\n\t\t\tvar id = History.extractId(newState.url),\n\t\t\t\tstr;\n\n\t\t\tif ( !id ) {\n\t\t\t\t// Find ID via State String\n\t\t\t\tstr = History.getStateString(newState);\n\t\t\t\tif ( typeof History.stateToId[str] !== 'undefined' ) {\n\t\t\t\t\tid = History.stateToId[str];\n\t\t\t\t}\n\t\t\t\telse if ( typeof History.store.stateToId[str] !== 'undefined' ) {\n\t\t\t\t\tid = History.store.stateToId[str];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Generate a new ID\n\t\t\t\t\twhile ( true ) {\n\t\t\t\t\t\tid = (new Date()).getTime() + String(Math.random()).replace(/\\D/g,'');\n\t\t\t\t\t\tif ( typeof History.idToState[id] === 'undefined' && typeof History.store.idToState[id] === 'undefined' ) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Apply the new State to the ID\n\t\t\t\t\tHistory.stateToId[str] = id;\n\t\t\t\t\tHistory.idToState[id] = newState;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Return ID\n\t\t\treturn id;\n\t\t};\n\n\t\t/**\n\t\t * History.normalizeState(State)\n\t\t * Expands a State Object\n\t\t * @param {object} State\n\t\t * @return {object}\n\t\t */\n\t\tHistory.normalizeState = function(oldState){\n\t\t\t// Variables\n\t\t\tvar newState, dataNotEmpty;\n\n\t\t\t// Prepare\n\t\t\tif ( !oldState || (typeof oldState !== 'object') ) {\n\t\t\t\toldState = {};\n\t\t\t}\n\n\t\t\t// Check\n\t\t\tif ( typeof oldState.normalized !== 'undefined' ) {\n\t\t\t\treturn oldState;\n\t\t\t}\n\n\t\t\t// Adjust\n\t\t\tif ( !oldState.data || (typeof oldState.data !== 'object') ) {\n\t\t\t\toldState.data = {};\n\t\t\t}\n\n\t\t\t// ----------------------------------------------------------------\n\n\t\t\t// Create\n\t\t\tnewState = {};\n\t\t\tnewState.normalized = true;\n\t\t\tnewState.title = oldState.title||'';\n\t\t\tnewState.url = History.getFullUrl(oldState.url?oldState.url:(History.getLocationHref()));\n\t\t\tnewState.hash = History.getShortUrl(newState.url);\n\t\t\tnewState.data = History.cloneObject(oldState.data);\n\n\t\t\t// Fetch ID\n\t\t\tnewState.id = History.getIdByState(newState);\n\n\t\t\t// ----------------------------------------------------------------\n\n\t\t\t// Clean the URL\n\t\t\tnewState.cleanUrl = newState.url.replace(/\\??\\&_suid.*/,'');\n\t\t\tnewState.url = newState.cleanUrl;\n\n\t\t\t// Check to see if we have more than just a url\n\t\t\tdataNotEmpty = !History.isEmptyObject(newState.data);\n\n\t\t\t// Apply\n\t\t\tif ( (newState.title || dataNotEmpty) && History.options.disableSuid !== true ) {\n\t\t\t\t// Add ID to Hash\n\t\t\t\tnewState.hash = History.getShortUrl(newState.url).replace(/\\??\\&_suid.*/,'');\n\t\t\t\tif ( !/\\?/.test(newState.hash) ) {\n\t\t\t\t\tnewState.hash += '?';\n\t\t\t\t}\n\t\t\t\tnewState.hash += '&_suid='+newState.id;\n\t\t\t}\n\n\t\t\t// Create the Hashed URL\n\t\t\tnewState.hashedUrl = History.getFullUrl(newState.hash);\n\n\t\t\t// ----------------------------------------------------------------\n\n\t\t\t// Update the URL if we have a duplicate\n\t\t\tif ( (History.emulated.pushState || History.bugs.safariPoll) && History.hasUrlDuplicate(newState) ) {\n\t\t\t\tnewState.url = newState.hashedUrl;\n\t\t\t}\n\n\t\t\t// ----------------------------------------------------------------\n\n\t\t\t// Return\n\t\t\treturn newState;\n\t\t};\n\n\t\t/**\n\t\t * History.createStateObject(data,title,url)\n\t\t * Creates a object based on the data, title and url state params\n\t\t * @param {object} data\n\t\t * @param {string} title\n\t\t * @param {string} url\n\t\t * @return {object}\n\t\t */\n\t\tHistory.createStateObject = function(data,title,url){\n\t\t\t// Hashify\n\t\t\tvar State = {\n\t\t\t\t'data': data,\n\t\t\t\t'title': title,\n\t\t\t\t'url': url\n\t\t\t};\n\n\t\t\t// Expand the State\n\t\t\tState = History.normalizeState(State);\n\n\t\t\t// Return object\n\t\t\treturn State;\n\t\t};\n\n\t\t/**\n\t\t * History.getStateById(id)\n\t\t * Get a state by it's UID\n\t\t * @param {String} id\n\t\t */\n\t\tHistory.getStateById = function(id){\n\t\t\t// Prepare\n\t\t\tid = String(id);\n\n\t\t\t// Retrieve\n\t\t\tvar State = History.idToState[id] || History.store.idToState[id] || undefined;\n\n\t\t\t// Return State\n\t\t\treturn State;\n\t\t};\n\n\t\t/**\n\t\t * Get a State's String\n\t\t * @param {State} passedState\n\t\t */\n\t\tHistory.getStateString = function(passedState){\n\t\t\t// Prepare\n\t\t\tvar State, cleanedState, str;\n\n\t\t\t// Fetch\n\t\t\tState = History.normalizeState(passedState);\n\n\t\t\t// Clean\n\t\t\tcleanedState = {\n\t\t\t\tdata: State.data,\n\t\t\t\ttitle: passedState.title,\n\t\t\t\turl: passedState.url\n\t\t\t};\n\n\t\t\t// Fetch\n\t\t\tstr = JSON.stringify(cleanedState);\n\n\t\t\t// Return\n\t\t\treturn str;\n\t\t};\n\n\t\t/**\n\t\t * Get a State's ID\n\t\t * @param {State} passedState\n\t\t * @return {String} id\n\t\t */\n\t\tHistory.getStateId = function(passedState){\n\t\t\t// Prepare\n\t\t\tvar State, id;\n\n\t\t\t// Fetch\n\t\t\tState = History.normalizeState(passedState);\n\n\t\t\t// Fetch\n\t\t\tid = State.id;\n\n\t\t\t// Return\n\t\t\treturn id;\n\t\t};\n\n\t\t/**\n\t\t * History.getHashByState(State)\n\t\t * Creates a Hash for the State Object\n\t\t * @param {State} passedState\n\t\t * @return {String} hash\n\t\t */\n\t\tHistory.getHashByState = function(passedState){\n\t\t\t// Prepare\n\t\t\tvar State, hash;\n\n\t\t\t// Fetch\n\t\t\tState = History.normalizeState(passedState);\n\n\t\t\t// Hash\n\t\t\thash = State.hash;\n\n\t\t\t// Return\n\t\t\treturn hash;\n\t\t};\n\n\t\t/**\n\t\t * History.extractId(url_or_hash)\n\t\t * Get a State ID by it's URL or Hash\n\t\t * @param {string} url_or_hash\n\t\t * @return {string} id\n\t\t */\n\t\tHistory.extractId = function ( url_or_hash ) {\n\t\t\t// Prepare\n\t\t\tvar id,parts,url, tmp;\n\n\t\t\t// Extract\n\t\t\t\n\t\t\t// If the URL has a #, use the id from before the #\n\t\t\tif (url_or_hash.indexOf('#') != -1)\n\t\t\t{\n\t\t\t\ttmp = url_or_hash.split(\"#\")[0];\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttmp = url_or_hash;\n\t\t\t}\n\t\t\t\n\t\t\tparts = /(.*)\\&_suid=([0-9]+)$/.exec(tmp);\n\t\t\turl = parts ? (parts[1]||url_or_hash) : url_or_hash;\n\t\t\tid = parts ? String(parts[2]||'') : '';\n\n\t\t\t// Return\n\t\t\treturn id||false;\n\t\t};\n\n\t\t/**\n\t\t * History.isTraditionalAnchor\n\t\t * Checks to see if the url is a traditional anchor or not\n\t\t * @param {String} url_or_hash\n\t\t * @return {Boolean}\n\t\t */\n\t\tHistory.isTraditionalAnchor = function(url_or_hash){\n\t\t\t// Check\n\t\t\tvar isTraditional = !(/[\\/\\?\\.]/.test(url_or_hash));\n\n\t\t\t// Return\n\t\t\treturn isTraditional;\n\t\t};\n\n\t\t/**\n\t\t * History.extractState\n\t\t * Get a State by it's URL or Hash\n\t\t * @param {String} url_or_hash\n\t\t * @return {State|null}\n\t\t */\n\t\tHistory.extractState = function(url_or_hash,create){\n\t\t\t// Prepare\n\t\t\tvar State = null, id, url;\n\t\t\tcreate = create||false;\n\n\t\t\t// Fetch SUID\n\t\t\tid = History.extractId(url_or_hash);\n\t\t\tif ( id ) {\n\t\t\t\tState = History.getStateById(id);\n\t\t\t}\n\n\t\t\t// Fetch SUID returned no State\n\t\t\tif ( !State ) {\n\t\t\t\t// Fetch URL\n\t\t\t\turl = History.getFullUrl(url_or_hash);\n\n\t\t\t\t// Check URL\n\t\t\t\tid = History.getIdByUrl(url)||false;\n\t\t\t\tif ( id ) {\n\t\t\t\t\tState = History.getStateById(id);\n\t\t\t\t}\n\n\t\t\t\t// Create State\n\t\t\t\tif ( !State && create && !History.isTraditionalAnchor(url_or_hash) ) {\n\t\t\t\t\tState = History.createStateObject(null,null,url);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Return\n\t\t\treturn State;\n\t\t};\n\n\t\t/**\n\t\t * History.getIdByUrl()\n\t\t * Get a State ID by a State URL\n\t\t */\n\t\tHistory.getIdByUrl = function(url){\n\t\t\t// Fetch\n\t\t\tvar id = History.urlToId[url] || History.store.urlToId[url] || undefined;\n\n\t\t\t// Return\n\t\t\treturn id;\n\t\t};\n\n\t\t/**\n\t\t * History.getLastSavedState()\n\t\t * Get an object containing the data, title and url of the current state\n\t\t * @return {Object} State\n\t\t */\n\t\tHistory.getLastSavedState = function(){\n\t\t\treturn History.savedStates[History.savedStates.length-1]||undefined;\n\t\t};\n\n\t\t/**\n\t\t * History.getLastStoredState()\n\t\t * Get an object containing the data, title and url of the current state\n\t\t * @return {Object} State\n\t\t */\n\t\tHistory.getLastStoredState = function(){\n\t\t\treturn History.storedStates[History.storedStates.length-1]||undefined;\n\t\t};\n\n\t\t/**\n\t\t * History.hasUrlDuplicate\n\t\t * Checks if a Url will have a url conflict\n\t\t * @param {Object} newState\n\t\t * @return {Boolean} hasDuplicate\n\t\t */\n\t\tHistory.hasUrlDuplicate = function(newState) {\n\t\t\t// Prepare\n\t\t\tvar hasDuplicate = false,\n\t\t\t\toldState;\n\n\t\t\t// Fetch\n\t\t\toldState = History.extractState(newState.url);\n\n\t\t\t// Check\n\t\t\thasDuplicate = oldState && oldState.id !== newState.id;\n\n\t\t\t// Return\n\t\t\treturn hasDuplicate;\n\t\t};\n\n\t\t/**\n\t\t * History.storeState\n\t\t * Store a State\n\t\t * @param {Object} newState\n\t\t * @return {Object} newState\n\t\t */\n\t\tHistory.storeState = function(newState){\n\t\t\t// Store the State\n\t\t\tHistory.urlToId[newState.url] = newState.id;\n\n\t\t\t// Push the State\n\t\t\tHistory.storedStates.push(History.cloneObject(newState));\n\n\t\t\t// Return newState\n\t\t\treturn newState;\n\t\t};\n\n\t\t/**\n\t\t * History.isLastSavedState(newState)\n\t\t * Tests to see if the state is the last state\n\t\t * @param {Object} newState\n\t\t * @return {boolean} isLast\n\t\t */\n\t\tHistory.isLastSavedState = function(newState){\n\t\t\t// Prepare\n\t\t\tvar isLast = false,\n\t\t\t\tnewId, oldState, oldId;\n\n\t\t\t// Check\n\t\t\tif ( History.savedStates.length ) {\n\t\t\t\tnewId = newState.id;\n\t\t\t\toldState = History.getLastSavedState();\n\t\t\t\toldId = oldState.id;\n\n\t\t\t\t// Check\n\t\t\t\tisLast = (newId === oldId);\n\t\t\t}\n\n\t\t\t// Return\n\t\t\treturn isLast;\n\t\t};\n\n\t\t/**\n\t\t * History.saveState\n\t\t * Push a State\n\t\t * @param {Object} newState\n\t\t * @return {boolean} changed\n\t\t */\n\t\tHistory.saveState = function(newState){\n\t\t\t// Check Hash\n\t\t\tif ( History.isLastSavedState(newState) ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Push the State\n\t\t\tHistory.savedStates.push(History.cloneObject(newState));\n\n\t\t\t// Return true\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * History.getStateByIndex()\n\t\t * Gets a state by the index\n\t\t * @param {integer} index\n\t\t * @return {Object}\n\t\t */\n\t\tHistory.getStateByIndex = function(index){\n\t\t\t// Prepare\n\t\t\tvar State = null;\n\n\t\t\t// Handle\n\t\t\tif ( typeof index === 'undefined' ) {\n\t\t\t\t// Get the last inserted\n\t\t\t\tState = History.savedStates[History.savedStates.length-1];\n\t\t\t}\n\t\t\telse if ( index < 0 ) {\n\t\t\t\t// Get from the end\n\t\t\t\tState = History.savedStates[History.savedStates.length+index];\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Get from the beginning\n\t\t\t\tState = History.savedStates[index];\n\t\t\t}\n\n\t\t\t// Return State\n\t\t\treturn State;\n\t\t};\n\t\t\n\t\t/**\n\t\t * History.getCurrentIndex()\n\t\t * Gets the current index\n\t\t * @return (integer)\n\t\t*/\n\t\tHistory.getCurrentIndex = function(){\n\t\t\t// Prepare\n\t\t\tvar index = null;\n\t\t\t\n\t\t\t// No states saved\n\t\t\tif(History.savedStates.length < 1) {\n\t\t\t\tindex = 0;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tindex = History.savedStates.length-1;\n\t\t\t}\n\t\t\treturn index;\n\t\t};\n\n\t\t// ====================================================================\n\t\t// Hash Helpers\n\n\t\t/**\n\t\t * History.getHash()\n\t\t * @param {Location=} location\n\t\t * Gets the current document hash\n\t\t * Note: unlike location.hash, this is guaranteed to return the escaped hash in all browsers\n\t\t * @return {string}\n\t\t */\n\t\tHistory.getHash = function(doc){\n\t\t\tvar url = History.getLocationHref(doc),\n\t\t\t\thash;\n\t\t\thash = History.getHashByUrl(url);\n\t\t\treturn hash;\n\t\t};\n\n\t\t/**\n\t\t * History.unescapeHash()\n\t\t * normalize and Unescape a Hash\n\t\t * @param {String} hash\n\t\t * @return {string}\n\t\t */\n\t\tHistory.unescapeHash = function(hash){\n\t\t\t// Prepare\n\t\t\tvar result = History.normalizeHash(hash);\n\n\t\t\t// Unescape hash\n\t\t\tresult = decodeURIComponent(result);\n\n\t\t\t// Return result\n\t\t\treturn result;\n\t\t};\n\n\t\t/**\n\t\t * History.normalizeHash()\n\t\t * normalize a hash across browsers\n\t\t * @return {string}\n\t\t */\n\t\tHistory.normalizeHash = function(hash){\n\t\t\t// Prepare\n\t\t\tvar result = hash.replace(/[^#]*#/,'').replace(/#.*/, '');\n\n\t\t\t// Return result\n\t\t\treturn result;\n\t\t};\n\n\t\t/**\n\t\t * History.setHash(hash)\n\t\t * Sets the document hash\n\t\t * @param {string} hash\n\t\t * @return {History}\n\t\t */\n\t\tHistory.setHash = function(hash,queue){\n\t\t\t// Prepare\n\t\t\tvar State, pageUrl;\n\n\t\t\t// Handle Queueing\n\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t// Wait + Push to Queue\n\t\t\t\t//History.debug('History.setHash: we must wait', arguments);\n\t\t\t\tHistory.pushQueue({\n\t\t\t\t\tscope: History,\n\t\t\t\t\tcallback: History.setHash,\n\t\t\t\t\targs: arguments,\n\t\t\t\t\tqueue: queue\n\t\t\t\t});\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Log\n\t\t\t//History.debug('History.setHash: called',hash);\n\n\t\t\t// Make Busy + Continue\n\t\t\tHistory.busy(true);\n\n\t\t\t// Check if hash is a state\n\t\t\tState = History.extractState(hash,true);\n\t\t\tif ( State && !History.emulated.pushState ) {\n\t\t\t\t// Hash is a state so skip the setHash\n\t\t\t\t//History.debug('History.setHash: Hash is a state so skipping the hash set with a direct pushState call',arguments);\n\n\t\t\t\t// PushState\n\t\t\t\tHistory.pushState(State.data,State.title,State.url,false);\n\t\t\t}\n\t\t\telse if ( History.getHash() !== hash ) {\n\t\t\t\t// Hash is a proper hash, so apply it\n\n\t\t\t\t// Handle browser bugs\n\t\t\t\tif ( History.bugs.setHash ) {\n\t\t\t\t\t// Fix Safari Bug https://bugs.webkit.org/show_bug.cgi?id=56249\n\n\t\t\t\t\t// Fetch the base page\n\t\t\t\t\tpageUrl = History.getPageUrl();\n\n\t\t\t\t\t// Safari hash apply\n\t\t\t\t\tHistory.pushState(null,null,pageUrl+'#'+hash,false);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Normal hash apply\n\t\t\t\t\tdocument.location.hash = hash;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Chain\n\t\t\treturn History;\n\t\t};\n\n\t\t/**\n\t\t * History.escape()\n\t\t * normalize and Escape a Hash\n\t\t * @return {string}\n\t\t */\n\t\tHistory.escapeHash = function(hash){\n\t\t\t// Prepare\n\t\t\tvar result = History.normalizeHash(hash);\n\n\t\t\t// Escape hash\n\t\t\tresult = window.encodeURIComponent(result);\n\n\t\t\t// IE6 Escape Bug\n\t\t\tif ( !History.bugs.hashEscape ) {\n\t\t\t\t// Restore common parts\n\t\t\t\tresult = result\n\t\t\t\t\t.replace(/\\%21/g,'!')\n\t\t\t\t\t.replace(/\\%26/g,'&')\n\t\t\t\t\t.replace(/\\%3D/g,'=')\n\t\t\t\t\t.replace(/\\%3F/g,'?');\n\t\t\t}\n\n\t\t\t// Return result\n\t\t\treturn result;\n\t\t};\n\n\t\t/**\n\t\t * History.getHashByUrl(url)\n\t\t * Extracts the Hash from a URL\n\t\t * @param {string} url\n\t\t * @return {string} url\n\t\t */\n\t\tHistory.getHashByUrl = function(url){\n\t\t\t// Extract the hash\n\t\t\tvar hash = String(url)\n\t\t\t\t.replace(/([^#]*)#?([^#]*)#?(.*)/, '$2')\n\t\t\t\t;\n\n\t\t\t// Unescape hash\n\t\t\thash = History.unescapeHash(hash);\n\n\t\t\t// Return hash\n\t\t\treturn hash;\n\t\t};\n\n\t\t/**\n\t\t * History.setTitle(title)\n\t\t * Applies the title to the document\n\t\t * @param {State} newState\n\t\t * @return {Boolean}\n\t\t */\n\t\tHistory.setTitle = function(newState){\n\t\t\t// Prepare\n\t\t\tvar title = newState.title,\n\t\t\t\tfirstState;\n\n\t\t\t// Initial\n\t\t\tif ( !title ) {\n\t\t\t\tfirstState = History.getStateByIndex(0);\n\t\t\t\tif ( firstState && firstState.url === newState.url ) {\n\t\t\t\t\ttitle = firstState.title||History.options.initialTitle;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Apply\n\t\t\ttry {\n\t\t\t\tdocument.getElementsByTagName('title')[0].innerHTML = title.replace('<','&lt;').replace('>','&gt;').replace(' & ',' &amp; ');\n\t\t\t}\n\t\t\tcatch ( Exception ) { }\n\t\t\tdocument.title = title;\n\n\t\t\t// Chain\n\t\t\treturn History;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// Queueing\n\n\t\t/**\n\t\t * History.queues\n\t\t * The list of queues to use\n\t\t * First In, First Out\n\t\t */\n\t\tHistory.queues = [];\n\n\t\t/**\n\t\t * History.busy(value)\n\t\t * @param {boolean} value [optional]\n\t\t * @return {boolean} busy\n\t\t */\n\t\tHistory.busy = function(value){\n\t\t\t// Apply\n\t\t\tif ( typeof value !== 'undefined' ) {\n\t\t\t\t//History.debug('History.busy: changing ['+(History.busy.flag||false)+'] to ['+(value||false)+']', History.queues.length);\n\t\t\t\tHistory.busy.flag = value;\n\t\t\t}\n\t\t\t// Default\n\t\t\telse if ( typeof History.busy.flag === 'undefined' ) {\n\t\t\t\tHistory.busy.flag = false;\n\t\t\t}\n\n\t\t\t// Queue\n\t\t\tif ( !History.busy.flag ) {\n\t\t\t\t// Execute the next item in the queue\n\t\t\t\tclearTimeout(History.busy.timeout);\n\t\t\t\tvar fireNext = function(){\n\t\t\t\t\tvar i, queue, item;\n\t\t\t\t\tif ( History.busy.flag ) return;\n\t\t\t\t\tfor ( i=History.queues.length-1; i >= 0; --i ) {\n\t\t\t\t\t\tqueue = History.queues[i];\n\t\t\t\t\t\tif ( queue.length === 0 ) continue;\n\t\t\t\t\t\titem = queue.shift();\n\t\t\t\t\t\tHistory.fireQueueItem(item);\n\t\t\t\t\t\tHistory.busy.timeout = setTimeout(fireNext,History.options.busyDelay);\n\t\t\t\t\t}\n\t\t\t\t};\n\t\t\t\tHistory.busy.timeout = setTimeout(fireNext,History.options.busyDelay);\n\t\t\t}\n\n\t\t\t// Return\n\t\t\treturn History.busy.flag;\n\t\t};\n\n\t\t/**\n\t\t * History.busy.flag\n\t\t */\n\t\tHistory.busy.flag = false;\n\n\t\t/**\n\t\t * History.fireQueueItem(item)\n\t\t * Fire a Queue Item\n\t\t * @param {Object} item\n\t\t * @return {Mixed} result\n\t\t */\n\t\tHistory.fireQueueItem = function(item){\n\t\t\treturn item.callback.apply(item.scope||History,item.args||[]);\n\t\t};\n\n\t\t/**\n\t\t * History.pushQueue(callback,args)\n\t\t * Add an item to the queue\n\t\t * @param {Object} item [scope,callback,args,queue]\n\t\t */\n\t\tHistory.pushQueue = function(item){\n\t\t\t// Prepare the queue\n\t\t\tHistory.queues[item.queue||0] = History.queues[item.queue||0]||[];\n\n\t\t\t// Add to the queue\n\t\t\tHistory.queues[item.queue||0].push(item);\n\n\t\t\t// Chain\n\t\t\treturn History;\n\t\t};\n\n\t\t/**\n\t\t * History.queue (item,queue), (func,queue), (func), (item)\n\t\t * Either firs the item now if not busy, or adds it to the queue\n\t\t */\n\t\tHistory.queue = function(item,queue){\n\t\t\t// Prepare\n\t\t\tif ( typeof item === 'function' ) {\n\t\t\t\titem = {\n\t\t\t\t\tcallback: item\n\t\t\t\t};\n\t\t\t}\n\t\t\tif ( typeof queue !== 'undefined' ) {\n\t\t\t\titem.queue = queue;\n\t\t\t}\n\n\t\t\t// Handle\n\t\t\tif ( History.busy() ) {\n\t\t\t\tHistory.pushQueue(item);\n\t\t\t} else {\n\t\t\t\tHistory.fireQueueItem(item);\n\t\t\t}\n\n\t\t\t// Chain\n\t\t\treturn History;\n\t\t};\n\n\t\t/**\n\t\t * History.clearQueue()\n\t\t * Clears the Queue\n\t\t */\n\t\tHistory.clearQueue = function(){\n\t\t\tHistory.busy.flag = false;\n\t\t\tHistory.queues = [];\n\t\t\treturn History;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// IE Bug Fix\n\n\t\t/**\n\t\t * History.stateChanged\n\t\t * States whether or not the state has changed since the last double check was initialised\n\t\t */\n\t\tHistory.stateChanged = false;\n\n\t\t/**\n\t\t * History.doubleChecker\n\t\t * Contains the timeout used for the double checks\n\t\t */\n\t\tHistory.doubleChecker = false;\n\n\t\t/**\n\t\t * History.doubleCheckComplete()\n\t\t * Complete a double check\n\t\t * @return {History}\n\t\t */\n\t\tHistory.doubleCheckComplete = function(){\n\t\t\t// Update\n\t\t\tHistory.stateChanged = true;\n\n\t\t\t// Clear\n\t\t\tHistory.doubleCheckClear();\n\n\t\t\t// Chain\n\t\t\treturn History;\n\t\t};\n\n\t\t/**\n\t\t * History.doubleCheckClear()\n\t\t * Clear a double check\n\t\t * @return {History}\n\t\t */\n\t\tHistory.doubleCheckClear = function(){\n\t\t\t// Clear\n\t\t\tif ( History.doubleChecker ) {\n\t\t\t\tclearTimeout(History.doubleChecker);\n\t\t\t\tHistory.doubleChecker = false;\n\t\t\t}\n\n\t\t\t// Chain\n\t\t\treturn History;\n\t\t};\n\n\t\t/**\n\t\t * History.doubleCheck()\n\t\t * Create a double check\n\t\t * @return {History}\n\t\t */\n\t\tHistory.doubleCheck = function(tryAgain){\n\t\t\t// Reset\n\t\t\tHistory.stateChanged = false;\n\t\t\tHistory.doubleCheckClear();\n\n\t\t\t// Fix IE6,IE7 bug where calling history.back or history.forward does not actually change the hash (whereas doing it manually does)\n\t\t\t// Fix Safari 5 bug where sometimes the state does not change: https://bugs.webkit.org/show_bug.cgi?id=42940\n\t\t\tif ( History.bugs.ieDoubleCheck ) {\n\t\t\t\t// Apply Check\n\t\t\t\tHistory.doubleChecker = setTimeout(\n\t\t\t\t\tfunction(){\n\t\t\t\t\t\tHistory.doubleCheckClear();\n\t\t\t\t\t\tif ( !History.stateChanged ) {\n\t\t\t\t\t\t\t//History.debug('History.doubleCheck: State has not yet changed, trying again', arguments);\n\t\t\t\t\t\t\t// Re-Attempt\n\t\t\t\t\t\t\ttryAgain();\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\tHistory.options.doubleCheckInterval\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// Chain\n\t\t\treturn History;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// Safari Bug Fix\n\n\t\t/**\n\t\t * History.safariStatePoll()\n\t\t * Poll the current state\n\t\t * @return {History}\n\t\t */\n\t\tHistory.safariStatePoll = function(){\n\t\t\t// Poll the URL\n\n\t\t\t// Get the Last State which has the new URL\n\t\t\tvar\n\t\t\t\turlState = History.extractState(History.getLocationHref()),\n\t\t\t\tnewState;\n\n\t\t\t// Check for a difference\n\t\t\tif ( !History.isLastSavedState(urlState) ) {\n\t\t\t\tnewState = urlState;\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Check if we have a state with that url\n\t\t\t// If not create it\n\t\t\tif ( !newState ) {\n\t\t\t\t//History.debug('History.safariStatePoll: new');\n\t\t\t\tnewState = History.createStateObject();\n\t\t\t}\n\n\t\t\t// Apply the New State\n\t\t\t//History.debug('History.safariStatePoll: trigger');\n\t\t\tHistory.Adapter.trigger(window,'popstate');\n\n\t\t\t// Chain\n\t\t\treturn History;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// State Aliases\n\n\t\t/**\n\t\t * History.back(queue)\n\t\t * Send the browser history back one item\n\t\t * @param {Integer} queue [optional]\n\t\t */\n\t\tHistory.back = function(queue){\n\t\t\t//History.debug('History.back: called', arguments);\n\n\t\t\t// Handle Queueing\n\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t// Wait + Push to Queue\n\t\t\t\t//History.debug('History.back: we must wait', arguments);\n\t\t\t\tHistory.pushQueue({\n\t\t\t\t\tscope: History,\n\t\t\t\t\tcallback: History.back,\n\t\t\t\t\targs: arguments,\n\t\t\t\t\tqueue: queue\n\t\t\t\t});\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Make Busy + Continue\n\t\t\tHistory.busy(true);\n\n\t\t\t// Fix certain browser bugs that prevent the state from changing\n\t\t\tHistory.doubleCheck(function(){\n\t\t\t\tHistory.back(false);\n\t\t\t});\n\n\t\t\t// Go back\n\t\t\thistory.go(-1);\n\n\t\t\t// End back closure\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * History.forward(queue)\n\t\t * Send the browser history forward one item\n\t\t * @param {Integer} queue [optional]\n\t\t */\n\t\tHistory.forward = function(queue){\n\t\t\t//History.debug('History.forward: called', arguments);\n\n\t\t\t// Handle Queueing\n\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t// Wait + Push to Queue\n\t\t\t\t//History.debug('History.forward: we must wait', arguments);\n\t\t\t\tHistory.pushQueue({\n\t\t\t\t\tscope: History,\n\t\t\t\t\tcallback: History.forward,\n\t\t\t\t\targs: arguments,\n\t\t\t\t\tqueue: queue\n\t\t\t\t});\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Make Busy + Continue\n\t\t\tHistory.busy(true);\n\n\t\t\t// Fix certain browser bugs that prevent the state from changing\n\t\t\tHistory.doubleCheck(function(){\n\t\t\t\tHistory.forward(false);\n\t\t\t});\n\n\t\t\t// Go forward\n\t\t\thistory.go(1);\n\n\t\t\t// End forward closure\n\t\t\treturn true;\n\t\t};\n\n\t\t/**\n\t\t * History.go(index,queue)\n\t\t * Send the browser history back or forward index times\n\t\t * @param {Integer} queue [optional]\n\t\t */\n\t\tHistory.go = function(index,queue){\n\t\t\t//History.debug('History.go: called', arguments);\n\n\t\t\t// Prepare\n\t\t\tvar i;\n\n\t\t\t// Handle\n\t\t\tif ( index > 0 ) {\n\t\t\t\t// Forward\n\t\t\t\tfor ( i=1; i<=index; ++i ) {\n\t\t\t\t\tHistory.forward(queue);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if ( index < 0 ) {\n\t\t\t\t// Backward\n\t\t\t\tfor ( i=-1; i>=index; --i ) {\n\t\t\t\t\tHistory.back(queue);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthrow new Error('History.go: History.go requires a positive or negative integer passed.');\n\t\t\t}\n\n\t\t\t// Chain\n\t\t\treturn History;\n\t\t};\n\n\n\t\t// ====================================================================\n\t\t// HTML5 State Support\n\n\t\t// Non-Native pushState Implementation\n\t\tif ( History.emulated.pushState ) {\n\t\t\t/*\n\t\t\t * Provide Skeleton for HTML4 Browsers\n\t\t\t */\n\n\t\t\t// Prepare\n\t\t\tvar emptyFunction = function(){};\n\t\t\tHistory.pushState = History.pushState||emptyFunction;\n\t\t\tHistory.replaceState = History.replaceState||emptyFunction;\n\t\t} // History.emulated.pushState\n\n\t\t// Native pushState Implementation\n\t\telse {\n\t\t\t/*\n\t\t\t * Use native HTML5 History API Implementation\n\t\t\t */\n\n\t\t\t/**\n\t\t\t * History.onPopState(event,extra)\n\t\t\t * Refresh the Current State\n\t\t\t */\n\t\t\tHistory.onPopState = function(event,extra){\n\t\t\t\t// Prepare\n\t\t\t\tvar stateId = false, newState = false, currentHash, currentState;\n\n\t\t\t\t// Reset the double check\n\t\t\t\tHistory.doubleCheckComplete();\n\n\t\t\t\t// Check for a Hash, and handle apporiatly\n\t\t\t\tcurrentHash = History.getHash();\n\t\t\t\tif ( currentHash ) {\n\t\t\t\t\t// Expand Hash\n\t\t\t\t\tcurrentState = History.extractState(currentHash||History.getLocationHref(),true);\n\t\t\t\t\tif ( currentState ) {\n\t\t\t\t\t\t// We were able to parse it, it must be a State!\n\t\t\t\t\t\t// Let's forward to replaceState\n\t\t\t\t\t\t//History.debug('History.onPopState: state anchor', currentHash, currentState);\n\t\t\t\t\t\tHistory.replaceState(currentState.data, currentState.title, currentState.url, false);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// Traditional Anchor\n\t\t\t\t\t\t//History.debug('History.onPopState: traditional anchor', currentHash);\n\t\t\t\t\t\tHistory.Adapter.trigger(window,'anchorchange');\n\t\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\t}\n\n\t\t\t\t\t// We don't care for hashes\n\t\t\t\t\tHistory.expectedStateId = false;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Ensure\n\t\t\t\tstateId = History.Adapter.extractEventData('state',event,extra) || false;\n\n\t\t\t\t// Fetch State\n\t\t\t\tif ( stateId ) {\n\t\t\t\t\t// Vanilla: Back/forward button was used\n\t\t\t\t\tnewState = History.getStateById(stateId);\n\t\t\t\t}\n\t\t\t\telse if ( History.expectedStateId ) {\n\t\t\t\t\t// Vanilla: A new state was pushed, and popstate was called manually\n\t\t\t\t\tnewState = History.getStateById(History.expectedStateId);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Initial State\n\t\t\t\t\tnewState = History.extractState(History.getLocationHref());\n\t\t\t\t}\n\n\t\t\t\t// The State did not exist in our store\n\t\t\t\tif ( !newState ) {\n\t\t\t\t\t// Regenerate the State\n\t\t\t\t\tnewState = History.createStateObject(null,null,History.getLocationHref());\n\t\t\t\t}\n\n\t\t\t\t// Clean\n\t\t\t\tHistory.expectedStateId = false;\n\n\t\t\t\t// Check if we are the same state\n\t\t\t\tif ( History.isLastSavedState(newState) ) {\n\t\t\t\t\t// There has been no change (just the page's hash has finally propagated)\n\t\t\t\t\t//History.debug('History.onPopState: no change', newState, History.savedStates);\n\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Store the State\n\t\t\t\tHistory.storeState(newState);\n\t\t\t\tHistory.saveState(newState);\n\n\t\t\t\t// Force update of the title\n\t\t\t\tHistory.setTitle(newState);\n\n\t\t\t\t// Fire Our Event\n\t\t\t\tHistory.Adapter.trigger(window,'statechange');\n\t\t\t\tHistory.busy(false);\n\n\t\t\t\t// Return true\n\t\t\t\treturn true;\n\t\t\t};\n\t\t\tHistory.Adapter.bind(window,'popstate',History.onPopState);\n\n\t\t\t/**\n\t\t\t * History.pushState(data,title,url)\n\t\t\t * Add a new State to the history object, become it, and trigger onpopstate\n\t\t\t * We have to trigger for HTML4 compatibility\n\t\t\t * @param {object} data\n\t\t\t * @param {string} title\n\t\t\t * @param {string} url\n\t\t\t * @return {true}\n\t\t\t */\n\t\t\tHistory.pushState = function(data,title,url,queue){\n\t\t\t\t//History.debug('History.pushState: called', arguments);\n\n\t\t\t\t// Check the State\n\t\t\t\tif ( History.getHashByUrl(url) && History.emulated.pushState ) {\n\t\t\t\t\tthrow new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');\n\t\t\t\t}\n\n\t\t\t\t// Handle Queueing\n\t\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t\t// Wait + Push to Queue\n\t\t\t\t\t//History.debug('History.pushState: we must wait', arguments);\n\t\t\t\t\tHistory.pushQueue({\n\t\t\t\t\t\tscope: History,\n\t\t\t\t\t\tcallback: History.pushState,\n\t\t\t\t\t\targs: arguments,\n\t\t\t\t\t\tqueue: queue\n\t\t\t\t\t});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Make Busy + Continue\n\t\t\t\tHistory.busy(true);\n\n\t\t\t\t// Create the newState\n\t\t\t\tvar newState = History.createStateObject(data,title,url);\n\n\t\t\t\t// Check it\n\t\t\t\tif ( History.isLastSavedState(newState) ) {\n\t\t\t\t\t// Won't be a change\n\t\t\t\t\tHistory.busy(false);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Store the newState\n\t\t\t\t\tHistory.storeState(newState);\n\t\t\t\t\tHistory.expectedStateId = newState.id;\n\n\t\t\t\t\t// Push the newState\n\t\t\t\t\thistory.pushState(newState.id,newState.title,newState.url);\n\n\t\t\t\t\t// Fire HTML5 Event\n\t\t\t\t\tHistory.Adapter.trigger(window,'popstate');\n\t\t\t\t}\n\n\t\t\t\t// End pushState closure\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.replaceState(data,title,url)\n\t\t\t * Replace the State and trigger onpopstate\n\t\t\t * We have to trigger for HTML4 compatibility\n\t\t\t * @param {object} data\n\t\t\t * @param {string} title\n\t\t\t * @param {string} url\n\t\t\t * @return {true}\n\t\t\t */\n\t\t\tHistory.replaceState = function(data,title,url,queue){\n\t\t\t\t//History.debug('History.replaceState: called', arguments);\n\n\t\t\t\t// Check the State\n\t\t\t\tif ( History.getHashByUrl(url) && History.emulated.pushState ) {\n\t\t\t\t\tthrow new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');\n\t\t\t\t}\n\n\t\t\t\t// Handle Queueing\n\t\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t\t// Wait + Push to Queue\n\t\t\t\t\t//History.debug('History.replaceState: we must wait', arguments);\n\t\t\t\t\tHistory.pushQueue({\n\t\t\t\t\t\tscope: History,\n\t\t\t\t\t\tcallback: History.replaceState,\n\t\t\t\t\t\targs: arguments,\n\t\t\t\t\t\tqueue: queue\n\t\t\t\t\t});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Make Busy + Continue\n\t\t\t\tHistory.busy(true);\n\n\t\t\t\t// Create the newState\n\t\t\t\tvar newState = History.createStateObject(data,title,url);\n\n\t\t\t\t// Check it\n\t\t\t\tif ( History.isLastSavedState(newState) ) {\n\t\t\t\t\t// Won't be a change\n\t\t\t\t\tHistory.busy(false);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Store the newState\n\t\t\t\t\tHistory.storeState(newState);\n\t\t\t\t\tHistory.expectedStateId = newState.id;\n\n\t\t\t\t\t// Push the newState\n\t\t\t\t\thistory.replaceState(newState.id,newState.title,newState.url);\n\n\t\t\t\t\t// Fire HTML5 Event\n\t\t\t\t\tHistory.Adapter.trigger(window,'popstate');\n\t\t\t\t}\n\n\t\t\t\t// End replaceState closure\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t} // !History.emulated.pushState\n\n\n\t\t// ====================================================================\n\t\t// Initialise\n\n\t\t/**\n\t\t * Load the Store\n\t\t */\n\t\tif ( sessionStorage ) {\n\t\t\t// Fetch\n\t\t\ttry {\n\t\t\t\tHistory.store = JSON.parse(sessionStorage.getItem('History.store'))||{};\n\t\t\t}\n\t\t\tcatch ( err ) {\n\t\t\t\tHistory.store = {};\n\t\t\t}\n\n\t\t\t// Normalize\n\t\t\tHistory.normalizeStore();\n\t\t}\n\t\telse {\n\t\t\t// Default Load\n\t\t\tHistory.store = {};\n\t\t\tHistory.normalizeStore();\n\t\t}\n\n\t\t/**\n\t\t * Clear Intervals on exit to prevent memory leaks\n\t\t */\n\t\tHistory.Adapter.bind(window,\"unload\",History.clearAllIntervals);\n\n\t\t/**\n\t\t * Create the initial State\n\t\t */\n\t\tHistory.saveState(History.storeState(History.extractState(History.getLocationHref(),true)));\n\n\t\t/**\n\t\t * Bind for Saving Store\n\t\t */\n\t\tif ( sessionStorage ) {\n\t\t\t// When the page is closed\n\t\t\tHistory.onUnload = function(){\n\t\t\t\t// Prepare\n\t\t\t\tvar\tcurrentStore, item, currentStoreString;\n\n\t\t\t\t// Fetch\n\t\t\t\ttry {\n\t\t\t\t\tcurrentStore = JSON.parse(sessionStorage.getItem('History.store'))||{};\n\t\t\t\t}\n\t\t\t\tcatch ( err ) {\n\t\t\t\t\tcurrentStore = {};\n\t\t\t\t}\n\n\t\t\t\t// Ensure\n\t\t\t\tcurrentStore.idToState = currentStore.idToState || {};\n\t\t\t\tcurrentStore.urlToId = currentStore.urlToId || {};\n\t\t\t\tcurrentStore.stateToId = currentStore.stateToId || {};\n\n\t\t\t\t// Sync\n\t\t\t\tfor ( item in History.idToState ) {\n\t\t\t\t\tif ( !History.idToState.hasOwnProperty(item) ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tcurrentStore.idToState[item] = History.idToState[item];\n\t\t\t\t}\n\t\t\t\tfor ( item in History.urlToId ) {\n\t\t\t\t\tif ( !History.urlToId.hasOwnProperty(item) ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tcurrentStore.urlToId[item] = History.urlToId[item];\n\t\t\t\t}\n\t\t\t\tfor ( item in History.stateToId ) {\n\t\t\t\t\tif ( !History.stateToId.hasOwnProperty(item) ) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\t\t\t\t\tcurrentStore.stateToId[item] = History.stateToId[item];\n\t\t\t\t}\n\n\t\t\t\t// Update\n\t\t\t\tHistory.store = currentStore;\n\t\t\t\tHistory.normalizeStore();\n\n\t\t\t\t// In Safari, going into Private Browsing mode causes the\n\t\t\t\t// Session Storage object to still exist but if you try and use\n\t\t\t\t// or set any property/function of it it throws the exception\n\t\t\t\t// \"QUOTA_EXCEEDED_ERR: DOM Exception 22: An attempt was made to\n\t\t\t\t// add something to storage that exceeded the quota.\" infinitely\n\t\t\t\t// every second.\n\t\t\t\tcurrentStoreString = JSON.stringify(currentStore);\n\t\t\t\ttry {\n\t\t\t\t\t// Store\n\t\t\t\t\tsessionStorage.setItem('History.store', currentStoreString);\n\t\t\t\t}\n\t\t\t\tcatch (e) {\n\t\t\t\t\tif (e.code === DOMException.QUOTA_EXCEEDED_ERR) {\n\t\t\t\t\t\tif (sessionStorage.length) {\n\t\t\t\t\t\t\t// Workaround for a bug seen on iPads. Sometimes the quota exceeded error comes up and simply\n\t\t\t\t\t\t\t// removing/resetting the storage can work.\n\t\t\t\t\t\t\tsessionStorage.removeItem('History.store');\n\t\t\t\t\t\t\tsessionStorage.setItem('History.store', currentStoreString);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Otherwise, we're probably private browsing in Safari, so we'll ignore the exception.\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// For Internet Explorer\n\t\t\tHistory.intervalList.push(setInterval(History.onUnload,History.options.storeInterval));\n\n\t\t\t// For Other Browsers\n\t\t\tHistory.Adapter.bind(window,'beforeunload',History.onUnload);\n\t\t\tHistory.Adapter.bind(window,'unload',History.onUnload);\n\n\t\t\t// Both are enabled for consistency\n\t\t}\n\n\t\t// Non-Native pushState Implementation\n\t\tif ( !History.emulated.pushState ) {\n\t\t\t// Be aware, the following is only for native pushState implementations\n\t\t\t// If you are wanting to include something for all browsers\n\t\t\t// Then include it above this if block\n\n\t\t\t/**\n\t\t\t * Setup Safari Fix\n\t\t\t */\n\t\t\tif ( History.bugs.safariPoll ) {\n\t\t\t\tHistory.intervalList.push(setInterval(History.safariStatePoll, History.options.safariPollInterval));\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Ensure Cross Browser Compatibility\n\t\t\t */\n\t\t\tif ( navigator.vendor === 'Apple Computer, Inc.' || (navigator.appCodeName||'') === 'Mozilla' ) {\n\t\t\t\t/**\n\t\t\t\t * Fix Safari HashChange Issue\n\t\t\t\t */\n\n\t\t\t\t// Setup Alias\n\t\t\t\tHistory.Adapter.bind(window,'hashchange',function(){\n\t\t\t\t\tHistory.Adapter.trigger(window,'popstate');\n\t\t\t\t});\n\n\t\t\t\t// Initialise Alias\n\t\t\t\tif ( History.getHash() ) {\n\t\t\t\t\tHistory.Adapter.onDomLoad(function(){\n\t\t\t\t\t\tHistory.Adapter.trigger(window,'hashchange');\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t} // !History.emulated.pushState\n\n\n\t}; // History.initCore\n\n\t// Try to Initialise History\n\tif (!History.options || !History.options.delayInit) {\n\t\tHistory.init();\n\t}\n\n})(window);\n","/*jslint browser:true, indent:2, nomen:true, todo:true*/\n/*global Modernizr*/\n/*global log, warn*/ // from common.js\n/*global insertText*/ // from main.js\n\n(function (window) {\n  'use strict';\n  var MyAnswers,\n    $ = window.jQuery,\n    navigator = window.navigator,\n    google; // defined in MyAnswers.setupGoogleMaps\n\n  MyAnswers = window.MyAnswers || {};\n  window.MyAnswers = MyAnswers;\n\n  MyAnswers.onGoogleMapsLoad = function () {\n    setTimeout(function () {\n      if (window.google && window.google.maps && window.google.maps.Map) {\n        MyAnswers.dfrdGoogleMaps.resolve();\n      } else {\n        MyAnswers.dfrdGoogleMaps.reject();\n      }\n    }, 197);\n  };\n\n  function getGoogleDirections(options) {\n    var dfrd = new $.Deferred(),\n      directionsService = new google.maps.DirectionsService(),\n      string;\n    /* END: var */\n    if (!$.isPlainObject(options) || !options.origin || !options.destination ||\n        !options.travelMode) {\n      dfrd.reject('GoogleDirections error: bad options');\n      return dfrd.promise();\n    }\n    directionsService.route(options, function (results, status) {\n      if (status === google.maps.DirectionsStatus.OK) {\n        dfrd.resolve(results);\n      } else {\n        switch (status) {\n        case google.maps.DirectionsStatus.NOT_FOUND:\n          string = 'one of the waypoints could not be geocoded';\n          break;\n        case google.maps.DirectionsStatus.ZERO_RESULTS:\n          string = 'no route found, be more specific';\n          break;\n        case google.maps.DirectionsStatus.MAX_WAYPOINTS_EXCEEDED:\n          string = 'too many waypoints specified';\n          break;\n        case google.maps.DirectionsStatus.OVER_QUERY_LIMIT:\n          string = 'request quota exceeded, try again later';\n          break;\n        case google.maps.DirectionsStatus.REQUEST_DENIED:\n          string = 'request denied';\n          break;\n        case google.maps.DirectionsStatus.INVALID_REQUEST:\n          string = 'invalid request';\n          break;\n        default:\n          string = 'unknown error, please try again';\n        }\n        dfrd.reject('GoogleDirections error: ' + string);\n      }\n    });\n    return dfrd.promise();\n  }\n\n  MyAnswers.getGeoLocation = function (options) {\n    var dfrd = new $.Deferred(),\n      defaultOptions = {\n        enableHighAccuracy: true,\n        maximumAge: 10 * 60 * 1000, // 10 minutes\n        timeout: 10 * 1000 // 10 seconds\n      };\n    /* END: var */\n    if (!Modernizr.geolocation) {\n      dfrd.reject('GeoLocation error: unsupported in this browser / device');\n      return dfrd.promise();\n    }\n    options = $.isPlainObject(options) ? options : {};\n    options = $.extend({}, defaultOptions, options);\n    navigator.geolocation.getCurrentPosition(\n      function (position) { // successCallback\n        var coords;\n        if (position.coords) {\n          coords = {\n            latitude: position.coords.latitude,\n            longitude: position.coords.longitude,\n            altitude: position.coords.altitude,\n            accuracy: position.coords.accuracy,\n            altitudeAccuracy: position.coords.altitudeAccuracy,\n            heading: position.coords.heading,\n            speed: position.coords.speed\n          };\n          dfrd.resolve(coords);\n        } else {\n          dfrd.reject('GeoLocation error: blank location from device');\n        }\n      },\n      function (error) { // errorCallback\n        var string;\n        switch (error.code) {\n        case error.PERMISSION_DENIED:\n          string = 'user has not granted permission';\n          break;\n        case error.PERMISSION_DENIED_TIMEOUT:\n          string = 'user did not grant permission in time';\n          break;\n        case error.POSITION_UNAVAILABLE:\n          string = 'unable to determine position';\n          break;\n        default:\n          string = 'unknown error';\n        }\n        dfrd.reject('GeoLocation error: ' + string);\n      },\n      options\n    );\n    return dfrd.promise();\n  };\n\n  /*jslint unparam:true*/\n  function setupGoogleMapsBasic(element, data, map) {\n    var location, options, marker, markerInfo;\n    log('GoogleMaps basic: initialising...');\n    MyAnswers.$body.trigger('taskBegun');\n    location = new google.maps.LatLng(data.latitude, data.longitude);\n    options = {\n      zoom: parseInt(data.zoom, 10),\n      center: location,\n      mapTypeId: google.maps.MapTypeId[data.type.toUpperCase()]\n    };\n\n    map.setOptions(options);\n    if (typeof data.kml === 'string') {\n      google.maps.KmlLayer(data.kml, {\n        map: map,\n        preserveViewport: true\n      });\n    } else if (typeof data.marker === 'string') {\n      marker = new google.maps.Marker({\n        position: location,\n        map: map,\n        icon: data.marker\n      });\n      if (typeof data.markerTitle === 'string') {\n        marker.setTitle(data.markerTitle);\n        markerInfo = new google.maps.InfoWindow();\n        google.maps.event.addListener(marker, 'click', function () {\n          markerInfo.setContent(marker.getTitle());\n          markerInfo.open(map, marker);\n        });\n      }\n    }\n    MyAnswers.$body.trigger('taskComplete');\n  }\n  /*jslint unparam:false*/\n\n  function setupGoogleMapsDirections(element, data, map) {\n    var origin, destination,\n      geocoderOptions = {},\n      travelMode = data.travelmode.toUpperCase(),\n      directionsOptions = {\n        travelMode: google.maps.DirectionsTravelMode[travelMode],\n        avoidHighways: data.avoidhighways,\n        avoidTolls: data.avoidtolls\n      },\n      mapOptions = {\n        mapTypeId: google.maps.MapTypeId[data.type.toUpperCase()]\n      },\n      directionsDisplay,\n      $element = $(element),\n      $status = $element.next('.googledirections').first(),\n      $directions = $status,\n      promiseOrigin = true,\n      promiseDestination = true,\n      failedFn = function (string) {\n        if (typeof string === 'string' && string.length) {\n          insertText($status[0], string);\n        }\n      };\n\n    log('GoogleMaps directions: initialising...');\n    // setting Geocoder options\n    if (typeof data.language === 'string') {\n      geocoderOptions.language = data.language;\n    }\n    if (typeof data.region === 'string') {\n      geocoderOptions.region = data.region;\n      directionsOptions.region = data.region;\n    }\n    // setting origin\n    if (typeof data.originAddress === 'string' && data.originAddress.length) {\n      origin = data.originAddress;\n    } else if (data.originLatitude) {\n      origin = new google.maps.LatLng(data.originLatitude,\n        data.originLongitude);\n    } else if (Modernizr.geolocation) {\n      log('Google Maps Directions: missing origin');\n      insertText($status[0],\n        'using your most recent location as the origin...');\n      promiseOrigin = MyAnswers.getGeoLocation()\n        .fail(failedFn)\n        .then(function (coords) {\n          origin = new google.maps.LatLng(coords.latitude, coords.longitude);\n        });\n    }\n    // setting destination\n    if (typeof data.destinationAddress === 'string' &&\n        data.destinationAddress.length) {\n      destination = data.destinationAddress;\n    } else if (data.destinationLatitude) {\n      destination = new google.maps.LatLng(data.destinationLatitude,\n        data.destinationLongitude);\n    } else if (Modernizr.geolocation) {\n      log('Google Maps Directions: missing destination');\n      insertText($status[0],\n        'using your most recent location as the destination...');\n      promiseDestination = MyAnswers.getGeoLocation()\n        .fail(failedFn)\n        .then(function (coords) {\n          destination = new google.maps.LatLng(coords.latitude,\n            coords.longitude);\n        });\n    }\n    $.when(promiseOrigin, promiseDestination)\n      .always(function () {\n        if (origin && destination) {\n          if ($.type(origin) === 'object' && $.type(destination) === 'object' &&\n              origin.equals(destination)) {\n            insertText($status[0], 'origin and destination are the identical');\n            data.latitude = origin.lat();\n            data.longitude = origin.lng();\n            setupGoogleMapsBasic(element, data, map);\n          } else {\n            directionsOptions.origin = origin;\n            directionsOptions.destination = destination;\n            map.setOptions(mapOptions);\n            // setup DirectionsRenderer\n            directionsDisplay = new google.maps.DirectionsRenderer();\n            directionsDisplay.setMap(map);\n            directionsDisplay.setPanel($directions[0]);\n            $.when(getGoogleDirections(directionsOptions))\n              .fail(failedFn)\n              .then(function (result) {\n                directionsDisplay.setDirections(result);\n              });\n          }\n        } else if (!origin && !destination) {\n          insertText($status[0],\n            'error: neither origin or destination could be determined');\n        } else {\n          if (origin) {\n            insertText($status[0],\n              'missing destination, only the provided origin is displayed');\n            data.latitude = origin.lat();\n            data.longitude = origin.lng();\n            setupGoogleMapsBasic(element, data, map);\n          } else { // destination\n            insertText($status[0],\n              'missing origin, only the provided destination is displayed');\n            data.latitude = destination.lat();\n            data.longitude = destination.lng();\n            setupGoogleMapsBasic(element, data, map);\n          }\n        }\n      });\n  }\n\n  MyAnswers.setupGoogleMaps = function ($view) {\n    var $element = $view.find('div.googlemap').first(),\n      data = $element.data(),\n      element = $element[0],\n      googleMap,\n      currentMarker,\n      currentInfo;\n\n    MyAnswers.$body.trigger('taskBegun');\n    google = window.google;\n    googleMap = new google.maps.Map(element);\n    if (data.mapAction === 'directions') {\n      setupGoogleMapsDirections(element, data, googleMap);\n    } else {\n      setupGoogleMapsBasic(element, data, googleMap);\n    }\n    if (Modernizr.geolocation) {\n      currentMarker = new google.maps.Marker({\n        map: googleMap,\n        // TODO: use a better icon for current location\n        icon: '/_R_/BICv2/images/location24.png',\n        title: 'you are here'\n      });\n      currentInfo = new google.maps.InfoWindow();\n      $.when(MyAnswers.getGeoLocation())\n        .then(function (coords) {\n          currentMarker.setPosition(new google.maps.LatLng(coords.latitude,\n            coords.longitude));\n        });\n      google.maps.event.addListener(currentMarker, 'click', function () {\n        currentInfo.setContent(currentMarker.getTitle());\n        currentInfo.open(googleMap, currentMarker);\n      });\n    }\n    MyAnswers.$body.trigger('taskComplete');\n  };\n\n}(this));\n"]}