function explode(e,t,r){var n={0:""};if(2>arguments.length||arguments[0]===void 0||arguments[1]===void 0)return null;
if(""===e||e===!1||null===e)return!1;if("function"==typeof e||"object"==typeof e||"function"==typeof t||"object"==typeof t)return n;
if(e===!0&&(e="1"),r){var i=(""+t).split(""+e),a=i.splice(0,r-1),o=i.join(""+e);return a.push(o),a
}return(""+t).split(""+e)}function utf8_encode(e){if(null===e||e===void 0)return"";
var t,r,n=e+"",i="",a=0;t=r=0,a=n.length;for(var o=0;a>o;o++){var s=n.charCodeAt(o),c=null;
128>s?r++:c=s>127&&2048>s?String.fromCharCode(192|s>>6)+String.fromCharCode(128|63&s):String.fromCharCode(224|s>>12)+String.fromCharCode(128|63&s>>6)+String.fromCharCode(128|63&s),null!==c&&(r>t&&(i+=n.slice(t,r)),i+=c,t=r=o+1)
}return r>t&&(i+=n.slice(t,a)),i}function sha1(e){var t,r,n,i,a,o,s,c,u,l=function(e,t){var r=e<<t|e>>>32-t;
return r},p=function(e){var t,r,n="";for(t=7;t>=0;t--)r=15&e>>>4*t,n+=r.toString(16);
return n},f=Array(80),d=1732584193,g=4023233417,h=2562383102,y=271733878,m=3285377520;
e=this.utf8_encode(e);var v=e.length,w=[];for(r=0;v-3>r;r+=4)n=e.charCodeAt(r)<<24|e.charCodeAt(r+1)<<16|e.charCodeAt(r+2)<<8|e.charCodeAt(r+3),w.push(n);
switch(v%4){case 0:r=2147483648;break;case 1:r=8388608|e.charCodeAt(v-1)<<24;break;
case 2:r=32768|(e.charCodeAt(v-2)<<24|e.charCodeAt(v-1)<<16);break;case 3:r=128|(e.charCodeAt(v-3)<<24|e.charCodeAt(v-2)<<16|e.charCodeAt(v-1)<<8)
}for(w.push(r);14!=w.length%16;)w.push(0);for(w.push(v>>>29),w.push(4294967295&v<<3),t=0;w.length>t;t+=16){for(r=0;16>r;r++)f[r]=w[t+r];
for(r=16;79>=r;r++)f[r]=l(f[r-3]^f[r-8]^f[r-14]^f[r-16],1);for(i=d,a=g,o=h,s=y,c=m,r=0;19>=r;r++)u=4294967295&l(i,5)+(a&o|~a&s)+c+f[r]+1518500249,c=s,s=o,o=l(a,30),a=i,i=u;
for(r=20;39>=r;r++)u=4294967295&l(i,5)+(a^o^s)+c+f[r]+1859775393,c=s,s=o,o=l(a,30),a=i,i=u;
for(r=40;59>=r;r++)u=4294967295&l(i,5)+(a&o|a&s|o&s)+c+f[r]+2400959708,c=s,s=o,o=l(a,30),a=i,i=u;
for(r=60;79>=r;r++)u=4294967295&l(i,5)+(a^o^s)+c+f[r]+3395469782,c=s,s=o,o=l(a,30),a=i,i=u;
d=4294967295&d+i,g=4294967295&g+a,h=4294967295&h+o,y=4294967295&y+s,m=4294967295&m+c
}return u=p(d)+p(g)+p(h)+p(y)+p(m),u.toLowerCase()}function urldecode(e){return decodeURIComponent((e+"").replace(/\+/g,"%20"))
}function parse_url(e,t){for(var r={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=r.parser[r.strictMode?"strict":"loose"].exec(e),i={},a=14;a--;)i[r.key[a]]=n[a]||"";
switch(t){case"PHP_URL_SCHEME":return i.protocol;case"PHP_URL_HOST":return i.host;
case"PHP_URL_PORT":return i.port;case"PHP_URL_USER":return i.user;case"PHP_URL_PASS":return i.password;
case"PHP_URL_PATH":return i.path;case"PHP_URL_QUERY":return i.query;case"PHP_URL_FRAGMENT":return i.anchor;
default:var o={};return""!==i.protocol&&(o.scheme=i.protocol),""!==i.host&&(o.host=i.host),""!==i.port&&(o.port=i.port),""!==i.user&&(o.user=i.user),""!==i.password&&(o.pass=i.password),""!==i.path&&(o.path=i.path),""!==i.query&&(o.query=i.query),""!==i.anchor&&(o.fragment=i.anchor),o
}}function parse_str(str,array){var glue1="=",glue2="&",array2=(str+"").replace(/^&?([\s\S]*?)&?$/,"$1").split(glue2),i,j,chr,tmp,key,value,bracket,keys,evalStr,that=this,fixStr=function(e){return that.urldecode(e).replace(/([\\"'])/g,"\\$1").replace(/\n/g,"\\n").replace(/\r/g,"\\r")
};for(array||(array=this.window),i=0;array2.length>i;i++){for(tmp=array2[i].split(glue1),2>tmp.length&&(tmp=[tmp,""]),key=fixStr(tmp[0]),value=fixStr(tmp[1]);" "===key.charAt(0);)key=key.substr(1);
if(-1!==key.indexOf("\0")&&(key=key.substr(0,key.indexOf("\0"))),key&&"["!==key.charAt(0)){for(keys=[],bracket=0,j=0;key.length>j;j++)if("["!==key.charAt(j)||bracket){if("]"===key.charAt(j)&&bracket&&(keys.length||keys.push(key.substr(0,bracket-1)),keys.push(key.substr(bracket,j-bracket)),bracket=0,"["!==key.charAt(j+1)))break
}else bracket=j+1;for(keys.length||(keys=[key]),j=0;keys[0].length>j&&(chr=keys[0].charAt(j),(" "===chr||"."===chr||"["===chr)&&(keys[0]=keys[0].substr(0,j)+"_"+keys[0].substr(j+1)),"["!==chr);j++);for(evalStr="array",j=0;keys.length>j;j++)key=keys[j],key=""!==key&&" "!==key||0===j?"'"+key+"'":eval(evalStr+".push([]);")-1,evalStr+="["+key+"]",j!==keys.length-1&&"undefined"===eval("typeof "+evalStr)&&eval(evalStr+" = [];");
evalStr+=" = '"+value+"';\n",eval(evalStr)}}}function htmlspecialchars(e,t,r,n){var i=0,a=0,o=!1;
(t===void 0||null===t)&&(t=2),e=""+e,n!==!1&&(e=e.replace(/&/g,"&amp;")),e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;");
var s={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};
if(0===t&&(o=!0),"number"!=typeof t){for(t=[].concat(t),a=0;t.length>a;a++)0===s[t[a]]?o=!0:s[t[a]]&&(i|=s[t[a]]);
t=i}return t&s.ENT_HTML_QUOTE_SINGLE&&(e=e.replace(/'/g,"&#039;")),o||(e=e.replace(/"/g,"&quot;")),e
}function htmlspecialchars_decode(e,t){var r=0,n=0,i=!1;t===void 0&&(t=2),e=(""+e).replace(/&lt;/g,"<").replace(/&gt;/g,">");
var a={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};
if(0===t&&(i=!0),"number"!=typeof t){for(t=[].concat(t),n=0;t.length>n;n++)0===a[t[n]]?i=!0:a[t[n]]&&(r|=a[t[n]]);
t=r}return t&a.ENT_HTML_QUOTE_SINGLE&&(e=e.replace(/&#0*39;/g,"'")),i||(e=e.replace(/&quot;/g,'"')),e=e.replace(/&amp;/g,"&")
}function setlocale(e,t){var r="",n=[],i=0,a=this.window.document,o=function o(e){if(e instanceof RegExp)return RegExp(e);
if(e instanceof Date)return new Date(e);var t={};for(var r in e)t[r]="object"==typeof e[r]?o(e[r]):e[r];
return t},s=function(e){return 1!==e?1:0},c=function(e){return e>1?1:0};this.php_js=this.php_js||{};
var u=this.php_js;if(u.locales||(u.locales={},u.locales.en={LC_COLLATE:function(e,t){return e==t?0:e>t?1:-1
},LC_CTYPE:{an:/^[A-Za-z\d]+$/g,al:/^[A-Za-z]+$/g,ct:/^[\u0000-\u001F\u007F]+$/g,dg:/^[\d]+$/g,gr:/^[\u0021-\u007E]+$/g,lw:/^[a-z]+$/g,pr:/^[\u0020-\u007E]+$/g,pu:/^[\u0021-\u002F\u003A-\u0040\u005B-\u0060\u007B-\u007E]+$/g,sp:/^[\f\n\r\t\v ]+$/g,up:/^[A-Z]+$/g,xd:/^[A-Fa-f\d]+$/g,CODESET:"UTF-8",lower:"abcdefghijklmnopqrstuvwxyz",upper:"ABCDEFGHIJKLMNOPQRSTUVWXYZ"},LC_TIME:{a:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],A:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],b:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],B:["January","February","March","April","May","June","July","August","September","October","November","December"],c:"%a %d %b %Y %r %Z",p:["AM","PM"],P:["am","pm"],r:"%I:%M:%S %p",x:"%m/%d/%Y",X:"%r",alt_digits:"",ERA:"",ERA_YEAR:"",ERA_D_T_FMT:"",ERA_D_FMT:"",ERA_T_FMT:""},LC_MONETARY:{int_curr_symbol:"USD",currency_symbol:"$",mon_decimal_point:".",mon_thousands_sep:",",mon_grouping:[3],positive_sign:"",negative_sign:"-",int_frac_digits:2,frac_digits:2,p_cs_precedes:1,p_sep_by_space:0,n_cs_precedes:1,n_sep_by_space:0,p_sign_posn:3,n_sign_posn:0},LC_NUMERIC:{decimal_point:".",thousands_sep:",",grouping:[3]},LC_MESSAGES:{YESEXPR:"^[yY].*",NOEXPR:"^[nN].*",YESSTR:"",NOSTR:""},nplurals:s},u.locales.en_US=o(u.locales.en),u.locales.en_US.LC_TIME.c="%a %d %b %Y %r %Z",u.locales.en_US.LC_TIME.x="%D",u.locales.en_US.LC_TIME.X="%r",u.locales.en_US.LC_MONETARY.int_curr_symbol="USD ",u.locales.en_US.LC_MONETARY.p_sign_posn=1,u.locales.en_US.LC_MONETARY.n_sign_posn=1,u.locales.en_US.LC_MONETARY.mon_grouping=[3,3],u.locales.en_US.LC_NUMERIC.thousands_sep="",u.locales.en_US.LC_NUMERIC.grouping=[],u.locales.en_GB=o(u.locales.en),u.locales.en_GB.LC_TIME.r="%l:%M:%S %P %Z",u.locales.en_AU=o(u.locales.en_GB),u.locales.C=o(u.locales.en),u.locales.C.LC_CTYPE.CODESET="ANSI_X3.4-1968",u.locales.C.LC_MONETARY={int_curr_symbol:"",currency_symbol:"",mon_decimal_point:"",mon_thousands_sep:"",mon_grouping:[],p_cs_precedes:127,p_sep_by_space:127,n_cs_precedes:127,n_sep_by_space:127,p_sign_posn:127,n_sign_posn:127,positive_sign:"",negative_sign:"",int_frac_digits:127,frac_digits:127},u.locales.C.LC_NUMERIC={decimal_point:".",thousands_sep:"",grouping:[]},u.locales.C.LC_TIME.c="%a %b %e %H:%M:%S %Y",u.locales.C.LC_TIME.x="%m/%d/%y",u.locales.C.LC_TIME.X="%H:%M:%S",u.locales.C.LC_MESSAGES.YESEXPR="^[yY]",u.locales.C.LC_MESSAGES.NOEXPR="^[nN]",u.locales.fr=o(u.locales.en),u.locales.fr.nplurals=c,u.locales.fr.LC_TIME.a=["dim","lun","mar","mer","jeu","ven","sam"],u.locales.fr.LC_TIME.A=["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],u.locales.fr.LC_TIME.b=["jan","fév","mar","avr","mai","jun","jui","aoû","sep","oct","nov","déc"],u.locales.fr.LC_TIME.B=["janvier","février","mars","avril","mai","juin","juillet","août","septembre","octobre","novembre","décembre"],u.locales.fr.LC_TIME.c="%a %d %b %Y %T %Z",u.locales.fr.LC_TIME.p=["",""],u.locales.fr.LC_TIME.P=["",""],u.locales.fr.LC_TIME.x="%d.%m.%Y",u.locales.fr.LC_TIME.X="%T",u.locales.fr_CA=o(u.locales.fr),u.locales.fr_CA.LC_TIME.x="%Y-%m-%d"),!u.locale){u.locale="en_US";
var l="http://www.w3.org/1999/xhtml",p="http://www.w3.org/XML/1998/namespace";a.getElementsByTagNameNS&&a.getElementsByTagNameNS(l,"html")[0]?a.getElementsByTagNameNS(l,"html")[0].getAttributeNS&&a.getElementsByTagNameNS(l,"html")[0].getAttributeNS(p,"lang")?u.locale=a.getElementsByTagName(l,"html")[0].getAttributeNS(p,"lang"):a.getElementsByTagNameNS(l,"html")[0].lang&&(u.locale=a.getElementsByTagNameNS(l,"html")[0].lang):a.getElementsByTagName("html")[0]&&a.getElementsByTagName("html")[0].lang&&(u.locale=a.getElementsByTagName("html")[0].lang)
}if(u.locale=u.locale.replace("-","_"),u.locale in u.locales||u.locale.replace(/_[a-zA-Z]+$/,"")in u.locales&&(u.locale=u.locale.replace(/_[a-zA-Z]+$/,"")),u.localeCategories||(u.localeCategories={LC_COLLATE:u.locale,LC_CTYPE:u.locale,LC_MONETARY:u.locale,LC_NUMERIC:u.locale,LC_TIME:u.locale,LC_MESSAGES:u.locale}),null===t||""===t)t=this.getenv(e)||this.getenv("LANG");
else if("[object Array]"===Object.prototype.toString.call(t))for(i=0;t.length>i;i++){if(t[i]in this.php_js.locales){t=t[i];
break}if(i===t.length-1)return!1}if("0"===t||0===t){if("LC_ALL"===e){for(r in this.php_js.localeCategories)n.push(r+"="+this.php_js.localeCategories[r]);
return n.join(";")}return this.php_js.localeCategories[e]}if(!(t in this.php_js.locales))return!1;
if("LC_ALL"===e)for(r in this.php_js.localeCategories)this.php_js.localeCategories[r]=t;
else this.php_js.localeCategories[e]=t;return t}function strftime(e,t){this.php_js=this.php_js||{},this.setlocale("LC_ALL",0);
for(var r=this.php_js,n=function(e,t,r){for(r===void 0&&(r=10);r>parseInt(e,10)&&r>1;r/=10)e=""+t+e;
return""+e},i=r.localeCategories.LC_TIME,a=r.locales,o=a[i].LC_TIME,s={a:function(e){return o.a[e.getDay()]
},A:function(e){return o.A[e.getDay()]},b:function(e){return o.b[e.getMonth()]},B:function(e){return o.B[e.getMonth()]
},C:function(e){return n(parseInt(e.getFullYear()/100,10),0)},d:["getDate","0"],e:["getDate"," "],g:function(e){return n(parseInt(this.G(e)/100,10),0)
},G:function(e){var t=e.getFullYear(),r=parseInt(s.V(e),10),n=parseInt(s.W(e),10);
return n>r?t++:0===n&&r>=52&&t--,t},H:["getHours","0"],I:function(e){var t=e.getHours()%12;
return n(0===t?12:t,0)},j:function(e){var t=e-new Date(""+e.getFullYear()+"/1/1 GMT");
t+=6e4*e.getTimezoneOffset();var r=parseInt(t/6e4/60/24,10)+1;return n(r,0,100)},k:["getHours","0"],l:function(e){var t=e.getHours()%12;
return n(0===t?12:t," ")},m:function(e){return n(e.getMonth()+1,0)},M:["getMinutes","0"],p:function(e){return o.p[e.getHours()>=12?1:0]
},P:function(e){return o.P[e.getHours()>=12?1:0]},s:function(e){return Date.parse(e)/1e3
},S:["getSeconds","0"],u:function(e){var t=e.getDay();return 0===t?7:t},U:function(e){var t=parseInt(s.j(e),10),r=6-e.getDay(),i=parseInt((t+r)/7,10);
return n(i,0)},V:function(e){var t=parseInt(s.W(e),10),r=new Date(""+e.getFullYear()+"/1/1").getDay(),i=t+(r>4||1>=r?0:1);
return 53===i&&4>new Date(""+e.getFullYear()+"/12/31").getDay()?i=1:0===i&&(i=s.V(new Date(""+(e.getFullYear()-1)+"/12/31"))),n(i,0)
},w:"getDay",W:function(e){var t=parseInt(s.j(e),10),r=7-s.u(e),i=parseInt((t+r)/7,10);
return n(i,0,10)},y:function(e){return n(e.getFullYear()%100,0)},Y:"getFullYear",z:function(e){var t=e.getTimezoneOffset(),r=n(parseInt(Math.abs(t/60),10),0),i=n(t%60,0);
return(t>0?"-":"+")+r+i},Z:function(e){return(""+e).replace(/^.*\(([^)]+)\)$/,"$1")
},"%":function(){return"%"}},c=t===void 0?new Date:"object"==typeof t?new Date(t):new Date(1e3*t),u={c:"locale",D:"%m/%d/%y",F:"%y-%m-%d",h:"%b",n:"\n",r:"locale",R:"%H:%M",t:"	",T:"%H:%M:%S",x:"locale",X:"locale"};e.match(/%[cDFhnrRtTxX]/);)e=e.replace(/%([cDFhnrRtTxX])/g,function(e,t){var r=u[t];
return"locale"===r?o[t]:r});var l=e.replace(/%([aAbBCdegGHIjklmMpPsSuUVwWyYzZ%])/g,function(e,t){var r=s[t];
return"string"==typeof r?c[r]():"function"==typeof r?r(c):"object"==typeof r&&"string"==typeof r[0]?n(c[r[0]](),r[1]):t
});return l}function init_device(){var e=$("#activityIndicator");log("init_device()"),deviceVars.engineVersion=navigator.userAgent.match(/WebKit\/(\d+)/),deviceVars.engineVersion=null!==deviceVars.engineVersion?deviceVars.engineVersion[1]:525,deviceVars.useCSS3animations=deviceVars.engineVersion>=532,deviceVars.scrollProperty=deviceVars.engineVersion>=532?"-webkit-transform":"top",deviceVars.scrollValue=deviceVars.engineVersion>=532?"translateY($1px)":"$1px",$navBar=$("#navBoxHeader"),activityIndicatorTop=Math.floor($(window).height()/3),e.css("top",activityIndicatorTop),$("#startUp-initDevice").addClass("success")
}function onDeviceReady(){try{log("Device Ready"),log("URL to Load: "+window.Settings.LoadURL),log("Device: "+window.device.platform),log("Camera Present: "+window.device.camerapresent),log("Multitasking: "+window.device.multitasking),MyAnswers.cameraPresent=window.device.camerapresent,MyAnswers.loadURL=window.Settings.LoadURL,MyAnswers.multiTasking=window.device.multitasking,siteVars.answerSpace=window.Settings.answerSpace,siteVars.serverDevicePath=MyAnswers.loadURL+"ios/"+siteVars.serverAppVersion+"/",deviceVars.deviceFileName="/ios.js",log("AppDevicePath: "+siteVars.serverDevicePath),log("AppPath: "+siteVars.serverAppPath)
}catch(e){log("onDeviceReady exception: "),log(e)}}function PictureSourceType(){}function lastPictureTaken(){}function isCameraPresent(){var e=isBlinkGapDevice();
return info("isBlinkGapDevice(): "+e),e&&window.device.camerapresent}function triggerScroll(){$(window).trigger("scroll")
}function insertHTML(e,t){"object"===$.type(e)&&MyAnswers.dispatch.add(function(){$(e).html(t)
})}function insertText(e,t){"object"===$.type(e)&&"string"==typeof t&&MyAnswers.dispatch.add(function(){$(e).text(t)
})}function setMainLabel(e){var t=document.getElementById("mainLabel");insertText(t,e)
}function deserialize(e){var t=e.split("&"),r={};return $.each(t,function(e,t){var n,i,a;
0!==t.length&&-1!==(n=t.indexOf("="))&&(i=t.substring(0,n),a=t.substring(n+1),r[decodeURIComponent(i)]=decodeURIComponent(a))
}),r}function getURLParameters(){var e,t=window.location.href,r={},n=RegExp("/"+siteVars.answerSpace+"/([^/?]*)","i");
return-1!==t.indexOf("?")&&(e=t.match(/\?([^#]*)#?.*$/),e&&e.length>=2&&(r=deserialize(e[1]),"string"==typeof r.keyword&&(r.keyword=r.keyword.replace("/","")))),e=t.match(n),e&&e.length>=2&&(r.keyword=e[1]),r
}function isAJAXError(e){switch(e){case null:case"timeout":case"error":case"notmodified":case"parseerror":return!0;
default:return!1}}function populateDataTags(e,t){var r;for(r in t)t.hasOwnProperty(r)&&e.attr("data-"+r,t[r])
}function processBlinkAnswerMessage(e){var t,r,n=MyAnswers.device.persistentStorage;
if(e=$.parseJSON(e),n&&"string"==typeof e.mojotarget&&("string"==typeof e.mojoxml?(log("controlMessage: populating Data Suitcase: "+e.mojotarget),MyAnswers.store.set("mojoXML:"+e.mojotarget,e.mojoxml)):e.mojodelete!==void 0&&(log("controlMessage: deleting Data Suitcase: "+e.mojotarget),MyAnswers.store.remove("mojoXML:"+e.mojotarget))),n&&e.startype){if(starsProfile[e.startype]=starsProfile[e.startype]||{},e.clearstars&&delete starsProfile[e.startype],"array"===$.type(e.staroff))for(r=e.staroff.length,t=0;r>t;t++)delete starsProfile[e.startype][e.staroff[t]];
if("array"===$.type(e.staron))for(r=e.staron.length,t=0;r>t;t++)starsProfile[e.startype][e.staron[t]]=starsProfile[e.startype][e.staron[t]]||{};
MyAnswers.store.set("starsProfile",JSON.stringify(starsProfile))}}function getPicture_Success(e){var t,r;
lastPictureTaken.image.put(lastPictureTaken.currentName,e);for(t in document.forms[0].elements)document.forms[0].elements.hasOwnProperty(t)&&(r=document.forms[0].elements[t],r.name&&(!r.type||"radio"!==r.type.toLowerCase()&&"checkbox"!==r.type.toLowerCase()||r.checked!==!1?r.type&&"button"===r.type.toLowerCase()&&lastPictureTaken.image.size()>0&&lastPictureTaken.currentName===r.name&&(r.style.backgroundColor="red"):$.noop()));
log("getpic success "+e.length)}function getPicture(e){var t=new BMP.BIC.Config(currentConfig),r=t.toCameraOptions();
void 0!==e&&(r.sourceType=e),navigator.camera.getPicture(getPicture_Success,null,r)
}function selectCamera(e){log("selectCamera: "),lastPictureTaken.currentName=e,getPicture(PictureSourceType.CAMERA)
}function selectLibrary(e){log("selectLibrary: "),lastPictureTaken.currentName=e,getPicture(PictureSourceType.PHOTO_LIBRARY)
}function resolveItemName(e,t){var r,n,i,a,o;if(t="string"==typeof t&&t||"interactions",r=t.substring(0,1),"number"==typeof e&&!isNaN(e)&&"object"===$.type(siteVars.config[r+e]))return e;
if("string"!=typeof e)return!1;for(e=decodeURI(e.replace(/\+/g," ").toLowerCase()),n=siteVars.map[t],a=n.length,i=0;a>i;i++)if(o=r+n[i],"object"===$.type(siteVars.config[o])&&e===siteVars.config[o].pertinent.name.toLowerCase())return n[i];
return"object"===$.type(siteVars.config[r+e])?e:!1}function performXSLT(e,t){var r=new $.Deferred(function(r){var n,i,a,o;
return window.ActiveXObject,"string"!=typeof e||"string"!=typeof t?(r.reject("XSLT failed due to poorly formed XML or XSL."),void 0):(i=$.parseXML(e),a=$.parseXML(t),window.XSLTProcessor?(log("performXSLT(): performing XSLT via XSLTProcessor (W3C)"),o=new window.XSLTProcessor,o.importStylesheet(a),n=o.transformToFragment(i,document)):i.transformNode!==void 0?(log("performXSLT(): performing XSLT via transformNode (IE)"),n=i.transformNode(a)):window.xsltProcess?(log("performXSLT(): performing XSLT via AJAXSLT library"),n=window.xsltProcess(i,a)):n="<p>Your browser does not support Data Suitcase keywords.</p>",r.resolve(n),void 0)
});return r.promise()}function isHome(){var e=siteVars.config["a"+siteVars.id].pertinent.siteStructure,t=$(".view:visible").first().attr("id");
switch(e){case"master categories":return"masterCategoriesView"===t;case"categories":return"categoriesView"===t;
default:return"keywordListView"===t}}function generateMojoAnswer(e){log("generateMojoAnswer(): currentConfig="+currentConfig.name);
var t,r,n,i,a,o,s,c,u=new $.Deferred,l=new $.Deferred,p=currentConfig.xsl,f=function(e,r){t+="<"+e+">"+r+"</"+e+">"
},d=function(e){s+=" or "+o+"='"+e+"'"};if("string"!==$.type(p)||0===p.length)return u.reject("<p>Error: this Interaction does not have any XSL to transform.</p>"),u.promise();
if(e)for(r=p.match(/\$args\[[\w\:][\w\:\-\.]*\]/g),i=r?r.length:0,n=0;i>n;n++)a="string"==typeof e[r[n].substring(1)]?e[r[n].substring(1)]:"",a=a.replace('"',""),a=a.replace("'",""),a=decodeURIComponent(a),p=p.replace(r[n],a);
for(c=p.match(/blink-stars\(([@\w.]+),\W*(\w+)\W*\)/);c;)s="",o=c[1],c=c[2],"object"===$.type(starsProfile[c])&&($.each(starsProfile[c],d),s=s.substr(4)),p=s.length>0?p.replace(/\(?blink-stars\(([@\w.]+),\W*(\w+)\W*\)\)?/,"("+s+")"):p.replace(/\(?blink-stars\(([@\w.]+),\W*(\w+)\W*\)\)?/,"(false())"),c=p.match(/blink-stars\(([@\w.]+),\W*(\w+)\W*\)/);
return"string"===$.type(currentConfig.xml)&&0===currentConfig.xml.indexOf("stars:")&&(currentConfig.mojoType="stars",currentConfig.xml=currentConfig.xml.replace(/^stars:/,"")),"stars"===currentConfig.mojoType?(c=currentConfig.xml,t="","object"!==$.type(starsProfile[c])?t="<stars></stars>":($.each(starsProfile[c],function(e,r){t+="<"+c+' id="'+e+'">',$.each(r,f),t+="</"+c+">"
}),t="<stars>"+t+"</stars>"),setTimeout(l.resolve,0)):"active-forms"===currentConfig.mojoType?$.when(window.getActiveFormsXML()).always(function(e){t=e,setTimeout(l.resolve,0)
}):"string"===$.type(currentConfig.xml)&&currentConfig.xml?$.when(MyAnswers.store.get("mojoXML:"+currentConfig.xml)).always(function(e){t=e,t||(t="<xml />"),setTimeout(l.resolve,0)
}):(t="<xml />",setTimeout(l.resolve,0)),"pending"!==u.state()?u.promise():($.when(l).always(function(){$.when(performXSLT(t,p)).done(function(e){u.resolve(e)
}).fail(function(e){u.resolve(e)})}),u.promise())}function getActiveFormsXML(){var e=new $.Deferred,t="";
return $.when(MyAnswers.pendingStore.keys(),MyAnswers.pendingV1Store.keys()).fail(function(){t="<type>error</type>",t+="<message>Unable to list active form records.</message>",t="<status>"+t+"</status>",e.resolve('<?xml version="1.0"?>\n<records>'+t+"</records>")
}).then(function(r,n){var i=[],a=function(e,r,n){var a,o=r.split(":"),s=siteVars.config["i"+o[0]],c=s?s.pertinent.name:"* unknown *",u=s?s.pertinent.displayName||s.pertinent.name:"* unknown *",l=o[1],p=o[2],f="";
f+="<id>"+r+"</id>\n",f+="<interaction>"+c+"</interaction>\n",f+="<interactionLabel>"+u+"</interactionLabel>\n",f+="<uuid>"+p+"</uuid>\n",f+="<form>"+l+"</form>\n",f+="<blinkFormsVersion>"+n+"</blinkFormsVersion>\n",2===n?(a=MyAnswers.pendingStore.get(r),i.push(a.promise()),$.when(a).fail(function(){t+="<record>"+f+"</record>\n"
}).then(function(e){var r,n="";"string"==typeof e&&0!==e.length&&("object"!==$.type(e)&&(e=$.parseJSON(e)),"array"===$.type(e)&&(e.length>=3&&(r=e[2],r.status&&(f+="<status>"+r.status+"</status>\n")),$.each(e[1],function(e,t){var r="";
r+="<name>"+e+"</name>\n",r+="<value>"+htmlspecialchars(t)+"</value>\n",n+="<field>"+r+"</field>\n"
}),f+="<fields>"+n+"</fields>\n"),t+="<record>"+f+"</record>\n")})):t+="<record>"+f+"</record>\n"
};$.each(r,function(e,t){a(e,t,2)}),$.each(n,function(e,t){a(e,t,1)}),$.whenArray(i).fail(function(){t="<type>error</type>",t+="<message>Unable to list active form records.</message>",t="<status>"+t+"</status>",e.resolve('<?xml version="1.0"?>\n<records>'+t+"</records>")
}).then(function(){e.resolve('<?xml version="1.0"?>\n<records>'+t+"</records>")})
}),e.promise()}function setSubmitCachedFormButton(){var e=$("#pendingButton");e.length>0&&$.when(window.countPendingForms()).fail(function(){e.hide()
}).then(function(t){var r=t+" Pending";MyAnswers.dispatch.add(function(){"number"==typeof t&&t>0?(insertText(e[0],r),e.show()):e.hide(),log("setSubmitCachedFormButton(): "+r)
})})}function onStarClick(){var e,t=$(this).data("id"),r=$(this).data("type"),n=$(this).data(),i=new Date;
if(delete n.id,delete n.type,$(this).hasClass("blink-star-on"))$(this).addClass("blink-star-off"),$(this).removeClass("blink-star-on"),delete starsProfile[r][t],$.isEmptyObject(starsProfile[r])&&delete starsProfile[r];
else if($(this).hasClass("blink-star-off")){$(this).addClass("blink-star-on"),$(this).removeClass("blink-star-off"),"object"!==$.type(starsProfile[r])&&(starsProfile[r]={}),starsProfile[r][t]={};
for(e in n)n.hasOwnProperty(e)&&(starsProfile[r][t][e.toUpperCase()]=n[e]);starsProfile[r][t].time=i.getTime(),starsProfile[r][t].type=r,starsProfile[r][t].id=t
}MyAnswers.store.set("starsProfile",JSON.stringify(starsProfile))}function onLinkClick(e){var t,r,n=$(this),i=n.attr(),a=!1,o=!0,s=null,c=null,u=null;
try{if(log("onLinkClick(): "+$(this).tagHTML()),n.hasClass("button")&&n.closest(".bLive-screen").length>0&&(a=!0,o=!1),"string"==typeof i.href){if(i.href=$.trim(i.href),r=explode("?",i.href,2),r[1]&&$.each(deserialize(r[1].trim()),function(e,t){i[e]=t
}),-1!==i.href.indexOf("../")&&(r[0]=r[0].replace(/^\.\.\//,""),i.interaction=r[0].replace(/^(.*)(?:\/)$/g,"$1"),delete i.href),i.href&&"#"===i.href[0])return!0;
if(i.href&&"?"===i.href[0])return delete i.interaction,delete i.keyword,delete i.style,delete i["class"],u=i.href,s=History.getState().data,s.arguments=i,c=window.document.title,o?History.pushState(s,c,u):History.replaceState(s,c,u),e.preventDefault(),!1
}if(i.href===void 0&&i.onclick===void 0)return i.back!==void 0?(History.back(),e.preventDefault(),!1):(i.home!==void 0?u="/"+siteVars.answerSpace+"/":i.login!==void 0?s={login:!0}:i.interaction||i.keyword?(t=resolveItemName(i.interaction||i.keyword,"interactions"),t&&($.each(i,function(e,t){"_"===e[0]&&(i["args["+e.substr(1)+"]"]=t,delete i[e])
}),delete i.interaction,delete i.keyword,delete i.style,delete i["class"],i["data-submit-stars-type"]&&(i._submitStarsType=n.data("submitStarsType"),i._submitStarsPost=n.data("submitStarsPost")||"stars"),u="/"+siteVars.answerSpace+"/"+siteVars.config["i"+t].pertinent.name+"/?"+$.param(i),s={m:currentMasterCategory,c:currentCategory,i:t,arguments:i})):i.category!==void 0?(t=resolveItemName(i.category,"categories"),t&&(u="/"+siteVars.answerSpace+"/?_c="+t,s={m:currentMasterCategory,c:t})):i.mastercategory!==void 0&&(t=resolveItemName(i.mastercategory,"masterCategories"),t&&(u="/"+siteVars.answerSpace+"/?_m="+t,s={m:t})),a&&("object"===$.type(s)?s._timestamp=$.now():s={_timestamp:$.now()}),(s||u)&&(o?History.pushState(s,c,u):History.replaceState(s,c,u)),e.preventDefault(),!1)
}catch(l){error("Error in onLinkClick handler..."),error(l)}return!0}function countPendingForms(){var e=new $.Deferred;
return $.when(MyAnswers.pendingStore.count(),MyAnswers.pendingV1Store.count()).then(function(t,r){e.resolve(t+r)
}).fail(function(){error("countPendingForms() unable to query storage"),e.resolve(0)
}),e.promise()}function pushPendingForm(e,t,r,n){var i=new $.Deferred;return $.when(MyAnswers.pendingStore.set(e+":"+t+":"+r,JSON.stringify(n))).then(function(){i.resolve()
}).fail(function(){i.reject()}).always(setSubmitCachedFormButton),i.promise()}function clearPendingForm(e,t,r){var n=new $.Deferred;
return $.when(MyAnswers.pendingStore.remove(e+":"+t+":"+r)).then(function(){n.resolve()
}).fail(function(){n.reject()}).always(setSubmitCachedFormButton),n.promise()}function pushPendingFormV1(e,t,r){var n=new $.Deferred;
return $.when(MyAnswers.pendingV1Store.set(e+":"+t,JSON.stringify(r))).then(function(){n.resolve(r)
}).fail(function(){n.reject()}).always(setSubmitCachedFormButton),n.promise()}function clearPendingFormV1(e,t){var r=new $.Deferred;
return $.when(MyAnswers.pendingV1Store.remove(e+":"+t)).then(function(){r.resolve()
}).fail(function(){r.reject()}).always(setSubmitCachedFormButton),r.promise()}function requestMoJO(e){var t=new $.Deferred;
return"string"!==$.type(e)||0===e.length?(t.resolve(),t.promise()):($.when(MyAnswers.store.get("mojoLastChecked:"+e)).done(function(r){var n={_id:siteVars.id,_m:e};
r=parseInt(r,10),"number"!=typeof r||isNaN(r)||(n._lc=r),deviceVars.isOnline?$.ajax({url:siteVars.serverAppPath+"/xhr/GetMoJO.php",data:n,dataType:"xml",complete:function(r){200===r.status?$.when(MyAnswers.store.set("mojoXML:"+e,r.responseText)).fail(t.reject).then(t.resolve):t.resolve()
},timeout:Math.max(1e3*currentConfig.downloadTimeout,computeTimeout(512e3))}):t.reject()
}),$.when(t.promise()).then(function(){MyAnswers.store.set("mojoLastChecked:"+e,$.now())
}),t.promise())}function processMoJOs(e){var t,r,n=new $.Deferred,i={},a=e?[e]:siteVars.map.interactions,o=a.length;
for(t=0;o>t;t++)r=siteVars.config["i"+a[t]],"object"===$.type(r)&&(r=r.pertinent,"object"===$.type(r)&&"xslt"===r.type&&"server-hosted"===r.mojoType&&"string"==typeof r.xml&&"stars:"!==r.xml.substring(0,6)&&(siteVars.mojos[r.xml]?(siteVars.mojos[r.xml].maximumAge=r.maximumAge?Math.min(r.maximumAge,siteVars.mojos[r.xml].maximumAge):siteVars.mojos[r.xml].maximumAge,siteVars.mojos[r.xml].minimumAge=r.minimumAge?Math.max(r.minimumAge,siteVars.mojos[r.xml].minimumAge):siteVars.mojos[r.xml].minimumAge):siteVars.mojos[r.xml]={maximumAge:r.maximumAge||0,minimumAge:r.minimumAge||0},i[r.xml]||(i[r.xml]=requestMoJO(r.xml))));
return i=$.map(i,function(e){return e}),$.whenArray(i).fail(n.reject).then(n.resolve),n.promise()
}function goBackToHome(){History.replaceState(null,null,"/"+siteVars.answerSpace+"/"),MyAnswers.$body.trigger("taskComplete")
}function showLoginView(){var e,t,r=$("#loginView");return currentConfig.loginAccess?MyAnswers.isCustomLogin?(e=resolveItemName(currentConfig.loginPromptInteraction,"interactions"))?(t="/"+siteVars.answerSpace+"/"+siteVars.config["i"+e].pertinent.name+"/?",History.pushState({m:null,c:null,i:e},null,t),!1):(BMP.alert("error: interaction used for login prompt is inaccessible or misconfigured"),!1):($.when(MyAnswersDevice.prepareView(r)).always(function(){MyAnswersDevice.showView(r),setMainLabel("Login")
}),void 0):!1}function updateLoginButtons(){var e=document.getElementById("loginStatus"),t=document.getElementById("loginButton"),r=document.getElementById("logoutButton"),n=function(){var e,t;
return log("submitLogout();"),currentConfig.loginAccess?currentConfig.loginUseInteractions?(e=resolveItemName(currentConfig.loginPromptInteraction,"interactions"))?(t="/"+siteVars.answerSpace+"/"+siteVars.config["i"+e].pertinent.name+"/?",History.pushState({m:null,c:null,i:e},null,t),!1):(BMP.alert("error: login interaction is inaccessible or misconfigured"),!1):(BMP.confirm("Log out?").then(function(e){e&&$.ajax({type:"GET",cache:"false",url:siteVars.serverAppPath+"/xhr/GetLogin.php",data:{_a:"logout"},complete:function(e){if(200===e.status){var t=$.parseJSON(e.responseText);
t&&("LOGGED IN"===t.status?(MyAnswers.loginAccount=t,MyAnswers.isLoggedIn=!0):(MyAnswers.isLoggedIn=!1,delete MyAnswers.loginAccount,window.location.reload())),updateLoginButtons(),goBackToHome()
}},timeout:1e3*currentConfig.downloadTimeout})}),!1):!1};siteVars.hasLogin&&(MyAnswers.isLoggedIn?(MyAnswers.loginAccount!==void 0&&"boolean"!=typeof MyAnswers.loginAccount?(MyAnswers.dispatch.add(function(){var t=$(e),r="logged in as<br />";
r+="object"===$.type(MyAnswers.loginAccount)?'<span class="loginAccount">'+MyAnswers.loginAccount.name||MyAnswers.loginAccount.username+"</span>":'<span class="loginAccount">'+MyAnswers.loginAccount+"</span>",t.empty(),t.append(r),t.unbind(),t.bind("click",n)
}),$(e).show()):$(r).show(),$(t).hide()):($(e).hide(),$(r).hide(),$(t).show()),void 0!==currentCategory&&MyAnswers.populateItemListing("interactions",$("#keywordListView")))
}function requestLoginStatus(){var e=new $.Deferred;return siteVars.hasLogin&&deviceVars.isOnline?($.ajax({url:siteVars.serverAppPath+"/xhr/GetLogin.php",dataType:"json",complete:function(t,r){if(isAJAXError(r)||200!==t.status)return e.reject(),void 0;
var n=$.parseJSON(t.responseText);n&&("LOGGED IN"===n.status?(MyAnswers.loginAccount=n,MyAnswers.isLoggedIn=!0):(MyAnswers.isLoggedIn=!1,delete MyAnswers.loginAccount)),updateLoginButtons(),e.resolve()
},timeout:Math.max(1e3*currentConfig.downloadTimeout,computeTimeout(500))}),e.promise()):(e.reject(),e.promise())
}function submitLogin(){log("submitLogin();"),$.ajax({type:"GET",cache:"false",url:siteVars.serverAppPath+"/xhr/GetLogin.php",data:$("#loginView").find("form").serializeArray(),complete:function(e,t){if($("#loginView").find("input[type=password]").val(""),200===e.status){var r=$.parseJSON(e.responseText);
r&&("LOGGED IN"===r.status?(MyAnswers.loginAccount=r,MyAnswers.isLoggedIn=!0,$.when(window.requestConfig()).always(function(){siteVars.map&&siteVars.config?(window.processConfig(),window.updateNavigationButtons()):BMP.alert("error: insufficient data, check network and reload / refresh")
})):(MyAnswers.isLoggedIn=!1,delete MyAnswers.loginAccount)),updateLoginButtons()
}else BMP.alert("Unable to login:  ("+t+" "+e.status+") "+e.responseText)},timeout:1e3*currentConfig.downloadTimeout})
}function updateNavigationButtons(){var e=MyAnswers.device.persistentStorage;MyAnswers.dispatch.add(function(){try{var t,r,n,i,a=$(".navBar"),o=$("#homeButton, #backButton"),s=$("#helpButton"),c=$("#pendingButton"),u=siteVars.hasLogin,l=window.isHome(),p=l||MyAnswers.isEmptySpace||MyAnswers.isLoginOnly;
switch($(".view:visible").first().attr("id")){case"keywordView":case"answerView":case"answerView2":currentInteraction&&(t=siteVars.config["i"+currentInteraction].pertinent.help);
break;case"helpView":t=null;break;default:t=siteVars.config["a"+siteVars.id]}r="string"==typeof t,r?(s.show(),s.removeAttr("disabled")):s.hide(),i=c.length>0&&p?countPendingForms():!0,$.when(i).always(function(e){"number"!=typeof e&&(e=0),n=p&&!u&&!r&&!e,n?a.hide():p?(a.show(),o.hide()):(o.show(),o.prop("disabled",!1),a.show())
}),$("#loginButton, #logoutButton, #pendingButton").removeAttr("disabled"),e&&l&&"pending"!==MyAnswers.dfrdMoJOs.state()&&processMoJOs(),MyAnswers.dispatch.add(function(){$(window).trigger("scroll")
}),MyAnswers.sideBar&&MyAnswers.sideBar.update()}catch(f){error("Error in updateNavigationButtons..."),error(f)
}})}function initialiseAnswerFeatures(e){log("initialiseAnswerFeatures(): view="+e.attr("id"));
var t,r=new $.Deferred,n=[],i="string"===$.type(currentInteraction)?currentInteraction:currentInteraction+"",a="string"===$.type(currentConfig.loginPromptInteraction)?currentConfig.loginPromptInteraction:currentConfig.loginPromptInteraction+"";
return currentConfig.loginAccess&&currentConfig.loginUseInteractions&&a===i&&(t=MyAnswers.isLoggedIn,$.when(requestLoginStatus()).always(function(){MyAnswers.isLoggedIn!==t&&(MyAnswers.isLoggedIn?$.when(window.requestConfig()).always(function(){siteVars.map&&siteVars.config?(window.processConfig(),window.updateNavigationButtons(),currentConfig.loginToDefaultScreen&&MyAnswers.gotoDefaultScreen()):BMP.alert("error: insufficient data, check network and reload / refresh")
}):window.location.reload())})),MyAnswers.dispatch.add(function(){var t=e.find("input, textarea, select"),r=e.find("form").first(),i=window.google!==void 0&&window.google.maps!==void 0&&window.google.maps.Map!==void 0;
MyAnswers.$body.trigger("taskBegun"),t.unbind("blur",triggerScroll),t.bind("blur",triggerScroll),MyAnswers.device.persistentStorage&&e.find(".blink-starrable").each(function(e,t){var r=$('<div class="blink-starrable" />'),n=$(t).data();
populateDataTags(r,n),r.bind("click",onStarClick),"object"!==$.type(starsProfile[$(t).data("type")])||"object"!==$.type(starsProfile[$(t).data("type")][$(t).data("id")])?r.addClass("blink-star-off"):r.addClass("blink-star-on"),$(t).replaceWith(r)
}),e.find("div.googlemap").size()>0&&(i?setTimeout(function(){MyAnswers.setupGoogleMaps(e)
},1e3):(MyAnswers.dfrdGoogleMaps=new $.Deferred,$.getCachedScript("//maps.googleapis.com/maps/api/js?key="+_Blink.cfg.GOOGLE_API_KEY+"&v=3&sensor=true&callback=MyAnswers.onGoogleMapsLoad").fail(function(){throw"unable to download Google Maps JavaScript library"
}).then(function(){$.when(MyAnswers.dfrdGoogleMaps.promise()).fail(function(){log("initialiseAnswerFeatures() error: unable to initialise Google Maps API")
}).then(function(){delete window.onGoogleMapsLoad,delete MyAnswers.dfrdGoogleMaps,MyAnswers.setupGoogleMaps(e)
})}))),0!==r.length&&("string"==typeof r.data("objectName")&&r.data("objectName").length>0?$.when(MyAnswers.formsDeferred.promise()).always(function(){n.push(BlinkForms.initialiseForm(r))
}):isCameraPresent()||r.find('input[onclick*="selectCamera"]').attr("disabled","disabled"))
}),MyAnswers.dispatch.add(function(){$.when.apply($,n).always(function(){MyAnswers.$body.trigger("taskComplete"),r.resolve(),e.trigger("viewReady")
})}),r.promise()}function updateCurrentConfig(){var e,t=[],r=_.clone(deviceVars.features),n=-1!==$.inArray("portrait",deviceVars.features)&&-1!==$.inArray("landscape",deviceVars.features),i="a"+siteVars.id,a="m"+currentMasterCategory,o="c"+currentCategory,s="i"+currentInteraction,c=function(e){var t,n,i,a,o,s,c=e.split("+"),u=c.length;
for(t=0;u>t;t++){if(n=c[t].split("|"),a=n.length,o=!0,s=!1,-1!==c[t].indexOf("|")){for(i=0;a>i;i++)if(-1!==$.inArray(n[i],r)){s=!0;
break}s||(o=!1)}else-1===$.inArray(c[t],r)&&(o=!1);if(!o)return null}return e},u=function(e){return e&&"string"==typeof e&&-1!==e.indexOf("+")?e.match(/\+/g).length:0
},l=function(r,n){t.push(e[n])};log("updateCurrentConfig(): "+i+" "+a+" "+o+" "+s),currentConfig={},t.push(currentConfig),n&&(r=_.without(r,"portrait","landscape"),r.push(MyAnswers.orientation)),$.each([i,a,o,s],function(r,n){var i,a;
e=siteVars.config[n],e&&$.isObject(e)&&(i=_.keys(e),a=1===i.length&&"pertinent"===i[0],a?t.push(e.pertinent):(t.push(e.pertinent),i=$.map(i,c),i=_.sortBy(i,u),$.each(i,l)))
}),$.extend.apply(this,t),MyAnswers.dispatch.add(function(){var e=$("#bannerBox"),t=e.find("img"),r=currentConfig.logoBanner;
"string"==typeof currentConfig.logoBanner?(r!==t.attr("src")&&t.attr("src",r),e.show()):(t.removeAttr("src"),e.hide())
}),MyAnswers.dispatch.add(function(){MyAnswers.$footer.html()!==currentConfig.footer&&MyAnswers.$footer.html(currentConfig.footer),"screen-bottom"===currentConfig.footerPosition?MyAnswers.$footer.css({position:"fixed",bottom:"0px","z-index":1}):MyAnswers.$footer.removeAttr("style")
}),MyAnswers.dispatch.add(function(){var e="",t=$('style[data-setting="styleSheet"]');
e+=currentConfig.styleSheet||"",e+=currentConfig.interfaceStyle?"body { "+currentConfig.interfaceStyle+" }\n":"",e+=currentConfig.backgroundStyle?".box { "+currentConfig.backgroundStyle+" }\n":"",e+=currentConfig.inputPromptStyle?"#argsBox { "+currentConfig.inputPromptStyle+" }\n":"",e+=currentConfig.evenRowStyle?"ul.box > li:nth-child(even), tr.even { "+currentConfig.evenRowStyle+" }\n":"",e+=currentConfig.oddRowStyle?"ul.box > li:nth-child(odd), tr.odd { "+currentConfig.oddRowStyle+" }\n":"",e+=currentConfig.headerStyle?"body > header { "+currentConfig.headerStyle+" }\n":"",e+=currentConfig.footerStyle?"body > footer { "+currentConfig.footerStyle+" }\n":"",e+=currentConfig.masterCategoriesStyle?"#masterCategoriesBox > .masterCategory { "+currentConfig.masterCategoriesStyle+" }\n":"",e+=currentConfig.categoriesStyle?"#categoriesBox > .category { "+currentConfig.categoriesStyle+" }\n":"",e+=currentConfig.interactionsStyle?"#keywordBox > .interaction, #keywordList > .interaction { "+currentConfig.interactionsStyle+" }\n":"",t.length&&(t[0].styleSheet?e!==t[0].styleSheet.cssText&&(t[0].styleSheet.cssText=e):e!==t.text()&&t.text(e))
}),MyAnswers.dispatch.add(function(){var e,t=$(".view:visible").last();try{if(t.hasClass("listing")){switch(t.attr("id")){case"masterCategoriesView":e="masterCategories";
break;case"categoriesView":e="categories";break;default:e="interactions"}MyAnswers.populateItemListing(e,t)
}}catch(r){r("Error in updateCurrentConfig...")}})}function showMasterCategoriesView(e){var t=$("#masterCategoriesView");
log("showMasterCategoriesView()"),currentInteraction=null,currentCategory=null,currentMasterCategory=null,$.when(MyAnswersDevice.prepareView(t,e)).always(function(){MyAnswers.populateItemListing("masterCategories",t),updateCurrentConfig(),setMainLabel("Master Categories"),MyAnswersDevice.showView(t,e)
})}function goBackToMasterCategoriesView(){var e=$("#masterCategoriesView");log("goBackToMasterCategoriesView()"),$.when(MyAnswersDevice.prepareView(e,!0)).always(function(){updateCurrentConfig(),setMainLabel("Master Categories"),MyAnswersDevice.showView($("#masterCategoriesView"),!0)
})}function showCategoriesView(e){var t=$("#categoriesView");log("showCategoriesView(): "+e),currentInteraction=null,currentCategory=null,hasMasterCategories&&e&&(currentMasterCategory=e),$.when(MyAnswersDevice.prepareView(t)).always(function(){updateCurrentConfig(),setMainLabel(e?siteVars.config["m"+e].pertinent.name:"Categories"),MyAnswers.populateItemListing("categories",t),MyAnswersDevice.showView(t)
})}function goBackToCategoriesView(){var e=$("#categoriesView");currentInteraction=null,currentCategory=null,log("goBackToCategoriesView()"),$.when(MyAnswersDevice.prepareView(e,!0)).always(function(){updateCurrentConfig(),setMainLabel(currentMasterCategory?siteVars.config["m"+currentMasterCategory].pertinent.name:"Categories"),MyAnswersDevice.showView(e,!0)
})}function restoreSessionProfile(e){log("restoreSessionProfile():");var t,r=siteVars.serverAppPath+"/util/GetSession.php",n=new $.Deferred;
return"string"!==$.type(e)||0===e.length?(n.reject(),n.promise()):(t="_as="+siteVars.answerSpace+"&_t="+e,$.ajax({url:r,data:t,dataType:"json",complete:function(e,t){if(isAJAXError(t)||200!==e.status)return BMP.alert("Connection error, please try again later. ("+t+" "+e.status+")"),n.reject(),n.promise();
var r=$.parseJSON(e.responseText);if(null===r)return log("restoreSessionProfile error: null data"),BMP.alert("Connection error, please try again later. ("+t+" "+e.status+")"),n.reject(),n.promise();
if("string"!=typeof r.errorMessage&&"string"!=typeof r.statusMessage){if(log("restoreSessionProfile success: no error messages, data: "+r),null===r.sessionProfile)return n.reject(),n.promise();
MyAnswers.store.set("starsProfile",JSON.stringify(r.sessionProfile.stars)),starsProfile=r.sessionProfile.stars
}"string"==typeof r.errorMessage&&(log("restoreSessionProfile error: "+r.errorMessage),n.reject()),setTimeout(function(){n.resolve()
},100)},timeout:Math.max(1e3*currentConfig.downloadTimeout,computeTimeout(10240))}),n.promise())
}function processFormsMap(e){var t,r,n={};return eachElement=function(e,t){var i=$(t);
n[r][i.attr("id")]=i.attr("object")},!e instanceof jQuery||!e.length?{}:(e.children("formObject[id]").each(function(e,i){t=$(i),r=t.attr("id"),n[r]={},t.children("formElement[id][object]").each(eachElement)
}),n)}function processForms(){var e,t=new BlinkDispatch(0),r=new $.Deferred,n=new $.Deferred,i=["add","delete","edit","find","list","search","view"],a=function(e,r){var n=new $.Deferred;
return t.add(function(){var t,a,o=$(r),s=o.tag(),c="formXML:"+e+":"+s,u=o.children(),l=u.length,p="";
if(-1!==i.indexOf(o.tag())){for(t=0;l>t;t++)a=_Blink.stringifyDOM(u[t]),a&&(p+=a);
$.when(MyAnswers.store.set(c,p)).fail(function(){warn("processForms()->formActionFn(): failed storing "+c),n.reject()
}).then(function(){MyAnswers.store.set("formLastChecked:"+e+":"+s,$.now()),MyAnswers.isDebug&&log("processForms()->formActionFn(): formXML="+c),n.resolve()
})}else n.resolve()}),n.promise()},o=function(t,r){var n=$(r);"_map"===n.tag()?siteVars.map.forms=processFormsMap(n):n.children().each(function(t,r){e.push(a(n.attr("id"),r))
})};n=window.BlinkForms&&window.BlinkFormObject&&window.BlinkFormElement?!0:$.getCachedScript(siteVars.serverAppPath+"/BlinkForms2.js"),e=[n],MyAnswers.device.persistentStorage&&(e.push(r.promise()),deviceVars.isOnline?$.ajax({url:siteVars.serverAppPath+"/xhr/GetForm.php",dataType:"xml",complete:function(e){var t;
200===e.status&&"string"==typeof e.responseText&&(e.responseText=e.responseText.substring(e.responseText.indexOf("<formObjects>")),t=$($.parseXML(e.responseText)),t.children().children().each(o)),200===e.status||304===e.status?r.resolve():(warn("processForms()->GetForm.XHR: failed "+e.status),r.reject())
},timeout:Math.max(1e3*currentConfig.downloadTimeout,computeTimeout(512e3))}):r.resolve()),$.whenArray(e).fail(MyAnswers.formsDeferred.reject).then(MyAnswers.formsDeferred.resolve)
}function processConfig(){var e,t;MyAnswers.isEmptySpace=!1,MyAnswers.isLoginOnly=!1,log("processConfig(): currentMasterCategory="+currentMasterCategory+" currentCategory="+currentCategory+" currentInteraction="+currentInteraction),"object"===$.type(siteVars.config["a"+siteVars.id])?(t=siteVars.config["a"+siteVars.id].pertinent,e=t.siteStructure,"master categories"===e&&(hasMasterCategories=siteVars.map.masterCategories.length>0),"interactions only"!==e&&(hasCategories=siteVars.map.categories.length>0),hasInteractions=siteVars.map.interactions.length>0,answerSpaceOneKeyword=1===siteVars.map.interactions.length,t.loginAccess&&t.loginUseInteractions&&t.loginPromptInteraction&&t.loginStatusInteraction&&siteVars.config["i"+t.loginPromptInteraction]&&siteVars.config["i"+t.loginStatusInteraction]&&(MyAnswers.isCustomLogin=!0),siteVars.map&&0===siteVars.map.masterCategories.length&&0===siteVars.map.categories.length&&siteVars.map.interactions.length===(MyAnswers.isCustomLogin?2:0)&&(MyAnswers.isEmptySpace=!0),t.loginAccess&&!MyAnswers.isLoggedIn&&("deny anonymous"===t.registeredOnly||MyAnswers.isEmptySpace)&&(MyAnswers.isLoginOnly=!0)):log("processConfig(): unable to retrieve answerSpace config")
}function requestConfig(){var e=($.now(),new $.Deferred),t=MyAnswers.device.persistentStorage,r=siteVars.serverAppPath+"/xhr/GetConfig.php";
return deviceVars.isOnline?($.ajax({url:r+"?_asn="+siteVars.answerSpace,type:"POST",dataType:"json",timeout:computeTimeout(40960),complete:function(r){var n,i,a=["a"+siteVars.id];
200===r.status&&(n=$.parseJSON(r.responseText),"object"===$.type(n.map)&&(siteVars.map=n.map,t&&MyAnswers.siteStore.set("map",JSON.stringify(siteVars.map))),"object"===$.type(n["a"+siteVars.id])&&(i=n["a"+siteVars.id].pertinent.siteStructure),siteVars.map&&("master categories"===i&&siteVars.map.masterCategories.length>0&&(a=a.concat($.map(siteVars.map.masterCategories,function(e){return"m"+e
}))),"interactions only"!==i&&siteVars.map.categories.length>0&&(a=a.concat($.map(siteVars.map.categories,function(e){return"c"+e
}))),siteVars.map.interactions.length>0&&(a=a.concat($.map(siteVars.map.interactions,function(e){return"i"+e
}))))),("object"!==$.type(siteVars.config)||a.length>0)&&(siteVars.config={}),$.each(a,function(e,t){"object"===$.type(n[t])&&(siteVars.config[t]=n[t])
}),t&&MyAnswers.siteStore.set("config",JSON.stringify(siteVars.config)),deviceVars.features=n.deviceFeatures,200===r.status||304===r.status||0===r.status?e.resolve():e.reject()
}}),e.promise()):(e.reject(),e.promise())}function gotoStorageView(){var e,t;if(currentConfig.activeFormsUseInteraction){if(e=siteVars.config["i"+currentConfig.activeFormsInteraction],"object"!==$.type(e))return BMP.alert("Interaction for active forms listing could not be found."),void 0;
t="/"+siteVars.answerSpace+"/"+e.pertinent.name+"/?",History.pushState({i:currentConfig.activeFormsInteraction},null,t)
}else t="/"+siteVars.answerSpace+"/?_storage=true",History.pushState({storage:!0},null,t)
}function showPendingView(){var e=$("#pendingView"),t=$("#pendingBox"),r=t.children("[data-blink-form-version=2]"),n=t.children("[data-blink-form-version=1]"),i=t.children(".bForm-noPending");
$.when(MyAnswers.pendingStore.keys(),MyAnswers.pendingV1Store.keys()).then(function(t,a){var o=(t.length+a.length,function(e,t,r){var n,i=r.data("blinkFormVersion"),a=r.children(".template"),o=a.clone(),s=t.split(":"),c=siteVars.config["i"+s[0]],u=c?c.pertinent.displayName||c.pertinent.name:"* unknown *",l=s[1],p=s[2];
o.children("h3").text(u),o.children("pre.uuid").text(p),o.attr("data-id",t),2===i&&$.when(MyAnswers.pendingStore.get(t)).then(function(e){"string"==typeof e&&0!==e.length&&("object"!==$.type(e)&&(e=$.parseJSON(e)),"array"===$.type(e)&&(n=o.children("dl"),$.each(e[1],function(e,t){n.append("<dt>"+e+"</dt><dd>"+t+"</dd>")
})))}),o.data("interaction",s[0]),o.data("form",l),MyAnswers.dispatch.add(function(){o.appendTo(r),o.show().removeClass("template")
})});MyAnswers.dispatch.add(function(){r.children(".bForm-pending:not(.template)").remove(),t.length>0?($.each(t,function(e,t){o(e,t,r)
}),r.show()):r.hide(),n.children(".bForm-pending:not(.template)").remove(),a.length>0?($.each(a,function(e,t){o(e,t,n)
}),n.show()):n.hide(),a.length+t.length>0?i.hide():i.show()}),MyAnswers.dispatch.add(function(){$.when(MyAnswersDevice.prepareView(e)).always(function(){MyAnswersDevice.showView(e)
})})})}function createParamsAndArgs(e){var t=siteVars.config["i"+e],r="asn="+siteVars.answerSpace+"&iact="+encodeURIComponent(t.pertinent.name),n="",i=$("#argsBox").find("input, textarea, select");
return void 0!==t&&t.pertinent.inputPrompt?(n="",i.each(function(){!this.type||"radio"!==this.type.toLowerCase()&&"checkbox"!==this.type.toLowerCase()||this.checked?this.name?n+="&"+this.name+"="+(this.value?encodeURIComponent(this.value):""):this.id&&this.id.match(/\d+/g)&&(n+="&args["+this.id.match(/\d+/g)+"]="+(this.value?encodeURIComponent(this.value):"")):$.noop()
}),n.length>0?r+=encodeURI(n):1===i.size()&&this.value&&(r+="&args="+encodeURIComponent(this.value)),r):r
}function showAnswerView(e,t,r){log("showAnswerView(): interaction="+e+" args="+t);
var n,i,a=$("#answerView"),o=$("#answerBox"),s=o[0],c=function(){$.when(initialiseAnswerFeatures(a)).always(function(){setMainLabel(currentConfig.displayName||currentConfig.name),MyAnswersDevice.showView(a,r),MyAnswers.dispatch.add(function(){MyAnswers.$body.trigger("taskComplete")
})})},u=MyAnswers.device.persistentStorage,l=!deviceVars.disableXSLT&&u;return e=resolveItemName(e),e===!1?(BMP.alert("The requested Interaction could not be found."),void 0):(MyAnswers.$body.trigger("taskBegun"),$.when(MyAnswersDevice.prepareView(a,r)).always(function(){if(currentInteraction=e,updateCurrentConfig(),"string"==typeof currentConfig.xml&&"stars:"!==currentConfig.xml.substring(0,6)&&"server-hosted"===currentConfig.mojoType&&"pending"!==MyAnswers.dfrdMoJOs.state()&&requestMoJO(currentConfig.xml),"string"==typeof t&&t.length>0?(i={},$.extend(i,deserialize(t))):i="object"===$.type(t)?t:{},currentConfig.inputPrompt&&!t&&($.extend(i,deserialize(createParamsAndArgs(e))),delete i.answerSpace,delete i.interaction),"hyperlink"===currentConfig.type)window.open(currentConfig.hyperlink,currentConfig.hyperlinkTarget);
else if("message"===currentConfig.type)insertHTML(s,currentConfig.message),c();else if("xslt"===currentConfig.type&&l)$.when(MyAnswers.dfrdMoJOs).always(function(){$.when(generateMojoAnswer(i)).always(function(e){insertHTML(s,e),c()
})});else if(r&&u)$.when(MyAnswers.store.get("answer___"+e)).done(function(e){insertHTML(s,e),c()
});else if("form"===currentConfig.type&&currentConfig.blinkFormObjectName&&currentConfig.blinkFormAction)$.when(MyAnswers.dfrdMoJOs,MyAnswers.formsDeferred.promise()).fail(function(){n="<p>Error: forms Interactions are currently unavailable. Reload the application and try again.</p>"
}).then(function(){n=$('<form data-object-name="'+currentConfig.blinkFormObjectName+'" novalidate="novalidate" data-action="'+currentConfig.blinkFormAction+'" />'),n.data(i)
}).always(function(){insertHTML(s,n),c()});else{var a=siteVars.serverAppPath+"/xhr/GetAnswer.php",o={asn:siteVars.answerSpace,iact:currentConfig.name},p=function(){u?$.when(MyAnswers.store.get("answer___"+e)).done(function(e){e===void 0&&(e="<p>Unable to reach server, and unable to display previously stored content.</p>"),insertHTML(s,e),c()
}):(n="<p>Unable to reach server.</p>",insertHTML(s,n),c())},f={},d={},g="GET";$.isEmptyObject(i)||$.extend(o,i),o._submitStarsType&&(g="POST","string"===$.type(o._submitStarsType)&&(o._submitStarsType=[o._submitStarsType]),"array"===$.type(o._submitStarsType)&&$.each(o._submitStarsType,function(e,t){d[t]=starsProfile[t]||{}
}),f[o._submitStarsPost||"stars"]=d,delete o._submitStarsPost,delete o._submitStarsType,a+="?"+$.param(o),o=f),$.ajax({type:g,url:a,data:o,complete:function(t,r){if("timeout"===r)insertHTML(s,"Error: the server has taken too long to respond.  ("+r+" "+t.status+")"),c();
else if(isAJAXError(r)||200!==t.status)p();else{log("GetAnswer: storing server response"),n=t.responseText;
var i,a,o=n.match(/<!-- blinkAnswerMessage:\{.*\} -->/g);if("array"===$.type(o))for(a=o.length,i=0;a>i;i++)processBlinkAnswerMessage(o[i].substring(24,o[i].length-4));
u&&MyAnswers.store.set("answer___"+e,n),insertHTML(s,n),c()}},timeout:Math.max(1e3*currentConfig.downloadTimeout,6e4)})
}}),void 0)}function getAnswer(){var e,t,r,n=resolveItemName(currentInteraction,"interactions");
n&&(t=deserialize(createParamsAndArgs(currentInteraction)),delete t.asn,delete t.iact,r=$.param(t),e="/"+siteVars.answerSpace+"/"+siteVars.config["i"+n].pertinent.name+"/?"+r,History.pushState({m:currentMasterCategory,c:currentCategory,i:n,arguments:t},null,e))
}function showKeywordView(e){var t=$("#keywordView");$.when(MyAnswersDevice.prepareView(t)).always(function(){var r=siteVars.config["i"+e].pertinent,n=$("#argsBox")[0],i=$("#descriptionBox")[0];
currentInteraction=e,updateCurrentConfig(),insertHTML(n,r.inputPrompt),r.description?(insertHTML(i,r.description),$(i).show()):$(i).hide(),MyAnswersDevice.showView(t),setMainLabel(r.displayName||r.name)
})}function goBackToKeywordView(e){var t=$("#keywordView");$.when(MyAnswersDevice.prepareView(t,!0)).always(function(){var r=siteVars.config["i"+e].pertinent;
currentInteraction=e,updateCurrentConfig(),MyAnswersDevice.showView(t,!0),setMainLabel(r.displayName||r.name)
})}function gotoNextScreen(e,t,r){var n;return siteVars.map.interactions.length,log("gotoNextScreen(): "+e),e=resolveItemName(e),e===!1?(BMP.alert("The requested Interaction could not be found."),void 0):(n=siteVars.config["i"+e],hasMasterCategories&&r&&(currentMasterCategory=r),hasCategories&&t&&(currentCategory=t),currentInteraction=e,n.pertinent.inputPrompt?showKeywordView(e):showAnswerView(e),void 0)
}function showSecondLevelAnswerView(e,t){var r,n=resolveItemName(e,"interactions");
log("showSecondLevelAnswerView(): keyword="+e+" args="+t),n&&(r="/"+siteVars.answerSpace+"/"+siteVars.config["i"+n].pertinent.name+"/?"+t,History.pushState({m:currentMasterCategory,c:currentCategory,i:n,arguments:deserialize(t)},null,r))
}function showKeywordListView(e,t){var r,n=$("#keywordListView");currentInteraction=null,currentCategory=e,hasMasterCategories&&t&&(currentMasterCategory=t),log("showKeywordListView(): hasCategories="+hasCategories+" currentCategory="+currentCategory),$.when(MyAnswersDevice.prepareView(n)).always(function(){updateCurrentConfig(),hasCategories?("function"==typeof prepareHistorySideBar&&prepareHistorySideBar(),r=currentConfig.displayName||currentConfig.name):r="Interactions",MyAnswers.populateItemListing("interactions",n),MyAnswersDevice.showView(n),setMainLabel(r)
})}function goBackToKeywordListView(){var e,t,r=$("#keywordListView");return currentInteraction=null,answerSpaceOneKeyword?(showKeywordView(0),void 0):hasMasterCategories&&null===currentMasterCategory?(goBackToMasterCategoriesView(),void 0):hasCategories&&null===currentCategory?(goBackToCategoriesView(hasMasterCategories?currentCategory:null),void 0):(hasCategories?(t=siteVars.config["c"+currentCategory].pertinent,e=t.displayName||t.name):e="Interactions",$.when(MyAnswersDevice.prepareView(r,!0)).always(function(){updateCurrentConfig(),MyAnswersDevice.showView(r,!0),setMainLabel(e)
}),void 0)}function showHelpView(){var e,t=document.getElementById("helpBox"),r=$("#helpView");
$.when(MyAnswersDevice.prepareView(r)).always(function(){switch($(".view:visible").first().attr("id")){case"keywordView":case"answerView":case"answerView2":currentInteraction&&(e=siteVars.config["i"+currentInteraction].pertinent.help||"Sorry, no guidance has been prepared for this item.");
break;default:e=siteVars.config["a"+siteVars.id].pertinent.help||"Sorry, no guidance has been prepared for this item."
}insertHTML(t,e),MyAnswersDevice.showView(r)})}function goBackToTopLevelAnswerView(){var e=$("#answerView");
log("goBackToTopLevelAnswerView()"),$.when(MyAnswersDevice.prepareView(e,!0)).always(function(){MyAnswersDevice.showView(e,!0)
})}function submitFormWithRetry(e){var t,r,n,i,a,o,s=siteVars.serverAppPath+"/xhr/GetAnswer.php?",c=$(".view:visible"),u=c.children(".box").first();
"object"===$.type(e)?(t=e.data,r=e.action.split("/"),n=e.method,i=e.uuid,".."===r[0]?(s+="asn="+siteVars.answerSpace+"&iact="+encodeURIComponent(r[1])+(r[2].length>1?"&"+r[2].substring(1):""),a=r[1]):(s+="asn="+r[1]+"&iact="+encodeURIComponent(r[2]),a=r[2]),"GET"===n?o="&"+t:(n="POST",o=t),MyAnswers.$body.trigger("taskBegun"),$.ajax({type:n,cache:"false",url:s,data:o,complete:function(t,r){var n;
isAJAXError(r)||200!==t.status?n="Unable to contact server. Your submission has been stored for future attempts.  ("+r+" "+t.status+")":(MyAnswers.device.persistentStorage&&clearPendingFormV1(e.interaction,i),n=t.responseText),$.when(MyAnswersDevice.prepareView(c)).always(function(){insertHTML(u[0],n),$.when(initialiseAnswerFeatures(u)).always(function(){MyAnswersDevice.showView(c)
}),MyAnswers.$body.trigger("taskComplete")})},timeout:Math.max(1e3*currentConfig.uploadTimeout,computeTimeout(s.length+o.length))})):log("submitFormWithRetry(): error: no forms in the queue")
}function submitForm(){var e,t="",r=$(".view:visible").find("form").first(),n=r.attr("action"),i=r.attr("method"),a=Math.uuid();
return r.find("input, textarea, select").each(function(e,r){r.name&&(!r.type||"radio"!==r.type.toLowerCase()&&"checkbox"!==r.type.toLowerCase()||r.checked!==!1?r.type&&"button"===r.type.toLowerCase()&&lastPictureTaken.image.size()>0?lastPictureTaken.image.containsKey(r.name)&&(t+="&"+r.name+"="+encodeURIComponent(lastPictureTaken.image.get(r.name))):t+=r.type&&"button"===r.type.toLowerCase()?"Gallery"!==r.value&&"Camera"!==r.value?"&"+r.name+"="+encodeURIComponent(r.value):"&"+r.name+"=":"&"+r.name+"="+encodeURIComponent(r.value):$.noop())
}),log("lastPictureTaken.image.size() = "+lastPictureTaken.image.size()),lastPictureTaken.image.clear(),log("submitForm(2): "+document.forms[0].action),e={data:t,action:n,method:"string"===$.type(i)?i.toUpperCase():"post",uuid:a,interaction:currentInteraction},MyAnswers.device.persistentStorage?$.when(pushPendingFormV1(currentInteraction,a,e)).fail(function(){BMP.alert("Error: unable to feed submission through queue.")
}).then(submitFormWithRetry):submitFormWithRetry(e),!1}function submitAction(e,t){log("submitAction(): keyword="+e+" action="+t);
var r,n,i,a=$(".view:visible,"),o=a.children(".box"),s=o.find("form").first(),c=s.find("input[type=submit]"),u=s.find("input[name=blink_session_data]"),l="cancel=Cancel"===t?"":s.find("input, textarea, select").serialize(),p=s.attr("method");
return 1===c.length&&c.attr("name")&&c.val()&&(l+="&"+c.attr("name")+"="+c.val()),1!==u.size()||$.isEmptyObject(starsProfile)||(i='{"stars":'+JSON.stringify(starsProfile)+"}",l=l.replace("blink_session_data=","blink_session_data="+encodeURIComponent(i)),p="post"),"string"===$.type(p)&&"get"===p.toLowerCase()?(p="GET",n=siteVars.serverAppPath+"/xhr/GetAnswer.php?asn="+siteVars.answerSpace+"&iact="+e,r="&"+l+("string"==typeof t&&t.length>0?"&"+t:"")):(p="POST",n=siteVars.serverAppPath+"/xhr/GetAnswer.php?asn="+siteVars.answerSpace+"&iact="+e+("string"==typeof t&&t.length>0?"&"+t:""),r=l),MyAnswers.$body.trigger("taskBegun"),$.ajax({type:p,cache:"false",url:n,data:r,complete:function(e,t){var r,n,i,s;
if(r=isAJAXError(t)||200!==e.status?"Unable to contact server.":e.responseText,s=r.match(/<!-- blinkAnswerMessage:\{.*\} -->/g),"array"===$.type(s))for(i=s.length,n=0;i>n;n++)processBlinkAnswerMessage(s[n].substring(24,s[n].length-4));
$.when(MyAnswersDevice.prepareView(a)).always(function(){insertHTML(o[0],r),$.when(initialiseAnswerFeatures(o)).always(function(){MyAnswersDevice.showView(a)
}),MyAnswers.$body.trigger("taskComplete")})},timeout:Math.max(1e3*currentConfig.downloadTimeout,computeTimeout(n.length+r.length))}),!1
}window.JSON||(window.JSON={}),function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];
return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'
}function str(e,t){var r,n,i,a,o,s=gap,c=t[e];switch(c&&"object"==typeof c&&"function"==typeof c.toJSON&&(c=c.toJSON(e)),"function"==typeof rep&&(c=rep.call(t,e,c)),typeof c){case"string":return quote(c);
case"number":return isFinite(c)?c+"":"null";case"boolean":case"null":return c+"";
case"object":if(!c)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(c)){for(a=c.length,r=0;a>r;r+=1)o[r]=str(r,c)||"null";
return i=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+s+"]":"["+o.join(",")+"]",gap=s,i
}if(rep&&"object"==typeof rep)for(a=rep.length,r=0;a>r;r+=1)n=rep[r],"string"==typeof n&&(i=str(n,c),i&&o.push(quote(n)+(gap?": ":":")+i));
else for(n in c)Object.hasOwnProperty.call(c,n)&&(i=str(n,c),i&&o.push(quote(n)+(gap?": ":":")+i));
return i=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+s+"}":"{"+o.join(",")+"}",gap=s,i
}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null
},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()
});var JSON=window.JSON,cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;
"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,r){var n;if(gap="",indent="","number"==typeof r)for(n=0;r>n;n+=1)indent+=" ";
else"string"==typeof r&&(indent=r);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});
throw Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var r,n,i=e[t];
if(i&&"object"==typeof i)for(r in i)Object.hasOwnProperty.call(i,r)&&(n=walk(i,r),void 0!==n?i[r]=n:delete i[r]);
return reviver.call(e,t,i)}var j;if(text+="",cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)
})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;
throw new SyntaxError("JSON.parse")})}(),function(e,t){"use strict";var r=e.History=e.History||{},n=e.jQuery;
if(r.Adapter!==void 0)throw Error("History.js Adapter has already been loaded...");
r.Adapter={bind:function(e,t,r){n(e).bind(t,r)},trigger:function(e,t,r){n(e).trigger(t,r)
},extractEventData:function(e,r,n){var i=r&&r.originalEvent&&r.originalEvent[e]||n&&n[e]||t;
return i},onDomLoad:function(e){n(e)}},r.init!==void 0&&r.init()}(window),function(e){"use strict";
var t=e.document,r=e.setTimeout||r,n=e.clearTimeout||n,i=e.setInterval||i,a=e.History=e.History||{};
if(a.initHtml4!==void 0)throw Error("History.js HTML4 Support has already been loaded...");
a.initHtml4=function(){return a.initHtml4.initialized!==void 0?!1:(a.initHtml4.initialized=!0,a.enabled=!0,a.savedHashes=[],a.isLastHash=function(e){var t,r=a.getHashByIndex();
return t=e===r},a.saveHash=function(e){return a.isLastHash(e)?!1:(a.savedHashes.push(e),!0)
},a.getHashByIndex=function(e){var t=null;return t=e===void 0?a.savedHashes[a.savedHashes.length-1]:0>e?a.savedHashes[a.savedHashes.length+e]:a.savedHashes[e]
},a.discardedHashes={},a.discardedStates={},a.discardState=function(e,t,r){var n,i=a.getHashByState(e);
return n={discardedState:e,backState:r,forwardState:t},a.discardedStates[i]=n,!0},a.discardHash=function(e,t,r){var n={discardedHash:e,backState:r,forwardState:t};
return a.discardedHashes[e]=n,!0},a.discardedState=function(e){var t,r=a.getHashByState(e);
return t=a.discardedStates[r]||!1},a.discardedHash=function(e){var t=a.discardedHashes[e]||!1;
return t},a.recycleState=function(e){var t=a.getHashByState(e);return a.discardedState(e)&&delete a.discardedStates[t],!0
},a.emulated.hashChange&&(a.hashChangeInit=function(){a.checkerFunction=null;var r,n,o,s,c="";
return a.isInternetExplorer()?(r="historyjs-iframe",n=t.createElement("iframe"),n.setAttribute("id",r),n.style.display="none",t.body.appendChild(n),n.contentWindow.document.open(),n.contentWindow.document.close(),o="",s=!1,a.checkerFunction=function(){if(s)return!1;
s=!0;var t=a.getHash()||"",r=a.unescapeHash(n.contentWindow.document.location.hash)||"";
return t!==c?(c=t,r!==t&&(o=r=t,n.contentWindow.document.open(),n.contentWindow.document.close(),n.contentWindow.document.location.hash=a.escapeHash(t)),a.Adapter.trigger(e,"hashchange")):r!==o&&(o=r,a.setHash(r,!1)),s=!1,!0
}):a.checkerFunction=function(){var t=a.getHash();return t!==c&&(c=t,a.Adapter.trigger(e,"hashchange")),!0
},a.intervalList.push(i(a.checkerFunction,a.options.hashChangeInterval)),!0},a.Adapter.onDomLoad(a.hashChangeInit)),a.emulated.pushState&&(a.onHashChange=function(r){var n,i=r&&r.newURL||t.location.href,o=a.getHashByUrl(i),s=null,c=null;
return a.isLastHash(o)?(a.busy(!1),!1):(a.doubleCheckComplete(),a.saveHash(o),o&&a.isTraditionalAnchor(o)?(a.Adapter.trigger(e,"anchorchange"),a.busy(!1),!1):(s=a.extractState(a.getFullUrl(o||t.location.href,!1),!0),a.isLastSavedState(s)?(a.busy(!1),!1):(c=a.getHashByState(s),n=a.discardedState(s),n?(a.getHashByIndex(-2)===a.getHashByState(n.forwardState)?a.back(!1):a.forward(!1),!1):(a.pushState(s.data,s.title,s.url,!1),!0))))
},a.Adapter.bind(e,"hashchange",a.onHashChange),a.pushState=function(r,n,i,o){if(a.getHashByUrl(i))throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");
if(o!==!1&&a.busy())return a.pushQueue({scope:a,callback:a.pushState,args:arguments,queue:o}),!1;
a.busy(!0);var s=a.createStateObject(r,n,i),c=a.getHashByState(s),u=a.getState(!1),l=a.getHashByState(u),p=a.getHash();
return a.storeState(s),a.expectedStateId=s.id,a.recycleState(s),a.setTitle(s),c===l?(a.busy(!1),!1):c!==p&&c!==a.getShortUrl(t.location.href)?(a.setHash(c,!1),!1):(a.saveState(s),a.Adapter.trigger(e,"statechange"),a.busy(!1),!0)
},a.replaceState=function(e,t,r,n){if(a.getHashByUrl(r))throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");
if(n!==!1&&a.busy())return a.pushQueue({scope:a,callback:a.replaceState,args:arguments,queue:n}),!1;
a.busy(!0);var i=a.createStateObject(e,t,r),o=a.getState(!1),s=a.getStateByIndex(-2);
return a.discardState(o,i,s),a.pushState(i.data,i.title,i.url,!1),!0}),a.emulated.pushState&&a.getHash()&&!a.emulated.hashChange&&a.Adapter.onDomLoad(function(){a.Adapter.trigger(e,"hashchange")
}),void 0)},a.init!==void 0&&a.init()}(window),function(e,t){"use strict";var r=e.console||t,n=e.document,i=e.navigator,a=e.sessionStorage||!1,o=e.setTimeout,s=e.clearTimeout,c=e.setInterval,u=e.clearInterval,l=e.JSON,p=e.alert,f=e.History=e.History||{},d=e.history;
if(l.stringify=l.stringify||l.encode,l.parse=l.parse||l.decode,f.init!==void 0)throw Error("History.js Core has already been loaded...");
f.init=function(){return f.Adapter===void 0?!1:(f.initCore!==void 0&&f.initCore(),f.initHtml4!==void 0&&f.initHtml4(),!0)
},f.initCore=function(){if(f.initCore.initialized!==void 0)return!1;if(f.initCore.initialized=!0,f.options=f.options||{},f.options.hashChangeInterval=f.options.hashChangeInterval||100,f.options.safariPollInterval=f.options.safariPollInterval||500,f.options.doubleCheckInterval=f.options.doubleCheckInterval||500,f.options.storeInterval=f.options.storeInterval||1e3,f.options.busyDelay=f.options.busyDelay||250,f.options.debug=f.options.debug||!1,f.options.initialTitle=f.options.initialTitle||n.title,f.intervalList=[],f.clearAllIntervals=function(){var e,t=f.intervalList;
if(t!==void 0&&null!==t){for(e=0;t.length>e;e++)u(t[e]);f.intervalList=null}},f.debug=function(){(f.options.debug||!1)&&f.log.apply(f,arguments)
},f.log=function(){var e,t,i,a,o,s=r!==void 0&&r.log!==void 0&&r.log.apply!==void 0,c=n.getElementById("log");
for(s?(a=Array.prototype.slice.call(arguments),e=a.shift(),r.debug!==void 0?r.debug.apply(r,[e,a]):r.log.apply(r,[e,a])):e="\n"+arguments[0]+"\n",t=1,i=arguments.length;i>t;++t){if(o=arguments[t],"object"==typeof o&&l!==void 0)try{o=l.stringify(o)
}catch(u){}e+="\n"+o+"\n"}return c?(c.value+=e+"\n-----\n",c.scrollTop=c.scrollHeight-c.clientHeight):s||p(e),!0
},f.getInternetExplorerMajorVersion=function(){var e=f.getInternetExplorerMajorVersion.cached=f.getInternetExplorerMajorVersion.cached!==void 0?f.getInternetExplorerMajorVersion.cached:function(){for(var e=3,t=n.createElement("div"),r=t.getElementsByTagName("i");(t.innerHTML="<!--[if gt IE "+ ++e+"]><i></i><![endif]-->")&&r[0];);return e>4?e:!1
}();return e},f.isInternetExplorer=function(){var e=f.isInternetExplorer.cached=f.isInternetExplorer.cached!==void 0?f.isInternetExplorer.cached:Boolean(f.getInternetExplorerMajorVersion());
return e},f.emulated={pushState:!Boolean(e.history&&e.history.pushState&&e.history.replaceState&&!/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(i.userAgent)&&!/AppleWebKit\/5([0-2]|3[0-2])/i.test(i.userAgent)),hashChange:Boolean(!("onhashchange"in e||"onhashchange"in n)||f.isInternetExplorer()&&8>f.getInternetExplorerMajorVersion())},f.enabled=!f.emulated.pushState,f.bugs={setHash:Boolean(!f.emulated.pushState&&"Apple Computer, Inc."===i.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),safariPoll:Boolean(!f.emulated.pushState&&"Apple Computer, Inc."===i.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(i.userAgent)),ieDoubleCheck:Boolean(f.isInternetExplorer()&&8>f.getInternetExplorerMajorVersion()),hashEscape:Boolean(f.isInternetExplorer()&&7>f.getInternetExplorerMajorVersion())},f.isEmptyObject=function(e){for(var t in e)return!1;
return!0},f.cloneObject=function(e){var t,r;return e?(t=l.stringify(e),r=l.parse(t)):r={},r
},f.getRootUrl=function(){var e=n.location.protocol+"//"+(n.location.hostname||n.location.host);
return n.location.port&&(e+=":"+n.location.port),e+="/"},f.getBaseHref=function(){var e=n.getElementsByTagName("base"),t=null,r="";
return 1===e.length&&(t=e[0],r=t.href.replace(/[^\/]+$/,"")),r=r.replace(/\/+$/,""),r&&(r+="/"),r
},f.getBaseUrl=function(){var e=f.getBaseHref()||f.getBasePageUrl()||f.getRootUrl();
return e},f.getPageUrl=function(){var e,t=f.getState(!1,!1),r=(t||{}).url||n.location.href;
return e=r.replace(/\/+$/,"").replace(/[^\/]+$/,function(e){return/\./.test(e)?e:e+"/"
})},f.getBasePageUrl=function(){var e=n.location.href.replace(/[#\?].*/,"").replace(/[^\/]+$/,function(e){return/[^\/]$/.test(e)?"":e
}).replace(/\/+$/,"")+"/";return e},f.getFullUrl=function(e,t){var r=e,n=e.substring(0,1);
return t=t===void 0?!0:t,/[a-z]+\:\/\//.test(e)||(r="/"===n?f.getRootUrl()+e.replace(/^\/+/,""):"#"===n?f.getPageUrl().replace(/#.*/,"")+e:"?"===n?f.getPageUrl().replace(/[\?#].*/,"")+e:t?f.getBaseUrl()+e.replace(/^(\.\/)+/,""):f.getBasePageUrl()+e.replace(/^(\.\/)+/,"")),r.replace(/\#$/,"")
},f.getShortUrl=function(e){var t=e,r=f.getBaseUrl(),n=f.getRootUrl();return f.emulated.pushState&&(t=t.replace(r,"")),t=t.replace(n,"/"),f.isTraditionalAnchor(t)&&(t="./"+t),t=t.replace(/^(\.\/)+/g,"./").replace(/\#$/,"")
},f.store={},f.idToState=f.idToState||{},f.stateToId=f.stateToId||{},f.urlToId=f.urlToId||{},f.storedStates=f.storedStates||[],f.savedStates=f.savedStates||[],f.normalizeStore=function(){f.store.idToState=f.store.idToState||{},f.store.urlToId=f.store.urlToId||{},f.store.stateToId=f.store.stateToId||{}
},f.getState=function(e,t){e===void 0&&(e=!0),t===void 0&&(t=!0);var r=f.getLastSavedState();
return!r&&t&&(r=f.createStateObject()),e&&(r=f.cloneObject(r),r.url=r.cleanUrl||r.url),r
},f.getIdByState=function(e){var t,r=f.extractId(e.url);if(!r)if(t=f.getStateString(e),f.stateToId[t]!==void 0)r=f.stateToId[t];
else if(f.store.stateToId[t]!==void 0)r=f.store.stateToId[t];else{for(;r=(new Date).getTime()+(Math.random()+"").replace(/\D/g,""),f.idToState[r]!==void 0||f.store.idToState[r]!==void 0;);f.stateToId[t]=r,f.idToState[r]=e
}return r},f.normalizeState=function(e){var t,r;return e&&"object"==typeof e||(e={}),e.normalized!==void 0?e:(e.data&&"object"==typeof e.data||(e.data={}),t={},t.normalized=!0,t.title=e.title||"",t.url=f.getFullUrl(f.unescapeString(e.url||n.location.href)),t.hash=f.getShortUrl(t.url),t.data=f.cloneObject(e.data),t.id=f.getIdByState(t),t.cleanUrl=t.url.replace(/\??\&_suid.*/,""),t.url=t.cleanUrl,r=!f.isEmptyObject(t.data),(t.title||r)&&(t.hash=f.getShortUrl(t.url).replace(/\??\&_suid.*/,""),/\?/.test(t.hash)||(t.hash+="?"),t.hash+="&_suid="+t.id),t.hashedUrl=f.getFullUrl(t.hash),(f.emulated.pushState||f.bugs.safariPoll)&&f.hasUrlDuplicate(t)&&(t.url=t.hashedUrl),t)
},f.createStateObject=function(e,t,r){var n={data:e,title:t,url:r};return n=f.normalizeState(n)
},f.getStateById=function(e){e+="";var r=f.idToState[e]||f.store.idToState[e]||t;
return r},f.getStateString=function(e){var t,r,n;return t=f.normalizeState(e),r={data:t.data,title:e.title,url:e.url},n=l.stringify(r)
},f.getStateId=function(e){var t,r;return t=f.normalizeState(e),r=t.id},f.getHashByState=function(e){var t,r;
return t=f.normalizeState(e),r=t.hash},f.extractId=function(e){var t,r,n;return r=/(.*)\&_suid=([0-9]+)$/.exec(e),n=r?r[1]||e:e,t=r?(r[2]||"")+"":"",t||!1
},f.isTraditionalAnchor=function(e){var t=!/[\/\?\.]/.test(e);return t},f.extractState=function(e,t){var r,n,i=null;
return t=t||!1,r=f.extractId(e),r&&(i=f.getStateById(r)),i||(n=f.getFullUrl(e),r=f.getIdByUrl(n)||!1,r&&(i=f.getStateById(r)),!i&&t&&!f.isTraditionalAnchor(e)&&(i=f.createStateObject(null,null,n))),i
},f.getIdByUrl=function(e){var r=f.urlToId[e]||f.store.urlToId[e]||t;return r},f.getLastSavedState=function(){return f.savedStates[f.savedStates.length-1]||t
},f.getLastStoredState=function(){return f.storedStates[f.storedStates.length-1]||t
},f.hasUrlDuplicate=function(e){var t,r=!1;return t=f.extractState(e.url),r=t&&t.id!==e.id
},f.storeState=function(e){return f.urlToId[e.url]=e.id,f.storedStates.push(f.cloneObject(e)),e
},f.isLastSavedState=function(e){var t,r,n,i=!1;return f.savedStates.length&&(t=e.id,r=f.getLastSavedState(),n=r.id,i=t===n),i
},f.saveState=function(e){return f.isLastSavedState(e)?!1:(f.savedStates.push(f.cloneObject(e)),!0)
},f.getStateByIndex=function(e){var t=null;return t=e===void 0?f.savedStates[f.savedStates.length-1]:0>e?f.savedStates[f.savedStates.length+e]:f.savedStates[e]
},f.getHash=function(){var e=f.unescapeHash(n.location.hash);return e},f.unescapeString=function(t){for(var r,n=t;r=e.unescape(n),r!==n;)n=r;
return n},f.unescapeHash=function(e){var t=f.normalizeHash(e);return t=f.unescapeString(t)
},f.normalizeHash=function(e){var t=e.replace(/[^#]*#/,"").replace(/#.*/,"");return t
},f.setHash=function(e,t){var r,i,a;return t!==!1&&f.busy()?(f.pushQueue({scope:f,callback:f.setHash,args:arguments,queue:t}),!1):(r=f.escapeHash(e),f.busy(!0),i=f.extractState(e,!0),i&&!f.emulated.pushState?f.pushState(i.data,i.title,i.url,!1):n.location.hash!==r&&(f.bugs.setHash?(a=f.getPageUrl(),f.pushState(null,null,a+"#"+r,!1)):n.location.hash=r),f)
},f.escapeHash=function(t){var r=f.normalizeHash(t);return r=e.escape(r),f.bugs.hashEscape||(r=r.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),r
},f.getHashByUrl=function(e){var t=(e+"").replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");
return t=f.unescapeHash(t)},f.setTitle=function(e){var t,r=e.title;r||(t=f.getStateByIndex(0),t&&t.url===e.url&&(r=t.title||f.options.initialTitle));
try{n.getElementsByTagName("title")[0].innerHTML=r.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")
}catch(i){}return n.title=r,f},f.queues=[],f.busy=function(e){if(e!==void 0?f.busy.flag=e:f.busy.flag===void 0&&(f.busy.flag=!1),!f.busy.flag){s(f.busy.timeout);
var t=function(){var e,r,n;if(!f.busy.flag)for(e=f.queues.length-1;e>=0;--e)r=f.queues[e],0!==r.length&&(n=r.shift(),f.fireQueueItem(n),f.busy.timeout=o(t,f.options.busyDelay))
};f.busy.timeout=o(t,f.options.busyDelay)}return f.busy.flag},f.busy.flag=!1,f.fireQueueItem=function(e){return e.callback.apply(e.scope||f,e.args||[])
},f.pushQueue=function(e){return f.queues[e.queue||0]=f.queues[e.queue||0]||[],f.queues[e.queue||0].push(e),f
},f.queue=function(e,t){return"function"==typeof e&&(e={callback:e}),t!==void 0&&(e.queue=t),f.busy()?f.pushQueue(e):f.fireQueueItem(e),f
},f.clearQueue=function(){return f.busy.flag=!1,f.queues=[],f},f.stateChanged=!1,f.doubleChecker=!1,f.doubleCheckComplete=function(){return f.stateChanged=!0,f.doubleCheckClear(),f
},f.doubleCheckClear=function(){return f.doubleChecker&&(s(f.doubleChecker),f.doubleChecker=!1),f
},f.doubleCheck=function(e){return f.stateChanged=!1,f.doubleCheckClear(),f.bugs.ieDoubleCheck&&(f.doubleChecker=o(function(){return f.doubleCheckClear(),f.stateChanged||e(),!0
},f.options.doubleCheckInterval)),f},f.safariStatePoll=function(){var t,r=f.extractState(n.location.href);
if(!f.isLastSavedState(r))return t=r,t||(t=f.createStateObject()),f.Adapter.trigger(e,"popstate"),f
},f.back=function(e){return e!==!1&&f.busy()?(f.pushQueue({scope:f,callback:f.back,args:arguments,queue:e}),!1):(f.busy(!0),f.doubleCheck(function(){f.back(!1)
}),d.go(-1),!0)},f.forward=function(e){return e!==!1&&f.busy()?(f.pushQueue({scope:f,callback:f.forward,args:arguments,queue:e}),!1):(f.busy(!0),f.doubleCheck(function(){f.forward(!1)
}),d.go(1),!0)},f.go=function(e,t){var r;if(e>0)for(r=1;e>=r;++r)f.forward(t);else{if(!(0>e))throw Error("History.go: History.go requires a positive or negative integer passed.");
for(r=-1;r>=e;--r)f.back(t)}return f},f.emulated.pushState){var g=function(){};f.pushState=f.pushState||g,f.replaceState=f.replaceState||g
}else f.onPopState=function(t,r){var i,a,o=!1,s=!1;return f.doubleCheckComplete(),i=f.getHash(),i?(a=f.extractState(i||n.location.href,!0),a?f.replaceState(a.data,a.title,a.url,!1):(f.Adapter.trigger(e,"anchorchange"),f.busy(!1)),f.expectedStateId=!1,!1):(o=f.Adapter.extractEventData("state",t,r)||!1,s=o?f.getStateById(o):f.expectedStateId?f.getStateById(f.expectedStateId):f.extractState(n.location.href),s||(s=f.createStateObject(null,null,n.location.href)),f.expectedStateId=!1,f.isLastSavedState(s)?(f.busy(!1),!1):(f.storeState(s),f.saveState(s),f.setTitle(s),f.Adapter.trigger(e,"statechange"),f.busy(!1),!0))
},f.Adapter.bind(e,"popstate",f.onPopState),f.pushState=function(t,r,n,i){if(f.getHashByUrl(n)&&f.emulated.pushState)throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");
if(i!==!1&&f.busy())return f.pushQueue({scope:f,callback:f.pushState,args:arguments,queue:i}),!1;
f.busy(!0);var a=f.createStateObject(t,r,n);return f.isLastSavedState(a)?f.busy(!1):(f.storeState(a),f.expectedStateId=a.id,d.pushState(a.id,a.title,a.url),f.Adapter.trigger(e,"popstate")),!0
},f.replaceState=function(t,r,n,i){if(f.getHashByUrl(n)&&f.emulated.pushState)throw Error("History.js does not support states with fragement-identifiers (hashes/anchors).");
if(i!==!1&&f.busy())return f.pushQueue({scope:f,callback:f.replaceState,args:arguments,queue:i}),!1;
f.busy(!0);var a=f.createStateObject(t,r,n);return f.isLastSavedState(a)?f.busy(!1):(f.storeState(a),f.expectedStateId=a.id,d.replaceState(a.id,a.title,a.url),f.Adapter.trigger(e,"popstate")),!0
};if(a){try{f.store=l.parse(a.getItem("History.store"))||{}}catch(h){f.store={}}f.normalizeStore()
}else f.store={},f.normalizeStore();f.Adapter.bind(e,"beforeunload",f.clearAllIntervals),f.Adapter.bind(e,"unload",f.clearAllIntervals),f.saveState(f.storeState(f.extractState(n.location.href,!0))),a&&(f.onUnload=function(){var e,t;
try{e=l.parse(a.getItem("History.store"))||{}}catch(r){e={}}e.idToState=e.idToState||{},e.urlToId=e.urlToId||{},e.stateToId=e.stateToId||{};
for(t in f.idToState)f.idToState.hasOwnProperty(t)&&(e.idToState[t]=f.idToState[t]);
for(t in f.urlToId)f.urlToId.hasOwnProperty(t)&&(e.urlToId[t]=f.urlToId[t]);for(t in f.stateToId)f.stateToId.hasOwnProperty(t)&&(e.stateToId[t]=f.stateToId[t]);
f.store=e,f.normalizeStore(),a.setItem("History.store",l.stringify(e))},f.intervalList.push(c(f.onUnload,f.options.storeInterval)),f.Adapter.bind(e,"beforeunload",f.onUnload),f.Adapter.bind(e,"unload",f.onUnload)),f.emulated.pushState||(f.bugs.safariPoll&&f.intervalList.push(c(f.safariStatePoll,f.options.safariPollInterval)),("Apple Computer, Inc."===i.vendor||"Mozilla"===(i.appCodeName||""))&&(f.Adapter.bind(e,"hashchange",function(){f.Adapter.trigger(e,"popstate")
}),f.getHash()&&f.Adapter.onDomLoad(function(){f.Adapter.trigger(e,"hashchange")})))
},f.init()}(window),function(){var e=this,t=e._,r={},n=Array.prototype,i=Object.prototype,a=Function.prototype,o=n.push,s=n.slice,c=n.concat,u=i.toString,l=i.hasOwnProperty,p=n.forEach,f=n.map,d=n.reduce,g=n.reduceRight,h=n.filter,y=n.every,m=n.some,v=n.indexOf,w=n.lastIndexOf,b=Array.isArray,S=Object.keys,C=a.bind,A=function(e){return e instanceof A?e:this instanceof A?(this._wrapped=e,void 0):new A(e)
};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=A),exports._=A):e._=A,A.VERSION="1.4.4";
var M=A.each=A.forEach=function(e,t,n){if(null!=e)if(p&&e.forEach===p)e.forEach(t,n);
else if(e.length===+e.length){for(var i=0,a=e.length;a>i;i++)if(t.call(n,e[i],i,e)===r)return
}else for(var o in e)if(A.has(e,o)&&t.call(n,e[o],o,e)===r)return};A.map=A.collect=function(e,t,r){var n=[];
return null==e?n:f&&e.map===f?e.map(t,r):(M(e,function(e,i,a){n[n.length]=t.call(r,e,i,a)
}),n)};var T="Reduce of empty array with no initial value";A.reduce=A.foldl=A.inject=function(e,t,r,n){var i=arguments.length>2;
if(null==e&&(e=[]),d&&e.reduce===d)return n&&(t=A.bind(t,n)),i?e.reduce(t,r):e.reduce(t);
if(M(e,function(e,a,o){i?r=t.call(n,r,e,a,o):(r=e,i=!0)}),!i)throw new TypeError(T);
return r},A.reduceRight=A.foldr=function(e,t,r,n){var i=arguments.length>2;if(null==e&&(e=[]),g&&e.reduceRight===g)return n&&(t=A.bind(t,n)),i?e.reduceRight(t,r):e.reduceRight(t);
var a=e.length;if(a!==+a){var o=A.keys(e);a=o.length}if(M(e,function(s,c,u){c=o?o[--a]:--a,i?r=t.call(n,r,e[c],c,u):(r=e[c],i=!0)
}),!i)throw new TypeError(T);return r},A.find=A.detect=function(e,t,r){var n;return k(e,function(e,i,a){return t.call(r,e,i,a)?(n=e,!0):void 0
}),n},A.filter=A.select=function(e,t,r){var n=[];return null==e?n:h&&e.filter===h?e.filter(t,r):(M(e,function(e,i,a){t.call(r,e,i,a)&&(n[n.length]=e)
}),n)},A.reject=function(e,t,r){return A.filter(e,function(e,n,i){return!t.call(r,e,n,i)
},r)},A.every=A.all=function(e,t,n){t||(t=A.identity);var i=!0;return null==e?i:y&&e.every===y?e.every(t,n):(M(e,function(e,a,o){return(i=i&&t.call(n,e,a,o))?void 0:r
}),!!i)};var k=A.some=A.any=function(e,t,n){t||(t=A.identity);var i=!1;return null==e?i:m&&e.some===m?e.some(t,n):(M(e,function(e,a,o){return i||(i=t.call(n,e,a,o))?r:void 0
}),!!i)};A.contains=A.include=function(e,t){return null==e?!1:v&&e.indexOf===v?-1!=e.indexOf(t):k(e,function(e){return e===t
})},A.invoke=function(e,t){var r=s.call(arguments,2),n=A.isFunction(t);return A.map(e,function(e){return(n?t:e[t]).apply(e,r)
})},A.pluck=function(e,t){return A.map(e,function(e){return e[t]})},A.where=function(e,t,r){return A.isEmpty(t)?r?null:[]:A[r?"find":"filter"](e,function(e){for(var r in t)if(t[r]!==e[r])return!1;
return!0})},A.findWhere=function(e,t){return A.where(e,t,!0)},A.max=function(e,t,r){if(!t&&A.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.max.apply(Math,e);
if(!t&&A.isEmpty(e))return-1/0;var n={computed:-1/0,value:-1/0};return M(e,function(e,i,a){var o=t?t.call(r,e,i,a):e;
o>=n.computed&&(n={value:e,computed:o})}),n.value},A.min=function(e,t,r){if(!t&&A.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.min.apply(Math,e);
if(!t&&A.isEmpty(e))return 1/0;var n={computed:1/0,value:1/0};return M(e,function(e,i,a){var o=t?t.call(r,e,i,a):e;
n.computed>o&&(n={value:e,computed:o})}),n.value},A.shuffle=function(e){var t,r=0,n=[];
return M(e,function(e){t=A.random(r++),n[r-1]=n[t],n[t]=e}),n};var _=function(e){return A.isFunction(e)?e:function(t){return t[e]
}};A.sortBy=function(e,t,r){var n=_(t);return A.pluck(A.map(e,function(e,t,i){return{value:e,index:t,criteria:n.call(r,e,t,i)}
}).sort(function(e,t){var r=e.criteria,n=t.criteria;if(r!==n){if(r>n||void 0===r)return 1;
if(n>r||void 0===n)return-1}return e.index<t.index?-1:1}),"value")};var x=function(e,t,r,n){var i={},a=_(t||A.identity);
return M(e,function(t,o){var s=a.call(r,t,o,e);n(i,s,t)}),i};A.groupBy=function(e,t,r){return x(e,t,r,function(e,t,r){(A.has(e,t)?e[t]:e[t]=[]).push(r)
})},A.countBy=function(e,t,r){return x(e,t,r,function(e,t){A.has(e,t)||(e[t]=0),e[t]++
})},A.sortedIndex=function(e,t,r,n){r=null==r?A.identity:_(r);for(var i=r.call(n,t),a=0,o=e.length;o>a;){var s=a+o>>>1;
i>r.call(n,e[s])?a=s+1:o=s}return a},A.toArray=function(e){return e?A.isArray(e)?s.call(e):e.length===+e.length?A.map(e,A.identity):A.values(e):[]
},A.size=function(e){return null==e?0:e.length===+e.length?e.length:A.keys(e).length
},A.first=A.head=A.take=function(e,t,r){return null==e?void 0:null==t||r?e[0]:s.call(e,0,t)
},A.initial=function(e,t,r){return s.call(e,0,e.length-(null==t||r?1:t))},A.last=function(e,t,r){return null==e?void 0:null==t||r?e[e.length-1]:s.call(e,Math.max(e.length-t,0))
},A.rest=A.tail=A.drop=function(e,t,r){return s.call(e,null==t||r?1:t)},A.compact=function(e){return A.filter(e,A.identity)
};var E=function(e,t,r){return M(e,function(e){A.isArray(e)?t?o.apply(r,e):E(e,t,r):r.push(e)
}),r};A.flatten=function(e,t){return E(e,t,[])},A.without=function(e){return A.difference(e,s.call(arguments,1))
},A.uniq=A.unique=function(e,t,r,n){A.isFunction(t)&&(n=r,r=t,t=!1);var i=r?A.map(e,r,n):e,a=[],o=[];
return M(i,function(r,n){(t?n&&o[o.length-1]===r:A.contains(o,r))||(o.push(r),a.push(e[n]))
}),a},A.union=function(){return A.uniq(c.apply(n,arguments))},A.intersection=function(e){var t=s.call(arguments,1);
return A.filter(A.uniq(e),function(e){return A.every(t,function(t){return A.indexOf(t,e)>=0
})})},A.difference=function(e){var t=c.apply(n,s.call(arguments,1));return A.filter(e,function(e){return!A.contains(t,e)
})},A.zip=function(){for(var e=s.call(arguments),t=A.max(A.pluck(e,"length")),r=Array(t),n=0;t>n;n++)r[n]=A.pluck(e,""+n);
return r},A.object=function(e,t){if(null==e)return{};for(var r={},n=0,i=e.length;i>n;n++)t?r[e[n]]=t[n]:r[e[n][0]]=e[n][1];
return r},A.indexOf=function(e,t,r){if(null==e)return-1;var n=0,i=e.length;if(r){if("number"!=typeof r)return n=A.sortedIndex(e,t),e[n]===t?n:-1;
n=0>r?Math.max(0,i+r):r}if(v&&e.indexOf===v)return e.indexOf(t,r);for(;i>n;n++)if(e[n]===t)return n;
return-1},A.lastIndexOf=function(e,t,r){if(null==e)return-1;var n=null!=r;if(w&&e.lastIndexOf===w)return n?e.lastIndexOf(t,r):e.lastIndexOf(t);
for(var i=n?r:e.length;i--;)if(e[i]===t)return i;return-1},A.range=function(e,t,r){1>=arguments.length&&(t=e||0,e=0),r=arguments[2]||1;
for(var n=Math.max(Math.ceil((t-e)/r),0),i=0,a=Array(n);n>i;)a[i++]=e,e+=r;return a
},A.bind=function(e,t){if(e.bind===C&&C)return C.apply(e,s.call(arguments,1));var r=s.call(arguments,2);
return function(){return e.apply(t,r.concat(s.call(arguments)))}},A.partial=function(e){var t=s.call(arguments,1);
return function(){return e.apply(this,t.concat(s.call(arguments)))}},A.bindAll=function(e){var t=s.call(arguments,1);
return 0===t.length&&(t=A.functions(e)),M(t,function(t){e[t]=A.bind(e[t],e)}),e},A.memoize=function(e,t){var r={};
return t||(t=A.identity),function(){var n=t.apply(this,arguments);return A.has(r,n)?r[n]:r[n]=e.apply(this,arguments)
}},A.delay=function(e,t){var r=s.call(arguments,2);return setTimeout(function(){return e.apply(null,r)
},t)},A.defer=function(e){return A.delay.apply(A,[e,1].concat(s.call(arguments,1)))
},A.throttle=function(e,t){var r,n,i,a,o=0,s=function(){o=new Date,i=null,a=e.apply(r,n)
};return function(){var c=new Date,u=t-(c-o);return r=this,n=arguments,0>=u?(clearTimeout(i),i=null,o=c,a=e.apply(r,n)):i||(i=setTimeout(s,u)),a
}},A.debounce=function(e,t,r){var n,i;return function(){var a=this,o=arguments,s=function(){n=null,r||(i=e.apply(a,o))
},c=r&&!n;return clearTimeout(n),n=setTimeout(s,t),c&&(i=e.apply(a,o)),i}},A.once=function(e){var t,r=!1;
return function(){return r?t:(r=!0,t=e.apply(this,arguments),e=null,t)}},A.wrap=function(e,t){return function(){var r=[e];
return o.apply(r,arguments),t.apply(this,r)}},A.compose=function(){var e=arguments;
return function(){for(var t=arguments,r=e.length-1;r>=0;r--)t=[e[r].apply(this,t)];
return t[0]}},A.after=function(e,t){return 0>=e?t():function(){return 1>--e?t.apply(this,arguments):void 0
}},A.keys=S||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];
for(var r in e)A.has(e,r)&&(t[t.length]=r);return t},A.values=function(e){var t=[];
for(var r in e)A.has(e,r)&&t.push(e[r]);return t},A.pairs=function(e){var t=[];for(var r in e)A.has(e,r)&&t.push([r,e[r]]);
return t},A.invert=function(e){var t={};for(var r in e)A.has(e,r)&&(t[e[r]]=r);return t
},A.functions=A.methods=function(e){var t=[];for(var r in e)A.isFunction(e[r])&&t.push(r);
return t.sort()},A.extend=function(e){return M(s.call(arguments,1),function(t){if(t)for(var r in t)e[r]=t[r]
}),e},A.pick=function(e){var t={},r=c.apply(n,s.call(arguments,1));return M(r,function(r){r in e&&(t[r]=e[r])
}),t},A.omit=function(e){var t={},r=c.apply(n,s.call(arguments,1));for(var i in e)A.contains(r,i)||(t[i]=e[i]);
return t},A.defaults=function(e){return M(s.call(arguments,1),function(t){if(t)for(var r in t)null==e[r]&&(e[r]=t[r])
}),e},A.clone=function(e){return A.isObject(e)?A.isArray(e)?e.slice():A.extend({},e):e
},A.tap=function(e,t){return t(e),e};var j=function(e,t,r,n){if(e===t)return 0!==e||1/e==1/t;
if(null==e||null==t)return e===t;e instanceof A&&(e=e._wrapped),t instanceof A&&(t=t._wrapped);
var i=u.call(e);if(i!=u.call(t))return!1;switch(i){case"[object String]":return e==t+"";
case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;
case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase
}if("object"!=typeof e||"object"!=typeof t)return!1;for(var a=r.length;a--;)if(r[a]==e)return n[a]==t;
r.push(e),n.push(t);var o=0,s=!0;if("[object Array]"==i){if(o=e.length,s=o==t.length)for(;o--&&(s=j(e[o],t[o],r,n)););}else{var c=e.constructor,l=t.constructor;
if(c!==l&&!(A.isFunction(c)&&c instanceof c&&A.isFunction(l)&&l instanceof l))return!1;
for(var p in e)if(A.has(e,p)&&(o++,!(s=A.has(t,p)&&j(e[p],t[p],r,n))))break;if(s){for(p in t)if(A.has(t,p)&&!o--)break;
s=!o}}return r.pop(),n.pop(),s};A.isEqual=function(e,t){return j(e,t,[],[])},A.isEmpty=function(e){if(null==e)return!0;
if(A.isArray(e)||A.isString(e))return 0===e.length;for(var t in e)if(A.has(e,t))return!1;
return!0},A.isElement=function(e){return!(!e||1!==e.nodeType)},A.isArray=b||function(e){return"[object Array]"==u.call(e)
},A.isObject=function(e){return e===Object(e)},M(["Arguments","Function","String","Number","Date","RegExp"],function(e){A["is"+e]=function(t){return u.call(t)=="[object "+e+"]"
}}),A.isArguments(arguments)||(A.isArguments=function(e){return!(!e||!A.has(e,"callee"))
}),A.isFunction=function(e){return"function"==typeof e},A.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))
},A.isNaN=function(e){return A.isNumber(e)&&e!=+e},A.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==u.call(e)
},A.isNull=function(e){return null===e},A.isUndefined=function(e){return void 0===e
},A.has=function(e,t){return l.call(e,t)},A.noConflict=function(){return e._=t,this
},A.identity=function(e){return e},A.times=function(e,t,r){for(var n=Array(e),i=0;e>i;i++)n[i]=t.call(r,i);
return n},A.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))
};var I={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};
I.unescape=A.invert(I.escape);var L={escape:RegExp("["+A.keys(I.escape).join("")+"]","g"),unescape:RegExp("("+A.keys(I.unescape).join("|")+")","g")};
A.each(["escape","unescape"],function(e){A[e]=function(t){return null==t?"":(""+t).replace(L[e],function(t){return I[e][t]
})}}),A.result=function(e,t){if(null==e)return null;var r=e[t];return A.isFunction(r)?r.call(e):r
},A.mixin=function(e){M(A.functions(e),function(t){var r=A[t]=e[t];A.prototype[t]=function(){var e=[this._wrapped];
return o.apply(e,arguments),V.call(this,r.apply(A,e))}})};var $=0;A.uniqueId=function(e){var t=++$+"";
return e?e+t:t},A.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};
var P=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},O=/\\|'|\r|\n|\t|\u2028|\u2029/g;
A.template=function(e,t,r){var n;r=A.defaults({},r,A.templateSettings);var i=RegExp([(r.escape||P).source,(r.interpolate||P).source,(r.evaluate||P).source].join("|")+"|$","g"),a=0,o="__p+='";
e.replace(i,function(t,r,n,i,s){return o+=e.slice(a,s).replace(O,function(e){return"\\"+B[e]
}),r&&(o+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),n&&(o+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),a=s+t.length,t
}),o+="';\n",r.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";
try{n=Function(r.variable||"obj","_",o)}catch(s){throw s.source=o,s}if(t)return n(t,A);
var c=function(e){return n.call(this,e,A)};return c.source="function("+(r.variable||"obj")+"){\n"+o+"}",c
},A.chain=function(e){return A(e).chain()};var V=function(e){return this._chain?A(e).chain():e
};A.mixin(A),M(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];
A.prototype[e]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=e&&"splice"!=e||0!==r.length||delete r[0],V.call(this,r)
}}),M(["concat","join","slice"],function(e){var t=n[e];A.prototype[e]=function(){return V.call(this,t.apply(this._wrapped,arguments))
}}),A.extend(A.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped
}})}.call(this),function(e){"function"==typeof define?define(e):"function"==typeof YUI?YUI.add("es5",e):e()
}(function(){function e(){}function t(e){return e=+e,e!==e?e=0:0!==e&&e!==1/0&&e!==-(1/0)&&(e=(e>0||-1)*Math.floor(Math.abs(e))),e
}function r(e){var t=typeof e;return null===e||"undefined"===t||"boolean"===t||"number"===t||"string"===t
}function n(e){var t,n,i;if(r(e))return e;if(n=e.valueOf,"function"==typeof n&&(t=n.call(e),r(t)))return t;
if(i=e.toString,"function"==typeof i&&(t=i.call(e),r(t)))return t;throw new TypeError
}Function.prototype.bind||(Function.prototype.bind=function(t){var r=this;if("function"!=typeof r)throw new TypeError("Function.prototype.bind called on incompatible "+r);
var n=f.call(arguments,1),i=function(){if(this instanceof i){var e=r.apply(this,n.concat(f.call(arguments)));
return Object(e)===e?e:this}return r.apply(t,n.concat(f.call(arguments)))};return r.prototype&&(e.prototype=r.prototype,i.prototype=new e,e.prototype=null),i
});var i,a,o,s,c,u=Function.prototype.call,l=Array.prototype,p=Object.prototype,f=l.slice,d=u.bind(p.toString),g=u.bind(p.hasOwnProperty);
if((c=g(p,"__defineGetter__"))&&(i=u.bind(p.__defineGetter__),a=u.bind(p.__defineSetter__),o=u.bind(p.__lookupGetter__),s=u.bind(p.__lookupSetter__)),2!=[1,2].splice(0).length){var h=Array.prototype.splice;
Array.prototype.splice=function(e,t){return arguments.length?h.apply(this,[void 0===e?0:e,void 0===t?this.length-e:t].concat(f.call(arguments,2))):[]
}}if(1!=[].unshift(0)){var y=Array.prototype.unshift;Array.prototype.unshift=function(){return y.apply(this,arguments),this.length
}}Array.isArray||(Array.isArray=function(e){return"[object Array]"==d(e)});var m=Object("a"),v="a"!=m[0]||!(0 in m);
if(Array.prototype.forEach||(Array.prototype.forEach=function(e){var t=L(this),r=v&&"[object String]"==d(this)?this.split(""):t,n=arguments[1],i=-1,a=r.length>>>0;
if("[object Function]"!=d(e))throw new TypeError;for(;a>++i;)i in r&&e.call(n,r[i],i,t)
}),Array.prototype.map||(Array.prototype.map=function(e){var t=L(this),r=v&&"[object String]"==d(this)?this.split(""):t,n=r.length>>>0,i=Array(n),a=arguments[1];
if("[object Function]"!=d(e))throw new TypeError(e+" is not a function");for(var o=0;n>o;o++)o in r&&(i[o]=e.call(a,r[o],o,t));
return i}),Array.prototype.filter||(Array.prototype.filter=function(e){var t,r=L(this),n=v&&"[object String]"==d(this)?this.split(""):r,i=n.length>>>0,a=[],o=arguments[1];
if("[object Function]"!=d(e))throw new TypeError(e+" is not a function");for(var s=0;i>s;s++)s in n&&(t=n[s],e.call(o,t,s,r)&&a.push(t));
return a}),Array.prototype.every||(Array.prototype.every=function(e){var t=L(this),r=v&&"[object String]"==d(this)?this.split(""):t,n=r.length>>>0,i=arguments[1];
if("[object Function]"!=d(e))throw new TypeError(e+" is not a function");for(var a=0;n>a;a++)if(a in r&&!e.call(i,r[a],a,t))return!1;
return!0}),Array.prototype.some||(Array.prototype.some=function(e){var t=L(this),r=v&&"[object String]"==d(this)?this.split(""):t,n=r.length>>>0,i=arguments[1];
if("[object Function]"!=d(e))throw new TypeError(e+" is not a function");for(var a=0;n>a;a++)if(a in r&&e.call(i,r[a],a,t))return!0;
return!1}),Array.prototype.reduce||(Array.prototype.reduce=function(e){var t=L(this),r=v&&"[object String]"==d(this)?this.split(""):t,n=r.length>>>0;
if("[object Function]"!=d(e))throw new TypeError(e+" is not a function");if(!n&&1==arguments.length)throw new TypeError("reduce of empty array with no initial value");
var i,a=0;if(arguments.length>=2)i=arguments[1];else for(;;){if(a in r){i=r[a++];
break}if(++a>=n)throw new TypeError("reduce of empty array with no initial value")
}for(;n>a;a++)a in r&&(i=e.call(void 0,i,r[a],a,t));return i}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(e){var t=L(this),r=v&&"[object String]"==d(this)?this.split(""):t,n=r.length>>>0;
if("[object Function]"!=d(e))throw new TypeError(e+" is not a function");if(!n&&1==arguments.length)throw new TypeError("reduceRight of empty array with no initial value");
var i,a=n-1;if(arguments.length>=2)i=arguments[1];else for(;;){if(a in r){i=r[a--];
break}if(0>--a)throw new TypeError("reduceRight of empty array with no initial value")
}do a in this&&(i=e.call(void 0,i,r[a],a,t));while(a--);return i}),Array.prototype.indexOf&&-1==[0,1].indexOf(1,2)||(Array.prototype.indexOf=function(e){var r=v&&"[object String]"==d(this)?this.split(""):L(this),n=r.length>>>0;
if(!n)return-1;var i=0;for(arguments.length>1&&(i=t(arguments[1])),i=i>=0?i:Math.max(0,n+i);n>i;i++)if(i in r&&r[i]===e)return i;
return-1}),Array.prototype.lastIndexOf&&-1==[0,1].lastIndexOf(0,-3)||(Array.prototype.lastIndexOf=function(e){var r=v&&"[object String]"==d(this)?this.split(""):L(this),n=r.length>>>0;
if(!n)return-1;var i=n-1;for(arguments.length>1&&(i=Math.min(i,t(arguments[1]))),i=i>=0?i:n-Math.abs(i);i>=0;i--)if(i in r&&e===r[i])return i;
return-1}),!Object.keys){var w=!0,b=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],S=b.length;
for(var C in{toString:null})w=!1;Object.keys=function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on a non-object");
var t=[];for(var r in e)g(e,r)&&t.push(r);if(w)for(var n=0,i=S;i>n;n++){var a=b[n];
g(e,a)&&t.push(a)}return t}}var A=-621987552e5,M="-000001";Date.prototype.toISOString&&-1!==new Date(A).toISOString().indexOf(M)||(Date.prototype.toISOString=function(){var e,t,r,n,i;
if(!isFinite(this))throw new RangeError("Date.prototype.toISOString called on non-finite value.");
for(n=this.getUTCFullYear(),i=this.getUTCMonth(),n+=Math.floor(i/12),i=(i%12+12)%12,e=[i+1,this.getUTCDate(),this.getUTCHours(),this.getUTCMinutes(),this.getUTCSeconds()],n=(0>n?"-":n>9999?"+":"")+("00000"+Math.abs(n)).slice(n>=0&&9999>=n?-4:-6),t=e.length;t--;)r=e[t],10>r&&(e[t]="0"+r);
return n+"-"+e.slice(0,2).join("-")+"T"+e.slice(2).join(":")+"."+("000"+this.getUTCMilliseconds()).slice(-3)+"Z"
});var T=!1;try{T=Date.prototype.toJSON&&null===new Date(0/0).toJSON()&&-1!==new Date(A).toJSON().indexOf(M)&&Date.prototype.toJSON.call({toISOString:function(){return!0
}})}catch(k){}if(T||(Date.prototype.toJSON=function(){var e,t=Object(this),r=n(t);
if("number"==typeof r&&!isFinite(r))return null;if(e=t.toISOString,"function"!=typeof e)throw new TypeError("toISOString property is not callable");
return e.call(t)}),Date=function(e){function t(r,n,i,a,o,s,c){var u=arguments.length;
if(this instanceof e){var l=1==u&&r+""===r?new e(t.parse(r)):u>=7?new e(r,n,i,a,o,s,c):u>=6?new e(r,n,i,a,o,s):u>=5?new e(r,n,i,a,o):u>=4?new e(r,n,i,a):u>=3?new e(r,n,i):u>=2?new e(r,n):u>=1?new e(r):new e;
return l.constructor=t,l}return e.apply(this,arguments)}function r(e,t){var r=t>1?1:0;
return i[t]+Math.floor((e-1969+r)/4)-Math.floor((e-1901+r)/100)+Math.floor((e-1601+r)/400)+365*(e-1970)
}var n=RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:\\.(\\d{3}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$"),i=[0,31,59,90,120,151,181,212,243,273,304,334,365];
for(var a in e)t[a]=e[a];return t.now=e.now,t.UTC=e.UTC,t.prototype=e.prototype,t.prototype.constructor=t,t.parse=function(t){var i=n.exec(t);
if(i){var a,o=Number(i[1]),s=Number(i[2]||1)-1,c=Number(i[3]||1)-1,u=Number(i[4]||0),l=Number(i[5]||0),p=Number(i[6]||0),f=Number(i[7]||0),d=!i[4]||i[8]?0:Number(new e(1970,0)),g="-"===i[9]?1:-1,h=Number(i[10]||0),y=Number(i[11]||0);
return(l>0||p>0||f>0?24:25)>u&&60>l&&60>p&&1e3>f&&s>-1&&12>s&&24>h&&60>y&&c>-1&&r(o,s+1)-r(o,s)>c&&(a=60*(24*(r(o,s)+c)+u+h*g),a=1e3*(60*(a+l+y*g)+p)+f+d,a>=-864e13&&864e13>=a)?a:0/0
}return e.parse.apply(this,arguments)},t}(Date),Date.now||(Date.now=function(){return(new Date).getTime()
}),"0".split(void 0,0).length){var _=String.prototype.split;String.prototype.split=function(e,t){return void 0===e&&0===t?[]:_.apply(this,arguments)
}}if("".substr&&"b"!=="0b".substr(-1)){var x=String.prototype.substr;String.prototype.substr=function(e,t){return x.call(this,0>e?0>(e=this.length+e)?0:e:e,t)
}}var E="	\n\f\r   ᠎             　\u2028\u2029﻿";if(!String.prototype.trim||E.trim()){E="["+E+"]";
var j=RegExp("^"+E+E+"*"),I=RegExp(E+E+"*$");String.prototype.trim=function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");
return(this+"").replace(j,"").replace(I,"")}}var L=function(e){if(null==e)throw new TypeError("can't convert "+e+" to object");
return Object(e)}});var Hashtable=function(){function e(t){var r;if("string"==typeof t)return t;
if(typeof t.hashCode==l)return r=t.hashCode(),"string"==typeof r?r:e(r);if(typeof t.toString==l)return""+t;
try{return t+""}catch(n){return Object.prototype.toString.call(t)}}function t(e,t){return e.equals(t)
}function r(e,t){return typeof t.equals==l?t.equals(e):e===t}function n(e){return function(t){if(null===t)throw Error("null is not a valid "+e);
if(t===void 0)throw Error(e+" must not be undefined")}}function i(e,t,r,n){this[0]=e,this.entries=[],this.addEntry(t,r),null!==n&&(this.getEqualityFunction=function(){return n
})}function a(e){return function(t){for(var r,n=this.entries.length,i=this.getEqualityFunction(t);n--;)if(r=this.entries[n],i(t,r[0]))switch(e){case g:return!0;
case h:return r;case y:return[n,r[1]]}return!1}}function o(e){return function(t){for(var r=t.length,n=0,i=this.entries.length;i>n;++n)t[r+n]=this.entries[n][e]
}}function s(e,t){for(var r,n=e.length;n--;)if(r=e[n],t===r[0])return n;return null
}function c(e,t){var r=e[t];return r&&r instanceof i?r:null}function u(t,r){var n=this,a=[],o={},g=typeof t==l?t:e,h=typeof r==l?r:null;
this.put=function(e,t){f(e),d(t);var r,n,s=g(e),u=null;return r=c(o,s),r?(n=r.getEntryForKey(e),n?(u=n[1],n[1]=t):r.addEntry(e,t)):(r=new i(s,e,t,h),a[a.length]=r,o[s]=r),u
},this.get=function(e){f(e);var t=g(e),r=c(o,t);if(r){var n=r.getEntryForKey(e);if(n)return n[1]
}return null},this.containsKey=function(e){f(e);var t=g(e),r=c(o,t);return r?r.containsKey(e):!1
},this.containsValue=function(e){d(e);for(var t=a.length;t--;)if(a[t].containsValue(e))return!0;
return!1},this.clear=function(){a.length=0,o={}},this.isEmpty=function(){return!a.length
};var y=function(e){return function(){for(var t=[],r=a.length;r--;)a[r][e](t);return t
}};this.keys=y("keys"),this.values=y("values"),this.entries=y("getEntries"),this.remove=function(e){f(e);
var t,r=g(e),n=null,i=c(o,r);return i&&(n=i.removeEntryForKey(e),null!==n&&(i.entries.length||(t=s(a,r),p(a,t),delete o[r]))),n
},this.size=function(){for(var e=0,t=a.length;t--;)e+=a[t].entries.length;return e
},this.each=function(e){for(var t,r=n.entries(),i=r.length;i--;)t=r[i],e(t[0],t[1])
},this.putAll=function(e,t){for(var r,i,a,o,s=e.entries(),c=s.length,u=typeof t==l;c--;)r=s[c],i=r[0],a=r[1],u&&(o=n.get(i))&&(a=t(i,o,a)),n.put(i,a)
},this.clone=function(){var e=new u(t,r);return e.putAll(n),e}}var l="function",p=typeof Array.prototype.splice==l?function(e,t){e.splice(t,1)
}:function(e,t){var r,n,i;if(t===e.length-1)e.length=t;else for(r=e.slice(t+1),e.length=t,n=0,i=r.length;i>n;++n)e[t+n]=r[n]
},f=n("key"),d=n("value"),g=0,h=1,y=2;return i.prototype={getEqualityFunction:function(e){return typeof e.equals==l?t:r
},getEntryForKey:a(h),getEntryAndIndexForKey:a(y),removeEntryForKey:function(e){var t=this.getEntryAndIndexForKey(e);
return t?(p(this.entries,t[0]),t[1]):null},addEntry:function(e,t){this.entries[this.entries.length]=[e,t]
},keys:o(0),values:o(1),getEntries:function(e){for(var t=e.length,r=0,n=this.entries.length;n>r;++r)e[t+r]=this.entries[r].slice(0)
},containsKey:a(g),containsValue:function(e){for(var t=this.entries.length;t--;)if(e===this.entries[t][1])return!0;
return!1}},u}();(function(e){"use strict";var t,r=(e.BMP,{}),n={};r.createObjectURL=function(e,r){var i=t();
return!(!r||!r.autoRevoke)||!1,n[i]=e,"blob:"+i},r.revokeObjectURL=function(e){var t=e.replace("blob:","");
delete n[t]},r.retrieveObject=function(e){var t=e.replace("blob:","");return n[t]
},r.revokeAllObjectURLs=function(){n={}},t=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=0|16*Math.random(),r="x"===e?t:8|3&t;
return r.toString(16)})},e.BMP=e.BMP||{},e.BMP.URL=r})(this),function(e){"use strict";
var t,r;e.BMP=e.BMP||{},t=e.BMP,t.MIME=t.MIME||{},r=t.MIME,r.TEXT_TYPES=["application/javascript","application/json","application/x-javascript"],r.isText=function(e){return 0===e.indexOf("text/")?!0:-1!==r.TEXT_TYPES.indexOf(e)?!0:!1
}}(this),function(e){"use strict";var t,r,n,i,a=!0;e.BMP.MIME;try{t=new e.Blob,t=null
}catch(o){a=!1}i=function(t){var r,n="",i=new e.Uint8Array(t),a=i.byteLength;for(r=0;a>r;r++)n+=String.fromCharCode(i[r]);
return e.btoa(n)},r=function(e,t){var r;if(e&&!Array.isArray(e))throw Error("first argument should be an Array");
return t=t||{},this.size=0,this.type="",this.base64="",this.text="","object"==typeof t&&(this.type=t.type||this.type),e&&e.length&&(r=e[0],"string"==typeof r&&(0===r.indexOf("data:")&&"text/plain"===this.type?(this.size+=r.length,this.text+=r):(this.size+=r.length,this.base64+=r))),this
},r.createNative=function(t,n){var i;return n=n||{},a?new e.Blob(t,n):e.BlobBuilder?(i=new e.BlobBuilder,i.append(t),i.getBlob(n)):new r(t,n)
},r.fromBlobURL=function(t,n,i){n=n||function(){},i=i||function(){},e.URL&&e.URL.createObjectURL?r.nativelyFromBlobURL(t,n,i):this.fromNativeBlob(e.BMP.URL.retrieveObject(t),function(e){n(e)
},function(e){i(e)})},r.fromNativeBlob=function(t,n,i){var a=new e.FileReader;n=n||function(){},i=i||function(){},a.onload=function(e){var o;
a.onload=null;try{if(o=e.target.result,t=r.fromDataURI(e.target.result),!t)throw Error("Blob.fromNativeBlob: fromDataURI gave no blob")
}catch(s){return i(s),void 0}n(t)},a.onerror=function(e){a.onerror=null,i(e.target.error)
};try{a.readAsDataURL(t)}catch(o){a.onload=null,a.onerror=null,i(o)}},r.fromDataURI=function(t){var n,i,a,o,s=new r;
n=t.split(","),o=n[1],n=n[0].split(":"),n=n[1].split(";"),i=n[0],a=n[1],"base64"===a?s.base64=o:s.text=o,s.type=i,s.size=o.length;
try{s=r.fromDataURI(e.atob(s.base64)),s.makeNested()}catch(c){}return s},r.nativelyFromBlobURL=function(t,n,a){var o,s;
n=n||function(){},a=a||function(){},o=new e.XMLHttpRequest,o.onreadystatechange=function(){var t,o,c;
this.readyState===e.XMLHttpRequest.DONE&&(this.onreadystatechange=null,t=this.getResponseHeader("Content-Type"),200===this.status?("arraybuffer"===this.responseType?(o=i(this.response),s=new r([o],{type:t})):"blob"===this.responseType?r.fromNativeBlob(this.response,function(e){n(e)
},function(e){a(e)}):"document"===this.responseType?(c=new e.XMLSerializer,o=e.btoa(c.serializeToString(this.response)),s=new r([o],{type:t})):"json"===this.responseType?(o=e.btoa(JSON.stringify(this.response)),s=new r([o],{type:t})):s=new r([this.response],{type:t}),s?n(s):a(Error("error retrieving target Blob via Blob URL"))):a(Error(this.url+" -> "+this.status)))
},o.open("GET",t),o.send()},r.isNested=function(){},r.prototype.makeNested=function(){var e="data:";
e+=this.type,e+=";base64,",e+=this.base64,this.type="text/plain",this.text=e,this.base64=null
},r.prototype.undoNested=function(){var e=r.fromDataURI(this.text);this.type=e.type,this.base64=e.base64,this.text=null
},r.prototype.toNative=function(){return e.BMP.Blob.createNative([e.atob(this.base64)],{type:this.type})
},e.BMP=e.BMP||{},e.BMP.Blob=r,e.BMP.NestedBlob=n}(this),function(e){"use strict";
var t,r,n,i=e.Modernizr,a=e.document,o=e.jQuery;return i?(i.addTest("filereader",function(){return!!(e.File&&e.FileList&&e.FileReader)
}),i.addTest("positionfixed",function(){var t,r,n=a.createElement("div"),i=!1,s=a.body||function(){return i=!0,a.documentElement.appendChild(a.createElement("body"))
}(),c=s.style.cssText;return s.style.cssText="height: 3000px; margin: 0; padding; 0;",n.style.cssText="position: fixed; top: 100px",s.appendChild(n),e.scrollTo(0,500),r=o(n).offset(),t=600===r.top,t||void 0===n.getBoundingClientRect||(t=100===n.getBoundingClientRect().top),s.removeChild(n),s.style.cssText=c,e.scrollTo(0,1),i&&a.documentElement.removeChild(s),t
}),i.addTest("xpath",function(){var t=o.parseXML("<xml />");return!!e.XPathResult&&!!t.evaluate
}),i.addTest("documentfragment",function(){var e,t,r;try{return r=a.createElement("p"),e=a.createDocumentFragment(),t=a.createDocumentFragment(),t.appendChild(r),e.appendChild(t),r.parentNode!==e?!1:t.parentNode===e?!1:!0
}catch(n){return!1}}),i.inputtypes.file=function(){var e,t=navigator.userAgent,r=-1!==t.indexOf("Android"),n=r&&/Android 2\.(0|1)/.test(t);
return r&&(-1!==t.indexOf("Android 1.")||n)?!1:(e=a.createElement("input"),e.setAttribute("type","file"),e.disabled===!1)
}(),i.inputtypes.number=function(){var e,t;return i.inputtypes.number?(e=o('<input type="number" />'),e.val(1.5),t=e[0].checkValidity(),e.remove(),t):!1
}(),i.canvas&&(t=new Image,r=a.createElement("canvas"),n=r.getContext("2d"),t.onload=function(){n.drawImage(t,0,0),i.addTest("canvastodataurlpng",function(){return 0===r.toDataURL("image/png").indexOf("data:image/png")
}),i.addTest("canvastodataurljpeg",function(){return 0===r.toDataURL("image/jpeg").indexOf("data:image/jpeg")
}),i.addTest("canvastodataurlwebp",function(){return 0===r.toDataURL("image/webp").indexOf("data:image/webp")
})},t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACklEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg=="),void 0):(e.warn("Blink Modernizr tests need Modernizr to be included first."),void 0)
}(this),function(e){"use strict";var t=e.jQuery,r=e.Math;e.isBlinkGapDevice=function(){return e.PhoneGap&&"object"===t.type(e.device)&&e.device instanceof e.Device
},e.computeTimeout=function(e){var t=1e3/600;return r.floor(e*t+15e3)}}(this),function(e){"use strict";
var t,r=e.jQuery,n=r(e.document),i={history:[]},a=["log","error","warn","info"],o=function(){n.off("ready deviceready",o),setTimeout(function(){t=e.console||e.debug||{log:r.noop},r.each(a,function(n,i){var a=r.type(t[i]);
e[i]="function"===a?function(){t[i].apply(t,arguments)}:"object"===a?function(e){t[i](e)
}:"log"!==i?e.log:r.noop}),r.each(i.history,function(n,i){var a=e[i.fn],o=r.type(a);
"function"===o?a.apply(t,i.args):"object"===o&&a(i.args[0])}),delete i.history,r.each(a,function(e,t){delete i[t]
})},0)},s=function(){e.PhoneGap&&e.PhoneGap.available?i.history&&o():setTimeout(s,197)
};t=i,r.each(a,function(n,a){i[a]=function(){i.history.push({fn:a,args:r.makeArray(arguments)})
},e[a]=t[a]}),e.isBlinkGap?s():n.on("ready",o)}(this),function(e){var t=e.String;
t.prototype.hasEntities=function(){var e=this;return-1===e.indexOf("&")?!1:void 0
},t.prototype.repeat=function(e){var t,r="";for(t=0;e>t;t++)r+=this;return r}}(this),function(e){"use strict";
var t=e.Math,r=t.round;t.round=function(e,n){var i;return n&&0!==n?(i=t.pow(10,n),"number"==typeof n&&n>0&&(e=t.round(e*i)/i),e):r(e)
},"function"!=typeof t.uuid&&(t.uuid=function(){var e,r=t.uuid.CHARS,n=[],i=36;for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4";i--;)n[i]||(e=0|16*t.random(),n[i]=r[19===i?8|3&e:e]);
return n.join("")},t.uuid.CHARS=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"])
}(this),function(e){"use strict";function t(e,t){var n=!0;return e&&"object"===r.type(e)?"array"===r.type(t)?(r.each(t,function(t,r){return e[r]===void 0?(n=!1,!1):!0
}),n):"object"===r.type(t)?(r.each(t,function(t,i){return r.type(e[t])!==i?(n=!1,!1):!0
}),n):!1:!1}var r=e.jQuery,n=r.fn.attr,i=r.fn.show;r.isObject=function(e){return"object"===r.type(e)
},r.isPromise=function(e){var r="function",n={always:r,done:r,fail:r,pipe:r,progress:r,promise:r,state:r,then:r};
return t(e,n)},r.isDeferred=function(e){var n="function",i={notify:n,notifyWith:n,reject:n,rejectWith:n,resolve:n,resolveWith:n};
return r.isPromise(e)?t(e,i):!1},r.fn.attr=function(){var e,t,i;return this[0]&&0===arguments.length?(i={},t=this[0].attributes,e=t.length,r.each(t,function(e,t){var r=t.name||t.nodeName,n=t.value||t.nodeValue;
r&&(i[r.toLowerCase()]=n)}),i):n.apply(this,arguments)},r.fn.show=function(){return this.removeAttr("hidden"),this.removeClass("hidden"),i.apply(this,arguments)
},r.fn.isHidden=function(){return this.prop("hidden")||this.hasClass("hidden")?!0:this[0]&&this[0].style&&"none"===this[0].style.display
},r.fn.tag=function(){var e;return this.length>0?(e=this[0].nodeName||this[0].tagName||"",e.toLowerCase()):""
},r.fn.tagHTML=function(){var e,t=r(this);return this[0]?(e="<"+t.tag(),r.each(t.attr(),function(t,r){e+=" "+t+'="'+r+'"'
}),e+=" />"):void 0},r.whenArray=function(e){return r.when.apply(r,e)},r.resolveTimeout=function(){var e=r.makeArray(arguments),t=e.shift();
return setTimeout(function(){t.resolve.apply(t,e)},0),this},r.fn.appendWithCheck=function(t,n,i,a){var o=r(this),s=new r.Deferred,c=e.MyAnswers;
return"string"!==r.type(i)&&(i=t.match(/>([^<>\0\n\f\r\t\v]+)</),i||(i=t.match(/(\w+)/)),i="array"===r.type(i)?i[0]:t),"number"!==r.type(a)&&c.dispatch.add(function(){a=o.html().lastIndexOf(i)
}),c.dispatch.add(function(){o.append(t)}),c.dispatch.add(function(){var e=o.html();
"string"!==r.type(e)||!e||e.lastIndexOf(i)>a?s.resolve():n>0?r.when(o.appendWithCheck(t,--n,i,a)).fail(s.reject).then(s.resolve):s.reject()
}),s.promise()},r.fn.childrenAsProperties=function(){var e={};return r(this).children().each(function(t,n){var i=r(n),a=i.tag(),o=i.text();
a.length>0&&o.length>0&&(e[a]=o)}),e},r.getCachedScript=function(e,t){return t=r.extend(t||{},{dataType:"script",cache:!0,url:e}),r.ajax(t)
}}(this),function(e){"use strict";var t=e.jQuery,r=e._Blink,n=e._SERVER,i={PREFIX_GZ:"/_c_/",SUFFIX_GZ:"",PREFIX:"/_c_/",SUFFIX:""},a=["css","js"],o=function(e){var o;
return o=r&&r.cfg&&r.cfg.CDN_PLATFORM,o=t.isObject(o)?o:{},o=t.extend({},i,o),e=e||n&&n.HTTP_ACCEPT_ENCODING,e="string"==typeof e?e:"",-1===e.indexOf("gzip")&&(o.PREFIX_GZ=o.PREFIX,o.SUFFIX_GZ=o.SUFFIX),this.getURL=function(e){var r;
return e&&"string"==typeof e?(e=t.trim(e),e=e.replace(/^\/*/,""),r=e.match(/\.?(\w+)$/),r="array"===t.type(r)?r[1]:"",r&&-1!==t.inArray(r,a)?o.PREFIX_GZ+e+o.SUFFIX_GZ:o.PREFIX+e+o.SUFFIX):""
},this};r.preloadPage=function(e){var r,n=t("<iframe></iframe>"),i=30,a=function(){n.remove()
},o=function(){i--,t(r.document.body).hasClass("s-ready")?a():0>i?(warn('preloadPage(): timed out waiting for "s-ready"'),a()):setTimeout(o,2e3)
};n.attr({height:10,width:10,src:e}),n.css({position:"absolute",top:"-50px",left:"-50px"}),t("body").append(n),r=n[0].contentWindow,t.isWindow(r)&&r.document?t(r.document.body).hasClass("s-ready")?a():setTimeout(o,2e3):warn("preloadPage(): unable to find Window or Document in <iframe>")
},r.stringifyDOM=function(t){var r;return t.xml?t.xml:e.XMLSerializer?(r=new e.XMLSerializer,r.serializeToString(t)):null
},r.hasFontFor=function(n){var i,a,o,s,c=r.hasFontFor;try{c.results||(c.results={}),"boolean"==typeof c.results[n]?i=c.results[n]:(a=t(e.document.body),o=t("<span>"+n+"</span>"),s=t("<span>&#xFFFD;</span>"),o.add(s).appendTo(a),i=o.innerWidth()!==s.innerWidth(),c.results[n]=i,o.add(s).remove())
}catch(u){error(error),i=!1}return i},e._Blink.cdnp=new o}(this),function(e){"use strict";
var t=e.jQuery,r=function(e){function r(){if(!i.isPaused&&null===n&&0!==i.queue.length){var e,a=i.queue.shift();
"function"==typeof a&&(e=a()),"function"==typeof t&&t()instanceof t&&e&&"object"==typeof e&&e.promise&&"function"==typeof e.promise?(n=0,t.when(e).always(function(){n=setTimeout(function(){n=null,r()
},i.interval)})):n=setTimeout(function(){n=null,r()},i.interval)}}var n=null,i=this;
return this.queue=[],this.interval=e||0,this.isPaused=!1,this.poke=function(){r()
},this.pause=function(){clearTimeout(n),n=null,this.isPaused=!0},this.resume=function(){this.isPaused=!1,r()
},this};r.prototype.add=function(e){this.queue.push(e),this.poke()},e.BlinkDispatch=r
}(this),function(e,t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],function(r){return e.BMP=t(e,r),e.BMP
}):e.BMP=t(e,e.$)}(this,function(e,t){"use strict";var r,n,i,a,o,s,c=t(e.document),u=t(e.document.body),l=e.navigator||{},p={};
return r=e.BMP=e.BMP||{},t&&t.fn&&"string"==typeof t.fn.jquery?(i=function(){var e=t('<div id="bmp-dialog-async"></div>');
return e.hide(),u.append(e),e},p.jQueryUI=function(e,t){n=u.find("#bmp-dialog-async"),n.length||(n=i()),n.empty(),n.hasClass("ui-dialog-content")&&n.dialog("destroy"),n.append("<p>"+e+"</p>"),t.modal=!0,t.closeOnEscape=!0,n.dialog(t)
},a=function(){return t.fn.dialog},o=function(){return t.mobile&&t.fn.dialog},r.alertNoQueue=function(r,n){var i,o=new t.Deferred,s=l.notification||{},c=s.alert;
return n=n||{},n.ok="OK",i=function(){o.resolve()},"function"===t.type(c)?(n.title="Alert",c(r,i,n.title,n.ok)):a()?(n.title="Alert",n.buttons={},n.buttons[n.ok]=function(){t(this).dialog("close")
},n.close=i,p.jQueryUI(r,n)):(r=(n.title?n.title+" | ":"")+r,e.alert(r),o.resolve()),o.promise()
},r.confirmNoQueue=function(r,n){var i=new t.Deferred,o=l.notification||{},s=o.alert;
return n=n||{},n.ok=n.ok||"OK",n.cancel=n.cancel||"Cancel","function"===t.type(s)?(n.title=n.title||"Confirm",s(r,function(e){1===e?i.resolve(!0):i.resolve(!1)
},n.title,n.ok+","+n.cancel)):a()?(n.title=n.title||"Confirm",n.buttons={},n.buttons[n.cancel]=function(){t(this).dialog("close")
},n.buttons[n.ok]=function(){i.resolve(!0),t(this).dialog("close")},n.close=function(){i.isRejected()&&i.isResolved()||i.resolve(!1)
},p.jQueryUI(r,n)):(r=(n.title?n.title+" | ":"")+r,i.resolve(e.confirm(r))),i.promise()
},r.promptNoQueue=function(r,n,i){var o=new t.Deferred;return"string"!=typeof n&&(i=n,n=""),i=i||{},i.ok=i.ok||"OK",i.cancel=i.cancel||"Cancel",a()?(r+='</p><p><input type="text" value="'+n+'" />',i.title=i.title||"Prompt",i.buttons={},i.buttons[i.cancel]=function(){t(this).dialog("close")
},i.buttons[i.ok]=function(){var e=t(this);o.resolve(e.find("input").val()),e.dialog("close")
},i.close=function(){o.isRejected()&&o.isResolved()||o.resolve(null)},p.jQueryUI(r,i)):(r=(i.title?i.title+" | ":"")+r,o.resolve(e.prompt(r))),o.promise()
},s=function(e,r,n){return"string"==typeof r&&(r=e[r]),function(){var i=t.makeArray(arguments),a=new t.Deferred;
return c.queue(n,function(o){var s,u=t._data(c[0],n+"queue");return u.unshift("inprogress"),s=r.apply(e,i),s.then(function(){a.resolve.apply(a,t.makeArray(arguments)),u.shift(),o()
},function(){a.reject.apply(a,t.makeArray(arguments)),u.shift(),o()}),s}),c.queue(n).length&&"inprogress"!==c.queue(n)[0]&&c.dequeue(n),a.promise()
}},r.alert=s(this,r.alertNoQueue,"bmp-alerts"),r.confirm=s(this,r.confirmNoQueue,"bmp-alerts"),r.prompt=s(this,r.promptNoQueue,"bmp-alerts"),r):void 0
}),function(e,t){"use strict";"function"==typeof define&&define.amd?define(["underscore"],function(r){return e.BMP=t(e,r),e.BMP
}):e.BMP=t(e,e._)}(this,function(e,t){"use strict";var r,n,i;return r=e.BMP=e.BMP||{},n=r.BIC=r.BIC||{},i=function(e){this.cfg=e
},i.prototype.toCameraOptions=function(){var e,r={};if(t.isNumber(this.cfg.imageCaptureQuality)&&(r.quality=this.cfg.imageCaptureQuality),t.isNumber(this.cfg.imageCaptureScale)&&(r.imageScale=this.cfg.imageCaptureScale),t.isString(this.cfg.cameraOptions)){try{e=JSON.parse(this.cfg.cameraOptions),(!t.isObject(e)||t.isArray(e))&&(e={})
}finally{e=e||{}}t.extend(r,e)}return r},n.Config=i,r}),function(e){"use strict";
var t,r,n,i,a,o,s,c,u,l=e.jQuery,p=e.BMP,f=(p.alert,{}),d={},g=function(c,u,d){var g,h,y,m=this,v=new l.Deferred;
return("string"!=typeof u||1>u.length)&&(u="default"),("string"!=typeof d||1>d.length)&&(d="main"),"string"!=typeof c?c=t[0]:"sessionstorage"===c&&-1===l.inArray("sessionstorage",t)?c="memory":-1===l.inArray(c,t)&&(c=t[0]),m.type=c,m.partition=u,m.section=d,v.done(function(){o("BlinkStorage(): "+c+" -> "+u+" : "+d+" ready")
}),m.ready=function(){return v.promise()},"localstorage"===c||"sessionstorage"===c?(h="localstorage"===c?e.localStorage:e.sessionStorage,m.get=function(e){var t=new l.Deferred;
return t.resolve(h.getItem(u+":"+d+":"+e)),t.promise()},m.set=function(e,t){var r=new l.Deferred;
return h.setItem(u+":"+d+":"+e,t),r.resolve(),r.promise()},m.remove=function(e){var t=new l.Deferred;
return h.removeItem(u+":"+d+":"+e),t.resolve(),t.promise()},m.keys=function(){var e,t,r=new l.Deferred,n=[],i=h.length,a=u+":"+d+":";
for(e=0;i>e;e++)t=h.key(e),0===t.indexOf(a)&&n.push(t.replace(a,""));return r.resolve(n),r.promise()
},m.count=function(){var e=new l.Deferred;return l.when(m.keys()).done(function(t){e.resolve(t.length)
}),e.promise()},v.resolve()):"websqldatabase"===c?(r=1024*1024*(e.device?5:.75),n=function(e,t){var r=t&&e.executeSql?t:e;
return s("BlinkStorage error1: "+r.code+" "+r.message),(3===r.code||4===r.code||7===r.code)&&p.alert(r.code+"\n"+r.message,{title:"Storage error!"}),!1
},i=function(){h.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS `"+d+"` (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)",[],v.resolve,v.reject)
},n,l.noop)},a=function(){try{h=e.openDatabase(u,"1.0",u,r),f[u]=h,h.readTransaction=h.readTransaction||h.transaction
}catch(t){throw v.reject(),"BlinkStorage: "+t}},g={get:"SELECT v FROM `"+d+"` WHERE k = ?",set:"INSERT OR REPLACE INTO `"+d+"` (k, v) VALUES (?, ?)",remove:"DELETE FROM `"+d+"` WHERE k = ?",keys:"SELECT k FROM `"+d+"`",count:"SELECT count(k) AS `count` FROM "+d},f[u]?h=f[u]:a(),i(),m.get=function(e){var t=new l.Deferred;
return h.readTransaction(function(r){r.executeSql(g.get,[e],function(e,r){1===r.rows.length?t.resolve(r.rows.item(0).v):(t.resolve(null),r.rows.length>1&&s("BlinkStorage: SELECT returned multiple rows"))
},n)},n,l.noop),t.promise()},m.set=function(e,t,r){var i=new l.Deferred,a=new l.Deferred,o=function(){setTimeout(function(){l.when(m.set(e,t,r)).fail(i.reject).then(i.resolve)
},2e3)};return r="number"!=typeof r?2:r,0>=r--?(i.reject(),i.promise()):(setTimeout(function(){h.transaction(function(r){r.executeSql(g.set,[e,t],function(e,t){1!==t.rowsAffected?(s("BlinkStorage: INSERT did not affect 1 row"),o()):a.resolve()
},function(e,t){n(t),o()})},function(e,t){n(e,t),o()},function(){"pending"===a.state()?o():i.resolve()
})},0),i.promise())},m.remove=function(e){var t=new l.Deferred;return h.transaction(function(r){r.executeSql(g.remove,[e],function(){t.resolve()
})},n,l.noop),t.promise()},m.keys=function(){var e=new l.Deferred;return h.readTransaction(function(t){t.executeSql(g.keys,[],function(t,r){var n,i,a=r.rows.length,o=[];
for(n=0;a>n;n++)i=r.rows.item(n),o.push(i.k);e.resolve(o)})},n,l.noop),e.promise()
},m.count=function(){var e=new l.Deferred;return h.readTransaction(function(t){t.executeSql(g.count,[],function(t,r){var n=r.rows.item(0).count;
l.isNumeric(n)?e.resolve(parseInt(n,10)):(s("BlinkStorage: SELECT count(k) non-numeric"),e.reject())
})},n,l.noop),e.promise()}):"memory"===c&&(y={},m.get=function(e){var t=new l.Deferred;
return t.resolve(y[u+":"+d+":"+e]),t.promise()},m.set=function(e,t){var r=new l.Deferred;
return y[u+":"+d+":"+e]=t,r.resolve(),r.promise()},m.remove=function(e){var t=new l.Deferred;
return delete y[u+":"+d+":"+e],t.resolve(),t.promise()},m.keys=function(){var e,t=new l.Deferred,r=[],n=u+":"+d+":";
for(e in y)y.hasOwnProperty(e)&&0===e.indexOf(n)&&r.push(e.replace(n,""));return t.resolve(r),t.promise()
},m.count=function(){var e=new l.Deferred;return l.when(m.keys()).done(function(t){e.resolve(t.length)
}),e.promise()},v.resolve()),this};return l?(l.each(["log","error","warn","info"],function(t,r){d[r]=function(){e[r]&&e[r].apply(e,arguments)
}}),o=d.log,s=d.error,c=d.warn,u=d.info,g.prototype.removeKeysRegExp=function(e){var t=this,r=new l.Deferred(function(r){l.when(t.keys()).done(function(n){var i,a=n.length,o=[];
for(i=0;a>i;i++)-1!==n[i].search(e)&&o.push(t.remove(n[i]));l.when(o).done(r.resolve())
})});return r.promise()},g.prototype.available=[],t=g.prototype.available,e.openDatabase!==void 0&&t.push("websqldatabase"),e.localStorage!==void 0&&t.push("localstorage"),e.sessionStorage!==void 0&&t.push("sessionstorage"),t.push("memory"),"function"==typeof e.log&&u("BlinkStorage(): available=["+t.join(",")+"]"),e.BlinkStorage=g,void 0):(p.alert("jQuery must be be loaded first",{title:"Storage error!"}),void 0)
}(this);var activityIndicatorTop,$navBar;document.getElementById("startUp-loadDevice").className="working",MyAnswers.deviceDeferred=new $.Deferred,function(e){var t=e.jQuery,r=function(){var r=this;
return r.hideLocationBar=function(){e.scrollTo(0,1)},r.prepareView=function(r,n){var i=new t.Deferred;
return MyAnswers.dispatch.add(function(){var a,o=n?"right":"left",s=t(".view:visible"),c=t("#navBoxHeader");
return"screen-bottom"!==e.currentConfig.footerPosition&&MyAnswers.$body.children("footer").hide(),1>s.size()?(i.resolve(),void 0):(MyAnswers.dispatch.pause("prepareView"),c.find("button").attr("disabled","disabled"),s.addClass("animating"),a=setTimeout(function(){s.trigger("webkitTransitionEnd")
},1e3),s.one("webkitTransitionEnd",function(){clearTimeout(a),a=null,s.hide(),s.removeClass("animating slid"+o),MyAnswers.dispatch.resume("hideView"),i.resolve()
}),setTimeout(function(){s.addClass("slid"+o)},0),currentMasterCategory?r.attr({"data-name":siteVars.config["m"+currentMasterCategory].pertinent.name}):t("#categoriesView").removeAttr("data-name"),currentCategory?r.attr({"data-name":siteVars.config["c"+currentCategory].pertinent.name}):t("#keywordListView").removeAttr("data-name"),currentInteraction?r.attr({"data-name":siteVars.config["i"+currentInteraction].pertinent.name,"data-type":siteVars.config["i"+currentInteraction].pertinent.type}):(t("#answerView").removeAttr("data-name"),t("#answerView").removeAttr("data-type")),void 0)
}),i.promise()},r.showView=function(e,n){var i=new t.Deferred;return MyAnswers.dispatch.add(function(){var t,a=n?"left":"right";
MyAnswers.dispatch.pause("showView"),r.hideLocationBar(),e.hide(),e.addClass("slid"+a),e.show(),t=setTimeout(function(){e.trigger("webkitTransitionEnd")
},1e3),e.one("webkitTransitionEnd",function(){clearTimeout(t),t=null,e.removeClass("animating"),MyAnswers.dispatch.resume("showView"),updateNavigationButtons(),MyAnswers.$body.children("footer").show(),i.resolve(),e.trigger("viewShow")
}),setTimeout(function(){e.addClass("animating"),e.removeClass("slid"+a)},0)}),i.promise()
},r};e.MyAnswersDevice=new r}(this),document.getElementById("startUp-loadDevice").className="working success",MyAnswers.deviceDeferred.resolve();
var MyAnswers=MyAnswers||{},siteVars=siteVars||{},deviceVars=deviceVars||{},hasCategories=!1,hasMasterCategories=!1,hasInteractions=!1,answerSpaceOneKeyword=!1,currentInteraction,currentCategory,currentMasterCategory,currentConfig={},starsProfile={};
document.getElementById("startUp-loadMain").className="working",currentConfig.downloadTimeout=30,currentConfig.uploadTimeout=45,deviceVars.isOnline=!0,MyAnswers.mainDeferred=new $.Deferred,MyAnswers.browserDeferred=new $.Deferred,MyAnswers.formsDeferred=new $.Deferred,MyAnswers.dfrdMoJOs=null,MyAnswers.dfrdGoogleMaps=null,siteVars.mojos=siteVars.mojos||{},siteVars.forms=siteVars.forms||{},MyAnswers.isLoggedIn=!1,MyAnswers.isCustomLogin=!1,MyAnswers.isEmptySpace=!1,window.applicationCache&&$(window.applicationCache).on({updateready:function(){this.status!==this.IDLE?(this.swapCache(),log("Application Cache: manifest change triggered update")):(this.update(),log("Application Cache: update requested"))
},error:function(){error("Application Cache: "+this.status)}}),MyAnswers.gotoDefaultScreen=function(){var e,t=window.History;
"login"===currentConfig.defaultScreen||MyAnswers.isLoginOnly?showLoginView():"interaction"===currentConfig.defaultScreen&&hasInteractions&&void 0!==typeof siteVars.config["i"+currentConfig.defaultInteraction]?(e="/"+siteVars.answerSpace+"/"+siteVars.config["i"+currentConfig.defaultInteraction].pertinent.name+"/?",t.pushState({i:currentConfig.defaultInteraction},null,e)):"category"===currentConfig.defaultScreen&&hasCategories&&void 0!==typeof siteVars.config["c"+currentConfig.defaultCategory]?(e="/"+siteVars.answerSpace+"/?_c="+currentConfig.defaultCategory,t.pushState({c:currentConfig.defaultCategory},null,e)):"master category"===currentConfig.defaultScreen&&hasMasterCategories&&void 0!==typeof siteVars.config["m"+currentConfig.defaultMasterCategory]?(e="/"+siteVars.answerSpace+"/?_m="+currentConfig.defaultMasterCategory,t.pushState({m:currentConfig.defaultMasterCategory},null,e)):t.replaceState({_now:$.now()},null,"/"+siteVars.answerSpace+"/")
},function(e){function t(){History.pushState({m:$(this).data("id")},null,"/"+siteVars.answerSpace+"/?_m="+$(this).data("id"))
}function r(){History.pushState({m:$(this).data("masterCategory"),c:$(this).data("id")},null,"/"+siteVars.answerSpace+"/?_c="+$(this).data("id"))
}function n(){var e=siteVars.config["i"+$(this).data("id")].pertinent.name;History.pushState({m:$(this).data("masterCategory"),c:$(this).data("category"),i:$(this).data("id")},null,"/"+siteVars.answerSpace+"/"+e+"/")
}function i(){e.open($(this).data("hyperlink"),$(this).data("target"))}var a=e.MyAnswers;
a.populateItemListing=function(e,o){var s,c,u,l,p,f,d,g,h,y,m,v,w,b,S,C,A={};A.interactions=function(e){var t=e.attr("data-id"),r=siteVars.config["i"+t].pertinent;
"hyperlink"===r.type&&r.hyperlink?(e.attr("data-hyperlink",r.hyperlink),e.attr("data-target",r.hyperlinkTarget),e.bind("click",i)):e.bind("click",n)
},A.categories=function(e){var t=e.attr("data-id");1===siteVars.map["c"+t].length?(e.attr("data-category",t),e.attr("data-id",siteVars.map["c"+t][0]),A.interactions(e)):siteVars.map["c"+t].length>0&&e.bind("click",r)
},A.masterCategories=function(e){var r=e.attr("data-id");1===siteVars.map["m"+r].length?(e.attr("data-master-category",r),e.attr("data-id",siteVars.map["m"+r][0]),A.categories(e)):siteVars.map["m"+r].length>0&&e.bind("click",t)
},a.dispatch.add(function(){switch(o.children(".box:not(.welcomeBox)").remove(),p=$('<div class="box bordered" />'),f=$('<ul class="box" />'),e){case"masterCategories":s=currentConfig.masterCategoriesArrangement,c=currentConfig.masterCategoriesDisplay,u=siteVars.map.masterCategories,l=u,d="m";
break;case"categories":s=currentConfig.categoriesArrangement,c=currentConfig.categoriesDisplay,u=siteVars.map.categories,l=siteVars.map["m"+currentMasterCategory]||u,d="c";
break;case"interactions":s=currentConfig.interactionsArrangement,c=currentConfig.interactionsDisplay,u=siteVars.map.interactions,l=siteVars.map["c"+currentCategory]||u,d="i"
}switch("BlinkSideBar"===o.attr("id")&&(s="list",c=currentConfig.sidebarDisplay),log("MyAnswers.populateItemListing(): "+e+" "+s+" "+c+" "+d+"["+l.join(",")+"]"),s){case"list":b=1;
break;case"2 column":b=2;break;case"3 column":b=3;break;case"4 column":b=4}for(w=u.length,v=0;w>v;v++)C=siteVars.config[d+u[v]],C!==void 0&&-1!==$.inArray(u[v],l)&&"hide"!==C.pertinent.display&&(g=C.pertinent.displayName||C.pertinent.name,"text only"!==c&&C.pertinent.icon?(h=$("<img />"),h.attr({"class":"v"+b+"col",src:C.pertinent.icon,alt:g}),p.append(h)):(h=$("<li />"),y=$('<div class="label" />'),y.text(g),h.append(y),"string"==typeof C.pertinent.description&&(m=$('<div class="description" />'),m.text(C.pertinent.description),h.append(m)),f.append(h)),h.attr("data-id",u[v]),A[e](h))
}),a.dispatch.add(function(){p.children().size()>0&&(S=p.find("img"),1===b?(S.first().addClass("topLeft topRight"),S.last().addClass("bottomLeft bottomRight")):(S.first().addClass("topLeft"),S.size()>=b&&S.eq(b-1).addClass("topRight"),0===S.size()%b&&(S.eq(-1*b).addClass("bottomLeft"),S.last().addClass("bottomRight"))),p.appendTo(o)),f.children().size()>0&&f.appendTo(o)
})}}(this),function(e){var t,r,n,i,a=e.jQuery,o=e.MyAnswers,s=e.deviceVars,c={},u=a("#BlinkSideBar"),l=a("#stackLayout");
c.show=function(){o.dispatch.add(function(){l.addClass("bSideBar-on"),l.find(".selected").removeClass("selected"),l.find("[data-id="+currentCategory+"]").addClass("selected")
})},c.hide=function(){o.dispatch.add(function(){l.removeClass("bSideBar-on")})},c.update=function(){var c=siteVars.config["a"+siteVars.id].pertinent;
if(-1!==a.inArray("phone",s.features)||768>a(e).width()||"disabled"===c.sidebarDisplay)return this.hide(),void 0;
if(hasMasterCategories&&currentMasterCategory)t="masterCategories",n=currentMasterCategory;
else if(hasCategories&&currentCategory)t="categories",n=currentCategory;else{if(!hasInteractions||!currentCategory)return this.hide(),void 0;
t="interactions",n=currentInteraction}r!==t&&o.populateItemListing(t,u),r=t,i=n,this.show()
},o.sideBar=c}(this),MyAnswers.dumpLocalStorage=function(){$.when(MyAnswers.store.keys()).done(function(e){var t,r=e.length,n=function(e){e=e.length>20?e.substring(0,20)+"...":e,log("dumpLocalStorage(): found value: "+e)
};for(t=0;r>t;t++)log("dumpLocalStorage(): found key: "+e[t]),$.when(MyAnswers.store.get(e[t])).done(n)
})},function(e){function t(){var t=new T.Deferred,r=T.now(),n=T("#startUp-initBlinkGap"),i=function(){e.PhoneGap?e.PhoneGap.available?t.resolve():T(S).on("deviceready",t.resolve):T.now()-r>1e4?(warn("waitForBlinkGap(): still no PhoneGap after 10 seconds"),t.reject()):setTimeout(i,197)
};return e.isBlinkGap?(log("waitForBlinkGap(): native application detected"),n.addClass("working"),i(),T.when(t.promise()).fail(function(){n.addClass("error")
}).then(function(){n.addClass("success")}),t.promise()):(log("waitForBlinkGap(): native application not detected"),n.remove(),t.resolve(),t.promise())
}function r(){var t=new T.Deferred,r=null,n=function(e){r=null,_.notification.alert("Database installed, please restart the App.",function(){_.gap_database.requestTerminate()
},"First Run","Close App"),log("fixWebSQL(): quota increase: "+e)},i=function(e){var r={quotaIncrease:M.device.storageQuota+""},i=e.allocatedSpace,a=e.currentQuota;
log("fixWebSQL(): allocatedSpace="+i+" currentQuota="+a),M.device.storageQuota>a?_.gap_database.increaseQuota(n,t.reject,r):t.resolve()
};if(M&&M.device&&M.device.storageQuota&&"number"===T.type(M.device.storageQuota)&&M.device.storageQuota>0){log("fixWebSQL(): requestedQuota="+M.device.storageQuota);
try{r=e.openDatabase(C.answerSpace,"1.0",C.answerSpace,1048576),_.gap_database.getLimits(i,t.reject,null)
}catch(a){throw t.reject(),log(a),log("*** Open/Increase quota for database failed"),"fixWebSQL(): "+a
}}else log("fixWebSQL(): nothing to do"),t.resolve();return t.promise()}function n(){var e=new T.Deferred;
return M.store?T.when(M.store.get("storageVersion")).always(function(t){t?e.resolve():T.when(M.store.set("storageVersion",0),M.store.remove("siteConfigMessage"),M.store.removeKeysRegExp(/^mojoMessage-/)).always(function(){e.resolve()
})}):e.resolve(),e.promise()}function i(e){var t,r,n,a=T.type(e);return"string"===a&&e.length>0?(t=e.indexOf("#"),-1!==t&&(e=e.substring(0,t))):"array"===a&&e.length>0?(r=[],T.each(e,function(e,t){r.push(i(t))
}),e=r):"object"===a&&(n={},T.each(e,function(e,t){n[e]=i(t)}),e=n),e}function a(e){var t,r=new T.Deferred,n=new b.maps.DirectionsService;
return T.isPlainObject(e)&&e.origin&&e.destination&&e.travelMode?(n.route(e,function(e,n){if(n===b.maps.DirectionsStatus.OK)r.resolve(e);
else{switch(n){case b.maps.DirectionsStatus.NOT_FOUND:t="one of the waypoints could not be geocoded";
break;case b.maps.DirectionsStatus.ZERO_RESULTS:t="no route found, be more specific";
break;case b.maps.DirectionsStatus.MAX_WAYPOINTS_EXCEEDED:t="too many waypoints specified";
break;case b.maps.DirectionsStatus.OVER_QUERY_LIMIT:t="request quota exceeded, try again later";
break;case b.maps.DirectionsStatus.REQUEST_DENIED:t="request denied";break;case b.maps.DirectionsStatus.INVALID_REQUEST:t="invalid request";
break;default:t="unknown error, please try again"}r.reject("GoogleDirections error: "+t)
}}),r.promise()):(r.reject("GoogleDirections error: bad options"),r.promise())}function o(e,t,r){log("GoogleMaps basic: initialising..."),M.$body.trigger("taskBegun");
var n,i,a,o=new b.maps.LatLng(t.latitude,t.longitude),s={zoom:parseInt(t.zoom,10),center:o,mapTypeId:b.maps.MapTypeId[t.type.toUpperCase()]};
r.setOptions(s),"string"==typeof t.kml?n=new b.maps.KmlLayer(t.kml,{map:r,preserveViewport:!0}):"string"==typeof t.marker&&(i=new b.maps.Marker({position:o,map:r,icon:t.marker}),"string"==typeof t.markerTitle&&(i.setTitle(t.markerTitle),a=new b.maps.InfoWindow,b.maps.event.addListener(i,"click",function(){a.setContent(i.getTitle()),a.open(r,i)
}))),M.$body.trigger("taskComplete")}function s(e,t,r){var n,i,s,c={},u={travelMode:b.maps.DirectionsTravelMode[t.travelmode.toUpperCase()],avoidHighways:t.avoidhighways,avoidTolls:t.avoidtolls},l={mapTypeId:b.maps.MapTypeId[t.type.toUpperCase()]},p=T(e),f=p.next(".googledirections").first(),d=f,g=!0,h=!0,y=function(e){"string"==typeof e&&e.length>0&&insertText(f[0],e)
};log("GoogleMaps directions: initialising..."),"string"==typeof t.language&&(c.language=t.language),"string"==typeof t.region&&(c.region=t.region,u.region=t.region),"string"==typeof t.originAddress&&t.originAddress.length>0?n=t.originAddress:t.originLatitude!==void 0?n=new b.maps.LatLng(t.originLatitude,t.originLongitude):Modernizr.geolocation&&(log("Google Maps Directions: missing origin"),insertText(f[0],"attempting to use your most recent location as the origin..."),g=M.getGeoLocation().fail(y).then(function(e){n=new b.maps.LatLng(e.latitude,e.longitude)
})),"string"==typeof t.destinationAddress&&t.destinationAddress.length>0?i=t.destinationAddress:t.destinationLatitude!==void 0?i=new b.maps.LatLng(t.destinationLatitude,t.destinationLongitude):Modernizr.geolocation&&(log("Google Maps Directions: missing destination"),insertText(f[0],"attempting to use your most recent location as the destination..."),h=M.getGeoLocation().fail(y).then(function(e){i=new b.maps.LatLng(e.latitude,e.longitude)
})),T.when(g,h).always(function(){n&&i?"object"===T.type(n)&&"object"===T.type(i)&&n.equals(i)?(insertText(f[0],"origin and destination are the identical"),t.latitude=n.lat(),t.longitude=n.lng(),o(e,t,r)):(u.origin=n,u.destination=i,r.setOptions(l),s=new b.maps.DirectionsRenderer,s.setMap(r),s.setPanel(d[0]),T.when(a(u)).fail(y).then(function(e){s.setDirections(e)
})):n||i?n?(insertText(f[0],"missing destination, only the provided origin is displayed"),t.latitude=n.lat(),t.longitude=n.lng(),o(e,t,r)):(insertText(f[0],"missing origin, only the provided destination is displayed"),t.latitude=i.lat(),t.longitude=i.lng(),o(e,t,r)):insertText(f[0],"error: neither origin or destination could be determined")
})}function c(){var t,r,n,i,a,o=M.orientation;-1!==T.inArray("ios",A.features)&&90===Math.abs(e.orientation||0)?(t=e.screen.height,r=e.screen.width):(t=e.screen.width,r=e.screen.height),n=e.innerWidth,i=e.innerHeight,a=n>i?"landscape":"portrait",T.extend(M,{screenX:t,screenY:r,windowX:n,windowY:i,orientation:a}),o&&o!==a&&(log("onOrientationChange(): rotated!"),updateCurrentConfig()),x.trigger("scroll")
}function u(){A.isOnline=_.onLine===!0,log("onNetworkChange(): online="+A.isOnline)
}function l(e){var t,r,n,i,a,o,s,c,u,l,p=T(e.target),f=p.data("action"),d="Check your network connectivity and try again.",g="Are you sure you wish to discard this pending record?",h="Submitting all records may take some time, continue?",y=function(e){var t,r=new T.Deferred,n=e.data("id"),i=n.split(":"),a=i[0],o=i[1],s=i[2];
return C.config["i"+a]?(t=C.config["i"+a].pertinent.name,p.prop("disabled",!0),T.when(M.pendingStore.get(a+":"+o+":"+s)).fail(function(){BMP.alert("Error: unable to retrieve this form"),p.prop("disabled",!1)
}).then(function(n){var i;if("string"!=typeof n||0===n.length)return p.prop("disabled",!1),void 0;
switch("object"!==T.type(n)&&(n=T.parseJSON(n)),T.type(n)){case"array":i=n[0];break;
case"object":i=n}e.addClass("s-working"),T.when(BlinkForms.submitData(t,o,i)).always(function(t,n,i){var c;
i&&"function"===T.type(i.promise)||(c=i,i=t,t=c),p.prop("disabled",!1),200===i.status&&t?M.store&&(clearPendingForm(a,o,s),e.remove()):e.toggleClass("s-working s-error"),r.resolve()
})}),r.promise()):(BMP.alert("Error: this record requires an Interaction that not currently available"),void 0)
};if("submit-all"===f){if(!A.isOnline)return BMP.alert(d,{title:"Forms Queue"}),void 0;
BMP.confirm(h,{title:"Forms Queue"}).then(function(e){e&&(n=new BlinkDispatch(197),r=p.closest(".box, .view"),r.find('[data-blink="active-form"][data-id]').each(function(e,t){n.add(function(){return y(T(t))
})}))})}else i=p.closest('[data-blink="active-form"]'),a=i.data("version"),o=i.data("id"),s=o.split(":"),c=s[0],u=s[1],l=s[2],2===a?"clear"===f?BMP.confirm(g,{title:"Forms Queue"}).then(function(e){e&&T.when(clearPendingForm(c,u,l)).then(function(){i.remove()
})}):"resume"===f?(t="/"+C.answerSpace+"/"+C.config["i"+c].pertinent.name+"/?_uuid="+l,m.pushState({m:currentMasterCategory,c:currentCategory,i:c,arguments:{pendingForm:o}},null,t)):"submit"===f&&y(i):1===a&&("clear"===f?BMP.confirm(g,{title:"Forms Queue"}).then(function(e){e&&T.when(clearPendingFormV1(c,l)).then(function(){i.remove()
})}):"submit"===f&&T.when(M.pendingV1Store.get(c+":"+l)).fail(function(){BMP.alert("Unable to retrieve record from storage.",{title:"Forms Queue"})
}).then(function(e){e=T.parseJSON(e),submitFormWithRetry(e)}))}function p(){return M.runningTasks++,T("#startUp").size()>0?!0:"number"==typeof M.activityIndicatorTimer?!0:(M.activityIndicatorTimer=setTimeout(function(){clearTimeout(M.activityIndicatorTimer),M.activityIndicatorTimer=null,T(M.activityIndicator).show()
},1e3),!0)}function f(){return M.runningTasks>0&&M.runningTasks--,0>=M.runningTasks&&(null!==M.activityIndicatorTimer&&clearTimeout(M.activityIndicatorTimer),M.activityIndicatorTimer=null,T(M.activityIndicator).hide()),!0
}function d(){var t=T("#startUp"),r=T("#masterCategoriesView"),n=T("#categoriesView"),i=T("#keywordListView"),a=C.queryParameters._t;
if(delete C.queryParameters._t,t.size()>0&&C.config!==void 0){switch((-1!==T.inArray("phone",A.features)||768>T(e).width())&&T("#mainLabel").remove(),currentConfig=C.config["a"+C.id].pertinent,C.config["a"+C.id].pertinent.siteStructure){case"interactions only":r.remove(),n.remove();
break;case"categories":r.remove(),i.find(".welcomeBox").remove();break;case"master categories":n.find(".welcomeBox").remove(),i.find(".welcomeBox").remove()
}T("#answerSpacesListView").remove(),M.gotoDefaultScreen(),T.when(restoreSessionProfile(a)).always(function(){var e,t=resolveItemName(C.queryParameters.keyword);
C.config["a"+C.id].pertinent,delete C.queryParameters.keyword,t&&!T.isEmptyObject(C.queryParameters)?(e="/"+C.answerSpace+"/"+C.config["i"+t].pertinent.name+"/?"+T.param(C.queryParameters),m.pushState({i:t,arguments:C.queryParameters},null,e)):t?(e="/"+C.answerSpace+"/"+C.config["i"+t].pertinent.name+"/?",m.pushState({i:t},null,e)):"string"==typeof C.queryParameters._c?(e="/"+C.answerSpace+"/?_c="+C.queryParameters._c,m.pushState({c:C.queryParameters._c},null,e)):"string"==typeof C.queryParameters._m&&(e="/"+C.answerSpace+"/?_m="+C.queryParameters._m,m.pushState({m:C.queryParameters._m},null,e)),delete C.queryParameters
})}t.remove(),T("#content").show(),setSubmitCachedFormButton(),processForms(),M.device.persistentStorage&&(M.dfrdMoJOs=processMoJOs())
}function g(){var e=M.device.persistentStorage;log("loaded():");try{e&&M.store.set("answerSpace",C.answerSpace),T.when(e?M.siteStore.get("config"):!0).then(function(e){"string"==typeof e&&(e=T.parseJSON(e)),"object"===T.type(e)&&(C.config=e)
}).always(function(){T.when(e?M.siteStore.get("map"):!0).then(function(e){"string"==typeof e&&(e=T.parseJSON(e)),"object"===T.type(e)&&(C.map=e)
}).always(function(){T.when(requestLoginStatus()).always(function(){T.when(requestConfig()).always(function(){C.map&&C.config?(processConfig(),d(),Modernizr.orientation&&x.on("orientationchange",c),x.on("resize",c),c()):k.append("error: unable to contact server, insufficient data found in local storage")
})})})}),T.when(e?M.store.get("starsProfile"):!0).then(function(e){"string"===T.type(e)&&(e=T.parseJSON(e)),"object"===T.type(e)&&(starsProfile=e)
}),T("#startUp-initLoaded").addClass("success")}catch(t){log("loaded(): exception:"),log(t),T("#startUp-initLoaded").addClass("error"),k.append("loading error: "+t)
}}function h(){var t,i,a=null,o=[],s=_.userAgent;if(log("init_main(): "),C.requestsCounter=0,PictureSourceType.PHOTO_LIBRARY=0,PictureSourceType.CAMERA=1,lastPictureTaken.image=new Hashtable,lastPictureTaken.currentName=null,T.fx.interval=27,M.dispatch=new BlinkDispatch(isBlinkGapDevice()?149:47),M.runningTasks=0,RegExp.quote=function(e){return e.replace(/([.?*+\^$\[\]\\(){}\-])/g,"\\$1")
},M.activityIndicator=S.getElementById("activityIndicator"),M.activityIndicatorTimer=null,M.$body.bind("taskBegun",p),M.$body.bind("taskComplete",f),M.$body.delegate('a:not([href="#"])',"click",onLinkClick),M.$body.delegate('a[href="#"]',"click",!1),M.$body.on("click",'[data-blink="active-form"] button',function(e){return e.preventDefault(),l(e),!1
}),_Blink.isPhantomJS||(x.bind("online",u),x.bind("offline",u),u()),isBlinkGapDevice()?(a=null,t=_.gap_database&&-1!==T.inArray("websqldatabase",BlinkStorage.prototype.available)?r():!0):-1!==s.indexOf("Android")&&(a="sessionstorage"),isBlinkGapDevice()&&M.device.domainWhitelist&&e.navigator.whitelistmanage&&(i=M.device.domainWhitelist,"array"===T.type(i))){log("BlinkGap: replacing domain whitelist...");
try{_.whitelistmanage.appendToWhitelist(T.noop,T.noop,{externalHosts:i})}catch(c){log("BlinkGap: domain whitelist error..."),error(c)
}log("BlinkGap: domain whitelist replaced!")}T.when(t).always(function(){if(M.device.persistentStorage)try{M.store=new BlinkStorage(a,C.answerSpace,"jstore"),o.push(M.store.ready()),M.siteStore=new BlinkStorage(a,C.answerSpace,"site"),o.push(M.siteStore.ready()),M.pendingStore=new BlinkStorage(null,C.answerSpace,"pending"),o.push(M.pendingStore.ready()),M.pendingV1Store=new BlinkStorage(null,C.answerSpace,"pendingV1"),o.push(M.pendingV1Store.ready())
}catch(e){return k.addClass("s-error"),T("#startUp-initMain").addClass("error"),e.toString&&k.children("output").text(""+e),k.children('article[data-name="persistentfull"]').show(),void 0
}T.whenArray(o).fail(function(){throw T("#startUp-initMain").addClass("error"),"initMain(): unable to initialise device storage"
}).then(function(){T.when(n()).always(function(){T("#startUp-initMain").addClass("success"),T("#startUp-initLoaded").addClass("working"),g(),log("loaded(): returned after call by BlinkStorage")
})}),log("init_main(): finished...")})}function y(){var r=T("#startUp");log("onBrowserReady: "+e.location.href);
try{m=e.History,v=m.pushState,m.pushState=function(){var e=T.makeArray(arguments);
e.length>=1&&(e[0]=i(e[0])),e.length>=3&&(e[2]=i(e[2])),v.apply(m,e)},w=m.replaceState,m.replaceState=function(){var e=T.makeArray(arguments);
e.length>=1&&(e[0]=i(e[0])),e.length>=3&&(e[2]=i(e[2])),w.apply(m,e)},log("domain="+C.serverDomain+" branch="+C.serverAppBranch+" version="+C.serverAppVersion+" device="+A.device),C.serverAppPath="/_"+C.serverAppBranch+"_/common/"+C.serverAppVersion,C.serverDevicePath="/_"+C.serverAppBranch+"_/"+A.device+"/"+C.serverAppVersion,C.queryParameters=getURLParameters(),delete C.queryParameters.uid,delete C.queryParameters.answerSpace,M.$html=T("html"),M.$body=M.$html.children("body"),M.$document=T(e.document),M.$window=x,M.$footer=M.$body.children("footer"),x.on("statechange",function(e){var t=m.getState(),r=t.data.arguments;
try{log("History.stateChange: "+T.param(t.data)+" "+t.url),"object"!==T.type(C.config)||T.isEmptyObject(currentConfig)?T.noop():t.data.storage?showPendingView():C.hasLogin&&t.data.login?showLoginView():hasInteractions&&t.data.i?T.isEmptyObject(r)||r.inputs?gotoNextScreen(t.data.i):showAnswerView(t.data.i,r):hasCategories&&t.data.c?showKeywordListView(t.data.c):hasMasterCategories&&t.data.m?showCategoriesView(t.data.m):hasMasterCategories?showMasterCategoriesView():hasCategories?showCategoriesView():answerSpaceOneKeyword?gotoNextScreen(C.map.interactions[0]):showKeywordListView()
}catch(n){n("Error in onStateChange handler...")}return e.preventDefault(),!1}),-1!==location.href.indexOf("index.php?answerSpace=")&&m.replaceState(null,null,"/"+C.answerSpace+"/"),null!==S.getElementById("loginButton")&&(C.hasLogin=!0),T.when(t()).then(function(){isBlinkGapDevice()&&"function"===T.type(onDeviceReady)&&onDeviceReady()
}).always(function(){M.browserDeferred.resolve()}),T("#startUp-initBrowser").addClass("success")
}catch(n){log("onBrowserReady: Exception"),log(n),r.append("browser error: "+n),T("#startUp-initBrowser").addClass("error")
}}var m,v,w,b,S=e.document,C=e.siteVars,A=e.deviceVars,M=e.MyAnswers,T=e.jQuery,k=T("#startUp"),_=e.navigator,x=T(e);
M.onGoogleMapsLoad=function(){setTimeout(function(){e.google!==void 0&&e.google.maps!==void 0&&e.google.maps.Map!==void 0?M.dfrdGoogleMaps.resolve():M.dfrdGoogleMaps.reject()
},197)},M.getGeoLocation=function(e){var t=new T.Deferred,r={enableHighAccuracy:!0,maximumAge:3e5,timeout:5e3};
return Modernizr.geolocation?(e=T.extend({},r,T.isPlainObject(e)?e:{}),_.geolocation.getCurrentPosition(function(e){var r;
e.coords?(r={latitude:e.coords.latitude,longitude:e.coords.longitude,altitude:e.coords.altitude,accuracy:e.coords.accuracy,altitudeAccuracy:e.coords.altitudeAccuracy,heading:e.coords.heading,speed:e.coords.speed},t.resolve(r)):t.reject("GeoLocation error: blank location from browser / device")
},function(e){var r;switch(e.code){case e.PERMISSION_DENIED:r="user has not granted permission";
break;case e.PERMISSION_DENIED_TIMEOUT:r="user did not grant permission in time";
break;case e.POSITION_UNAVAILABLE:r="unable to determine position";break;default:r="unknown error"
}t.reject("GeoLocation error: "+r)},e),t.promise()):(t.reject("GeoLocation error: unsupported in this browser / device"),t.promise())
},M.setupGoogleMaps=function(t){var r,n,i,a=t.find("div.googlemap").first(),c=a.data(),u=a[0];
M.$body.trigger("taskBegun"),b=e.google,r=new b.maps.Map(u),"directions"===c.mapAction?s(u,c,r):o(u,c,r),Modernizr.geolocation&&(n=new b.maps.Marker({map:r,icon:C.serverAppPath+"/images/location24.png",title:"you are here"}),i=new b.maps.InfoWindow,T.when(M.getGeoLocation()).then(function(e){n.setPosition(new b.maps.LatLng(e.latitude,e.longitude))
}),b.maps.event.addListener(n,"click",function(){i.setContent(n.getTitle()),i.open(r,n)
})),M.$body.trigger("taskComplete")},M.bootPromises=[M.deviceDeferred.promise(),M.browserDeferred.promise(),M.mainDeferred.promise()],T.whenArray(M.bootPromises).done(function(){log("all promises kept, initialising...");
try{T("#startUp-initMain").addClass("working"),h(),T("#startUp-initDevice").addClass("working"),init_device()
}catch(t){log("exception in init_?():"),log(t),k.append("initialisation error: "+t)
}log("User-Agent: "+e.navigator.userAgent),delete M.bootPromises,delete M.deviceDeferred,delete M.browserDeferred,delete M.mainDeferred
}).fail(function(){log("init failed, not all promises kept")}),T(S).ready(function(){var t,r=_.userAgent;
if(-1!==r.indexOf("Safari")&&e.localStorage){t="SafariTest-"+Math.random()*Math.pow(10,16);
try{e.localStorage.setItem(t,t),e.localStorage.removeItem(t)}catch(n){return k.addClass("s-error"),n.toString&&k.children("output").text(""+n),k.children('article[data-name="privatesafari"]').show(),void 0
}}T("#startUp-loadPolyFills").addClass("working"),T.ajaxPrefilter(function(e,t,r){var n=decodeURI(e.url),i={answerSpaceId:C.id,answerSpace:C.answerSpace,conditions:A.features};
n.length>100&&(n=n.substring(0,100)+"..."),r.setRequestHeader("X-Blink-Config",JSON.stringify(i)),r.setRequestHeader("X-Blink-Statistics",T.param({requests:++C.requestsCounter})),e.cache="true",log("AJAX start: "+n)
}),T.getScripts=function(e){var t=new T.Deferred;return"array"!==T.type(e)?t.reject():e.length?T.getCachedScript(e.shift()).fail(t.reject).then(function(){T.getScripts(e).fail(t.reject).then(t.resolve)
}):t.resolve(),t.promise()},T.when(M.mainDeferred.promise()).then(function(){var t,r,n=new T.Deferred;
t=e.JSON&&e.JSON.stringify?!0:T.getCachedScript(_Blink.cdnp.getURL("json2.min.js")),e.XSLTProcessor&&Modernizr.xpath?(log("XPath supported natively"),n.resolve()):e.xpathParse?(log("XPath supported via AJAXSLT"),n.resolve()):T.getScripts([_Blink.cdnp.getURL("ajaxslt/0.8.1-r61/xmltoken.min.js"),_Blink.cdnp.getURL("ajaxslt/0.8.1-r61/util.min.js"),_Blink.cdnp.getURL("ajaxslt/0.8.1-r61/dom.min.js"),_Blink.cdnp.getURL("ajaxslt/0.8.1-r61/xpath.min.js")]).fail(n.reject).then(n.resolve),e.XSLTProcessor?(log("XSLT supported natively"),r=!0):e.xsltProcess?(log("XSLT supported via AJAXSLT"),r=!0):r=n.pipe(function(){return T.getCachedScript(_Blink.cdnp.getURL("ajaxslt/0.8.1-r61/xslt.min.js"))
}),T.when(t,n.promise(),r).fail(function(){T("#startUp-loadPolyFills").addClass("error"),T("#startUp").append("<p>error: refresh the application or clear cache and try again</p>")
}).then(function(){T("#startUp-loadPolyFills").addClass("success"),T("#startUp-initBrowser").addClass("working"),setTimeout(y,e.device?2e3:193)
})})})}(this),document.getElementById("startUp-loadMain").className="working success",MyAnswers.mainDeferred.resolve();

//@ sourceMappingURL=/_R_/ios/3/bic2.js.map